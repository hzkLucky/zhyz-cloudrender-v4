const LOADING="loading",FAIL="fail",NOTIFACTION_RENDER="notifactionRender";var global$d,hasRequiredGlobal,commonjsGlobal="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function getDefaultExportFromCjs(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function getAugmentedNamespace(r){var a,e=r.default;return"function"==typeof e?(a=function(){return e.apply(this,arguments)}).prototype=e.prototype:a={},Object.defineProperty(a,"__esModule",{value:!0}),Object.keys(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(a,e,t.get?t:{enumerable:!0,get:function(){return r[e]}})}),a}function requireGlobal(){var t;return hasRequiredGlobal||(hasRequiredGlobal=1,t=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")},global$d=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return t()}try{return __global__?__global__:t()}finally{delete Object.prototype.__global__}}()),global$d}var _globalThis$1,name$1="websocket",description$1="Websocket Client & Server Library implementing the WebSocket protocol as specified in RFC 6455.",keywords$1=["websocket","websockets","socket","networking","comet","push","RFC-6455","realtime","server","client"],author$1="Brian McKelvey <theturtle32@gmail.com> (https://github.com/theturtle32)",contributors=["Iñaki Baz Castillo <ibc@aliax.net> (http://dev.sipdoc.net)"],version$5="1.0.34",repository$1={type:"git",url:"https://github.com/theturtle32/WebSocket-Node.git"},homepage$1="https://github.com/theturtle32/WebSocket-Node",engines$1={node:">=4.0.0"},dependencies$1={bufferutil:"^4.0.1",debug:"^2.2.0","es5-ext":"^0.10.50","typedarray-to-buffer":"^3.1.5","utf-8-validate":"^5.0.2",yaeti:"^0.0.6"},devDependencies$1={"buffer-equal":"^1.0.0",gulp:"^4.0.2","gulp-jshint":"^2.0.4","jshint-stylish":"^2.2.1",jshint:"^2.0.0",tape:"^4.9.1"},config$1={verbose:!1},scripts$1={test:"tape test/unit/*.js",gulp:"gulp"},main$1="index",directories={lib:"./lib"},browser$3="lib/browser.js",license$1="Apache-2.0",__npminstall_done$1=!0,_from$1="websocket@1.0.34",_resolved$1="https://registry.npmmirror.com/websocket/-/websocket-1.0.34.tgz",require$$0$2={name:name$1,description:description$1,keywords:keywords$1,author:author$1,contributors:contributors,version:version$5,repository:repository$1,homepage:homepage$1,engines:engines$1,dependencies:dependencies$1,devDependencies:devDependencies$1,config:config$1,scripts:scripts$1,main:main$1,directories:directories,browser:browser$3,license:license$1,__npminstall_done:__npminstall_done$1,_from:_from$1,_resolved:_resolved$1},version$4=require$$0$2.version;if("object"==typeof globalThis)_globalThis$1=globalThis;else try{_globalThis$1=requireGlobal()}catch(e){}finally{if(!(_globalThis$1=_globalThis$1||"undefined"==typeof window?_globalThis$1:window))throw new Error("Could not determine global this")}var NativeWebSocket=_globalThis$1.WebSocket||_globalThis$1.MozWebSocket,websocket_version=version$4;function W3CWebSocket$1(e,t){t=t?new NativeWebSocket(e,t):new NativeWebSocket(e);return t}NativeWebSocket&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(W3CWebSocket$1,e,{get:function(){return NativeWebSocket[e]}})});var browser$2={w3cwebsocket:NativeWebSocket?W3CWebSocket$1:null,version:websocket_version};class websocket{constructor(e,t){this.global_callback=t&&"function"==typeof t?t:null,this.lockReconnect=!1,this.initWebSocket(e,t)}initWebSocket(e,t){this.websock=new browser$2.w3cwebsocket(e),this.websock.onopen=()=>{t(JSON.stringify({msg:"连接成功"}))},this.websock.onerror=()=>{this.lockReconnect||(this.lockReconnect=!0,setTimeout(()=>{new websocket(e,t),this.lockReconnect=!1},2e3))},this.websock.onmessage=e=>{this.websocketOnMessage(e)},this.websock.onclose=()=>{this.websocketclose()}}sendSock(e,t){t&&("function"==typeof t?this.global_callback=t:(this.global_callback=e=>{},alert("sendSock，传参没有回调"))),this.websock.readyState===this.websock.OPEN?this.websock.send(e):setTimeout(()=>{this.sendSock(e)},1e3)}websocketclose(){this.websock.close(),this.global_callback=null}websocketOnMessage(e){try{this.global_callback(e.data)}catch(e){}}}var global$c=void 0!==global$b?global$b:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},global$b=void 0!==global$c?global$c:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}var cachedSetTimeout=defaultSetTimout,cachedClearTimeout=defaultClearTimeout;function runTimeout(t){if(cachedSetTimeout===setTimeout)return setTimeout(t,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return(cachedSetTimeout=setTimeout)(t,0);try{return cachedSetTimeout(t,0)}catch(e){try{return cachedSetTimeout.call(null,t,0)}catch(e){return cachedSetTimeout.call(this,t,0)}}}function runClearTimeout(t){if(cachedClearTimeout===clearTimeout)return clearTimeout(t);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return(cachedClearTimeout=clearTimeout)(t);try{return cachedClearTimeout(t)}catch(e){try{return cachedClearTimeout.call(null,t)}catch(e){return cachedClearTimeout.call(this,t)}}}"function"==typeof global$b.setTimeout&&(cachedSetTimeout=setTimeout),"function"==typeof global$b.clearTimeout&&(cachedClearTimeout=clearTimeout);var currentQueue,queue$1=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue$1=currentQueue.concat(queue$1):queueIndex=-1,queue$1.length)&&drainQueue()}function drainQueue(){if(!draining){for(var e=runTimeout(cleanUpNextTick),t=(draining=!0,queue$1.length);t;){for(currentQueue=queue$1,queue$1=[];++queueIndex<t;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,t=queue$1.length}currentQueue=null,draining=!1,runClearTimeout(e)}}function nextTick$1(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];queue$1.push(new Item(e,t)),1!==queue$1.length||draining||runTimeout(drainQueue)}function Item(e,t){this.fun=e,this.array=t}Item.prototype.run=function(){this.fun.apply(null,this.array)};var title="browser",platform="browser",browser$1=!0,env={},argv=[],version$3="",versions$1={},release={},config={};function noop(){}var on=noop,addListener=noop,once=noop,off=noop,removeListener=noop,removeAllListeners=noop,emit=noop;function binding(e){throw new Error("process.binding is not supported")}function cwd(){return"/"}function chdir(e){throw new Error("process.chdir is not supported")}function umask(){return 0}var performance=global$b.performance||{},performanceNow=performance.now||performance.mozNow||performance.msNow||performance.oNow||performance.webkitNow||function(){return(new Date).getTime()};function hrtime(e){var t=.001*performanceNow.call(performance),r=Math.floor(t),t=Math.floor(t%1*1e9);return e&&(r-=e[0],(t-=e[1])<0)&&(r--,t+=1e9),[r,t]}var startTime=new Date;function uptime(){return(new Date-startTime)/1e3}var _a,process$1={nextTick:nextTick$1,title:title,browser:browser$1,env:env,argv:argv,version:version$3,versions:versions$1,on:on,addListener:addListener,once:once,off:off,removeListener:removeListener,removeAllListeners:removeAllListeners,emit:emit,binding:binding,cwd:cwd,chdir:chdir,umask:umask,hrtime:hrtime,platform:platform,release:release,config:config,uptime:uptime};function makeMap(e,t){const r=Object.create(null);var a=e.split(",");for(let e=0;e<a.length;e++)r[a[e]]=!0;return t?e=>!!r[e.toLowerCase()]:e=>!!r[e]}const GLOBALS_WHITE_LISTED="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt",isGloballyWhitelisted=makeMap(GLOBALS_WHITE_LISTED);function normalizeStyle(t){if(isArray$2(t)){var r={};for(let e=0;e<t.length;e++){var a=t[e],n=(isString(a)?parseStringStyle:normalizeStyle)(a);if(n)for(const o in n)r[o]=n[o]}return r}return isString(t)||isObject$7(t)?t:void 0}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*.*?\*\//gs;function parseStringStyle(e){const t={};return e.replace(styleCommentRE,"").split(listDelimiterRE).forEach(e=>{e&&1<(e=e.split(propertyDelimiterRE)).length&&(t[e[0].trim()]=e[1].trim())}),t}function normalizeClass(t){let r="";if(isString(t))r=t;else if(isArray$2(t))for(let e=0;e<t.length;e++){var a=normalizeClass(t[e]);a&&(r+=a+" ")}else if(isObject$7(t))for(const e in t)t[e]&&(r+=e+" ");return r.trim()}const HTML_TAGS="html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot",SVG_TAGS="svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistanceLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view",VOID_TAGS="area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr",specialBooleanAttrs=(makeMap(HTML_TAGS),makeMap(SVG_TAGS),makeMap(VOID_TAGS),"itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly"),isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(e){return!!e||""===e}makeMap(specialBooleanAttrs+",async,autofocus,autoplay,controls,default,defer,disabled,hidden,loop,open,required,reversed,scoped,seamless,checked,muted,multiple,selected"),makeMap("accept,accept-charset,accesskey,action,align,allow,alt,async,autocapitalize,autocomplete,autofocus,autoplay,background,bgcolor,border,buffered,capture,challenge,charset,checked,cite,class,code,codebase,color,cols,colspan,content,contenteditable,contextmenu,controls,coords,crossorigin,csp,data,datetime,decoding,default,defer,dir,dirname,disabled,download,draggable,dropzone,enctype,enterkeyhint,for,form,formaction,formenctype,formmethod,formnovalidate,formtarget,headers,height,hidden,high,href,hreflang,http-equiv,icon,id,importance,integrity,ismap,itemprop,keytype,kind,label,lang,language,loading,list,loop,low,manifest,max,maxlength,minlength,media,min,multiple,muted,name,novalidate,open,optimum,pattern,ping,placeholder,poster,preload,radiogroup,readonly,referrerpolicy,rel,required,reversed,rows,rowspan,sandbox,scope,scoped,selected,shape,size,sizes,slot,span,spellcheck,src,srcdoc,srclang,srcset,start,step,style,summary,tabindex,target,title,translate,type,usemap,value,width,wrap"),makeMap("xmlns,accent-height,accumulate,additive,alignment-baseline,alphabetic,amplitude,arabic-form,ascent,attributeName,attributeType,azimuth,baseFrequency,baseline-shift,baseProfile,bbox,begin,bias,by,calcMode,cap-height,class,clip,clipPathUnits,clip-path,clip-rule,color,color-interpolation,color-interpolation-filters,color-profile,color-rendering,contentScriptType,contentStyleType,crossorigin,cursor,cx,cy,d,decelerate,descent,diffuseConstant,direction,display,divisor,dominant-baseline,dur,dx,dy,edgeMode,elevation,enable-background,end,exponent,fill,fill-opacity,fill-rule,filter,filterRes,filterUnits,flood-color,flood-opacity,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,format,from,fr,fx,fy,g1,g2,glyph-name,glyph-orientation-horizontal,glyph-orientation-vertical,glyphRef,gradientTransform,gradientUnits,hanging,height,href,hreflang,horiz-adv-x,horiz-origin-x,id,ideographic,image-rendering,in,in2,intercept,k,k1,k2,k3,k4,kernelMatrix,kernelUnitLength,kerning,keyPoints,keySplines,keyTimes,lang,lengthAdjust,letter-spacing,lighting-color,limitingConeAngle,local,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mask,maskContentUnits,maskUnits,mathematical,max,media,method,min,mode,name,numOctaves,offset,opacity,operator,order,orient,orientation,origin,overflow,overline-position,overline-thickness,panose-1,paint-order,path,pathLength,patternContentUnits,patternTransform,patternUnits,ping,pointer-events,points,pointsAtX,pointsAtY,pointsAtZ,preserveAlpha,preserveAspectRatio,primitiveUnits,r,radius,referrerPolicy,refX,refY,rel,rendering-intent,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,result,rotate,rx,ry,scale,seed,shape-rendering,slope,spacing,specularConstant,specularExponent,speed,spreadMethod,startOffset,stdDeviation,stemh,stemv,stitchTiles,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,string,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,style,surfaceScale,systemLanguage,tabindex,tableValues,target,targetX,targetY,text-anchor,text-decoration,text-rendering,textLength,to,transform,transform-origin,type,u1,u2,underline-position,underline-thickness,unicode,unicode-bidi,unicode-range,units-per-em,v-alphabetic,v-hanging,v-ideographic,v-mathematical,values,vector-effect,version,vert-adv-y,vert-origin-x,vert-origin-y,viewBox,viewTarget,visibility,width,widths,word-spacing,writing-mode,x,x-height,x1,x2,xChannelSelector,xlink:actuate,xlink:arcrole,xlink:href,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,y,y1,y2,yChannelSelector,z,zoomAndPan");const EMPTY_OBJ="production"!==process$1.env.NODE_ENV?Object.freeze({}):{},NOOP=("production"!==process$1.env.NODE_ENV&&Object.freeze([]),()=>{}),onRE=/^on[^a-z]/,isOn=e=>onRE.test(e),isModelListener=e=>e.startsWith("onUpdate:"),extend=Object.assign,remove=(e,t)=>{t=e.indexOf(t);-1<t&&e.splice(t,1)},hasOwnProperty$1=Object.prototype.hasOwnProperty,hasOwn$7=(e,t)=>hasOwnProperty$1.call(e,t),isArray$2=Array.isArray,isMap=e=>"[object Map]"===toTypeString(e),isSet=e=>"[object Set]"===toTypeString(e),isFunction$1=e=>"function"==typeof e,isString=e=>"string"==typeof e,isSymbol$3=e=>"symbol"==typeof e,isObject$7=e=>null!==e&&"object"==typeof e,isPromise$1=e=>isObject$7(e)&&isFunction$1(e.then)&&isFunction$1(e.catch),objectToString=Object.prototype.toString,toTypeString=e=>objectToString.call(e),toRawType=e=>toTypeString(e).slice(8,-1),isPlainObject=e=>"[object Object]"===toTypeString(e),isIntegerKey=e=>isString(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e,cacheStringFunction=(makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),makeMap("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo"),t=>{const r=Object.create(null);return e=>{return r[e]||(r[e]=t(e))}}),camelizeRE=/-(\w)/g,camelize=cacheStringFunction(e=>e.replace(camelizeRE,(e,t)=>t?t.toUpperCase():"")),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(e=>e.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(e=>e.charAt(0).toUpperCase()+e.slice(1)),toHandlerKey=cacheStringFunction(e=>e?"on"+capitalize(e):""),hasChanged=(e,t)=>!Object.is(e,t),def=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},toNumber=e=>{var t=parseFloat(e);return isNaN(t)?e:t};let _globalThis;const getGlobalThis=()=>_globalThis=_globalThis||("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==global$b?global$b:{});function warn$1(e,...t){console.warn("[Vue warn] "+e,...t)}let activeEffectScope;class EffectScope{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=activeEffectScope,!e&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}run(e){if(this.active){var t=activeEffectScope;try{return activeEffectScope=this,e()}finally{activeEffectScope=t}}else"production"!==process$1.env.NODE_ENV&&warn$1("cannot run an inactive effect scope.")}on(){activeEffectScope=this}off(){activeEffectScope=this.parent}stop(r){if(this.active){let e,t;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].stop();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);this.detached||!this.parent||r||(r=this.parent.scopes.pop())&&r!==this&&((this.parent.scopes[this.index]=r).index=this.index),this.parent=void 0,this.active=!1}}}function effectScope(e){return new EffectScope(e)}function recordEffectScope(e,t=activeEffectScope){t&&t.active&&t.effects.push(e)}const createDep=e=>{e=new Set(e);return e.w=0,e.n=0,e},wasTracked=e=>0<(e.w&trackOpBit),newTracked=e=>0<(e.n&trackOpBit),initDepMarkers=({deps:t})=>{if(t.length)for(let e=0;e<t.length;e++)t[e].w|=trackOpBit},finalizeDepMarkers=r=>{var a=r["deps"];if(a.length){let t=0;for(let e=0;e<a.length;e++){var n=a[e];wasTracked(n)&&!newTracked(n)?n.delete(r):a[t++]=n,n.w&=~trackOpBit,n.n&=~trackOpBit}a.length=t}},targetMap=new WeakMap;let effectTrackDepth=0,trackOpBit=1;const maxMarkerBits=30;let activeEffect;const ITERATE_KEY=Symbol("production"!==process$1.env.NODE_ENV?"iterate":""),MAP_KEY_ITERATE_KEY=Symbol("production"!==process$1.env.NODE_ENV?"Map key iterate":"");class ReactiveEffect{constructor(e,t=null,r){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,recordEffectScope(this,r)}run(){if(!this.active)return this.fn();let e=activeEffect;for(var t=shouldTrack;e;){if(e===this)return;e=e.parent}try{return this.parent=activeEffect,activeEffect=this,shouldTrack=!0,trackOpBit=1<<++effectTrackDepth,(effectTrackDepth<=maxMarkerBits?initDepMarkers:cleanupEffect)(this),this.fn()}finally{effectTrackDepth<=maxMarkerBits&&finalizeDepMarkers(this),trackOpBit=1<<--effectTrackDepth,activeEffect=this.parent,shouldTrack=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){activeEffect===this?this.deferStop=!0:this.active&&(cleanupEffect(this),this.onStop&&this.onStop(),this.active=!1)}}function cleanupEffect(t){var r=t["deps"];if(r.length){for(let e=0;e<r.length;e++)r[e].delete(t);r.length=0}}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){var e=trackStack.pop();shouldTrack=void 0===e||e}function track(r,a,n){if(shouldTrack&&activeEffect){let e=targetMap.get(r),t=(e||targetMap.set(r,e=new Map),e.get(n));t||e.set(n,t=createDep());r="production"!==process$1.env.NODE_ENV?{effect:activeEffect,target:r,type:a,key:n}:void 0;trackEffects(t,r)}}function trackEffects(e,t){let r=!1;effectTrackDepth<=maxMarkerBits?newTracked(e)||(e.n|=trackOpBit,r=!wasTracked(e)):r=!e.has(activeEffect),r&&(e.add(activeEffect),activeEffect.deps.push(e),"production"!==process$1.env.NODE_ENV)&&activeEffect.onTrack&&activeEffect.onTrack(Object.assign({effect:activeEffect},t))}function trigger(e,t,a,n,o,i){var s=targetMap.get(e);if(s){let r=[];if("clear"===t)r=[...s.values()];else if("length"===a&&isArray$2(e)){const d=toNumber(n);s.forEach((e,t)=>{("length"===t||t>=d)&&r.push(e)})}else switch(void 0!==a&&r.push(s.get(a)),t){case"add":isArray$2(e)?isIntegerKey(a)&&r.push(s.get("length")):(r.push(s.get(ITERATE_KEY)),isMap(e)&&r.push(s.get(MAP_KEY_ITERATE_KEY)));break;case"delete":isArray$2(e)||(r.push(s.get(ITERATE_KEY)),isMap(e)&&r.push(s.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(e)&&r.push(s.get(ITERATE_KEY))}t="production"!==process$1.env.NODE_ENV?{target:e,type:t,key:a,newValue:n,oldValue:o,oldTarget:i}:void 0;if(1===r.length)r[0]&&("production"!==process$1.env.NODE_ENV?triggerEffects(r[0],t):triggerEffects(r[0]));else{var c=[];for(const l of r)l&&c.push(...l);"production"!==process$1.env.NODE_ENV?triggerEffects(createDep(c),t):triggerEffects(createDep(c))}}}function triggerEffects(e,t){e=isArray$2(e)?e:[...e];for(const r of e)r.computed&&triggerEffect(r,t);for(const a of e)a.computed||triggerEffect(a,t)}function triggerEffect(e,t){e===activeEffect&&!e.allowRecurse||("production"!==process$1.env.NODE_ENV&&e.onTrigger&&e.onTrigger(extend({effect:e},t)),e.scheduler?e.scheduler():e.run())}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>"arguments"!==e&&"caller"!==e).map(e=>Symbol[e]).filter(isSymbol$3)),get$1=createGetter(),shallowGet=createGetter(!1,!0),readonlyGet=createGetter(!0),shallowReadonlyGet=createGetter(!0,!0),arrayInstrumentations=createArrayInstrumentations();function createArrayInstrumentations(){const e={};return["includes","indexOf","lastIndexOf"].forEach(a=>{e[a]=function(...e){var r=toRaw(this);for(let e=0,t=this.length;e<t;e++)track(r,"get",e+"");var t=r[a](...e);return-1===t||!1===t?r[a](...e.map(toRaw)):t}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...e){pauseTracking();e=toRaw(this)[t].apply(this,e);return resetTracking(),e}}),e}function createGetter(n=!1,o=!1){return function(e,t,r){var a;return"__v_isReactive"===t?!n:"__v_isReadonly"===t?n:"__v_isShallow"===t?o:"__v_raw"===t&&r===(n?o?shallowReadonlyMap:readonlyMap:o?shallowReactiveMap:reactiveMap).get(e)?e:(a=isArray$2(e),!n&&a&&hasOwn$7(arrayInstrumentations,t)?Reflect.get(arrayInstrumentations,t,r):(r=Reflect.get(e,t,r),(isSymbol$3(t)?builtInSymbols.has(t):isNonTrackableKeys(t))||(n||track(e,"get",t),o)?r:isRef(r)?a&&isIntegerKey(t)?r:r.value:isObject$7(r)?(n?readonly:reactive)(r):r))}}const set$1=createSetter(),shallowSet=createSetter(!0);function createSetter(s=!1){return function(e,t,r,a){let n=e[t];var o,i;return!(isReadonly(n)&&isRef(n)&&!isRef(r))&&(s||(isShallow$1(r)||isReadonly(r)||(n=toRaw(n),r=toRaw(r)),isArray$2(e))||!isRef(n)||isRef(r)?(o=isArray$2(e)&&isIntegerKey(t)?Number(t)<e.length:hasOwn$7(e,t),i=Reflect.set(e,t,r,a),e===toRaw(a)&&(o?hasChanged(r,n)&&trigger(e,"set",t,r,n):trigger(e,"add",t,r)),i):(n.value=r,!0))}}function deleteProperty(e,t){var r=hasOwn$7(e,t),a=e[t],n=Reflect.deleteProperty(e,t);return n&&r&&trigger(e,"delete",t,void 0,a),n}function has$1(e,t){var r=Reflect.has(e,t);return isSymbol$3(t)&&builtInSymbols.has(t)||track(e,"has",t),r}function ownKeys$2(e){return track(e,"iterate",isArray$2(e)?"length":ITERATE_KEY),Reflect.ownKeys(e)}const mutableHandlers={get:get$1,set:set$1,deleteProperty:deleteProperty,has:has$1,ownKeys:ownKeys$2},readonlyHandlers={get:readonlyGet,set(e,t){return"production"!==process$1.env.NODE_ENV&&warn$1(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return"production"!==process$1.env.NODE_ENV&&warn$1(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},shallowReadonlyHandlers=(extend({},mutableHandlers,{get:shallowGet,set:shallowSet}),extend({},readonlyHandlers,{get:shallowReadonlyGet})),toShallow=e=>e,getProto=e=>Reflect.getPrototypeOf(e);function get$1$1(e,t,r=!1,a=!1){var n=toRaw(e=e.__v_raw),o=toRaw(t),i=(r||(t!==o&&track(n,"get",t),track(n,"get",o)),getProto(n))["has"],a=a?toShallow:r?toReadonly:toReactive;return i.call(n,t)?a(e.get(t)):i.call(n,o)?a(e.get(o)):void(e!==n&&e.get(t))}function has$1$1(e,t=!1){var r=this.__v_raw,a=toRaw(r),n=toRaw(e);return t||(e!==n&&track(a,"has",e),track(a,"has",n)),e===n?r.has(e):r.has(e)||r.has(n)}function size(e,t=!1){return e=e.__v_raw,t||track(toRaw(e),"iterate",ITERATE_KEY),Reflect.get(e,"size",e)}function add(e){e=toRaw(e);var t=toRaw(this);return getProto(t).has.call(t,e)||(t.add(e),trigger(t,"add",e,e)),this}function set$1$1(e,t){t=toRaw(t);var r=toRaw(this),{has:a,get:n}=getProto(r);let o=a.call(r,e);o?"production"!==process$1.env.NODE_ENV&&checkIdentityKeys(r,a,e):(e=toRaw(e),o=a.call(r,e));a=n.call(r,e);return r.set(e,t),o?hasChanged(t,a)&&trigger(r,"set",e,t,a):trigger(r,"add",e,t),this}function deleteEntry(e){var t=toRaw(this),{has:r,get:a}=getProto(t);let n=r.call(t,e);n?"production"!==process$1.env.NODE_ENV&&checkIdentityKeys(t,r,e):(e=toRaw(e),n=r.call(t,e));r=a?a.call(t,e):void 0,a=t.delete(e);return n&&trigger(t,"delete",e,void 0,r),a}function clear(){var e=toRaw(this),t=0!==e.size,r="production"!==process$1.env.NODE_ENV?new(isMap(e)?Map:Set)(e):void 0,a=e.clear();return t&&trigger(e,"clear",void 0,void 0,r),a}function createForEach(i,s){return function(r,a){const n=this;var e=n.__v_raw,t=toRaw(e);const o=s?toShallow:i?toReadonly:toReactive;return i||track(t,"iterate",ITERATE_KEY),e.forEach((e,t)=>r.call(a,o(e),o(t),n))}}function createIterableMethod(s,c,d){return function(...e){var t=this.__v_raw,r=toRaw(t),a=isMap(r);const n="entries"===s||s===Symbol.iterator&&a;a="keys"===s&&a;const o=t[s](...e),i=d?toShallow:c?toReadonly:toReactive;return c||track(r,"iterate",a?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){var{value:e,done:t}=o.next();return t?{value:e,done:t}:{value:n?[i(e[0]),i(e[1])]:i(e),done:t}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(t){return function(...e){return"production"!==process$1.env.NODE_ENV&&(e=e[0]?`on key "${e[0]}" `:"",console.warn(capitalize(t)+` operation ${e}failed: target is readonly.`,toRaw(this))),"delete"!==t&&this}}function createInstrumentations(){const t={get(e){return get$1$1(this,e)},get size(){return size(this)},has:has$1$1,add:add,set:set$1$1,delete:deleteEntry,clear:clear,forEach:createForEach(!1,!1)},r={get(e){return get$1$1(this,e,!1,!0)},get size(){return size(this)},has:has$1$1,add:add,set:set$1$1,delete:deleteEntry,clear:clear,forEach:createForEach(!1,!0)},a={get(e){return get$1$1(this,e,!0)},get size(){return size(this,!0)},has(e){return has$1$1.call(this,e,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!1)},n={get(e){return get$1$1(this,e,!0,!0)},get size(){return size(this,!0)},has(e){return has$1$1.call(this,e,!0)},add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear"),forEach:createForEach(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(e=>{t[e]=createIterableMethod(e,!1,!1),a[e]=createIterableMethod(e,!0,!1),r[e]=createIterableMethod(e,!1,!0),n[e]=createIterableMethod(e,!0,!0)}),[t,a,r,n]}const[mutableInstrumentations,readonlyInstrumentations,shallowInstrumentations,shallowReadonlyInstrumentations]=createInstrumentations();function createInstrumentationGetter(a,e){const n=e?a?shallowReadonlyInstrumentations:shallowInstrumentations:a?readonlyInstrumentations:mutableInstrumentations;return(e,t,r)=>"__v_isReactive"===t?!a:"__v_isReadonly"===t?a:"__v_raw"===t?e:Reflect.get(hasOwn$7(n,t)&&t in e?n:e,t,r)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)};function checkIdentityKeys(e,t,r){var a=toRaw(r);a!==r&&t.call(e,a)&&(r=toRawType(e),console.warn(`Reactive ${r} contains both the raw and reactive `+`versions of the same object${"Map"===r?" as keys":""}, `+"which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible."))}const reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(e){switch(e){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(e){return e.__v_skip||!Object.isExtensible(e)?0:targetTypeMap(toRawType(e))}function reactive(e){return isReadonly(e)?e:createReactiveObject(e,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function readonly(e){return createReactiveObject(e,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(e){return createReactiveObject(e,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(e,t,r,a,n){return isObject$7(e)?!e.__v_raw||t&&e.__v_isReactive?n.get(e)||(0===(t=getTargetType(e))?e:(t=new Proxy(e,2===t?a:r),n.set(e,t),t)):e:("production"!==process$1.env.NODE_ENV&&console.warn("value cannot be made reactive: "+String(e)),e)}function isReactive(e){return isReadonly(e)?isReactive(e.__v_raw):!(!e||!e.__v_isReactive)}function isReadonly(e){return!(!e||!e.__v_isReadonly)}function isShallow$1(e){return!(!e||!e.__v_isShallow)}function isProxy(e){return isReactive(e)||isReadonly(e)}function toRaw(e){var t=e&&e.__v_raw;return t?toRaw(t):e}function markRaw(e){return def(e,"__v_skip",!0),e}const toReactive=e=>isObject$7(e)?reactive(e):e,toReadonly=e=>isObject$7(e)?readonly(e):e;function trackRefValue(e){shouldTrack&&activeEffect&&(e=toRaw(e),"production"!==process$1.env.NODE_ENV?trackEffects(e.dep||(e.dep=createDep()),{target:e,type:"get",key:"value"}):trackEffects(e.dep||(e.dep=createDep())))}function triggerRefValue(e,t){(e=toRaw(e)).dep&&("production"!==process$1.env.NODE_ENV?triggerEffects(e.dep,{target:e,type:"set",key:"value",newValue:t}):triggerEffects(e.dep))}function isRef(e){return!(!e||!0!==e.__v_isRef)}function unref(e){return isRef(e)?e.value:e}const shallowUnwrapHandlers={get:(e,t,r)=>unref(Reflect.get(e,t,r)),set:(e,t,r,a)=>{var n=e[t];return isRef(n)&&!isRef(r)?(n.value=r,!0):Reflect.set(e,t,r,a)}};function proxyRefs(e){return isReactive(e)?e:new Proxy(e,shallowUnwrapHandlers)}class ComputedRefImpl{constructor(e,t,r,a){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[_a]=!1,this._dirty=!0,this.effect=new ReactiveEffect(e,()=>{this._dirty||(this._dirty=!0,triggerRefValue(this))}),(this.effect.computed=this).effect.active=this._cacheable=!a,this.__v_isReadonly=r}get value(){var e=toRaw(this);return trackRefValue(e),!e._dirty&&e._cacheable||(e._dirty=!1,e._value=e.effect.run()),e._value}set value(e){this._setter(e)}}function computed$1(e,t,r=!1){let a,n;var o=isFunction$1(e),e=(n=o?(a=e,"production"!==process$1.env.NODE_ENV?()=>{console.warn("Write operation failed: computed value is readonly")}:NOOP):(a=e.get,e.set),new ComputedRefImpl(a,n,o||!n,r));return"production"!==process$1.env.NODE_ENV&&t&&!r&&(e.effect.onTrack=t.onTrack,e.effect.onTrigger=t.onTrigger),e}_a="__v_isReadonly",Promise.resolve();const stack=[];function pushWarningContext(e){stack.push(e)}function popWarningContext(){stack.pop()}function warn(e,...t){if("production"!==process$1.env.NODE_ENV){pauseTracking();const n=stack.length?stack[stack.length-1].component:null;var r=n&&n.appContext.config.warnHandler,a=getComponentTrace();r?callWithErrorHandling(r,n,11,[e+t.join(""),n&&n.proxy,a.map(({vnode:e})=>`at <${formatComponentName(n,e.type)}>`).join("\n"),a]):(r=["[Vue warn]: "+e,...t],a.length&&r.push(`
`,...formatTrace(a)),console.warn(...r)),resetTracking()}}function getComponentTrace(){let e=stack[stack.length-1];if(!e)return[];for(var t=[];e;){var r=t[0],r=(r&&r.vnode===e?r.recurseCount++:t.push({vnode:e,recurseCount:0}),e.component&&e.component.parent);e=r&&r.vnode}return t}function formatTrace(e){const r=[];return e.forEach((e,t)=>{r.push(...0===t?[]:[`
`],...formatTraceEntry(e))}),r}function formatTraceEntry({vnode:e,recurseCount:t}){var t=0<t?`... (${t} recursive calls)`:"",r=!!e.component&&null==e.component.parent,r=" at <"+formatComponentName(e.component,e.type,r),t=">"+t;return e.props?[r,...formatProps(e.props),t]:[r+t]}function formatProps(t){const r=[];var e=Object.keys(t);return e.slice(0,3).forEach(e=>{r.push(...formatProp(e,t[e]))}),3<e.length&&r.push(" ..."),r}function formatProp(e,t,r){return isString(t)?(t=JSON.stringify(t),r?t:[e+"="+t]):"number"==typeof t||"boolean"==typeof t||null==t?r?t:[e+"="+t]:isRef(t)?(t=formatProp(e,toRaw(t.value),!0),r?t:[e+"=Ref<",t,">"]):isFunction$1(t)?[e+"=fn"+(t.name?`<${t.name}>`:"")]:(t=toRaw(t),r?t:[e+"=",t])}const ErrorTypeStrings={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",[0]:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush. This is likely a Vue internals bug. Please open an issue at https://new-issue.vuejs.org/?repo=vuejs/core"};function callWithErrorHandling(e,t,r,a){let n;try{n=a?e(...a):e()}catch(e){handleError(e,t,r)}return n}function callWithAsyncErrorHandling(t,r,a,n){var e;if(isFunction$1(t))return(e=callWithErrorHandling(t,r,a,n))&&isPromise$1(e)&&e.catch(e=>{handleError(e,r,a)}),e;var o=[];for(let e=0;e<t.length;e++)o.push(callWithAsyncErrorHandling(t[e],r,a,n));return o}function handleError(t,r,a,e=!0){var n=r?r.vnode:null;if(r){let e=r.parent;for(var o=r.proxy,i="production"!==process$1.env.NODE_ENV?ErrorTypeStrings[a]:a;e;){var s=e.ec;if(s)for(let e=0;e<s.length;e++)if(!1===s[e](t,o,i))return;e=e.parent}r=r.appContext.config.errorHandler;if(r)return void callWithErrorHandling(r,null,10,[t,o,i])}logError(t,a,n,e)}function logError(e,t,r,a=!0){if("production"!==process$1.env.NODE_ENV){t=ErrorTypeStrings[t];if(r&&pushWarningContext(r),warn("Unhandled error"+(t?" during execution of "+t:"")),r&&popWarningContext(),a)throw e}console.error(e)}let isFlushing=!1,isFlushPending=!1;const queue=[];let flushIndex=0;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;const RECURSION_LIMIT=100;function nextTick(e){var t=currentFlushPromise||resolvedPromise;return e?t.then(this?e.bind(this):e):t}function findInsertionIndex(e){let t=flushIndex+1,r=queue.length;for(;t<r;){var a=t+r>>>1;getId(queue[a])<e?t=1+a:r=a}return t}function queueJob(e){queue.length&&queue.includes(e,isFlushing&&e.allowRecurse?flushIndex+1:flushIndex)||(null==e.id?queue.push(e):queue.splice(findInsertionIndex(e.id),0,e),queueFlush())}function queueFlush(){isFlushing||isFlushPending||(isFlushPending=!0,currentFlushPromise=resolvedPromise.then(flushJobs))}function queuePostFlushCb(e){isArray$2(e)?pendingPostFlushCbs.push(...e):activePostFlushCbs&&activePostFlushCbs.includes(e,e.allowRecurse?postFlushIndex+1:postFlushIndex)||pendingPostFlushCbs.push(e),queueFlush()}function flushPostFlushCbs(e){if(pendingPostFlushCbs.length){var t=[...new Set(pendingPostFlushCbs)];if(pendingPostFlushCbs.length=0,activePostFlushCbs)activePostFlushCbs.push(...t);else{for(activePostFlushCbs=t,"production"!==process$1.env.NODE_ENV&&(e=e||new Map),activePostFlushCbs.sort((e,t)=>getId(e)-getId(t)),postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++)"production"!==process$1.env.NODE_ENV&&checkRecursiveUpdates(e,activePostFlushCbs[postFlushIndex])||activePostFlushCbs[postFlushIndex]();activePostFlushCbs=null,postFlushIndex=0}}}const getId=e=>null==e.id?1/0:e.id,comparator=(e,t)=>{var r=getId(e)-getId(t);if(0==r){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function flushJobs(t){isFlushPending=!1,isFlushing=!0,"production"!==process$1.env.NODE_ENV&&(t=t||new Map),queue.sort(comparator);var e="production"!==process$1.env.NODE_ENV?e=>checkRecursiveUpdates(t,e):NOOP;try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){var r=queue[flushIndex];!r||!1===r.active||"production"!==process$1.env.NODE_ENV&&e(r)||callWithErrorHandling(r,null,14)}}finally{flushIndex=0,queue.length=0,flushPostFlushCbs(t),isFlushing=!1,currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs(t)}}function checkRecursiveUpdates(e,t){if(e.has(t)){var r,a=e.get(t);if(a>RECURSION_LIMIT)return warn(`Maximum recursive updates exceeded${(r=(r=t.ownerInstance)&&getComponentName(r.type))?` in component <${r}>`:""}. `+"This means you have a reactive effect that is mutating its own dependencies and thus recursively triggering itself. Possible sources include component template, render function, updated hook or watcher source function."),!0;e.set(t,a+1)}else e.set(t,1)}const hmrDirtyComponents=new Set,map=("production"!==process$1.env.NODE_ENV&&(getGlobalThis().__VUE_HMR_RUNTIME__={createRecord:tryWrap(createRecord),rerender:tryWrap(rerender),reload:tryWrap(reload)}),new Map);function createRecord(e,t){return!map.has(e)&&(map.set(e,{initialDef:normalizeClassComponent(t),instances:new Set}),!0)}function normalizeClassComponent(e){return isClassComponent(e)?e.__vccOpts:e}function rerender(e,t){e=map.get(e);e&&(e.initialDef.render=t,[...e.instances].forEach(e=>{t&&(e.render=t,normalizeClassComponent(e.type).render=t),e.renderCache=[],e.update()}))}function reload(e,t){var r=map.get(e);if(r){t=normalizeClassComponent(t),updateComponentDef(r.initialDef,t);const n=[...r.instances];for(const o of n){var a=normalizeClassComponent(o.type);hmrDirtyComponents.has(a)||(a!==r.initialDef&&updateComponentDef(a,t),hmrDirtyComponents.add(a)),o.appContext.optionsCache.delete(o.type),o.ceReload?(hmrDirtyComponents.add(a),o.ceReload(t.styles),hmrDirtyComponents.delete(a)):o.parent?queueJob(o.parent.update):o.appContext.reload?o.appContext.reload():"undefined"!=typeof window?window.location.reload():console.warn("[HMR] Root or manually mounted instance modified. Full reload required.")}queuePostFlushCb(()=>{for(const e of n)hmrDirtyComponents.delete(normalizeClassComponent(e.type))})}}function updateComponentDef(e,t){extend(e,t);for(const r in e)"__file"===r||r in t||delete e[r]}function tryWrap(r){return(e,t)=>{try{return r(e,t)}catch(e){console.error(e),console.warn("[HMR] Something went wrong during Vue component hot-reload. Full reload required.")}}}let currentRenderingInstance=null,currentScopeId=null;function markAttrsAccessed(){}const isSuspense=e=>e.__isSuspense;function queueEffectWithSuspense(e,t){t&&t.pendingBranch?isArray$2(e)?t.effects.push(...e):t.effects.push(e):queuePostFlushCb(e)}const INITIAL_WATCHER_VALUE={};function watch(e,t,r){return"production"===process$1.env.NODE_ENV||isFunction$1(t)||warn("`watch(fn, options?)` signature has been moved to a separate API. Use `watchEffect(fn, options?)` instead. `watch` now only supports `watch(source, cb, options?) signature."),doWatch(e,t,r)}function doWatch(e,t,{immediate:r,deep:a,flush:n,onTrack:o,onTrigger:i}=EMPTY_OBJ){"production"===process$1.env.NODE_ENV||t||(void 0!==r&&warn('watch() "immediate" option is only respected when using the watch(source, callback, options?) signature.'),void 0!==a&&warn('watch() "deep" option is only respected when using the watch(source, callback, options?) signature.'));const s=e=>{warn("Invalid watch source: ",e,"A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.")},c=currentInstance;let d,l=!1,p=!1;if(isRef(e)?(d=()=>e.value,l=isShallow$1(e)):isReactive(e)?(d=()=>e,a=!0):isArray$2(e)?(p=!0,l=e.some(e=>isReactive(e)||isShallow$1(e)),d=()=>e.map(e=>isRef(e)?e.value:isReactive(e)?traverse(e):isFunction$1(e)?callWithErrorHandling(e,c,2):void("production"!==process$1.env.NODE_ENV&&s(e)))):isFunction$1(e)?d=t?()=>callWithErrorHandling(e,c,2):()=>{if(!c||!c.isUnmounted)return u&&u(),callWithAsyncErrorHandling(e,c,3,[h])}:(d=NOOP,"production"!==process$1.env.NODE_ENV&&s(e)),t&&a){const y=d;d=()=>traverse(y())}let u,h=e=>{u=_.onStop=()=>{callWithErrorHandling(e,c,4)}},m=p?new Array(e.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const g=()=>{var e;_.active&&(t?(e=_.run(),(a||l||(p?e.some((e,t)=>hasChanged(e,m[t])):hasChanged(e,m)))&&(u&&u(),callWithAsyncErrorHandling(t,c,3,[e,m===INITIAL_WATCHER_VALUE?void 0:p&&m[0]===INITIAL_WATCHER_VALUE?[]:m,h]),m=e)):_.run())};g.allowRecurse=!!t;let f;f="sync"===n?g:"post"===n?()=>queuePostRenderEffect(g,c&&c.suspense):(g.pre=!0,c&&(g.id=c.uid),()=>queueJob(g));const _=new ReactiveEffect(d,f);"production"!==process$1.env.NODE_ENV&&(_.onTrack=o,_.onTrigger=i),t?r?g():m=_.run():"post"===n?queuePostRenderEffect(_.run.bind(_),c&&c.suspense):_.run();return()=>{_.stop(),c&&c.scope&&remove(c.scope.effects,_)}}function instanceWatch(e,t,r){const a=this.proxy;var n=isString(e)?e.includes(".")?createPathGetter(a,e):()=>a[e]:e.bind(a,a);let o;isFunction$1(t)?o=t:(o=t.handler,r=t);t=currentInstance,setCurrentInstance(this),n=doWatch(n,o.bind(a),r);return t?setCurrentInstance(t):unsetCurrentInstance(),n}function createPathGetter(e,t){const r=t.split(".");return()=>{let t=e;for(let e=0;e<r.length&&t;e++)t=t[r[e]];return t}}function traverse(t,r){if(isObject$7(t)&&!t.__v_skip&&!(r=r||new Set).has(t))if(r.add(t),isRef(t))traverse(t.value,r);else if(isArray$2(t))for(let e=0;e<t.length;e++)traverse(t[e],r);else if(isSet(t)||isMap(t))t.forEach(e=>{traverse(e,r)});else if(isPlainObject(t))for(const e in t)traverse(t[e],r);return t}function useTransitionState(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{e.isMounted=!0}),onBeforeUnmount(()=>{e.isUnmounting=!0}),e}const TransitionHookValidator=[Function,Array],BaseTransitionImpl={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},setup(d,{slots:e}){const l=getCurrentInstance(),p=useTransitionState();let u;return()=>{var r=e.default&&getTransitionRawChildren(e.default(),!0);if(r&&r.length){let t=r[0];if(1<r.length){let e=!1;for(const c of r)if(c.type!==Comment){if("production"!==process$1.env.NODE_ENV&&e){warn("<transition> can only be used on a single element or component. Use <transition-group> for lists.");break}if(t=c,e=!0,"production"===process$1.env.NODE_ENV)break}}var r=toRaw(d),a=r["mode"];if("production"!==process$1.env.NODE_ENV&&a&&"in-out"!==a&&"out-in"!==a&&"default"!==a&&warn("invalid <transition> mode: "+a),p.isLeaving)return emptyPlaceholder(t);var n=getKeepAliveChild(t);if(!n)return emptyPlaceholder(t);const i=resolveTransitionHooks(n,r,p,l);setTransitionHooks(n,i);var o=l.subTree;const s=o&&getKeepAliveChild(o);let e=!1;var o=n.type["getTransitionKey"];if(o&&(o=o(),void 0===u?u=o:o!==u&&(u=o,e=!0)),s&&s.type!==Comment&&(!isSameVNodeType(n,s)||e)){o=resolveTransitionHooks(s,r,p,l);if(setTransitionHooks(s,o),"out-in"===a)return p.isLeaving=!0,o.afterLeave=()=>{(p.isLeaving=!1)!==l.update.active&&l.update()},emptyPlaceholder(t);"in-out"===a&&n.type!==Comment&&(o.delayLeave=(e,t,r)=>{getLeavingNodesForType(p,s)[String(s.key)]=s,e._leaveCb=()=>{t(),e._leaveCb=void 0,delete i.delayedLeave},i.delayedLeave=r})}return t}}}},BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(e,t){e=e.leavingVNodes;let r=e.get(t.type);return r||(r=Object.create(null),e.set(t.type,r)),r}function resolveTransitionHooks(o,t,i,r){const{appear:s,mode:e,persisted:a=!1,onBeforeEnter:n,onEnter:c,onAfterEnter:d,onEnterCancelled:l,onBeforeLeave:p,onLeave:u,onAfterLeave:h,onLeaveCancelled:m,onBeforeAppear:g,onAppear:f,onAfterAppear:_,onAppearCancelled:y}=t,v=String(o.key),b=getLeavingNodesForType(i,o),w=(e,t)=>{e&&callWithAsyncErrorHandling(e,r,9,t)},S=(e,t)=>{var r=t[1];w(e,t),isArray$2(e)?e.every(e=>e.length<=1)&&r():e.length<=1&&r()},P={mode:e,persisted:a,beforeEnter(e){let t=n;if(!i.isMounted){if(!s)return;t=g||n}e._leaveCb&&e._leaveCb(!0);var r=b[v];r&&isSameVNodeType(o,r)&&r.el._leaveCb&&r.el._leaveCb(),w(t,[e])},enter(t){let e=c,r=d,a=l;if(!i.isMounted){if(!s)return;e=f||c,r=_||d,a=y||l}let n=!1;var o=t._enterCb=e=>{n||(n=!0,e?w(a,[t]):w(r,[t]),P.delayedLeave&&P.delayedLeave(),t._enterCb=void 0)};e?S(e,[t,o]):o()},leave(t,r){const a=String(o.key);if(t._enterCb&&t._enterCb(!0),i.isUnmounting)return r();w(p,[t]);let n=!1;var e=t._leaveCb=e=>{n||(n=!0,r(),e?w(m,[t]):w(h,[t]),t._leaveCb=void 0,b[a]===o&&delete b[a])};b[a]=o,u?S(u,[t,e]):e()},clone(e){return resolveTransitionHooks(e,t,i,r)}};return P}function emptyPlaceholder(e){if(isKeepAlive(e))return(e=cloneVNode(e)).children=null,e}function getKeepAliveChild(e){return isKeepAlive(e)?e.children?e.children[0]:void 0:e}function setTransitionHooks(e,t){6&e.shapeFlag&&e.component?setTransitionHooks(e.component.subTree,t):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function getTransitionRawChildren(t,r=!1,a){let n=[],o=0;for(let e=0;e<t.length;e++){var i=t[e],s=null==a?i.key:String(a)+String(null!=i.key?i.key:e);i.type===Fragment?(128&i.patchFlag&&o++,n=n.concat(getTransitionRawChildren(i.children,r,s))):!r&&i.type===Comment||n.push(null!=s?cloneVNode(i,{key:s}):i)}if(1<o)for(let e=0;e<n.length;e++)n[e].patchFlag=-2;return n}const isKeepAlive=e=>e.type.__isKeepAlive;function injectHook(t,r,a=currentInstance,e=!1){var n,o;if(a)return n=a[t]||(a[t]=[]),o=r.__weh||(r.__weh=(...e)=>{if(!a.isUnmounted)return pauseTracking(),setCurrentInstance(a),e=callWithAsyncErrorHandling(r,a,t,e),unsetCurrentInstance(),resetTracking(),e}),e?n.unshift(o):n.push(o),o;"production"!==process$1.env.NODE_ENV&&warn(toHandlerKey(ErrorTypeStrings[t].replace(/ hook$/,""))+" is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.")}const createHook=r=>(t,e=currentInstance)=>injectHook(r,(...e)=>t(...e),e),onMounted=createHook("m"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),NULL_DYNAMIC_COMPONENT=Symbol(),getPublicInstance=e=>e?isStatefulComponent(e)?getExposeProxy(e)||e.proxy:getPublicInstance(e.parent):null,publicPropertiesMap=extend(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>"production"!==process$1.env.NODE_ENV?shallowReadonly(e.props):e.props,$attrs:e=>"production"!==process$1.env.NODE_ENV?shallowReadonly(e.attrs):e.attrs,$slots:e=>"production"!==process$1.env.NODE_ENV?shallowReadonly(e.slots):e.slots,$refs:e=>"production"!==process$1.env.NODE_ENV?shallowReadonly(e.refs):e.refs,$parent:e=>getPublicInstance(e.parent),$root:e=>getPublicInstance(e.root),$emit:e=>e.emit,$options:e=>__VUE_OPTIONS_API__?resolveMergedOptions(e):e.type,$forceUpdate:e=>e.f||(e.f=()=>queueJob(e.update)),$nextTick:e=>e.n||(e.n=nextTick.bind(e.proxy)),$watch:e=>__VUE_OPTIONS_API__?instanceWatch.bind(e):NOOP}),isReservedPrefix=e=>"_"===e||"$"===e,hasSetupBinding=(e,t)=>e!==EMPTY_OBJ&&!e.__isScriptSetup&&hasOwn$7(e,t),PublicInstanceProxyHandlers={get({_:e},t){var{ctx:r,setupState:a,data:n,props:o,accessCache:i,type:s,appContext:c}=e;if("production"!==process$1.env.NODE_ENV&&"__isVue"===t)return!0;if("$"!==t[0]){var d=i[t];if(void 0!==d)switch(d){case 1:return a[t];case 2:return n[t];case 4:return r[t];case 3:return o[t]}else{if(hasSetupBinding(a,t))return i[t]=1,a[t];if(n!==EMPTY_OBJ&&hasOwn$7(n,t))return i[t]=2,n[t];if((d=e.propsOptions[0])&&hasOwn$7(d,t))return i[t]=3,o[t];if(r!==EMPTY_OBJ&&hasOwn$7(r,t))return i[t]=4,r[t];__VUE_OPTIONS_API__&&!shouldCacheAccess||(i[t]=0)}}d=publicPropertiesMap[t];let l,p;return d?("$attrs"===t&&(track(e,"get",t),"production"!==process$1.env.NODE_ENV)&&markAttrsAccessed(),d(e)):(l=(l=s.__cssModules)&&l[t])||(r!==EMPTY_OBJ&&hasOwn$7(r,t)?(i[t]=4,r[t]):(p=c.config.globalProperties,hasOwn$7(p,t)?p[t]:void("production"===process$1.env.NODE_ENV||!currentRenderingInstance||isString(t)&&0===t.indexOf("__v")||(n!==EMPTY_OBJ&&isReservedPrefix(t[0])&&hasOwn$7(n,t)?warn(`Property ${JSON.stringify(t)} must be accessed via $data because it starts with a reserved `+'character ("$" or "_") and is not proxied on the render context.'):e===currentRenderingInstance&&warn(`Property ${JSON.stringify(t)} was accessed during render `+"but is not defined on instance.")))))},set({_:e},t,r){var{data:a,setupState:n,ctx:o}=e;if(hasSetupBinding(n,t))n[t]=r;else{if("production"!==process$1.env.NODE_ENV&&n.__isScriptSetup&&hasOwn$7(n,t))return warn(`Cannot mutate <script setup> binding "${t}" from Options API.`),!1;if(a!==EMPTY_OBJ&&hasOwn$7(a,t))a[t]=r;else{if(hasOwn$7(e.props,t))return"production"!==process$1.env.NODE_ENV&&warn(`Attempting to mutate prop "${t}". Props are readonly.`),!1;if("$"===t[0]&&t.slice(1)in e)return"production"!==process$1.env.NODE_ENV&&warn(`Attempting to mutate public property "${t}". `+"Properties starting with $ are reserved and readonly."),!1;"production"!==process$1.env.NODE_ENV&&t in e.appContext.config.globalProperties?Object.defineProperty(o,t,{enumerable:!0,configurable:!0,value:r}):o[t]=r}}return!0},has({_:{data:e,setupState:t,accessCache:r,ctx:a,appContext:n,propsOptions:o}},i){return!!r[i]||e!==EMPTY_OBJ&&hasOwn$7(e,i)||hasSetupBinding(t,i)||(r=o[0])&&hasOwn$7(r,i)||hasOwn$7(a,i)||hasOwn$7(publicPropertiesMap,i)||hasOwn$7(n.config.globalProperties,i)},defineProperty(e,t,r){return null!=r.get?e._.accessCache[t]=0:hasOwn$7(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};"production"!==process$1.env.NODE_ENV&&(PublicInstanceProxyHandlers.ownKeys=e=>(warn("Avoid app logic that relies on enumerating keys on a component instance. The keys will be empty in production mode to avoid performance overhead."),Reflect.ownKeys(e))),extend({},PublicInstanceProxyHandlers,{get(e,t){if(t!==Symbol.unscopables)return PublicInstanceProxyHandlers.get(e,t,e)},has(e,t){var r="_"!==t[0]&&!isGloballyWhitelisted(t);return"production"!==process$1.env.NODE_ENV&&!r&&PublicInstanceProxyHandlers.has(e,t)&&warn(`Property ${JSON.stringify(t)} should not start with _ which is a reserved prefix for Vue internals.`),r}});let shouldCacheAccess=!0;function resolveMergedOptions(e){var t=e.type,{mixins:r,extends:a}=t;const{mixins:n,optionsCache:o,config:{optionMergeStrategies:i}}=e.appContext;e=o.get(t);let s;return e?s=e:n.length||r||a?(s={},n.length&&n.forEach(e=>mergeOptions(s,e,i,!0)),mergeOptions(s,t,i)):s=t,isObject$7(t)&&o.set(t,s),s}function mergeOptions(t,e,r,a=!1){var n,{mixins:o,extends:i}=e;i&&mergeOptions(t,i,r,!0),o&&o.forEach(e=>mergeOptions(t,e,r,!0));for(const s in e)a&&"expose"===s?"production"!==process$1.env.NODE_ENV&&warn('"expose" option is ignored when declared in mixins or extends. It should only be declared in the base component itself.'):(n=internalOptionMergeStrats[s]||r&&r[s],t[s]=n?n(t[s],e[s]):e[s]);return t}const internalOptionMergeStrats={data:mergeDataFn,props:mergeObjectOptions,emits:mergeObjectOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(e,t){return t?e?function(){return extend(isFunction$1(e)?e.call(this,this):e,isFunction$1(t)?t.call(this,this):t)}:t:e}function mergeInject(e,t){return mergeObjectOptions(normalizeInject(e),normalizeInject(t))}function normalizeInject(t){if(isArray$2(t)){var r={};for(let e=0;e<t.length;e++)r[t[e]]=t[e];return r}return t}function mergeAsArray(e,t){return e?[...new Set([].concat(e,t))]:t}function mergeObjectOptions(e,t){return e?extend(extend(Object.create(null),e),t):t}function mergeWatchOptions(e,t){if(!e)return t;if(!t)return e;var r=extend(Object.create(null),e);for(const a in t)r[a]=mergeAsArray(e[a],t[a]);return r}makeMap("String,Number,Boolean,Function,Symbol,BigInt");const queuePostRenderEffect=queueEffectWithSuspense,isTeleport=e=>e.__isTeleport,Fragment=Symbol("production"!==process$1.env.NODE_ENV?"Fragment":void 0),Text=Symbol("production"!==process$1.env.NODE_ENV?"Text":void 0),Comment=Symbol("production"!==process$1.env.NODE_ENV?"Comment":void 0);Symbol("production"!==process$1.env.NODE_ENV?"Static":void 0);let currentBlock=null;function isVNode(e){return!!e&&!0===e.__v_isVNode}function isSameVNodeType(e,t){return"production"!==process$1.env.NODE_ENV&&6&t.shapeFlag&&hmrDirtyComponents.has(t.type)?(e.shapeFlag&=-257,t.shapeFlag&=-513,!1):e.type===t.type&&e.key===t.key}const createVNodeWithArgsTransform=(...e)=>_createVNode(...e),InternalObjectKey="__vInternal",normalizeKey=({key:e})=>null!=e?e:null,normalizeRef=({ref:e,ref_key:t,ref_for:r})=>null!=e?isString(e)||isRef(e)||isFunction$1(e)?{i:currentRenderingInstance,r:e,k:t,f:!!r}:e:null;function createBaseVNode(e,t=null,r=null,a=0,n=null,o=e===Fragment?0:1,i=!1,s=!1){t={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&normalizeKey(t),ref:t&&normalizeRef(t),scopeId:currentScopeId,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:a,dynamicProps:n,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return s?(normalizeChildren(t,r),128&o&&e.normalize(t)):r&&(t.shapeFlag|=isString(r)?8:16),"production"!==process$1.env.NODE_ENV&&t.key!=t.key&&warn("VNode created with invalid key (NaN). VNode type:",t.type),!i&&currentBlock&&(0<t.patchFlag||6&o)&&32!==t.patchFlag&&currentBlock.push(t),t}const createVNode="production"!==process$1.env.NODE_ENV?createVNodeWithArgsTransform:_createVNode;function _createVNode(e,r=null,t=null,a=0,n=null,o=!1){if(e&&e!==NULL_DYNAMIC_COMPONENT||("production"===process$1.env.NODE_ENV||e||warn(`Invalid vnode type when creating vnode: ${e}.`),e=Comment),isVNode(e))return i=cloneVNode(e,r,!0),t&&normalizeChildren(i,t),!o&&currentBlock&&(6&i.shapeFlag?currentBlock[currentBlock.indexOf(e)]=i:currentBlock.push(i)),i.patchFlag|=-2,i;if(isClassComponent(e)&&(e=e.__vccOpts),r){let{class:e,style:t}=r=guardReactiveProps(r);e&&!isString(e)&&(r.class=normalizeClass(e)),isObject$7(t)&&(isProxy(t)&&!isArray$2(t)&&(t=extend({},t)),r.style=normalizeStyle(t))}var i=isString(e)?1:isSuspense(e)?128:isTeleport(e)?64:isObject$7(e)?4:isFunction$1(e)?2:0;return"production"!==process$1.env.NODE_ENV&&4&i&&isProxy(e)&&warn("Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with `markRaw` or using `shallowRef` instead of `ref`.",`
Component that was made reactive: `,e=toRaw(e)),createBaseVNode(e,r,t,a,n,i,o,!0)}function guardReactiveProps(e){return e?isProxy(e)||InternalObjectKey in e?extend({},e):e:null}function cloneVNode(e,t,r=!1){var{props:a,ref:n,patchFlag:o,children:i}=e,a=t?mergeProps(a||{},t):a;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:a,key:a&&normalizeKey(a),ref:t&&t.ref?r&&n?isArray$2(n)?n.concat(normalizeRef(t)):[n,normalizeRef(t)]:normalizeRef(t):n,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:"production"!==process$1.env.NODE_ENV&&-1===o&&isArray$2(i)?i.map(deepCloneVNode):i,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==Fragment?-1===o?16:16|o:o,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&cloneVNode(e.ssContent),ssFallback:e.ssFallback&&cloneVNode(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx}}function deepCloneVNode(e){var t=cloneVNode(e);return isArray$2(e.children)&&(t.children=e.children.map(deepCloneVNode)),t}function createTextVNode(e=" ",t=0){return createVNode(Text,null,e,t)}function normalizeChildren(e,t){let r=0;var a,n=e["shapeFlag"];if(null==t)t=null;else if(isArray$2(t))r=16;else if("object"==typeof t){if(65&n)return void((a=t.default)&&(a._c&&(a._d=!1),normalizeChildren(e,a()),a._c)&&(a._d=!0));r=32,(a=t._)||InternalObjectKey in t?3===a&&currentRenderingInstance&&(1===currentRenderingInstance.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=currentRenderingInstance}else isFunction$1(t)?(t={default:t,_ctx:currentRenderingInstance},r=32):(t=String(t),64&n?(r=16,t=[createTextVNode(t)]):r=8);e.children=t,e.shapeFlag|=r}function mergeProps(...t){var r={};for(let e=0;e<t.length;e++){var a,n,o=t[e];for(const i in o)"class"===i?r.class!==o.class&&(r.class=normalizeClass([r.class,o.class])):"style"===i?r.style=normalizeStyle([r.style,o.style]):isOn(i)?(a=r[i],!(n=o[i])||a===n||isArray$2(a)&&a.includes(n)||(r[i]=a?[].concat(a,n):n)):""!==i&&(r[i]=o[i])}return r}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance,setCurrentInstance=e=>{(currentInstance=e).scope.on()},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),currentInstance=null};function isStatefulComponent(e){return 4&e.vnode.shapeFlag}makeMap("slot,component");let isInSSRComponentSetup=!1;function getExposeProxy(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(proxyRefs(markRaw(r.exposed)),{get(e,t){return t in e?e[t]:t in publicPropertiesMap?publicPropertiesMap[t](r):void 0},has(e,t){return t in e||t in publicPropertiesMap}}))}const classifyRE=/(?:^|[-_])(\w)/g,classify=e=>e.replace(classifyRE,e=>e.toUpperCase()).replace(/[-_]/g,"");function getComponentName(e,t=!0){return isFunction$1(e)?e.displayName||e.name:e.name||t&&e.__name}function formatComponentName(e,r,t=!1){let a=getComponentName(r);var n;return!(a=!a&&r.__file&&(n=r.__file.match(/([^/\\]+)\.\w+$/))?n[1]:a)&&e&&e.parent&&(n=e=>{for(const t in e)if(e[t]===r)return t},a=n(e.components||e.parent.type.components)||n(e.appContext.components)),a?classify(a):t?"App":"Anonymous"}function isClassComponent(e){return isFunction$1(e)&&"__vccOpts"in e}const computed=(e,t)=>computed$1(e,t,isInSSRComponentSetup);function isShallow(e){return!(!e||!e.__v_isShallow)}function initCustomFormatter(){if("production"!==process$1.env.NODE_ENV&&"undefined"!=typeof window){const t={style:"color:#3ba776"},o={style:"color:#0b1bc9"},i={style:"color:#b62e24"},s={style:"color:#9d288c"};var e={header(e){return isObject$7(e)?e.__isVue?["div",t,"VueInstance"]:isRef(e)?["div",{},["span",t,function(e){if(isShallow(e))return"ShallowRef";if(e.effect)return"ComputedRef";return"Ref"}(e)],"<",r(e.value),">"]:isReactive(e)?["div",{},["span",t,isShallow(e)?"ShallowReactive":"Reactive"],"<",r(e),">"+(isReadonly(e)?" (readonly)":"")]:isReadonly(e)?["div",{},["span",t,isShallow(e)?"ShallowReadonly":"Readonly"],"<",r(e),">"]:null:null},hasBody(e){return e&&e.__isVue},body(e){if(e&&e.__isVue)return["div",{},...function(e){var t=[];e.type.props&&e.props&&t.push(a("props",toRaw(e.props)));e.setupState!==EMPTY_OBJ&&t.push(a("setup",e.setupState));e.data!==EMPTY_OBJ&&t.push(a("data",toRaw(e.data)));var r=n(e,"computed");r&&t.push(a("computed",r));r=n(e,"inject");r&&t.push(a("injected",r));return t.push(["div",{},["span",{style:s.style+";opacity:0.66"},"$ (internal): "],["object",{object:e}]]),t}(e.$)]}};function a(e,t){return t=extend({},t),Object.keys(t).length?["div",{style:"line-height:1.25em;margin-bottom:0.6em"},["div",{style:"color:#476582"},e],["div",{style:"padding-left:1.25em"},...Object.keys(t).map(e=>["div",{},["span",s,e+": "],r(t[e],!1)])]]:["span",{}]}function r(e,t=!0){return"number"==typeof e?["span",o,e]:"string"==typeof e?["span",i,JSON.stringify(e)]:"boolean"==typeof e?["span",s,e]:isObject$7(e)?["object",{object:t?toRaw(e):e}]:["span",i,String(e)]}function n(e,t){var r=e.type;if(!isFunction$1(r)){var a={};for(const n in e.ctx)!function t(e,r,a){const n=e[a];if(isArray$2(n)&&n.includes(r)||isObject$7(n)&&r in n)return!0;if(e.extends&&t(e.extends,r,a))return!0;if(e.mixins&&e.mixins.some(e=>t(e,r,a)))return!0}(r,n,t)||(a[n]=e.ctx[n]);return a}}window.devtoolsFormatters?window.devtoolsFormatters.push(e):window.devtoolsFormatters=[e]}}Symbol("production"!==process$1.env.NODE_ENV?"ssrContext":"");const svgNS="http://www.w3.org/2000/svg",doc="undefined"!=typeof document?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{var t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,a)=>{t=t?doc.createElementNS(svgNS,e):doc.createElement(e,r?{is:r}:void 0);return"select"===e&&a&&null!=a.multiple&&t.setAttribute("multiple",a.multiple),t},createText:e=>doc.createTextNode(e),createComment:e=>doc.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>doc.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,a,n,o){var i=r?r.previousSibling:t.lastChild;if(n&&(n===o||n.nextSibling)){for(;;)if(t.insertBefore(n.cloneNode(!0),r),n===o||!(n=n.nextSibling))break}else{templateContainer.innerHTML=a?`<svg>${e}</svg>`:e;var s=templateContainer.content;if(a){for(var c=s.firstChild;c.firstChild;)s.appendChild(c.firstChild);s.removeChild(c)}t.insertBefore(s,r)}return[i?i.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};function patchClass(e,t,r){var a=e._vtc;null==(t=a?(t?[t,...a]:[...a]).join(" "):t)?e.removeAttribute("class"):r?e.setAttribute("class",t):e.className=t}function patchStyle(e,t,r){var a=e.style,n=isString(r);if(r&&!n){for(const i in r)setStyle(a,i,r[i]);if(t&&!isString(t))for(const s in t)null==r[s]&&setStyle(a,s,"")}else{var o=a.display;n?t!==r&&(a.cssText=r):t&&e.removeAttribute("style"),"_vod"in e&&(a.display=o)}}const semicolonRE=/[^\\];\s*$/,importantRE=/\s*!important$/;function setStyle(t,r,e){var a;isArray$2(e)?e.forEach(e=>setStyle(t,r,e)):(null==e&&(e=""),"production"!==process$1.env.NODE_ENV&&semicolonRE.test(e)&&warn(`Unexpected semicolon at the end of '${r}' style value: '${e}'`),r.startsWith("--")?t.setProperty(r,e):(a=autoPrefix(t,r),importantRE.test(e)?t.setProperty(hyphenate(a),e.replace(importantRE,""),"important"):t[a]=e))}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(t,r){var e=prefixCache[r];if(e)return e;var a=camelize(r);if("filter"!==a&&a in t)return prefixCache[r]=a;a=capitalize(a);for(let e=0;e<prefixes.length;e++){var n=prefixes[e]+a;if(n in t)return prefixCache[r]=n}return r}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(e,t,r,a,n){a&&t.startsWith("xlink:")?null==r?e.removeAttributeNS(xlinkNS,t.slice(6,t.length)):e.setAttributeNS(xlinkNS,t,r):(a=isSpecialBooleanAttr(t),null==r||a&&!includeBooleanAttr(r)?e.removeAttribute(t):e.setAttribute(t,a?"":r))}function patchDOMProp(r,a,n,e,t,o,i){if("innerHTML"===a||"textContent"===a)e&&i(e,t,o),r[a]=null==n?"":n;else if("value"!==a||"PROGRESS"===r.tagName||r.tagName.includes("-")){let t=!1;""!==n&&null!=n||("boolean"==(i=typeof r[a])?n=includeBooleanAttr(n):null==n&&"string"==i?(n="",t=!0):"number"==i&&(n=0,t=!0));try{r[a]=n}catch(e){"production"===process$1.env.NODE_ENV||t||warn(`Failed setting prop "${a}" on <${r.tagName.toLowerCase()}>: `+`value ${n} is invalid.`,e)}t&&r.removeAttribute(a)}else e=null==(r._value=n)?"":n,r.value===e&&"OPTION"!==r.tagName||(r.value=e),null==n&&r.removeAttribute(a)}function addEventListener(e,t,r,a){e.addEventListener(t,r,a)}function removeEventListener(e,t,r,a){e.removeEventListener(t,r,a)}function patchEvent(e,t,r,a,n=null){var o,i,s=e._vei||(e._vei={}),c=s[t];a&&c?c.value=a:([o,i]=parseName(t),a?addEventListener(e,o,s[t]=createInvoker(a,n),i):c&&(removeEventListener(e,o,c,i),s[t]=void 0))}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(e){let t;var r;if(optionsModifierRE.test(e))for(t={};r=e.match(optionsModifierRE);)e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0;return[":"===e[2]?e.slice(3):hyphenate(e.slice(2)),t]}let cachedNow=0;const p=Promise.resolve(),getNow=()=>cachedNow||(p.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(e,t){const r=e=>{if(e._vts){if(e._vts<=r.attached)return}else e._vts=Date.now();callWithAsyncErrorHandling(patchStopImmediatePropagation(e,r.value),t,5,[e])};return r.value=e,r.attached=getNow(),r}function patchStopImmediatePropagation(e,t){if(isArray$2(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map(t=>e=>!e._stopped&&t&&t(e))}return t}const nativeOnRE=/^on[a-z]/,patchProp=(e,t,r,a,n=!1,o,i,s,c)=>{"class"===t?patchClass(e,a,n):"style"===t?patchStyle(e,r,a):isOn(t)?isModelListener(t)||patchEvent(e,t,r,a,i):("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):shouldSetAsProp(e,t,a,n))?patchDOMProp(e,t,a,o,i,s,c):("true-value"===t?e._trueValue=a:"false-value"===t&&(e._falseValue=a),patchAttr(e,t,a,n))};function shouldSetAsProp(e,t,r,a){return a?"innerHTML"===t||"textContent"===t||!!(t in e&&nativeOnRE.test(t)&&isFunction$1(r)):"spellcheck"!==t&&"draggable"!==t&&"translate"!==t&&"form"!==t&&("list"!==t||"INPUT"!==e.tagName)&&!("type"===t&&"TEXTAREA"===e.tagName||nativeOnRE.test(t)&&isString(r))&&t in e}const TRANSITION="transition",ANIMATION="animation",DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},TransitionPropsValidators=extend({},BaseTransition.props,DOMTransitionPropsValidators),callHook=(e,t=[])=>{isArray$2(e)?e.forEach(e=>e(...t)):e&&e(...t)},hasExplicitCallback=e=>!!e&&(isArray$2(e)?e.some(e=>1<e.length):1<e.length);function resolveTransitionProps(e){var t={};for(const C in e)C in DOMTransitionPropsValidators||(t[C]=e[C]);if(!1===e.css)return t;const{name:r="v",type:o,duration:a,enterFromClass:i=r+"-enter-from",enterActiveClass:n=r+"-enter-active",enterToClass:s=r+"-enter-to",appearFromClass:c=i,appearActiveClass:d=n,appearToClass:l=s,leaveFromClass:p=r+"-leave-from",leaveActiveClass:u=r+"-leave-active",leaveToClass:h=r+"-leave-to"}=e;var m=normalizeDuration(a);const g=m&&m[0],f=m&&m[1],{onBeforeEnter:_,onEnter:y,onEnterCancelled:v,onLeave:b,onLeaveCancelled:w,onBeforeAppear:S=_,onAppear:P=y,onAppearCancelled:$=v}=t,T=(e,t,r)=>{removeTransitionClass(e,t?l:s),removeTransitionClass(e,t?d:n),r&&r()},R=(e,t)=>{e._isLeaving=!1,removeTransitionClass(e,p),removeTransitionClass(e,h),removeTransitionClass(e,u),t&&t()};m=n=>(e,t)=>{const r=n?P:y,a=()=>T(e,n,t);callHook(r,[e,a]),nextFrame(()=>{removeTransitionClass(e,n?c:i),addTransitionClass(e,n?l:s),hasExplicitCallback(r)||whenTransitionEnds(e,o,g,a)})};return extend(t,{onBeforeEnter(e){callHook(_,[e]),addTransitionClass(e,i),addTransitionClass(e,n)},onBeforeAppear(e){callHook(S,[e]),addTransitionClass(e,c),addTransitionClass(e,d)},onEnter:m(!1),onAppear:m(!0),onLeave(e,t){e._isLeaving=!0;const r=()=>R(e,t);addTransitionClass(e,p),forceReflow(),addTransitionClass(e,u),nextFrame(()=>{e._isLeaving&&(removeTransitionClass(e,p),addTransitionClass(e,h),hasExplicitCallback(b)||whenTransitionEnds(e,o,f,r))}),callHook(b,[e,r])},onEnterCancelled(e){T(e,!1),callHook(v,[e])},onAppearCancelled(e){T(e,!0),callHook($,[e])},onLeaveCancelled(e){R(e),callHook(w,[e])}})}function normalizeDuration(e){return null==e?null:isObject$7(e)?[NumberOf(e.enter),NumberOf(e.leave)]:[e=NumberOf(e),e]}function NumberOf(e){e=toNumber(e);return"production"!==process$1.env.NODE_ENV&&validateDuration(e),e}function validateDuration(e){"number"!=typeof e?warn("<transition> explicit duration is not a valid number - "+`got ${JSON.stringify(e)}.`):isNaN(e)&&warn("<transition> explicit duration is NaN - the duration expression might be incorrect.")}function addTransitionClass(t,e){e.split(/\s+/).forEach(e=>e&&t.classList.add(e)),(t._vtc||(t._vtc=new Set)).add(e)}function removeTransitionClass(t,e){e.split(/\s+/).forEach(e=>e&&t.classList.remove(e));var r=t["_vtc"];r&&(r.delete(e),r.size||(t._vtc=void 0))}function nextFrame(e){requestAnimationFrame(()=>{requestAnimationFrame(e)})}let endId=0;function whenTransitionEnds(t,e,r,a){const n=t._endId=++endId,o=()=>{n===t._endId&&a()};if(r)return setTimeout(o,r);const{type:i,timeout:s,propCount:c}=getTransitionInfo(t,e);if(!i)return a();const d=i+"end";let l=0;const p=()=>{t.removeEventListener(d,u),o()},u=e=>{e.target===t&&++l>=c&&p()};setTimeout(()=>{l<c&&p()},s+1),t.addEventListener(d,u)}function getTransitionInfo(e,t){const r=window.getComputedStyle(e);var e=e=>(r[e]||"").split(", "),a=e(TRANSITION+"Delay"),n=e(TRANSITION+"Duration"),a=getTimeout(a,n),o=e(ANIMATION+"Delay"),i=e(ANIMATION+"Duration"),o=getTimeout(o,i);let s=null,c=0,d=0;t===TRANSITION?0<a&&(s=TRANSITION,c=a,d=n.length):t===ANIMATION?0<o&&(s=ANIMATION,c=o,d=i.length):(c=Math.max(a,o),s=0<c?o<a?TRANSITION:ANIMATION:null,d=s?(s===TRANSITION?n:i).length:0);t=s===TRANSITION&&/\b(transform|all)(,|$)/.test(e(TRANSITION+"Property").toString());return{type:s,timeout:c,propCount:d,hasTransform:t}}function getTimeout(r,e){for(;r.length<e.length;)r=r.concat(r);return Math.max(...e.map((e,t)=>toMs(e)+toMs(r[t])))}function toMs(e){return 1e3*Number(e.slice(0,-1).replace(",","."))}function forceReflow(){return document.body.offsetHeight}const positionMap=new WeakMap,newPositionMap=new WeakMap;function callPendingCbs(e){e=e.el;e._moveCb&&e._moveCb(),e._enterCb&&e._enterCb()}function recordPosition(e){newPositionMap.set(e,e.el.getBoundingClientRect())}function applyTranslation(e){var t=positionMap.get(e),r=newPositionMap.get(e),a=t.left-r.left,t=t.top-r.top;if(a||t)return(r=e.el.style).transform=r.webkitTransform=`translate(${a}px,${t}px)`,r.transitionDuration="0s",e}function hasCSSTransform(e,t,r){const a=e.cloneNode();e._vtc&&e._vtc.forEach(e=>{e.split(/\s+/).forEach(e=>e&&a.classList.remove(e))}),r.split(/\s+/).forEach(e=>e&&a.classList.add(e)),a.style.display="none";e=1===t.nodeType?t:t.parentNode,e.appendChild(a),r=getTransitionInfo(a).hasTransform;return e.removeChild(a),r}function initDev(){initCustomFormatter()}function getDevtoolsGlobalHook(){return getTarget().__VUE_DEVTOOLS_GLOBAL_HOOK__}function getTarget(){return"undefined"!=typeof navigator&&"undefined"!=typeof window?window:void 0!==global$b?global$b:{}}extend({},TransitionPropsValidators,{tag:String,moveClass:String}),extend({patchProp:patchProp},nodeOps),"production"!==process$1.env.NODE_ENV&&initDev();const isProxyAvailable="function"==typeof Proxy,HOOK_SETUP="devtools-plugin:setup",HOOK_PLUGIN_SETTINGS_SET="plugin:settings:set";let supported,perf;function isPerformanceSupported(){var e;return void 0===supported&&("undefined"!=typeof window&&window.performance?(supported=!0,perf=window.performance):void 0!==global$b&&null!=(e=global$b.perf_hooks)&&e.performance?(supported=!0,perf=global$b.perf_hooks.performance):supported=!1),supported}function now(){return(isPerformanceSupported()?perf:Date).now()}class ApiProxy{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;var r={};if(e.settings)for(const c in e.settings){var a=e.settings[c];r[c]=a.defaultValue}const n="__vue-devtools-plugin-settings__"+e.id;let o=Object.assign({},r);try{var i=localStorage.getItem(n),s=JSON.parse(i);Object.assign(o,s)}catch(e){}this.fallbacks={getSettings(){return o},setSettings(e){try{localStorage.setItem(n,JSON.stringify(e))}catch(e){}o=e},now(){return now()}},t&&t.on(HOOK_PLUGIN_SETTINGS_SET,(e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)}),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,r)=>this.target?this.target[r]:"on"===r?this.proxiedOn:Object.keys(this.fallbacks).includes(r)?(...e)=>(this.targetQueue.push({method:r,args:e,resolve:()=>{}}),this.fallbacks[r](...e)):(...t)=>new Promise(e=>{this.targetQueue.push({method:r,args:t,resolve:e})})})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const r of this.targetQueue)r.resolve(await this.target[r.method](...r.args))}}function setupDevtoolsPlugin(e,t){var r=e,a=getTarget(),n=getDevtoolsGlobalHook(),o=isProxyAvailable&&r.enableEarlyProxy;!n||!a.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&o?(o=o?new ApiProxy(r,n):null,(a.__VUE_DEVTOOLS_PLUGINS__=a.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:r,setupFn:t,proxy:o}),o&&t(o.proxiedTarget)):n.emit(HOOK_SETUP,e,t)}var storeKey="store";function find(e,t){return e.filter(t)[0]}function deepCopy(t,r){var e,a;return void 0===r&&(r=[]),null===t||"object"!=typeof t?t:(e=find(r,function(e){return e.original===t}))?e.copy:(a=Array.isArray(t)?[]:{},r.push({original:t,copy:a}),Object.keys(t).forEach(function(e){a[e]=deepCopy(t[e],r)}),a)}function forEachValue(t,r){Object.keys(t).forEach(function(e){return r(t[e],e)})}function isObject$6(e){return null!==e&&"object"==typeof e}function isPromise(e){return e&&"function"==typeof e.then}function assert(e,t){if(!e)throw new Error("[vuex] "+t)}function partial(e,t){return function(){return e(t)}}function genericSubscribe(t,r,e){return r.indexOf(t)<0&&(e&&e.prepend?r.unshift(t):r.push(t)),function(){var e=r.indexOf(t);-1<e&&r.splice(e,1)}}function resetStore(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var r=e.state;installModule(e,r,[],e._modules.root,!0),resetStoreState(e,r,t)}function resetStoreState(r,e,t){var a=r._state,n=r._scope,o=(r.getters={},r._makeLocalGettersCache=Object.create(null),r._wrappedGetters),i={},s={},c=effectScope(!0);c.run(function(){forEachValue(o,function(e,t){i[t]=partial(e,r),s[t]=computed(function(){return i[t]()}),Object.defineProperty(r.getters,t,{get:function(){return s[t].value},enumerable:!0})})}),r._state=reactive({data:e}),r._scope=c,r.strict&&enableStrictMode(r),a&&t&&r._withCommit(function(){a.data=null}),n&&n.stop()}function installModule(r,a,n,e,o){var t,i,s=!n.length,c=r._modules.getNamespace(n),d=(e.namespaced&&(r._modulesNamespaceMap[c]&&"production"!==process$1.env.NODE_ENV&&console.error("[vuex] duplicate namespace "+c+" for the namespaced module "+n.join("/")),r._modulesNamespaceMap[c]=e),s||o||(t=getNestedState(a,n.slice(0,-1)),i=n[n.length-1],r._withCommit(function(){"production"!==process$1.env.NODE_ENV&&i in t&&console.warn('[vuex] state field "'+i+'" was overridden by a module with the same name at "'+n.join(".")+'"'),t[i]=e.state})),e.context=makeLocalContext(r,c,n));e.forEachMutation(function(e,t){registerMutation(r,c+t,e,d)}),e.forEachAction(function(e,t){t=e.root?t:c+t,e=e.handler||e;registerAction(r,t,e,d)}),e.forEachGetter(function(e,t){registerGetter(r,c+t,e,d)}),e.forEachChild(function(e,t){installModule(r,a,n.concat(t),e,o)})}function makeLocalContext(n,o,e){var t=""===o,r={dispatch:t?n.dispatch:function(e,t,r){var e=unifyObjectStyle(e,t,r),t=e.payload,r=e.options,a=e.type;if(r&&r.root||(a=o+a,"production"===process$1.env.NODE_ENV)||n._actions[a])return n.dispatch(a,t);console.error("[vuex] unknown local action type: "+e.type+", global type: "+a)},commit:t?n.commit:function(e,t,r){var e=unifyObjectStyle(e,t,r),t=e.payload,r=e.options,a=e.type;r&&r.root||(a=o+a,"production"===process$1.env.NODE_ENV)||n._mutations[a]?n.commit(a,t,r):console.error("[vuex] unknown local mutation type: "+e.type+", global type: "+a)}};return Object.defineProperties(r,{getters:{get:t?function(){return n.getters}:function(){return makeLocalGetters(n,o)}},state:{get:function(){return getNestedState(n.state,e)}}}),r}function makeLocalGetters(r,a){var n,o;return r._makeLocalGettersCache[a]||(n={},o=a.length,Object.keys(r.getters).forEach(function(e){var t;e.slice(0,o)===a&&(t=e.slice(o),Object.defineProperty(n,t,{get:function(){return r.getters[e]},enumerable:!0}))}),r._makeLocalGettersCache[a]=n),r._makeLocalGettersCache[a]}function registerMutation(t,e,r,a){(t._mutations[e]||(t._mutations[e]=[])).push(function(e){r.call(t,a.state,e)})}function registerAction(t,e,r,a){(t._actions[e]||(t._actions[e]=[])).push(function(e){e=r.call(t,{dispatch:a.dispatch,commit:a.commit,getters:a.getters,state:a.state,rootGetters:t.getters,rootState:t.state},e);return isPromise(e)||(e=Promise.resolve(e)),t._devtoolHook?e.catch(function(e){throw t._devtoolHook.emit("vuex:error",e),e}):e})}function registerGetter(e,t,r,a){e._wrappedGetters[t]?"production"!==process$1.env.NODE_ENV&&console.error("[vuex] duplicate getter key: "+t):e._wrappedGetters[t]=function(e){return r(a.state,a.getters,e.state,e.getters)}}function enableStrictMode(e){watch(function(){return e._state.data},function(){"production"!==process$1.env.NODE_ENV&&assert(e._committing,"do not mutate vuex store state outside mutation handlers.")},{deep:!0,flush:"sync"})}function getNestedState(e,t){return t.reduce(function(e,t){return e[t]},e)}function unifyObjectStyle(e,t,r){return isObject$6(e)&&e.type&&(r=t,e=(t=e).type),"production"!==process$1.env.NODE_ENV&&assert("string"==typeof e,"expects string as the type, but found "+typeof e+"."),{type:e,payload:t,options:r}}var LABEL_VUEX_BINDINGS="vuex bindings",MUTATIONS_LAYER_ID="vuex:mutations",ACTIONS_LAYER_ID="vuex:actions",INSPECTOR_ID="vuex",actionId=0;function addDevtools(a,o){setupDevtoolsPlugin({id:"org.vuejs.vuex",app:a,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:[LABEL_VUEX_BINDINGS]},function(n){n.addTimelineLayer({id:MUTATIONS_LAYER_ID,label:"Vuex Mutations",color:COLOR_LIME_500}),n.addTimelineLayer({id:ACTIONS_LAYER_ID,label:"Vuex Actions",color:COLOR_LIME_500}),n.addInspector({id:INSPECTOR_ID,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),n.on.getInspectorTree(function(e){var t;e.app===a&&e.inspectorId===INSPECTOR_ID&&(e.filter?(flattenStoreForInspectorTree(t=[],o._modules.root,e.filter,""),e.rootNodes=t):e.rootNodes=[formatStoreForInspectorTree(o._modules.root,"")])}),n.on.getInspectorState(function(e){var t;e.app===a&&e.inspectorId===INSPECTOR_ID&&(t=e.nodeId,makeLocalGetters(o,t),e.state=formatStoreForInspectorState(getStoreModule(o._modules,t),"root"===t?o.getters:o._makeLocalGettersCache,t))}),n.on.editInspectorState(function(e){var t,r;e.app===a&&e.inspectorId===INSPECTOR_ID&&(t=e.nodeId,r=e.path,"root"!==t&&(r=t.split("/").filter(Boolean).concat(r)),o._withCommit(function(){e.set(o._state.data,r,e.state.value)}))}),o.subscribe(function(e,t){var r={};e.payload&&(r.payload=e.payload),r.state=t,n.notifyComponentUpdate(),n.sendInspectorTree(INSPECTOR_ID),n.sendInspectorState(INSPECTOR_ID),n.addTimelineEvent({layerId:MUTATIONS_LAYER_ID,event:{time:Date.now(),title:e.type,data:r}})}),o.subscribeAction({before:function(e,t){var r={};e.payload&&(r.payload=e.payload),e._id=actionId++,e._time=Date.now(),r.state=t,n.addTimelineEvent({layerId:ACTIONS_LAYER_ID,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:r}})},after:function(e,t){var r={},a=Date.now()-e._time;r.duration={_custom:{type:"duration",display:a+"ms",tooltip:"Action duration",value:a}},e.payload&&(r.payload=e.payload),r.state=t,n.addTimelineEvent({layerId:ACTIONS_LAYER_ID,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:r}})}})})}var COLOR_LIME_500=8702998,COLOR_DARK=6710886,COLOR_WHITE=16777215,TAG_NAMESPACED={label:"namespaced",textColor:COLOR_WHITE,backgroundColor:COLOR_DARK};function extractNameFromPath(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function formatStoreForInspectorTree(t,r){return{id:r||"root",label:extractNameFromPath(r),tags:t.namespaced?[TAG_NAMESPACED]:[],children:Object.keys(t._children).map(function(e){return formatStoreForInspectorTree(t._children[e],r+e+"/")})}}function flattenStoreForInspectorTree(t,r,a,n){n.includes(a)&&t.push({id:n||"root",label:n.endsWith("/")?n.slice(0,n.length-1):n||"Root",tags:r.namespaced?[TAG_NAMESPACED]:[]}),Object.keys(r._children).forEach(function(e){flattenStoreForInspectorTree(t,r._children[e],a,n+e+"/")})}function formatStoreForInspectorState(t,e,r){e="root"===r?e:e[r];var a,r=Object.keys(e),n={state:Object.keys(t.state).map(function(e){return{key:e,editable:!0,value:t.state[e]}})};return r.length&&(a=transformPathsToObjectTree(e),n.getters=Object.keys(a).map(function(e){return{key:e.endsWith("/")?extractNameFromPath(e):e,editable:!1,value:canThrow(function(){return a[e]})}})),n}function transformPathsToObjectTree(n){var o={};return Object.keys(n).forEach(function(e){var t,r,a=e.split("/");1<a.length?(t=o,r=a.pop(),a.forEach(function(e){t[e]||(t[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),t=t[e]._custom.value}),t[r]=canThrow(function(){return n[e]})):o[e]=canThrow(function(){return n[e]})}),o}function getStoreModule(e,a){var n=a.split("/").filter(function(e){return e});return n.reduce(function(e,t,r){e=e[t];if(e)return r===n.length-1?e:e._children;throw new Error('Missing module "'+t+'" for path "'+a+'".')},"root"===a?e:e.root._children)}function canThrow(e){try{return e()}catch(e){return e}}var Module=function(e,t){this.runtime=t,this._children=Object.create(null);t=(this._rawModule=e).state;this.state=("function"==typeof t?t():t)||{}},prototypeAccessors$1={namespaced:{configurable:!0}},ModuleCollection=(prototypeAccessors$1.namespaced.get=function(){return!!this._rawModule.namespaced},Module.prototype.addChild=function(e,t){this._children[e]=t},Module.prototype.removeChild=function(e){delete this._children[e]},Module.prototype.getChild=function(e){return this._children[e]},Module.prototype.hasChild=function(e){return e in this._children},Module.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},Module.prototype.forEachChild=function(e){forEachValue(this._children,e)},Module.prototype.forEachGetter=function(e){this._rawModule.getters&&forEachValue(this._rawModule.getters,e)},Module.prototype.forEachAction=function(e){this._rawModule.actions&&forEachValue(this._rawModule.actions,e)},Module.prototype.forEachMutation=function(e){this._rawModule.mutations&&forEachValue(this._rawModule.mutations,e)},Object.defineProperties(Module.prototype,prototypeAccessors$1),function(e){this.register([],e,!1)});function update(e,t,r){if("production"!==process$1.env.NODE_ENV&&assertRawModule(e,r),t.update(r),r.modules)for(var a in r.modules){if(!t.getChild(a))return void("production"!==process$1.env.NODE_ENV&&console.warn("[vuex] trying to add a new module '"+a+"' on hot reloading, manual reload is needed"));update(e.concat(a),t.getChild(a),r.modules[a])}}ModuleCollection.prototype.get=function(e){return e.reduce(function(e,t){return e.getChild(t)},this.root)},ModuleCollection.prototype.getNamespace=function(e){var r=this.root;return e.reduce(function(e,t){return e+((r=r.getChild(t)).namespaced?t+"/":"")},"")},ModuleCollection.prototype.update=function(e){update([],this.root,e)},ModuleCollection.prototype.register=function(r,e,a){var n=this,t=(void 0===a&&(a=!0),"production"!==process$1.env.NODE_ENV&&assertRawModule(r,e),new Module(e,a));0===r.length?this.root=t:this.get(r.slice(0,-1)).addChild(r[r.length-1],t),e.modules&&forEachValue(e.modules,function(e,t){n.register(r.concat(t),e,a)})},ModuleCollection.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),e=e[e.length-1],r=t.getChild(e);r?r.runtime&&t.removeChild(e):"production"!==process$1.env.NODE_ENV&&console.warn("[vuex] trying to unregister module '"+e+"', which is not registered")},ModuleCollection.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),e=e[e.length-1];return!!t&&t.hasChild(e)};var functionAssert={assert:function(e){return"function"==typeof e},expected:"function"},objectAssert={assert:function(e){return"function"==typeof e||"object"==typeof e&&"function"==typeof e.handler},expected:'function or object with "handler" function'},assertTypes={getters:functionAssert,mutations:functionAssert,actions:objectAssert};function assertRawModule(n,e){Object.keys(assertTypes).forEach(function(r){var a;e[r]&&(a=assertTypes[r],forEachValue(e[r],function(e,t){assert(a.assert(e),makeAssertionMessage(n,r,t,e,a.expected))}))})}function makeAssertionMessage(e,t,r,a,n){n=t+" should be "+n+' but "'+t+"."+r+'"';return 0<e.length&&(n+=' in module "'+e.join(".")+'"'),n+=" is "+JSON.stringify(a)+"."}function createStore(e){return new Store(e)}var Store=function e(t){var r=this,a=(void 0===t&&(t={}),"production"!==process$1.env.NODE_ENV&&(assert("undefined"!=typeof Promise,"vuex requires a Promise polyfill in this browser."),assert(this instanceof e,"store must be called with the new operator.")),t.plugins),n=(void 0===a&&(a=[]),t.strict),o=(void 0===n&&(n=!1),t.devtools),i=(this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new ModuleCollection(t),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=o,this),s=this.dispatch,c=this.commit,t=(this.dispatch=function(e,t){return s.call(i,e,t)},this.commit=function(e,t,r){return c.call(i,e,t,r)},this.strict=n,this._modules.root.state);installModule(this,t,[],this._modules.root),resetStoreState(this,t),a.forEach(function(e){return e(r)})},prototypeAccessors={state:{configurable:!0}};function createLogger(e){var o=(e=void 0===e?{}:e).collapsed,i=(void 0===o&&(o=!0),e.filter),s=(void 0===i&&(i=function(e,t,r){return!0}),e.transformer),c=(void 0===s&&(s=function(e){return e}),e.mutationTransformer),a=(void 0===c&&(c=function(e){return e}),e.actionFilter),d=(void 0===a&&(a=function(e,t){return!0}),e.actionTransformer),t=(void 0===d&&(d=function(e){return e}),e.logMutations),r=(void 0===t&&(t=!0),e.logActions),l=(void 0===r&&(r=!0),e.logger);return void 0===l&&(l=console),function(e){var n=deepCopy(e.state);void 0!==l&&(t&&e.subscribe(function(e,t){var r,a,t=deepCopy(t);i(e,n,t)&&(r=getFormattedTime(),a=c(e),e="mutation "+e.type+r,startMessage(l,e,o),l.log("%c prev state","color: #9E9E9E; font-weight: bold",s(n)),l.log("%c mutation","color: #03A9F4; font-weight: bold",a),l.log("%c next state","color: #4CAF50; font-weight: bold",s(t)),endMessage(l)),n=t}),r)&&e.subscribeAction(function(e,t){var r;a(e,t)&&(t=getFormattedTime(),r=d(e),e="action "+e.type+t,startMessage(l,e,o),l.log("%c action","color: #03A9F4; font-weight: bold",r),endMessage(l))})}}function startMessage(t,r,e){e=e?t.groupCollapsed:t.group;try{e.call(t,r)}catch(e){t.log(r)}}function endMessage(t){try{t.groupEnd()}catch(e){t.log("—— log end ——")}}function getFormattedTime(){var e=new Date;return" @ "+pad(e.getHours(),2)+":"+pad(e.getMinutes(),2)+":"+pad(e.getSeconds(),2)+"."+pad(e.getMilliseconds(),3)}function repeat(e,t){return new Array(t+1).join(e)}function pad(e,t){return repeat("0",t-e.toString().length)+e}Store.prototype.install=function(e,t){e.provide(t||storeKey,this),(void 0!==(e.config.globalProperties.$store=this)._devtools?this._devtools:"production"!==process$1.env.NODE_ENV||__VUE_PROD_DEVTOOLS__)&&addDevtools(e,this)},prototypeAccessors.state.get=function(){return this._state.data},prototypeAccessors.state.set=function(e){"production"!==process$1.env.NODE_ENV&&assert(!1,"use store.replaceState() to explicit replace store state.")},Store.prototype.commit=function(e,t,r){var a=this,e=unifyObjectStyle(e,t,r),t=e.type,n=e.payload,r=e.options,o={type:t,payload:n},i=this._mutations[t];i?(this._withCommit(function(){i.forEach(function(e){e(n)})}),this._subscribers.slice().forEach(function(e){return e(o,a.state)}),"production"!==process$1.env.NODE_ENV&&r&&r.silent&&console.warn("[vuex] mutation type: "+t+". Silent option has been removed. Use the filter functionality in the vue-devtools")):"production"!==process$1.env.NODE_ENV&&console.error("[vuex] unknown mutation type: "+t)},Store.prototype.dispatch=function(e,t){var r=this,e=unifyObjectStyle(e,t),t=e.type,a=e.payload,n={type:t,payload:a},e=this._actions[t];if(e){try{this._actionSubscribers.slice().filter(function(e){return e.before}).forEach(function(e){return e.before(n,r.state)})}catch(e){"production"!==process$1.env.NODE_ENV&&(console.warn("[vuex] error in before action subscribers: "),console.error(e))}var o=1<e.length?Promise.all(e.map(function(e){return e(a)})):e[0](a);return new Promise(function(t,e){o.then(function(e){try{r._actionSubscribers.filter(function(e){return e.after}).forEach(function(e){return e.after(n,r.state)})}catch(e){"production"!==process$1.env.NODE_ENV&&(console.warn("[vuex] error in after action subscribers: "),console.error(e))}t(e)},function(t){try{r._actionSubscribers.filter(function(e){return e.error}).forEach(function(e){return e.error(n,r.state,t)})}catch(e){"production"!==process$1.env.NODE_ENV&&(console.warn("[vuex] error in error action subscribers: "),console.error(e))}e(t)})})}"production"!==process$1.env.NODE_ENV&&console.error("[vuex] unknown action type: "+t)},Store.prototype.subscribe=function(e,t){return genericSubscribe(e,this._subscribers,t)},Store.prototype.subscribeAction=function(e,t){return genericSubscribe("function"==typeof e?{before:e}:e,this._actionSubscribers,t)},Store.prototype.watch=function(e,t,r){var a=this;return"production"!==process$1.env.NODE_ENV&&assert("function"==typeof e,"store.watch only accepts a function."),watch(function(){return e(a.state,a.getters)},t,Object.assign({},r))},Store.prototype.replaceState=function(e){var t=this;this._withCommit(function(){t._state.data=e})},Store.prototype.registerModule=function(e,t,r){void 0===r&&(r={}),"string"==typeof e&&(e=[e]),"production"!==process$1.env.NODE_ENV&&(assert(Array.isArray(e),"module path must be a string or an Array."),assert(0<e.length,"cannot register the root module by using registerModule.")),this._modules.register(e,t),installModule(this,this.state,e,this._modules.get(e),r.preserveState),resetStoreState(this,this.state)},Store.prototype.unregisterModule=function(e){var t=this;"string"==typeof e&&(e=[e]),"production"!==process$1.env.NODE_ENV&&assert(Array.isArray(e),"module path must be a string or an Array."),this._modules.unregister(e),this._withCommit(function(){delete getNestedState(t.state,e.slice(0,-1))[e[e.length-1]]}),resetStore(this)},Store.prototype.hasModule=function(e){return"string"==typeof e&&(e=[e]),"production"!==process$1.env.NODE_ENV&&assert(Array.isArray(e),"module path must be a string or an Array."),this._modules.isRegistered(e)},Store.prototype.hotUpdate=function(e){this._modules.update(e),resetStore(this,!0)},Store.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(Store.prototype,prototypeAccessors);const SET_STREAM="setStream",SET_WEBRTC_OBJ="setWebrtcObj";var _ms_2_1_2_ms,hasRequired_ms_2_1_2_ms,store$5=createStore({modules:{stream:{state:{cc:{},wc:{}},mutations:{[SET_STREAM](e,t){e.cc={...e.cc,...t}},[SET_WEBRTC_OBJ](e,t){e.wc={...e.wc,...t}}}}},strict:!0,plugins:[createLogger()]}),lib$3={},browser={exports:{}};function require_ms_2_1_2_ms(){var n,o,i,s,c,d;return hasRequired_ms_2_1_2_ms||(hasRequired_ms_2_1_2_ms=1,c=7*(s=24*(i=60*(o=60*(n=1e3)))),d=365.25*s,_ms_2_1_2_ms=function(e,t){t=t||{};var r=typeof e;if(!("string"==r&&0<e.length)){if("number"==r&&isFinite(e))return(t.long?function(e){var t=Math.abs(e);if(s<=t)return l(e,t,s,"day");if(i<=t)return l(e,t,i,"hour");if(o<=t)return l(e,t,o,"minute");if(n<=t)return l(e,t,n,"second");return e+" ms"}:function(e){var t=Math.abs(e);if(s<=t)return Math.round(e/s)+"d";if(i<=t)return Math.round(e/i)+"h";if(o<=t)return Math.round(e/o)+"m";if(n<=t)return Math.round(e/n)+"s";return e+"ms"})(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}r=e;if(!(100<(r=String(r)).length)){r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(r){var a=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*d;case"weeks":case"week":case"w":return a*c;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*i;case"minutes":case"minute":case"mins":case"min":case"m":return a*o;case"seconds":case"second":case"secs":case"sec":case"s":return a*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}}}),_ms_2_1_2_ms;function l(e,t,r,a){t=1.5*r<=t;return Math.round(e/r)+" "+a+(t?"s":"")}}function setup$1(t){function s(e){let r,t=null,a,n;function i(...n){if(i.enabled){const o=i;var e=Number(new Date),t=e-(r||e);o.diff=t,o.prev=r,o.curr=e,r=e,n[0]=s.coerce(n[0]),"string"!=typeof n[0]&&n.unshift("%O");let a=0;n[0]=n[0].replace(/%([a-zA-Z%])/g,(e,t)=>{if("%%"===e)return"%";a++;var r,t=s.formatters[t];return"function"==typeof t&&(r=n[a],e=t.call(o,r),n.splice(a,1),a--),e}),s.formatArgs.call(o,n),(o.log||s.log).apply(o,n)}}return i.namespace=e,i.useColors=s.useColors(),i.color=s.selectColor(e),i.extend=o,i.destroy=s.destroy,Object.defineProperty(i,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==t?t:(a!==s.namespaces&&(a=s.namespaces,n=s.enabled(e)),n),set:e=>{t=e}}),"function"==typeof s.init&&s.init(i),i}function o(e,t){t=s(this.namespace+(void 0===t?":":t)+e);return t.log=this.log,t}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return((s.debug=s).default=s).coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},s.disable=function(){var e=[...s.names.map(r),...s.skips.map(r).map(e=>"-"+e)].join(",");return s.enable(""),e},s.enable=function(e){s.save(e),s.namespaces=e,s.names=[],s.skips=[];let t;var r=("string"==typeof e?e:"").split(/[\s,]+/),a=r.length;for(t=0;t<a;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?s.skips.push(new RegExp("^"+e.slice(1)+"$")):s.names.push(new RegExp("^"+e+"$")))},s.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=s.skips.length;t<r;t++)if(s.skips[t].test(e))return!1;for(t=0,r=s.names.length;t<r;t++)if(s.names[t].test(e))return!0;return!1},s.humanize=require_ms_2_1_2_ms(),s.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{s[e]=t[e]}),s.names=[],s.skips=[],s.formatters={},s.selectColor=function(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return s.colors[Math.abs(r)%s.colors.length]},s.enable(s.load()),s}var common=setup$1,debug$1=(!function(t,r){r.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),this.useColors){var a="color: "+this.color;e.splice(1,0,a,"color: inherit");let t=0,r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(t++,"%c"===e)&&(r=t)}),e.splice(r,0,a)}},r.save=function(e){try{e?r.storage.setItem("debug",e):r.storage.removeItem("debug")}catch(e){}},r.load=function(){let e;try{e=r.storage.getItem("debug")}catch(e){}!e&&void 0!==process$1&&"env"in process$1&&(e=process$1.env.DEBUG);return e},r.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},r.storage=function(){try{return localStorage}catch(e){}}(),r.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.log=console.debug||console.log||(()=>{}),t.exports=common(r);var e=t.exports["formatters"];e.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}}(browser,browser.exports),browser.exports),Device$1={},es5={exports:{}},bowser=(!function(){function n(e){var t;return(a[e]||(t=a[e]={i:e,l:!1,exports:{}},r[e].call(t.exports,t,t.exports,n),t.l=!0,t)).exports}var r,a;es5.exports=(r={17:function(e,t,r){t.__esModule=!0,t.default=void 0;var a=r(18);function c(){}c.getFirstMatch=function(e,t){t=t.match(e);return t&&0<t.length&&t[1]||""},c.getSecondMatch=function(e,t){t=t.match(e);return t&&1<t.length&&t[2]||""},c.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},c.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},c.getMacOSVersionName=function(e){e=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},c.getAndroidVersionName=function(e){e=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&6<=e[1]?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&2<e[1]?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&4<=e[1]?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},c.getVersionPrecision=function(e){return e.split(".").length},c.compareVersions=function(e,t,r){void 0===r&&(r=!1);var a=c.getVersionPrecision(e),n=c.getVersionPrecision(t),o=Math.max(a,n),i=0,s=c.map([e,t],function(e){var t=o-c.getVersionPrecision(e),e=e+new Array(1+t).join(".0");return c.map(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(r&&(i=o-Math.min(a,n)),--o;i<=o;){if(s[0][o]>s[1][o])return 1;if(s[0][o]===s[1][o]){if(o===i)return 0;--o}else if(s[0][o]<s[1][o])return-1}},c.map=function(e,t){var r,a=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)a.push(t(e[r]));return a},c.find=function(e,t){var r,a;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,a=e.length;r<a;r+=1){var n=e[r];if(t(n,r))return n}},c.assign=function(e){for(var r=e,t=arguments.length,a=new Array(1<t?t-1:0),n=1;n<t;n++)a[n-1]=arguments[n];if(Object.assign)return Object.assign.apply(Object,[e].concat(a));for(var o=0,i=a.length;o<i;o+=1)!function(){var t=a[o];"object"==typeof t&&null!==t&&Object.keys(t).forEach(function(e){r[e]=t[e]})}();return e},c.getBrowserAlias=function(e){return a.BROWSER_ALIASES_MAP[e]},c.getBrowserTypeByAlias=function(e){return a.BROWSER_MAP[e]||""},t.default=c,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var a,n=(a=r(91))&&a.__esModule?a:{default:a},o=r(18);function i(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function s(){}s.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new n.default(e,t)},s.parse=function(e){return new n.default(e).getResult()},a=s,r=[{key:"BROWSER_MAP",get:function(){return o.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return o.ENGINE_MAP}},{key:"OS_MAP",get:function(){return o.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return o.PLATFORMS_MAP}}],null&&i(a.prototype,null),i(a,r),t.default=s,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var a=s(r(92)),n=s(r(93)),o=s(r(94)),i=s(r(95)),c=s(r(17));function s(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}(r=d.prototype).getUA=function(){return this._ua},r.test=function(e){return e.test(this._ua)},r.parseBrowser=function(){var t=this,e=(this.parsedResult.browser={},c.default.find(a.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},r.getBrowser=function(){return this.parsedResult.browser||this.parseBrowser()},r.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},r.getBrowserVersion=function(){return this.getBrowser().version},r.getOS=function(){return this.parsedResult.os||this.parseOS()},r.parseOS=function(){var t=this,e=(this.parsedResult.os={},c.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},r.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},r.getOSVersion=function(){return this.getOS().version},r.getPlatform=function(){return this.parsedResult.platform||this.parsePlatform()},r.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},r.parsePlatform=function(){var t=this,e=(this.parsedResult.platform={},c.default.find(o.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},r.getEngine=function(){return this.parsedResult.engine||this.parseEngine()},r.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},r.parseEngine=function(){var t=this,e=(this.parsedResult.engine={},c.default.find(i.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},r.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},r.getResult=function(){return c.default.assign({},this.parsedResult)},r.satisfies=function(r){var t=this,a={},n=0,o={},i=0;if(Object.keys(r).forEach(function(e){var t=r[e];"string"==typeof t?(o[e]=t,i+=1):"object"==typeof t&&(a[e]=t,n+=1)}),0<n){var e=Object.keys(a),s=c.default.find(e,function(e){return t.isOS(e)});if(s){s=this.satisfies(a[s]);if(void 0!==s)return s}s=c.default.find(e,function(e){return t.isPlatform(e)});if(s){e=this.satisfies(a[s]);if(void 0!==e)return e}}if(0<i){s=Object.keys(o),e=c.default.find(s,function(e){return t.isBrowser(e,!0)});if(void 0!==e)return this.compareVersion(o[e])}},r.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),e=e.toLowerCase(),a=c.default.getBrowserTypeByAlias(e);return(e=t&&a?a.toLowerCase():e)===r},r.compareVersion=function(e){var t=[0],r=e,a=!1,n=this.getBrowserVersion();if("string"==typeof n)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(a=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(a=!0,r=e.substr(1)),-1<t.indexOf(c.default.compareVersions(n,r,a))},r.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},r.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},r.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},r.is=function(e,t){return this.isBrowser(e,t=void 0===t?!1:t)||this.isOS(e)||this.isPlatform(e)},r.some=function(e){var t=this;return(e=void 0===e?[]:e).some(function(e){return t.is(e)})},t.default=d,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var a=(r=r(17))&&r.__esModule?r:{default:r},n=/version\/(\d+(\.?_?\d+)+)/i;t.default=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},e=a.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},e=a.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},e=a.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},e=a.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},e=a.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},e=a.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},e=a.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},e=a.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},e=a.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},e=a.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},e=a.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},e=a.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},e=a.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},e=a.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},e=a.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return e&&(t.version=e),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},e=a.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},e=a.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},e=a.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},e=a.default.getFirstMatch(n,e)||a.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},e=a.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},e=a.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},e=a.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},e=a.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},e=a.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},e=a.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},e=a.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},e=a.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},e=a.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:function(e){var t=!e.test(/like android/i),e=e.test(/android/i);return t&&e},describe:function(e){var t={name:"Android Browser"},e=a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},e=a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},e=a.default.getFirstMatch(n,e);return e&&(t.version=e),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:a.default.getFirstMatch(t,e),version:a.default.getSecondMatch(t,e)}}}],e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},o=r(18);t.default=[{test:[/Roku\/DVP/],describe:function(e){e=n.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:o.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(e){e=n.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(e){var e=n.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),t=n.default.getWindowsVersionName(e);return{name:o.OS_MAP.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:o.OS_MAP.iOS},e=n.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return e&&(t.version=e),t}},{test:[/macintosh/i],describe:function(e){var e=n.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),t=n.default.getMacOSVersionName(e),e={name:o.OS_MAP.MacOS,version:e};return t&&(e.versionName=t),e}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){e=n.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:o.OS_MAP.iOS,version:e}}},{test:function(e){var t=!e.test(/like android/i),e=e.test(/android/i);return t&&e},describe:function(e){var e=n.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),t=n.default.getAndroidVersionName(e),e={name:o.OS_MAP.Android,version:e};return t&&(e.versionName=t),e}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var e=n.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),t={name:o.OS_MAP.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){e=n.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||n.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||n.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:o.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(e){e=n.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(e){e=n.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:o.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:o.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){e=n.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:o.OS_MAP.PlayStation4,version:e}}}],e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},o=r(18);t.default=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var e=n.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",t={type:o.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),e=e.test(/like (ipod|iphone)/i);return t&&!e},describe:function(e){e=n.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:o.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:o.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&3<=t},describe:function(){return{type:o.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:o.PLATFORMS_MAP.tv}}}],e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var a,n=(a=r(17))&&a.__esModule?a:{default:a},o=r(18);t.default=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){return/\sedg\//i.test(e)?{name:o.ENGINE_MAP.Blink}:(e=n.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e),{name:o.ENGINE_MAP.EdgeHTML,version:e})}},{test:[/trident/i],describe:function(e){var t={name:o.ENGINE_MAP.Trident},e=n.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:o.ENGINE_MAP.Presto},e=n.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:function(e){var t=e.test(/gecko/i),e=e.test(/like gecko/i);return t&&!e},describe:function(e){var t={name:o.ENGINE_MAP.Gecko},e=n.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:o.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:o.ENGINE_MAP.WebKit},e=n.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}}],e.exports=t.default}},a={},n.m=r,n.c=a,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)n.d(r,a,function(e){return t[e]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=90))}(),getDefaultExportFromCjs(es5.exports)),Logger$9={},__importDefault$2=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Logger$9,"__esModule",{value:!0}),Logger$9.Logger=void 0;const debug_1$1=__importDefault$2(browser.exports),APP_NAME$2="mediasoup-client";class Logger$8{constructor(e){e?(this._debug=(0,debug_1$1.default)(APP_NAME$2+":"+e),this._warn=(0,debug_1$1.default)(APP_NAME$2+":WARN:"+e),this._error=(0,debug_1$1.default)(APP_NAME$2+":ERROR:"+e)):(this._debug=(0,debug_1$1.default)(APP_NAME$2),this._warn=(0,debug_1$1.default)(APP_NAME$2+":WARN"),this._error=(0,debug_1$1.default)(APP_NAME$2+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}Logger$9.Logger=Logger$8;var domain,EnhancedEventEmitter$4={};function EventHandlers(){}function EventEmitter$1(){EventEmitter$1.init.call(this)}function $getMaxListeners(e){return void 0===e._maxListeners?EventEmitter$1.defaultMaxListeners:e._maxListeners}function emitNone(e,t,r){if(t)e.call(r);else for(var a=e.length,n=arrayClone(e,a),o=0;o<a;++o)n[o].call(r)}function emitOne(e,t,r,a){if(t)e.call(r,a);else for(var n=e.length,o=arrayClone(e,n),i=0;i<n;++i)o[i].call(r,a)}function emitTwo(e,t,r,a,n){if(t)e.call(r,a,n);else for(var o=e.length,i=arrayClone(e,o),s=0;s<o;++s)i[s].call(r,a,n)}function emitThree(e,t,r,a,n,o){if(t)e.call(r,a,n,o);else for(var i=e.length,s=arrayClone(e,i),c=0;c<i;++c)s[c].call(r,a,n,o)}function emitMany(e,t,r,a){if(t)e.apply(r,a);else for(var n=e.length,o=arrayClone(e,n),i=0;i<n;++i)o[i].apply(r,a)}function _addListener(e,t,r,a){var n,o;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(n=e._events)?(n.newListener&&(e.emit("newListener",t,r.listener||r),n=e._events),o=n[t]):(n=e._events=new EventHandlers,e._eventsCount=0),o?("function"==typeof o?o=n[t]=a?[r,o]:[o,r]:a?o.unshift(r):o.push(r),o.warned||(a=$getMaxListeners(e))&&0<a&&o.length>a&&(o.warned=!0,(a=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",a.emitter=e,a.type=t,a.count=o.length,emitWarning(a))):(o=n[t]=r,++e._eventsCount),e}function emitWarning(e){"function"==typeof console.warn?console.warn(e):console.log(e)}function _onceWrap(e,t,r){var a=!1;function n(){e.removeListener(t,n),a||(a=!0,r.apply(e,arguments))}return n.listener=r,n}function listenerCount(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function spliceOne(e,t){for(var r=t,a=r+1,n=e.length;a<n;r+=1,a+=1)e[r]=e[a];e.pop()}function arrayClone(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}function unwrapListeners(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}EventHandlers.prototype=Object.create(null),(EventEmitter$1.EventEmitter=EventEmitter$1).usingDomains=!1,EventEmitter$1.prototype.domain=void 0,EventEmitter$1.prototype._events=void 0,EventEmitter$1.prototype._maxListeners=void 0,EventEmitter$1.defaultMaxListeners=10,EventEmitter$1.init=function(){this.domain=null,EventEmitter$1.usingDomains&&domain.active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new EventHandlers,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},EventEmitter$1.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},EventEmitter$1.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter$1.prototype.emit=function(e){var t,r,a,n="error"===e,o=this._events;if(o)n=n&&null==o.error;else if(!n)return!1;if(i=this.domain,n){var i,n=arguments[1];if(i)return(n=n||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,n.domain=i,n.domainThrown=!1,i.emit("error",n),!1;throw n instanceof Error?n:((i=new Error('Uncaught, unspecified "error" event. ('+n+")")).context=n,i)}if(!(t=o[e]))return!1;var s,c="function"==typeof t;switch(s=arguments.length){case 1:emitNone(t,c,this);break;case 2:emitOne(t,c,this,arguments[1]);break;case 3:emitTwo(t,c,this,arguments[1],arguments[2]);break;case 4:emitThree(t,c,this,arguments[1],arguments[2],arguments[3]);break;default:for(r=new Array(s-1),a=1;a<s;a++)r[a-1]=arguments[a];emitMany(t,c,this,r)}return!0},EventEmitter$1.prototype.addListener=function(e,t){return _addListener(this,e,t,!1)},EventEmitter$1.prototype.on=EventEmitter$1.prototype.addListener,EventEmitter$1.prototype.prependListener=function(e,t){return _addListener(this,e,t,!0)},EventEmitter$1.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,_onceWrap(this,e,t)),this},EventEmitter$1.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,_onceWrap(this,e,t)),this},EventEmitter$1.prototype.removeListener=function(e,t){var r,a,n,o,i;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((a=this._events)&&(r=a[e]))if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new EventHandlers:(delete a[e],a.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(n=-1,o=r.length;0<o--;)if(r[o]===t||r[o].listener&&r[o].listener===t){i=r[o].listener,n=o;break}if(n<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new EventHandlers,this;delete a[e]}else spliceOne(r,n);a.removeListener&&this.emit("removeListener",e,i||t)}return this},EventEmitter$1.prototype.removeAllListeners=function(e){var t,r=this._events;if(r)if(r.removeListener){if(0===arguments.length){for(var a,n=Object.keys(r),o=0;o<n.length;++o)"removeListener"!==(a=n[o])&&this.removeAllListeners(a);this.removeAllListeners("removeListener"),this._events=new EventHandlers,this._eventsCount=0}else if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(;this.removeListener(e,t[t.length-1]),t[0];);}else 0===arguments.length?(this._events=new EventHandlers,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new EventHandlers:delete r[e]);return this},EventEmitter$1.prototype.listeners=function(e){var t=this._events,e=t&&(t=t[e])?"function"==typeof t?[t.listener||t]:unwrapListeners(t):[];return e},EventEmitter$1.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):listenerCount.call(e,t)},EventEmitter$1.prototype.listenerCount=listenerCount,EventEmitter$1.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};var events=Object.freeze({__proto__:null,default:EventEmitter$1,EventEmitter:EventEmitter$1}),require$$0$1=getAugmentedNamespace(events);Object.defineProperty(EnhancedEventEmitter$4,"__esModule",{value:!0}),EnhancedEventEmitter$4.EnhancedEventEmitter=void 0;const events_1=require$$0$1,Logger_1$j=Logger$9,logger$n=new Logger_1$j.Logger("EnhancedEventEmitter");class EnhancedEventEmitter$3 extends events_1.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(t,...e){var r=super.listenerCount(t);try{return super.emit(t,...e)}catch(e){return logger$n.error("safeEmit() | event listener threw an error [eventName:%s]:%o",t,e),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}EnhancedEventEmitter$4.EnhancedEventEmitter=EnhancedEventEmitter$3;var errors={};Object.defineProperty(errors,"__esModule",{value:!0}),errors.InvalidStateError=errors.UnsupportedError=void 0;class UnsupportedError extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,UnsupportedError):this.stack=new Error(e).stack}}errors.UnsupportedError=UnsupportedError;class InvalidStateError extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,InvalidStateError):this.stack=new Error(e).stack}}errors.InvalidStateError=InvalidStateError;var utils$g={};function clone(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))}function generateRandomNumber$1(){return Math.round(1e7*Math.random())}Object.defineProperty(utils$g,"__esModule",{value:!0}),utils$g.generateRandomNumber=utils$g.clone=void 0,utils$g.clone=clone,utils$g.generateRandomNumber=generateRandomNumber$1;var ortc$c={},_h264ProfileLevelId_1_0_1_h264ProfileLevelId={},__createBinding$g=(!function(o){const i=browser.exports("h264-profile-level-id"),s=(i.log=console.info.bind(console),o.ProfileConstrainedBaseline=1,o.ProfileBaseline=2,o.ProfileMain=3,o.ProfileConstrainedHigh=4,o.ProfileHigh=5,0),c=10;o.Level1_b=s,o.Level1=c,o.Level1_1=11,o.Level1_2=12,o.Level1_3=13,o.Level2=20,o.Level2_1=21,o.Level2_2=22,o.Level3=30,o.Level3_1=31,o.Level3_2=32,o.Level4=40,o.Level4_1=41,o.Level4_2=42,o.Level5=50,o.Level5_1=51,o.Level5_2=52;class d{constructor(e,t){this.profile=e,this.level=t}}const t=new(o.ProfileLevelId=d)(1,31);class e{constructor(e){this._mask=~a("x",e),this._maskedValue=a("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class r{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const l=[new r(66,new e("x1xx0000"),1),new r(77,new e("1xxx0000"),1),new r(88,new e("11xx0000"),1),new r(66,new e("x0xx0000"),2),new r(88,new e("10xx0000"),2),new r(77,new e("0x0x0000"),3),new r(100,new e("00000000"),5),new r(100,new e("00001100"),4)];function a(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function p(e={}){e=e["level-asymmetry-allowed"];return 1===e||"1"===e}o.parseProfileLevelId=function(t){if("string"==typeof t&&6===t.length){t=parseInt(t,16);if(0!==t){var r=255&t,a=t>>8&255,n=t>>16&255;let e;switch(r){case 11:e=0!=(16&a)?s:11;break;case c:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:e=r;break;default:return i("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const o of l)if(n===o.profile_idc&&o.profile_iop.isMatch(a))return new d(o.profile,e);i("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination")}}return null},o.profileLevelIdToString=function(e){if(e.level==s)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return i("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return i("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r="0"+r),""+t+r},o.parseSdpProfileLevelId=function(e={}){e=e["profile-level-id"];return e?o.parseProfileLevelId(e):t},o.isSameProfile=function(e={},t={}){e=o.parseSdpProfileLevelId(e),t=o.parseSdpProfileLevelId(t);return Boolean(e&&t&&e.profile===t.profile)},o.generateProfileLevelIdForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"])return i("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;var r=o.parseSdpProfileLevelId(e),a=o.parseSdpProfileLevelId(t);if(!r)throw new TypeError("invalid local_profile_level_id");if(!a)throw new TypeError("invalid remote_profile_level_id");if(r.profile!==a.profile)throw new TypeError("H264 Profile mismatch");var e=p(e)&&p(t),t=r.level,a=a.level,n=function(e,t){return e===s?t!==c&&t!==s:t===s?e!==c:e<t}(n=t,a=a)?n:a,a=e?t:n;return i("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",r.profile,a),o.profileLevelIdToString(new d(r.profile,a))}}(_h264ProfileLevelId_1_0_1_h264ProfileLevelId),commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]})),__setModuleDefault$g=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$g=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$g(t,e,r);return __setModuleDefault$g(t,e),t};Object.defineProperty(ortc$c,"__esModule",{value:!0}),ortc$c.canReceive=ortc$c.canSend=ortc$c.generateProbatorRtpParameters=ortc$c.reduceCodecs=ortc$c.getSendingRemoteRtpParameters=ortc$c.getSendingRtpParameters=ortc$c.getRecvRtpCapabilities=ortc$c.getExtendedRtpCapabilities=ortc$c.validateSctpStreamParameters=ortc$c.validateSctpParameters=ortc$c.validateNumSctpStreams=ortc$c.validateSctpCapabilities=ortc$c.validateRtcpParameters=ortc$c.validateRtpEncodingParameters=ortc$c.validateRtpHeaderExtensionParameters=ortc$c.validateRtpCodecParameters=ortc$c.validateRtpParameters=ortc$c.validateRtpHeaderExtension=ortc$c.validateRtcpFeedback=ortc$c.validateRtpCodecCapability=ortc$c.validateRtpCapabilities=void 0;const h264=__importStar$g(_h264ProfileLevelId_1_0_1_h264ProfileLevelId),utils$f=__importStar$g(utils$g),RTP_PROBATOR_MID="probator",RTP_PROBATOR_SSRC=1234,RTP_PROBATOR_CODEC_PAYLOAD_TYPE=127;function validateRtpCapabilities(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)validateRtpCodecCapability(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const r of e.headerExtensions)validateRtpHeaderExtension(r)}function validateRtpCodecCapability(t){var e=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof t)throw new TypeError("codec is not an object");if(!t.mimeType||"string"!=typeof t.mimeType)throw new TypeError("missing codec.mimeType");e=e.exec(t.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");if(t.kind=e[1].toLowerCase(),t.preferredPayloadType&&"number"!=typeof t.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof t.clockRate)throw new TypeError("missing codec.clockRate");"audio"===t.kind?"number"!=typeof t.channels&&(t.channels=1):delete t.channels,t.parameters&&"object"==typeof t.parameters||(t.parameters={});for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(void 0===e&&(t.parameters[r]="",e=""),"string"!=typeof e&&"number"!=typeof e)throw new TypeError(`invalid codec parameter [key:${r}s, value:${e}]`);if("apt"===r&&"number"!=typeof e)throw new TypeError("invalid codec apt parameter")}t.rtcpFeedback&&Array.isArray(t.rtcpFeedback)||(t.rtcpFeedback=[]);for(const a of t.rtcpFeedback)validateRtcpFeedback(a)}function validateRtcpFeedback(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function validateRtpHeaderExtension(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function validateRtpParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)validateRtpCodecParameters(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const r of e.headerExtensions)validateRtpHeaderExtensionParameters(r);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const a of e.encodings)validateRtpEncodingParameters(a);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),validateRtcpParameters(e.rtcp)}function validateRtpCodecParameters(t){var e=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof t)throw new TypeError("codec is not an object");if(!t.mimeType||"string"!=typeof t.mimeType)throw new TypeError("missing codec.mimeType");e=e.exec(t.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");if("number"!=typeof t.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof t.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e[1].toLowerCase()?"number"!=typeof t.channels&&(t.channels=1):delete t.channels,t.parameters&&"object"==typeof t.parameters||(t.parameters={});for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(void 0===e&&(t.parameters[r]="",e=""),"string"!=typeof e&&"number"!=typeof e)throw new TypeError(`invalid codec parameter [key:${r}s, value:${e}]`);if("apt"===r&&"number"!=typeof e)throw new TypeError("invalid codec apt parameter")}t.rtcpFeedback&&Array.isArray(t.rtcpFeedback)||(t.rtcpFeedback=[]);for(const a of t.rtcpFeedback)validateRtcpFeedback(a)}function validateRtpHeaderExtensionParameters(t){if("object"!=typeof t)throw new TypeError("ext is not an object");if(!t.uri||"string"!=typeof t.uri)throw new TypeError("missing ext.uri");if("number"!=typeof t.id)throw new TypeError("missing ext.id");if(t.encrypt&&"boolean"!=typeof t.encrypt)throw new TypeError("invalid ext.encrypt");t.encrypt||(t.encrypt=!1),t.parameters&&"object"==typeof t.parameters||(t.parameters={});for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(void 0===e&&(t.parameters[r]="",e=""),"string"!=typeof e&&"number"!=typeof e)throw new TypeError("invalid header extension parameter")}}function validateRtpEncodingParameters(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function validateRtcpParameters(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function validateSctpCapabilities(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");validateNumSctpStreams(e.numStreams)}function validateNumSctpStreams(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function validateSctpParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")}function validateSctpStreamParameters(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")}function getExtendedRtpCapabilities(e,t){var r,a={codecs:[],headerExtensions:[]};for(const c of t.codecs||[])isRtxCodec(c)||(r=(e.codecs||[]).find(e=>matchCodecs(e,c,{strict:!0,modify:!0})))&&(r={mimeType:r.mimeType,kind:r.kind,clockRate:r.clockRate,channels:r.channels,localPayloadType:r.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:c.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:r.parameters,remoteParameters:c.parameters,rtcpFeedback:reduceRtcpFeedback(r,c)},a.codecs.push(r));for(const d of a.codecs){var n=e.codecs.find(e=>isRtxCodec(e)&&e.parameters.apt===d.localPayloadType),o=t.codecs.find(e=>isRtxCodec(e)&&e.parameters.apt===d.remotePayloadType);n&&o&&(d.localRtxPayloadType=n.preferredPayloadType,d.remoteRtxPayloadType=o.preferredPayloadType)}for(const l of t.headerExtensions){var i=e.headerExtensions.find(e=>matchHeaderExtensions(e,l));if(i){var s={kind:l.kind,uri:l.uri,sendId:i.preferredId,recvId:l.preferredId,encrypt:i.preferredEncrypt,direction:"sendrecv"};switch(l.direction){case"sendrecv":s.direction="sendrecv";break;case"recvonly":s.direction="sendonly";break;case"sendonly":s.direction="recvonly";break;case"inactive":s.direction="inactive"}a.headerExtensions.push(s)}}return a}function getRecvRtpCapabilities(e){var t,r={codecs:[],headerExtensions:[]};for(const n of e.codecs){var a={mimeType:n.mimeType,kind:n.kind,preferredPayloadType:n.remotePayloadType,clockRate:n.clockRate,channels:n.channels,parameters:n.localParameters,rtcpFeedback:n.rtcpFeedback};r.codecs.push(a),n.remoteRtxPayloadType&&(a={mimeType:n.kind+"/rtx",kind:n.kind,preferredPayloadType:n.remoteRtxPayloadType,clockRate:n.clockRate,parameters:{apt:n.remotePayloadType},rtcpFeedback:[]},r.codecs.push(a))}for(const o of e.headerExtensions)"sendrecv"!==o.direction&&"recvonly"!==o.direction||(t={kind:o.kind,uri:o.uri,preferredId:o.recvId,preferredEncrypt:o.encrypt,direction:o.direction},r.headerExtensions.push(t));return r}function getSendingRtpParameters(e,t){var r,a,n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const o of t.codecs)o.kind===e&&(r={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.localParameters,rtcpFeedback:o.rtcpFeedback},n.codecs.push(r),o.localRtxPayloadType)&&(r={mimeType:o.kind+"/rtx",payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]},n.codecs.push(r));for(const i of t.headerExtensions)i.kind&&i.kind!==e||"sendrecv"!==i.direction&&"sendonly"!==i.direction||(a={uri:i.uri,id:i.sendId,encrypt:i.encrypt,parameters:{}},n.headerExtensions.push(a));return n}function getSendingRemoteRtpParameters(e,t){var r,a,n={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const o of t.codecs)o.kind===e&&(r={mimeType:o.mimeType,payloadType:o.localPayloadType,clockRate:o.clockRate,channels:o.channels,parameters:o.remoteParameters,rtcpFeedback:o.rtcpFeedback},n.codecs.push(r),o.localRtxPayloadType)&&(r={mimeType:o.kind+"/rtx",payloadType:o.localRtxPayloadType,clockRate:o.clockRate,parameters:{apt:o.localPayloadType},rtcpFeedback:[]},n.codecs.push(r));for(const i of t.headerExtensions)i.kind&&i.kind!==e||"sendrecv"!==i.direction&&"sendonly"!==i.direction||(a={uri:i.uri,id:i.sendId,encrypt:i.encrypt,parameters:{}},n.headerExtensions.push(a));if(n.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(const s of n.codecs)s.rtcpFeedback=(s.rtcpFeedback||[]).filter(e=>"goog-remb"!==e.type);else if(n.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(const c of n.codecs)c.rtcpFeedback=(c.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type);else for(const d of n.codecs)d.rtcpFeedback=(d.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return n}function reduceCodecs(t,r){var a=[];if(r){for(let e=0;e<t.length;++e)if(matchCodecs(t[e],r)){a.push(t[e]),isRtxCodec(t[e+1])&&a.push(t[e+1]);break}if(0===a.length)throw new TypeError("no matching codec found")}else a.push(t[0]),isRtxCodec(t[1])&&a.push(t[1]);return a}function generateProbatorRtpParameters(e){validateRtpParameters(e=utils$f.clone(e,{}));var t={mid:RTP_PROBATOR_MID,codecs:[],headerExtensions:[],encodings:[{ssrc:RTP_PROBATOR_SSRC}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=RTP_PROBATOR_CODEC_PAYLOAD_TYPE,t.headerExtensions=e.headerExtensions,t}function canSend(t,e){return e.codecs.some(e=>e.kind===t)}function canReceive(e,t){if(validateRtpParameters(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===r.payloadType)}function isRtxCodec(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function matchCodecs(t,r,{strict:e=!1,modify:a=!1}={}){var n=t.mimeType.toLowerCase();if(n!==r.mimeType.toLowerCase())return!1;if(t.clockRate!==r.clockRate)return!1;if(t.channels!==r.channels)return!1;switch(n){case"video/h264":if(e){if((t.parameters["packetization-mode"]||0)!==(r.parameters["packetization-mode"]||0))return!1;if(!h264.isSameProfile(t.parameters,r.parameters))return!1;let e;try{e=h264.generateProfileLevelIdForAnswer(t.parameters,r.parameters)}catch(e){return!1}a&&(e?(t.parameters["profile-level-id"]=e,r.parameters["profile-level-id"]=e):(delete t.parameters["profile-level-id"],delete r.parameters["profile-level-id"]))}break;case"video/vp9":if(e)if((t.parameters["profile-id"]||0)!==(r.parameters["profile-id"]||0))return!1}return!0}function matchHeaderExtensions(e,t){return!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri)}function reduceRtcpFeedback(e,t){var r=[];for(const n of e.rtcpFeedback||[]){var a=(t.rtcpFeedback||[]).find(e=>e.type===n.type&&(e.parameter===n.parameter||!e.parameter&&!n.parameter));a&&r.push(a)}return r}ortc$c.validateRtpCapabilities=validateRtpCapabilities,ortc$c.validateRtpCodecCapability=validateRtpCodecCapability,ortc$c.validateRtcpFeedback=validateRtcpFeedback,ortc$c.validateRtpHeaderExtension=validateRtpHeaderExtension,ortc$c.validateRtpParameters=validateRtpParameters,ortc$c.validateRtpCodecParameters=validateRtpCodecParameters,ortc$c.validateRtpHeaderExtensionParameters=validateRtpHeaderExtensionParameters,ortc$c.validateRtpEncodingParameters=validateRtpEncodingParameters,ortc$c.validateRtcpParameters=validateRtcpParameters,ortc$c.validateSctpCapabilities=validateSctpCapabilities,ortc$c.validateNumSctpStreams=validateNumSctpStreams,ortc$c.validateSctpParameters=validateSctpParameters,ortc$c.validateSctpStreamParameters=validateSctpStreamParameters,ortc$c.getExtendedRtpCapabilities=getExtendedRtpCapabilities,ortc$c.getRecvRtpCapabilities=getRecvRtpCapabilities,ortc$c.getSendingRtpParameters=getSendingRtpParameters,ortc$c.getSendingRemoteRtpParameters=getSendingRemoteRtpParameters,ortc$c.reduceCodecs=reduceCodecs,ortc$c.generateProbatorRtpParameters=generateProbatorRtpParameters,ortc$c.canSend=canSend,ortc$c.canReceive=canReceive;var Transport$1={},lib$2={},Logger$7={},__importDefault$1=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Logger$7,"__esModule",{value:!0}),Logger$7.Logger=void 0;const debug_1=__importDefault$1(browser.exports),LIB_NAME="awaitqueue";class Logger$6{constructor(e){e?(this._debug=(0,debug_1.default)(LIB_NAME+":"+e),this._warn=(0,debug_1.default)(LIB_NAME+":WARN:"+e),this._error=(0,debug_1.default)(LIB_NAME+":ERROR:"+e)):(this._debug=(0,debug_1.default)(LIB_NAME),this._warn=(0,debug_1.default)(LIB_NAME+":WARN"),this._error=(0,debug_1.default)(LIB_NAME+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}Logger$7.Logger=Logger$6,Object.defineProperty(lib$2,"__esModule",{value:!0}),lib$2.AwaitQueue=lib$2.AwaitQueueRemovedTaskError=lib$2.AwaitQueueStoppedError=void 0;const Logger_1$i=Logger$7,logger$m=new Logger_1$i.Logger;class AwaitQueueStoppedError extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,AwaitQueueStoppedError)}}lib$2.AwaitQueueStoppedError=AwaitQueueStoppedError;class AwaitQueueRemovedTaskError extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,AwaitQueueRemovedTaskError)}}lib$2.AwaitQueueRemovedTaskError=AwaitQueueRemovedTaskError;class AwaitQueue{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,n){if(n=null!=n?n:e.name,logger$m.debug(`push() [name:${n}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(n)try{Object.defineProperty(e,"name",{value:n})}catch(e){}return new Promise((t,r)=>{const a={id:this.nextTaskId++,task:e,name:n,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{a.completed||(a.completed=!0,this.pendingTasks.delete(a.id),logger$m.debug(`resolving task [name:${a.name}]`),t(e),[e]=this.pendingTasks.values(),e&&!e.executedAt&&this.execute(e))},reject:e=>{a.completed||(a.completed=!0,this.pendingTasks.delete(a.id),logger$m.debug(`rejecting task [name:${a.name}]: %s`,String(e)),r(e),this.stopping)||([e]=this.pendingTasks.values(),e&&!e.executedAt&&this.execute(e))}};this.pendingTasks.set(a.id,a),1===this.pendingTasks.size&&this.execute(a)})}stop(){logger$m.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())logger$m.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new AwaitQueueStoppedError);this.stopping=!1}remove(e){logger$m.debug(`remove() [taskIdx:${e}]`);var t=Array.from(this.pendingTasks.values())[e];t?t.reject(new AwaitQueueRemovedTaskError):logger$m.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const t=Date.now();let r=0;return Array.from(this.pendingTasks.values()).map(e=>({idx:r++,task:e.task,name:e.name,enqueuedTime:e.executedAt?e.executedAt-e.enqueuedAt:t-e.enqueuedAt,executionTime:e.executedAt?t-e.executedAt:0}))}async execute(t){if(logger$m.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{var e=await t.task();t.resolve(e)}catch(e){t.reject(e)}}}lib$2.AwaitQueue=AwaitQueue;var Producer$1={};Object.defineProperty(Producer$1,"__esModule",{value:!0}),Producer$1.Producer=void 0;const Logger_1$h=Logger$9,EnhancedEventEmitter_1$7=EnhancedEventEmitter$4,errors_1$8=errors,logger$l=new Logger_1$h.Logger("Producer");class Producer extends EnhancedEventEmitter_1$7.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:a,rtpParameters:n,stopTracks:o,disableTrackOnPause:i,zeroRtpOnPause:s,appData:c}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$7.EnhancedEventEmitter,logger$l.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=a,this._kind=a.kind,this._rtpParameters=n,this._paused=!!i&&!a.enabled,this._maxSpatialLayer=void 0,this._stopTracks=o,this._disableTrackOnPause=i,this._zeroRtpOnPause=s,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$l.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$l.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new errors_1$8.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){logger$l.debug("pause()"),this._closed?logger$l.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){logger$l.debug("resume()"),this._closed?logger$l.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:r}){if(logger$l.debug("replaceTrack() [track:%o]",r),this._closed){if(r&&this._stopTracks)try{r.stop()}catch(e){}throw new errors_1$8.InvalidStateError("closed")}if(r&&"ended"===r.readyState)throw new errors_1$8.InvalidStateError("track ended");r===this._track?logger$l.debug("replaceTrack() | same track, ignored"):(await new Promise((e,t)=>{this.safeEmit("@replacetrack",r,e,t)}),this.destroyTrack(),this._track=r,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack())}async setMaxSpatialLayer(r){if(this._closed)throw new errors_1$8.InvalidStateError("closed");if("video"!==this._kind)throw new errors_1$8.UnsupportedError("not a video Producer");if("number"!=typeof r)throw new TypeError("invalid spatialLayer");r!==this._maxSpatialLayer&&(await new Promise((e,t)=>{this.safeEmit("@setmaxspatiallayer",r,e,t)}).catch(()=>{}),this._maxSpatialLayer=r)}async setRtpEncodingParameters(r){if(this._closed)throw new errors_1$8.InvalidStateError("closed");if("object"!=typeof r)throw new TypeError("invalid params");await new Promise((e,t)=>{this.safeEmit("@setrtpencodingparameters",r,e,t)})}onTrackEnded(){logger$l.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}Producer$1.Producer=Producer;var Consumer$1={};Object.defineProperty(Consumer$1,"__esModule",{value:!0}),Consumer$1.Consumer=void 0;const Logger_1$g=Logger$9,EnhancedEventEmitter_1$6=EnhancedEventEmitter$4,errors_1$7=errors,logger$k=new Logger_1$g.Logger("Consumer");class Consumer extends EnhancedEventEmitter_1$6.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:a,track:n,rtpParameters:o,appData:i}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$6.EnhancedEventEmitter,logger$k.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=a,this._track=n,this._rtpParameters=o,this._paused=!n.enabled,this._appData=i||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$k.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$k.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new errors_1$7.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){logger$k.debug("pause()"),this._closed?logger$k.error("pause() | Consumer closed"):this._paused?logger$k.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){logger$k.debug("resume()"),this._closed?logger$k.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):logger$k.debug("resume() | Consumer is already resumed")}onTrackEnded(){logger$k.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}Consumer$1.Consumer=Consumer;var DataProducer$1={};Object.defineProperty(DataProducer$1,"__esModule",{value:!0}),DataProducer$1.DataProducer=void 0;const Logger_1$f=Logger$9,EnhancedEventEmitter_1$5=EnhancedEventEmitter$4,errors_1$6=errors,logger$j=new Logger_1$f.Logger("DataProducer");class DataProducer extends EnhancedEventEmitter_1$5.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:a}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$5.EnhancedEventEmitter,logger$j.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=a||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$j.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$j.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(logger$j.debug("send()"),this._closed)throw new errors_1$6.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(logger$j.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",t=>{if(!this._closed){let e=t["error"];"sctp-failure"===(e=e||new Error("unknown DataChannel error")).errorDetail?logger$j.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.sctpCauseCode,e.message):logger$j.error('DataChannel "error" event: %o',e),this.safeEmit("error",e)}}),this._dataChannel.addEventListener("close",()=>{this._closed||(logger$j.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||logger$j.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}DataProducer$1.DataProducer=DataProducer;var DataConsumer$1={};Object.defineProperty(DataConsumer$1,"__esModule",{value:!0}),DataConsumer$1.DataConsumer=void 0;const Logger_1$e=Logger$9,EnhancedEventEmitter_1$4=EnhancedEventEmitter$4,logger$i=new Logger_1$e.Logger("DataConsumer");class DataConsumer extends EnhancedEventEmitter_1$4.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:a,appData:n}){super(),this._closed=!1,this._observer=new EnhancedEventEmitter_1$4.EnhancedEventEmitter,logger$i.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=a,this._appData=n||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(logger$i.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(logger$i.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(logger$i.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",t=>{if(!this._closed){let e=t["error"];"sctp-failure"===(e=e||new Error("unknown DataChannel error")).errorDetail?logger$i.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.sctpCauseCode,e.message):logger$i.error('DataChannel "error" event: %o',e),this.safeEmit("error",e)}}),this._dataChannel.addEventListener("close",()=>{this._closed||(logger$i.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}DataConsumer$1.DataConsumer=DataConsumer;var __createBinding$f=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$f=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$f=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$f(t,e,r);return __setModuleDefault$f(t,e),t};Object.defineProperty(Transport$1,"__esModule",{value:!0}),Transport$1.Transport=void 0;const awaitqueue_1=lib$2,Logger_1$d=Logger$9,EnhancedEventEmitter_1$3=EnhancedEventEmitter$4,errors_1$5=errors,utils$e=__importStar$f(utils$g),ortc$b=__importStar$f(ortc$c),Producer_1=Producer$1,Consumer_1=Consumer$1,DataProducer_1=DataProducer$1,DataConsumer_1=DataConsumer$1,logger$h=new Logger_1$d.Logger("Transport");class ConsumerCreationTask{constructor(e){this.consumerOptions=e,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Transport extends EnhancedEventEmitter_1$3.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:p,extendedRtpCapabilities:u,canProduceByKind:h}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new awaitqueue_1.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new EnhancedEventEmitter_1$3.EnhancedEventEmitter,logger$h.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=u,this._canProduceByKind=h,this._maxSctpMessageSize=o?o.maxMessageSize:null,delete(c=utils$e.clone(c,{})).iceServers,delete c.iceTransportPolicy,delete c.bundlePolicy,delete c.rtcpMuxPolicy,delete c.sdpSemantics,this._handler=p(),this._handler.run({direction:e,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}),this._appData=l||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){logger$h.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const t of this._consumers.values())t.transportClosed();this._consumers.clear();for(const r of this._dataProducers.values())r.transportClosed();this._dataProducers.clear();for(const a of this._dataConsumers.values())a.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new errors_1$5.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(logger$h.debug("restartIce()"),this._closed)throw new errors_1$5.InvalidStateError("closed");if(e)return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()");throw new TypeError("missing iceParameters")}async updateIceServers({iceServers:e}={}){if(logger$h.debug("updateIceServers()"),this._closed)throw new errors_1$5.InvalidStateError("closed");if(Array.isArray(e))return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()");throw new TypeError("missing iceServers")}async produce({track:i,encodings:s,codecOptions:c,codec:d,stopTracks:l=!0,disableTrackOnPause:p=!0,zeroRtpOnPause:u=!1,appData:h={}}={}){if(logger$h.debug("produce() [track:%o]",i),this._closed)throw new errors_1$5.InvalidStateError("closed");if(!i)throw new TypeError("missing track");if("send"!==this._direction)throw new errors_1$5.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[i.kind])throw new errors_1$5.UnsupportedError("cannot produce "+i.kind);if("ended"===i.readyState)throw new errors_1$5.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(h&&"object"!=typeof h)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let e;if(s&&!Array.isArray(s))throw TypeError("encodings must be an array");s&&0===s.length?e=void 0:s&&(e=s.map(e=>{var t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t}));const{localId:t,rtpParameters:r,rtpSender:a}=await this._handler.send({track:i,encodings:e,codecOptions:c,codec:d});try{ortc$b.validateRtpParameters(r);var n=(await new Promise((e,t)=>{this.safeEmit("produce",{kind:i.kind,rtpParameters:r,appData:h},e,t)}))["id"],o=new Producer_1.Producer({id:n,localId:t,rtpSender:a,track:i,rtpParameters:r,stopTracks:l,disableTrackOnPause:p,zeroRtpOnPause:u,appData:h});return this._producers.set(o.id,o),this.handleProducer(o),this._observer.safeEmit("newproducer",o),o}catch(e){throw this._handler.stopSending(t).catch(()=>{}),e}},"transport.produce()").catch(e=>{if(l)try{i.stop()}catch(e){}throw e})}async consume({id:e,producerId:t,kind:r,rtpParameters:a,streamId:n,appData:o={}}){if(logger$h.debug("consume()"),a=utils$e.clone(a,void 0),this._closed)throw new errors_1$5.InvalidStateError("closed");if("recv"!==this._direction)throw new errors_1$5.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(o&&"object"!=typeof o)throw new TypeError("if given, appData must be an object");if(ortc$b.canReceive(a,this._extendedRtpCapabilities))return e=new ConsumerCreationTask({id:e,producerId:t,kind:r,rtpParameters:a,streamId:n,appData:o}),this._pendingConsumerTasks.push(e),!1===this._consumerCreationInProgress&&this.createPendingConsumers(),e.promise;throw new errors_1$5.UnsupportedError("cannot consume this Producer")}async produceData({ordered:a=!0,maxPacketLifeTime:n,maxRetransmits:o,label:i="",protocol:s="",appData:c={}}={}){if(logger$h.debug("produceData()"),this._closed)throw new errors_1$5.InvalidStateError("closed");if("send"!==this._direction)throw new errors_1$5.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new errors_1$5.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(c&&"object"!=typeof c)throw new TypeError("if given, appData must be an object");return(n||o)&&(a=!1),this._awaitQueue.push(async()=>{const{dataChannel:e,sctpStreamParameters:r}=await this._handler.sendDataChannel({ordered:a,maxPacketLifeTime:n,maxRetransmits:o,label:i,protocol:s});ortc$b.validateSctpStreamParameters(r);var t=(await new Promise((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:r,label:i,protocol:s,appData:c},e,t)}))["id"],t=new DataProducer_1.DataProducer({id:t,dataChannel:e,sctpStreamParameters:r,appData:c});return this._dataProducers.set(t.id,t),this.handleDataProducer(t),this._observer.safeEmit("newdataproducer",t),t},"transport.produceData()")}async consumeData({id:t,dataProducerId:r,sctpStreamParameters:a,label:n="",protocol:o="",appData:i={}}){if(logger$h.debug("consumeData()"),a=utils$e.clone(a,void 0),this._closed)throw new errors_1$5.InvalidStateError("closed");if("recv"!==this._direction)throw new errors_1$5.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new errors_1$5.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof t)throw new TypeError("missing id");if("string"!=typeof r)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");return ortc$b.validateSctpStreamParameters(a),this._awaitQueue.push(async()=>{var e=(await this._handler.receiveDataChannel({sctpStreamParameters:a,label:n,protocol:o}))["dataChannel"],e=new DataConsumer_1.DataConsumer({id:t,dataProducerId:r,dataChannel:e,sctpStreamParameters:a,appData:i});return this._dataConsumers.set(e.id,e),this.handleDataConsumer(e),this._observer.safeEmit("newdataconsumer",e),e},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingConsumerTasks.length)logger$h.debug("createPendingConsumers() | there is no Consumer to be created");else{var r=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let t=void 0;var e=[];for(const b of r){var{id:a,kind:n,rtpParameters:o,streamId:i}=b.consumerOptions;e.push({trackId:a,kind:n,rtpParameters:o,streamId:i})}try{var s=await this._handler.receive(e);for(let e=0;e<s.length;e++){var c=r[e],d=s[e],{id:l,producerId:p,kind:u,rtpParameters:h,appData:m}=c.consumerOptions,{localId:g,rtpReceiver:f,track:_}=d,y=new Consumer_1.Consumer({id:l,localId:g,producerId:p,rtpReceiver:f,track:_,rtpParameters:h,appData:m});this._consumers.set(y.id,y),this.handleConsumer(y),this._probatorConsumerCreated||t||"video"!==u||(t=y),this._observer.safeEmit("newconsumer",y),c.resolve(y)}}catch(e){for(const w of r)w.reject(e)}if(t)try{var v=ortc$b.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:v}]),logger$h.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){logger$h.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e)}}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,0<this._pendingConsumerTasks.length&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingPauseConsumers.size)logger$h.debug("pausePendingConsumers() | there is no Consumer to be paused");else{var e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{var t=e.map(e=>e.localId);await this._handler.pauseReceiving(t)}catch(e){logger$h.error("pausePendingConsumers() | failed to pause Consumers:",e)}}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,0<this._pendingPauseConsumers.size&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingResumeConsumers.size)logger$h.debug("resumePendingConsumers() | there is no Consumer to be resumed");else{var e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{var t=e.map(e=>e.localId);await this._handler.resumeReceiving(t)}catch(e){logger$h.error("resumePendingConsumers() | failed to resume Consumers:",e)}}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,0<this._pendingResumeConsumers.size&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingCloseConsumers.size)logger$h.debug("closePendingConsumers() | there is no Consumer to be closed");else{var e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(e=>e.localId))}catch(e){logger$h.error("closePendingConsumers() | failed to close Consumers:",e)}}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,0<this._pendingCloseConsumers.size&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){var e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>{this._closed?r(new errors_1$5.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)}),e.on("@connectionstatechange",e=>{e===this._connectionState||(logger$h.debug("connection state changed to %s",e),this._connectionState=e,this._closed)||this.safeEmit("connectionstatechange",e)})}handleProducer(a){a.on("@close",()=>{this._producers.delete(a.id),this._closed||this._awaitQueue.push(async()=>this._handler.stopSending(a.localId),"producer @close event").catch(e=>logger$h.warn("producer.close() failed:%o",e))}),a.on("@pause",(e,t)=>{this._awaitQueue.push(async()=>this._handler.pauseSending(a.localId),"producer @pause event").then(e).catch(t)}),a.on("@resume",(e,t)=>{this._awaitQueue.push(async()=>this._handler.resumeSending(a.localId),"producer @resume event").then(e).catch(t)}),a.on("@replacetrack",(e,t,r)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(a.localId,e),"producer @replacetrack event").then(t).catch(r)}),a.on("@setmaxspatiallayer",(e,t,r)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(a.localId,e),"producer @setmaxspatiallayer event").then(t).catch(r)}),a.on("@setrtpencodingparameters",(e,t,r)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(a.localId,e),"producer @setrtpencodingparameters event").then(t).catch(r)}),a.on("@getstats",(e,t)=>{if(this._closed)return t(new errors_1$5.InvalidStateError("closed"));this._handler.getSenderStats(a.localId).then(e).catch(t)})}handleConsumer(r){r.on("@close",()=>{this._consumers.delete(r.id),this._pendingPauseConsumers.delete(r.id),this._pendingResumeConsumers.delete(r.id),this._closed||(this._pendingCloseConsumers.set(r.id,r),!1===this._consumerCloseInProgress&&this.closePendingConsumers())}),r.on("@pause",()=>{this._pendingResumeConsumers.has(r.id)&&this._pendingResumeConsumers.delete(r.id),this._pendingPauseConsumers.set(r.id,r),!1===this._consumerPauseInProgress&&this.pausePendingConsumers()}),r.on("@resume",()=>{this._pendingPauseConsumers.has(r.id)&&this._pendingPauseConsumers.delete(r.id),this._pendingResumeConsumers.set(r.id,r),!1===this._consumerResumeInProgress&&this.resumePendingConsumers()}),r.on("@getstats",(e,t)=>{if(this._closed)return t(new errors_1$5.InvalidStateError("closed"));this._handler.getReceiverStats(r.localId).then(e).catch(t)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}Transport$1.Transport=Transport;var Chrome74$1={},lib$1={},parser$1={},grammar$2={exports:{}},grammar$1=grammar$2.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s",t=(t+=null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v");return null!=e.generation&&(t+=" generation %d"),t=(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value)&&(t+=":%s"),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return(t+=null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]},grammar=(Object.keys(grammar$1).forEach(function(e){grammar$1[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),!function(e){function s(e,t,r){var a=e.name&&e.names,a=(e.push&&!t[e.push]?t[e.push]=[]:a&&!t[e.name]&&(t[e.name]={}),e.push?{}:a?t[e.name]:t),n=r.match(e.reg),o=a,i=e.names;if((r=e.name)&&!i)o[r]=c(n[1]);else for(var s=0;s<i.length;s+=1)null!=n[s+1]&&(o[i[s]]=c(n[s+1]));e.push&&t[e.push].push(a)}function t(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=c(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e}var c=function(e){return String(Number(e))===e?Number(e):e},d=grammar$2.exports,r=RegExp.prototype.test.bind(/^([a-z])=(.*)/);e.parse=function(e){var t={},o=[],i=t;return e.split(/(\r\n|\r|\n)/).filter(r).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(o.push({rtp:[],fmtp:[]}),i=o[o.length-1]);for(var a=0;a<(d[t]||[]).length;a+=1){var n=d[t][a];if(n.reg.test(r))return s(n,i,r)}}),t.media=o,t};e.parseParams=function(e){return e.split(/;\s?/).reduce(t,{})},e.parseFmtpConfig=e.parseParams,e.parsePayloads=function(e){return e.toString().split(" ").map(Number)},e.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(c),a=0;a<r.length;a+=3)t.push({component:r[a],ip:r[a+1],port:r[a+2]});return t},e.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(t,{})})},e.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=c(e):(t=c(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}}(parser$1),grammar$2.exports),formatRegExp=/%[sdv%]/g,format=function(e){var r=1,a=arguments,n=a.length;return e.replace(formatRegExp,function(e){if(n<=r)return e;var t=a[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},makeLine=function(e,t,r){var a=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var n=0;n<t.names.length;n+=1){var o=t.names[n];t.name?a.push(r[t.name][o]):a.push(r[t.names[n]])}else a.push(r[t.name]);return format.apply(null,a)},defaultOuterOrder=["v","o","s","i","u","e","p","c","b","t","r","z","a"],defaultInnerOrder=["i","c","b","a"],writer$1=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||defaultOuterOrder,a=t.innerOrder||defaultInnerOrder,n=[];return r.forEach(function(r){grammar[r].forEach(function(t){t.name in e&&null!=e[t.name]?n.push(makeLine(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){n.push(makeLine(r,t,e))})})}),e.media.forEach(function(e){n.push(makeLine("m",grammar.m[0],e)),a.forEach(function(r){grammar[r].forEach(function(t){t.name in e&&null!=e[t.name]?n.push(makeLine(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){n.push(makeLine(r,t,e))})})})}),n.join("\r\n")+"\r\n"},parser=parser$1,writer=writer$1,commonUtils=(lib$1.write=writer,lib$1.parse=parser.parse,lib$1.parseParams=parser.parseParams,lib$1.parseFmtpConfig=parser.parseFmtpConfig,lib$1.parsePayloads=parser.parsePayloads,lib$1.parseRemoteCandidates=parser.parseRemoteCandidates,lib$1.parseImageAttributes=parser.parseImageAttributes,lib$1.parseSimulcastStreamList=parser.parseSimulcastStreamList,{}),__createBinding$e=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$e=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$e=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$e(t,e,r);return __setModuleDefault$e(t,e),t};Object.defineProperty(commonUtils,"__esModule",{value:!0}),commonUtils.applyCodecParameters=commonUtils.getCname=commonUtils.extractDtlsParameters=commonUtils.extractRtpCapabilities=void 0;const sdpTransform$a=__importStar$e(lib$1);function extractRtpCapabilities({sdpObject:e}){var t=new Map,r=[];let a=!1,n=!1;for(const u of e.media){var o,i=u.type;switch(i){case"audio":if(a)continue;a=!0;break;case"video":if(n)continue;n=!0;break;default:continue}for(const h of u.rtp){var s={kind:i,mimeType:i+"/"+h.codec,preferredPayloadType:h.payload,clockRate:h.rate,channels:h.encoding,parameters:{},rtcpFeedback:[]};t.set(s.preferredPayloadType,s)}for(const m of u.fmtp||[]){var c=sdpTransform$a.parseParams(m.config),d=t.get(m.payload);d&&(c&&c.hasOwnProperty("profile-level-id")&&(c["profile-level-id"]=String(c["profile-level-id"])),d.parameters=c)}for(const g of u.rtcpFb||[]){var l={type:g.type,parameter:g.subtype};if(l.parameter||delete l.parameter,"*"!==g.payload){var p=t.get(g.payload);p&&p.rtcpFeedback.push(l)}else for(const f of t.values())f.kind!==i||/.+\/rtx$/i.test(f.mimeType)||f.rtcpFeedback.push(l)}for(const _ of u.ext||[])_["encrypt-uri"]||(o={kind:i,uri:_.uri,preferredId:_.value},r.push(o))}return{codecs:Array.from(t.values()),headerExtensions:r}}function extractDtlsParameters({sdpObject:e}){var t=(e.media||[]).find(e=>e.iceUfrag&&0!==e.port);if(!t)throw new Error("no active media section found");e=t.fingerprint||e.fingerprint;let r;switch(t.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto"}return{role:r,fingerprints:[{algorithm:e.type,value:e.hash}]}}function getCname({offerMediaObject:e}){e=(e.ssrcs||[]).find(e=>"cname"===e.attribute);return e?e.value:""}function applyCodecParameters({offerRtpParameters:e,answerMediaObject:t}){for(const n of e.codecs){var r=n.mimeType.toLowerCase();if("audio/opus"===r)if((t.rtp||[]).find(e=>e.payload===n.payloadType)){t.fmtp=t.fmtp||[];let e=t.fmtp.find(e=>e.payload===n.payloadType);e||(e={payload:n.payloadType,config:""},t.fmtp.push(e));var a=sdpTransform$a.parseParams(e.config);"audio/opus"===r&&void 0!==(r=n.parameters["sprop-stereo"])&&(a.stereo=r?1:0),e.config="";for(const o of Object.keys(a))e.config&&(e.config+=";"),e.config+=o+"="+a[o]}}}commonUtils.extractRtpCapabilities=extractRtpCapabilities,commonUtils.extractDtlsParameters=extractDtlsParameters,commonUtils.getCname=getCname,commonUtils.applyCodecParameters=applyCodecParameters;var unifiedPlanUtils={};function getRtpEncodings$1({offerMediaObject:e}){var t=new Set;for(const l of e.ssrcs||[]){var r=l.id;t.add(r)}if(0===t.size)throw new Error("no a=ssrc lines found");var a,n,o=new Map;for(const p of e.ssrcGroups||[])"FID"===p.semantics&&([a,n]=p.ssrcs.split(/\s+/),a=Number(a),n=Number(n),t.has(a))&&(t.delete(a),t.delete(n),o.set(a,n));for(const u of t)o.set(u,null);var i,s,c=[];for([i,s]of o){var d={ssrc:i};s&&(d.rtx={ssrc:s}),c.push(d)}return c}function addLegacySimulcast$1({offerMediaObject:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");var e=(t.ssrcs||[]).find(e=>"msid"===e.attribute);if(!e)throw new Error("a=ssrc line with msid information not found");var[a,n]=e.value.split(" ");const o=e.id;let i;(t.ssrcGroups||[]).some(e=>{return"FID"===e.semantics&&(e=e.ssrcs.split(/\s+/),Number(e[0])===o)&&(i=Number(e[1]),!0)});e=t.ssrcs.find(e=>"cname"===e.attribute);if(!e)throw new Error("a=ssrc line with cname information not found");var s=e.value,c=[],d=[];for(let e=0;e<r;++e)c.push(o+e),i&&d.push(i+e);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let e=0;e<c.length;++e){var l=c[e];t.ssrcs.push({id:l,attribute:"cname",value:s}),t.ssrcs.push({id:l,attribute:"msid",value:a+" "+n})}for(let e=0;e<d.length;++e){var p=c[e],u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:s}),t.ssrcs.push({id:u,attribute:"msid",value:a+" "+n}),t.ssrcGroups.push({semantics:"FID",ssrcs:p+" "+u})}}Object.defineProperty(unifiedPlanUtils,"__esModule",{value:!0}),unifiedPlanUtils.addLegacySimulcast=unifiedPlanUtils.getRtpEncodings=void 0,unifiedPlanUtils.getRtpEncodings=getRtpEncodings$1,unifiedPlanUtils.addLegacySimulcast=addLegacySimulcast$1;var HandlerInterface$1={};Object.defineProperty(HandlerInterface$1,"__esModule",{value:!0}),HandlerInterface$1.HandlerInterface=void 0;const EnhancedEventEmitter_1$2=EnhancedEventEmitter$4;class HandlerInterface extends EnhancedEventEmitter_1$2.EnhancedEventEmitter{constructor(){super()}}HandlerInterface$1.HandlerInterface=HandlerInterface;var RemoteSdp$1={},MediaSection$1={},__createBinding$d=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$d=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$d=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$d(t,e,r);return __setModuleDefault$d(t,e),t};Object.defineProperty(MediaSection$1,"__esModule",{value:!0}),MediaSection$1.OfferMediaSection=MediaSection$1.AnswerMediaSection=MediaSection$1.MediaSection=void 0;const utils$d=__importStar$d(utils$g);class MediaSection{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:a=!1}){if(this._mediaObject={},this._planB=a,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const o of t){var n={component:1};n.foundation=o.foundation,n.ip=o.ip,n.port=o.port,n.priority=o.priority,n.transport=o.protocol,n.type=o.type,o.tcpType&&(n.tcptype=o.tcpType),this._mediaObject.candidates.push(n)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}MediaSection$1.MediaSection=MediaSection;class AnswerMediaSection extends MediaSection{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:o=!1,offerMediaObject:i,offerRtpParameters:s,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:l=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:o}),this._mediaObject.mid=String(i.mid),this._mediaObject.type=i.type,this._mediaObject.protocol=i.protocol,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),i.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const $ of c.codecs){var p={payload:$.payloadType,codec:getCodecName($),rate:$.clockRate},u=(1<$.channels&&(p.encoding=$.channels),this._mediaObject.rtp.push(p),utils$d.clone($.parameters,{}));if(d){var{opusStereo:h,opusFec:m,opusDtx:g,opusMaxPlaybackRate:f,opusMaxAverageBitrate:_,opusPtime:y,videoGoogleStartBitrate:v,videoGoogleMaxBitrate:b,videoGoogleMinBitrate:w}=d,S=s.codecs.find(e=>e.payloadType===$.payloadType);switch($.mimeType.toLowerCase()){case"audio/opus":void 0!==h&&(S.parameters["sprop-stereo"]=h?1:0,u.stereo=h?1:0),void 0!==m&&(S.parameters.useinbandfec=m?1:0,u.useinbandfec=m?1:0),void 0!==g&&(S.parameters.usedtx=g?1:0,u.usedtx=g?1:0),void 0!==f&&(u.maxplaybackrate=f),void 0!==_&&(u.maxaveragebitrate=_),void 0!==y&&(S.parameters.ptime=y,u.ptime=y);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==v&&(u["x-google-start-bitrate"]=v),void 0!==b&&(u["x-google-max-bitrate"]=b),void 0!==w&&(u["x-google-min-bitrate"]=w)}}var P={payload:$.payloadType,config:""};for(const T of Object.keys(u))P.config&&(P.config+=";"),P.config+=T+"="+u[T];P.config&&this._mediaObject.fmtp.push(P);for(const R of $.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:$.payloadType,type:R.type,subtype:R.parameter})}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const C of c.headerExtensions)(i.ext||[]).some(e=>e.uri===C.uri)&&this._mediaObject.ext.push({uri:C.uri,value:C.id});if(l&&"extmap-allow-mixed"===i.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),i.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:i.simulcast.list1},this._mediaObject.rids=[];for(const E of i.rids||[])"send"===E.direction&&this._mediaObject.rids.push({id:E.id,direction:"recv"})}else if(i.simulcast_03){this._mediaObject.simulcast_03={value:i.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const D of i.rids||[])"send"===D.direction&&this._mediaObject.rids.push({id:D.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof i.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize):i.sctpmap&&(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}}MediaSection$1.AnswerMediaSection=AnswerMediaSection;class OfferMediaSection extends MediaSection{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:o=!1,mid:i,kind:s,offerRtpParameters:c,streamId:d,trackId:l,oldDataChannelSpec:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:o}),this._mediaObject.mid=String(i),this._mediaObject.type=s,n?(this._mediaObject.connection={ip:n.ip,version:n.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=n.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=a?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),s){case"audio":case"video":this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${d||"-"} `+l);for(const f of c.codecs){var u={payload:f.payloadType,codec:getCodecName(f),rate:f.clockRate},h=(1<f.channels&&(u.encoding=f.channels),this._mediaObject.rtp.push(u),{payload:f.payloadType,config:""});for(const _ of Object.keys(f.parameters))h.config&&(h.config+=";"),h.config+=_+"="+f.parameters[_];h.config&&this._mediaObject.fmtp.push(h);for(const y of f.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:f.payloadType,type:y.type,subtype:y.parameter})}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const v of c.headerExtensions)this._mediaObject.ext.push({uri:v.uri,value:v.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";var m=c.encodings[0],g=m.ssrc,m=m.rtx&&m.rtx.ssrc?m.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:g,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:g,attribute:"msid",value:`${d||"-"} `+l}),m&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:m,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:m,attribute:"msid",value:`${d||"-"} `+l}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:g+" "+m}));break;case"application":p?(this._mediaObject.payloads=a.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:a.port,maxMessageSize:a.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=a.port,this._mediaObject.maxMessageSize=a.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){var a=e.encodings[0],n=a.ssrc,a=a.rtx&&a.rtx.ssrc?a.rtx.ssrc:void 0,o=this._mediaObject.payloads.split(" ");for(const c of e.codecs)if(!o.includes(String(c.payloadType))){var i={payload:c.payloadType,codec:getCodecName(c),rate:c.clockRate},s=(1<c.channels&&(i.encoding=c.channels),this._mediaObject.rtp.push(i),{payload:c.payloadType,config:""});for(const d of Object.keys(c.parameters))s.config&&(s.config+=";"),s.config+=d+"="+c.parameters[d];s.config&&this._mediaObject.fmtp.push(s);for(const l of c.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:c.payloadType,type:l.type,subtype:l.parameter})}this._mediaObject.payloads+=" "+e.codecs.filter(e=>!this._mediaObject.payloads.includes(e.payloadType)).map(e=>e.payloadType).join(" "),this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} `+r}),a&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t||"-"} `+r}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:n+" "+a}))}planBStopReceiving({offerRtpParameters:e}){e=e.encodings[0];const t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==t&&e.id!==r),r&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==t+" "+r))}}function getCodecName(e){e=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(e)return e[2];throw new TypeError("invalid codec.mimeType")}MediaSection$1.OfferMediaSection=OfferMediaSection;var __createBinding$c=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$c=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$c=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$c(t,e,r);return __setModuleDefault$c(t,e),t};Object.defineProperty(RemoteSdp$1,"__esModule",{value:!0}),RemoteSdp$1.RemoteSdp=void 0;const sdpTransform$9=__importStar$c(lib$1),Logger_1$c=Logger$9,MediaSection_1=MediaSection$1,logger$g=new Logger_1$c.Logger("RemoteSdp");class RemoteSdp{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:a,plainRtpParameters:n,planB:o=!1}){this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=a,this._plainRtpParameters=n,this._planB=o,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r&&(this._sdpObject.msidSemantic={semantic:"WMS",token:"*"},t=this._dtlsParameters.fingerprints.length,this._sdpObject.fingerprint={type:r.fingerprints[t-1].algorithm,hash:r.fingerprints[t-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]),n&&(this._sdpObject.origin.address=n.ip,this._sdpObject.origin.ipVer=n.ipVersion)}updateIceParameters(e){logger$g.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){logger$g.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:o=!1}){e=new MediaSection_1.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:a,codecOptions:n,extmapAllowMixed:o});t?this._replaceMediaSection(e,t):this._midToIndex.has(e.mid)?this._replaceMediaSection(e):this._addMediaSection(e)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n}){var o=this._midToIndex.get(e);let i;(i=void 0!==o?this._mediaSections[o]:i)?(i.planBReceive({offerRtpParameters:r,streamId:a,trackId:n}),this._replaceMediaSection(i)):(i=new MediaSection_1.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:a,trackId:n}),(o=this._mediaSections.find(e=>e.closed))?this._replaceMediaSection(i,o.mid):this._addMediaSection(i))}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){var t=this._findMediaSection(e);return e===this._firstMid?(logger$g.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}planBStopReceiving({mid:e,offerRtpParameters:t}){var r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);e=this._mediaSections[r];e.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(e)}sendSctpAssociation({offerMediaObject:e}){e=new MediaSection_1.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(e)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){e=new MediaSection_1.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(e)}getSdp(){return this._sdpObject.origin.sessionVersion++,sdpTransform$9.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){var r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);t=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(t.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}}RemoteSdp$1.RemoteSdp=RemoteSdp;var scalabilityModes={};Object.defineProperty(scalabilityModes,"__esModule",{value:!0}),scalabilityModes.parse=void 0;const ScalabilityModeRegex=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");function parse(e){e=ScalabilityModeRegex.exec(e||"");return e?{spatialLayers:Number(e[1]),temporalLayers:Number(e[2])}:{spatialLayers:1,temporalLayers:1}}scalabilityModes.parse=parse;var __createBinding$b=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$b=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$b=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$b(t,e,r);return __setModuleDefault$b(t,e),t};Object.defineProperty(Chrome74$1,"__esModule",{value:!0}),Chrome74$1.Chrome74=void 0;const sdpTransform$8=__importStar$b(lib$1),Logger_1$b=Logger$9,utils$c=__importStar$b(utils$g),ortc$a=__importStar$b(ortc$c),sdpCommonUtils$8=__importStar$b(commonUtils),sdpUnifiedPlanUtils$4=__importStar$b(unifiedPlanUtils),HandlerInterface_1$9=HandlerInterface$1,RemoteSdp_1$8=RemoteSdp$1,scalabilityModes_1$2=scalabilityModes,logger$f=new Logger_1$b.Logger("Chrome74"),SCTP_NUM_STREAMS$8={OS:1024,MIS:1024};class Chrome74 extends HandlerInterface_1$9.HandlerInterface{static createFactory(){return()=>new Chrome74}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(logger$f.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$f.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=sdpTransform$8.parse(e.sdp);return sdpCommonUtils$8.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$f.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$8}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$f.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$8.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:ortc$a.getSendingRtpParameters("audio",d),video:ortc$a.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$a.getSendingRemoteRtpParameters("audio",d),video:ortc$a.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(logger$f.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){logger$f.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$f.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$f.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$f.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$f.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$f.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this.assertSendDirection(),logger$f.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<t.length&&t.forEach((e,t)=>{e.rid="r"+t});var n=utils$c.clone(this._sendingRtpParametersByKind[e.kind],{}),o=(n.codecs=ortc$a.reduceCodecs(n.codecs,a),utils$c.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),a=(o.codecs=ortc$a.reduceCodecs(o.codecs,a),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let i=await this._pc.createOffer(),s=sdpTransform$8.parse(i.sdp),c,d=(this._transportReady||await this.setupTransport({localDtlsRole:null!=(l=this._forcedLocalDtlsRole)?l:"client",localSdpObject:s}),!1);var l=(0,scalabilityModes_1$2.parse)((t||[{}])[0].scalabilityMode),l=(t&&1===t.length&&1<l.spatialLayers&&"video/vp9"===n.codecs[0].mimeType.toLowerCase()&&(logger$f.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,s=sdpTransform$8.parse(i.sdp),c=s.media[a.idx],sdpUnifiedPlanUtils$4.addLegacySimulcast({offerMediaObject:c,numStreams:l.spatialLayers}),i={type:"offer",sdp:sdpTransform$8.write(s)}),logger$f.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),e.mid);if(n.mid=l,s=sdpTransform$8.parse(this._pc.localDescription.sdp),c=s.media[a.idx],n.rtcp.cname=sdpCommonUtils$8.getCname({offerMediaObject:c}),t)if(1===t.length){let e=sdpUnifiedPlanUtils$4.getRtpEncodings({offerMediaObject:c});Object.assign(e[0],t[0]),d&&(e=[e[0]]),n.encodings=e}else n.encodings=t;else n.encodings=sdpUnifiedPlanUtils$4.getRtpEncodings({offerMediaObject:c});if(1<n.encodings.length&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const p of n.encodings)p.scalabilityMode="S1T2";this._remoteSdp.send({offerMediaObject:c,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});t={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$f.debug("send() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.set(l,e),{localId:l,rtpParameters:n,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),logger$f.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),logger$f.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$f.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),logger$f.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),logger$f.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};logger$f.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),logger$f.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";e=await this._pc.createOffer(),logger$f.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$f.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async replaceTrack(e,t){this.assertSendDirection(),t?logger$f.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$f.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$f.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$f.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const a=e.sender.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.sender.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n},t=(logger$f.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$8.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$8.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$f.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$f.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[],a=new Map;for(const m of e){var{trackId:n,kind:o,rtpParameters:i,streamId:s}=m,c=(logger$f.debug("receive() [trackId:%s, kind:%s]",n,o),i.mid||String(this._mapMidTransceiver.size));a.set(n,c),this._remoteSdp.receive({mid:c,kind:o,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(logger$f.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),l=sdpTransform$8.parse(d.sdp);for(const g of e){var{trackId:p,rtpParameters:u}=g;const f=a.get(p);p=l.media.find(e=>String(e.mid)===f);sdpCommonUtils$8.applyCodecParameters({offerRtpParameters:u,answerMediaObject:p})}d={type:"answer",sdp:sdpTransform$8.write(l)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:l}),logger$f.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const y=a.get(h);h=this._pc.getTransceivers().find(e=>e.mid===y);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(y,h),r.push({localId:y,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$f.debug("stopReceiving() [localId:%s]",a);var t=this._mapMidTransceiver.get(a);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(logger$f.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());logger$f.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){logger$f.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$f.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$f.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){logger$f.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$f.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$f.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o,protocol:r},a=(logger$f.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$8.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$f.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$8.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$8.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome74$1.Chrome74=Chrome74;var Chrome70$1={},__createBinding$a=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$a=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$a=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$a(t,e,r);return __setModuleDefault$a(t,e),t};Object.defineProperty(Chrome70$1,"__esModule",{value:!0}),Chrome70$1.Chrome70=void 0;const sdpTransform$7=__importStar$a(lib$1),Logger_1$a=Logger$9,utils$b=__importStar$a(utils$g),ortc$9=__importStar$a(ortc$c),sdpCommonUtils$7=__importStar$a(commonUtils),sdpUnifiedPlanUtils$3=__importStar$a(unifiedPlanUtils),HandlerInterface_1$8=HandlerInterface$1,RemoteSdp_1$7=RemoteSdp$1,scalabilityModes_1$1=scalabilityModes,logger$e=new Logger_1$a.Logger("Chrome70"),SCTP_NUM_STREAMS$7={OS:1024,MIS:1024};class Chrome70 extends HandlerInterface_1$8.HandlerInterface{static createFactory(){return()=>new Chrome70}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(logger$e.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$e.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=sdpTransform$7.parse(e.sdp);return sdpCommonUtils$7.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$e.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$7}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$e.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$7.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:ortc$9.getSendingRtpParameters("audio",d),video:ortc$9.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$9.getSendingRemoteRtpParameters("audio",d),video:ortc$9.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$e.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$e.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$e.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$e.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$e.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$e.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$e.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this.assertSendDirection(),logger$e.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);var n=utils$b.clone(this._sendingRtpParametersByKind[e.kind],{}),o=(n.codecs=ortc$9.reduceCodecs(n.codecs,a),utils$b.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),a=(o.codecs=ortc$9.reduceCodecs(o.codecs,a),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let i=await this._pc.createOffer(),s=sdpTransform$7.parse(i.sdp),c,d=(this._transportReady||await this.setupTransport({localDtlsRole:null!=(l=this._forcedLocalDtlsRole)?l:"client",localSdpObject:s}),t&&1<t.length&&(logger$e.debug("send() | enabling legacy simulcast"),s=sdpTransform$7.parse(i.sdp),c=s.media[a.idx],sdpUnifiedPlanUtils$3.addLegacySimulcast({offerMediaObject:c,numStreams:t.length}),i={type:"offer",sdp:sdpTransform$7.write(s)}),!1);var l=(0,scalabilityModes_1$1.parse)((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&1<l.spatialLayers&&"video/vp9"===n.codecs[0].mimeType.toLowerCase()&&(logger$e.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,s=sdpTransform$7.parse(i.sdp),c=s.media[a.idx],sdpUnifiedPlanUtils$3.addLegacySimulcast({offerMediaObject:c,numStreams:l.spatialLayers}),i={type:"offer",sdp:sdpTransform$7.write(s)}),logger$e.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),t){logger$e.debug("send() | applying given encodings");var p=e.sender.getParameters();for(let e=0;e<(p.encodings||[]).length;++e){var u=p.encodings[e],h=t[e];if(!h)break;p.encodings[e]=Object.assign(u,h)}await e.sender.setParameters(p)}l=e.mid;if(n.mid=l,s=sdpTransform$7.parse(this._pc.localDescription.sdp),c=s.media[a.idx],n.rtcp.cname=sdpCommonUtils$7.getCname({offerMediaObject:c}),n.encodings=sdpUnifiedPlanUtils$3.getRtpEncodings({offerMediaObject:c}),t)for(let e=0;e<n.encodings.length;++e)t[e]&&Object.assign(n.encodings[e],t[e]);if(d&&(n.encodings=[n.encodings[0]]),1<n.encodings.length&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const m of n.encodings)m.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:o,codecOptions:r});a={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$e.debug("send() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.set(l,e),{localId:l,rtpParameters:n,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),logger$e.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),logger$e.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$e.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?logger$e.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$e.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$e.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$e.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const a=e.sender.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.sender.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n},t=(logger$e.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$7.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$7.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$e.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$e.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[],a=new Map;for(const m of e){var{trackId:n,kind:o,rtpParameters:i,streamId:s}=m,c=(logger$e.debug("receive() [trackId:%s, kind:%s]",n,o),i.mid||String(this._mapMidTransceiver.size));a.set(n,c),this._remoteSdp.receive({mid:c,kind:o,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(logger$e.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),l=sdpTransform$7.parse(d.sdp);for(const g of e){var{trackId:p,rtpParameters:u}=g;const f=a.get(p);p=l.media.find(e=>String(e.mid)===f);sdpCommonUtils$7.applyCodecParameters({offerRtpParameters:u,answerMediaObject:p})}d={type:"answer",sdp:sdpTransform$7.write(l)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:l}),logger$e.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const y=a.get(h);h=this._pc.getTransceivers().find(e=>e.mid===y);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(y,h),r.push({localId:y,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$e.debug("stopReceiving() [localId:%s]",a);var t=this._mapMidTransceiver.get(a);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(logger$e.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());logger$e.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:r},a=(logger$e.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$e.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$7.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$e.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$7.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$7.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome70$1.Chrome70=Chrome70;var Chrome67$1={},planBUtils={};function getRtpEncodings({offerMediaObject:e,track:t}){var r,a=new Set;for(const p of e.ssrcs||[])"msid"===p.attribute&&p.value.split(" ")[1]===t.id&&(r=p.id,a.add(r));if(0===a.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);var n,o,i=new Map;for(const u of e.ssrcGroups||[])"FID"===u.semantics&&([n,o]=u.ssrcs.split(/\s+/),n=Number(n),o=Number(o),a.has(n))&&(a.delete(n),a.delete(o),i.set(n,o));for(const h of a)i.set(h,null);var s,c,d=[];for([s,c]of i){var l={ssrc:s};c&&(l.rtx={ssrc:c}),d.push(l)}return d}function addLegacySimulcast({offerMediaObject:t,track:r,numStreams:a}){if(a<=1)throw new TypeError("numStreams must be greater than 1");let n,o,i;if(!(t.ssrcs||[]).find(e=>{return"msid"===e.attribute&&e.value.split(" ")[1]===r.id&&(n=e.id,i=e.value.split(" ")[0],!0)}))throw new Error(`a=ssrc line with msid information not found [track.id:${r.id}]`);(t.ssrcGroups||[]).some(e=>{return"FID"===e.semantics&&(e=e.ssrcs.split(/\s+/),Number(e[0])===n)&&(o=Number(e[1]),!0)});var e=t.ssrcs.find(e=>"cname"===e.attribute&&e.id===n);if(!e)throw new Error(`a=ssrc line with cname information not found [track.id:${r.id}]`);var s=e.value,c=[],d=[];for(let e=0;e<a;++e)c.push(n+e),o&&d.push(o+e);t.ssrcGroups=t.ssrcGroups||[],t.ssrcs=t.ssrcs||[],t.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let e=0;e<c.length;++e){var l=c[e];t.ssrcs.push({id:l,attribute:"cname",value:s}),t.ssrcs.push({id:l,attribute:"msid",value:i+" "+r.id})}for(let e=0;e<d.length;++e){var p=c[e],u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:s}),t.ssrcs.push({id:u,attribute:"msid",value:i+" "+r.id}),t.ssrcGroups.push({semantics:"FID",ssrcs:p+" "+u})}}Object.defineProperty(planBUtils,"__esModule",{value:!0}),planBUtils.addLegacySimulcast=planBUtils.getRtpEncodings=void 0,planBUtils.getRtpEncodings=getRtpEncodings,planBUtils.addLegacySimulcast=addLegacySimulcast;var __createBinding$9=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$9=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$9=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$9(t,e,r);return __setModuleDefault$9(t,e),t};Object.defineProperty(Chrome67$1,"__esModule",{value:!0}),Chrome67$1.Chrome67=void 0;const sdpTransform$6=__importStar$9(lib$1),Logger_1$9=Logger$9,utils$a=__importStar$9(utils$g),ortc$8=__importStar$9(ortc$c),sdpCommonUtils$6=__importStar$9(commonUtils),sdpPlanBUtils$3=__importStar$9(planBUtils),HandlerInterface_1$7=HandlerInterface$1,RemoteSdp_1$6=RemoteSdp$1,logger$d=new Logger_1$9.Logger("Chrome67"),SCTP_NUM_STREAMS$6={OS:1024,MIS:1024};class Chrome67 extends HandlerInterface_1$7.HandlerInterface{static createFactory(){return()=>new Chrome67}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(logger$d.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$d.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=sdpTransform$6.parse(e.sdp);return sdpCommonUtils$6.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$d.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$6}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$d.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$6.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$8.getSendingRtpParameters("audio",d),video:ortc$8.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$8.getSendingRemoteRtpParameters("audio",d),video:ortc$8.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$d.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$d.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$d.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$d.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$d.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$d.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$d.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:a}){this.assertSendDirection(),logger$d.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),a&&logger$d.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addTrack(t,this._sendStream);let n=await this._pc.createOffer(),o=sdpTransform$6.parse(n.sdp),i;var s=utils$a.clone(this._sendingRtpParametersByKind[t.kind],{}),a=(s.codecs=ortc$8.reduceCodecs(s.codecs),utils$a.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(a.codecs=ortc$8.reduceCodecs(a.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:o}),"video"===t.kind&&r&&1<r.length&&(logger$d.debug("send() | enabling simulcast"),o=sdpTransform$6.parse(n.sdp),i=o.media.find(e=>"video"===e.type),sdpPlanBUtils$3.addLegacySimulcast({offerMediaObject:i,track:t,numStreams:r.length}),n={type:"offer",sdp:sdpTransform$6.write(o)}),logger$d.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),o=sdpTransform$6.parse(this._pc.localDescription.sdp),i=o.media.find(e=>e.type===t.kind),s.rtcp.cname=sdpCommonUtils$6.getCname({offerMediaObject:i}),s.encodings=sdpPlanBUtils$3.getRtpEncodings({offerMediaObject:i,track:t}),r)for(let e=0;e<s.encodings.length;++e)r[e]&&Object.assign(s.encodings[e],r[e]);if(1<s.encodings.length&&"video/vp8"===s.codecs[0].mimeType.toLowerCase())for(const d of s.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:s,answerRtpParameters:a,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},a=(logger$d.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId)),e=(this._nextSendLocalId++,this._pc.getSenders().find(e=>e.track===t));return this._mapSendLocalIdRtpSender.set(a,e),{localId:a,rtpParameters:s,rtpSender:e}}async stopSending(e){this.assertSendDirection(),logger$d.debug("stopSending() [localId:%s]",e);var t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);t=await this._pc.createOffer();logger$d.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$d.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$d.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?logger$d.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$d.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var r=e.track;await e.replaceTrack(t),r&&this._sendStream.removeTrack(r),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$d.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var t=e.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$d.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");const a=e.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapSendLocalIdRtpSender.get(e);if(e)return e.getStats();throw new Error("associated RTCRtpSender not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n},t=(logger$d.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$6.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$6.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$d.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$d.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[];for(const g of e){var{trackId:a,kind:n,rtpParameters:o,streamId:i}=g,s=(logger$d.debug("receive() [trackId:%s, kind:%s]",a,n),n);this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:o,streamId:i||o.rtcp.cname,trackId:a})}var c={type:"offer",sdp:this._remoteSdp.getSdp()},c=(logger$d.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c),await this._pc.createAnswer()),d=sdpTransform$6.parse(c.sdp);for(const f of e){var{kind:l,rtpParameters:p}=f;const _=l;l=d.media.find(e=>String(e.mid)===_);sdpCommonUtils$6.applyCodecParameters({offerRtpParameters:p,answerMediaObject:l})}c={type:"answer",sdp:sdpTransform$6.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:d}),logger$d.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const y of e){var{kind:u,trackId:h,rtpParameters:m}=y;const v=h;h=u,u=this._pc.getReceivers().find(e=>e.track&&e.track.id===v);if(!u)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(v,{mid:h,rtpParameters:m,rtpReceiver:u}),r.push({localId:v,track:u.track,rtpReceiver:u})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$d.debug("stopReceiving() [localId:%s]",a);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(a)||{};this._mapRecvLocalIdInfo.delete(a),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$d.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$d.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();e=(this._mapRecvLocalIdInfo.get(e)||{}).rtpReceiver;if(e)return e.getStats();throw new Error("associated RTCRtpReceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:r},a=(logger$d.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$d.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$6.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$d.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$6.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$6.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome67$1.Chrome67=Chrome67;var Chrome55$1={},__createBinding$8=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$8=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$8=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$8(t,e,r);return __setModuleDefault$8(t,e),t};Object.defineProperty(Chrome55$1,"__esModule",{value:!0}),Chrome55$1.Chrome55=void 0;const sdpTransform$5=__importStar$8(lib$1),Logger_1$8=Logger$9,errors_1$4=errors,utils$9=__importStar$8(utils$g),ortc$7=__importStar$8(ortc$c),sdpCommonUtils$5=__importStar$8(commonUtils),sdpPlanBUtils$2=__importStar$8(planBUtils),HandlerInterface_1$6=HandlerInterface$1,RemoteSdp_1$5=RemoteSdp$1,logger$c=new Logger_1$8.Logger("Chrome55"),SCTP_NUM_STREAMS$5={OS:1024,MIS:1024};class Chrome55 extends HandlerInterface_1$6.HandlerInterface{static createFactory(){return()=>new Chrome55}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(logger$c.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$c.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=sdpTransform$5.parse(e.sdp);return sdpCommonUtils$5.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$c.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$5}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$c.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$5.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$7.getSendingRtpParameters("audio",d),video:ortc$7.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$7.getSendingRemoteRtpParameters("audio",d),video:ortc$7.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$c.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$c.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$c.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$c.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$c.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$c.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$c.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:a}){this.assertSendDirection(),logger$c.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),a&&logger$c.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addStream(this._sendStream);let n=await this._pc.createOffer(),o=sdpTransform$5.parse(n.sdp),i;var s=utils$9.clone(this._sendingRtpParametersByKind[t.kind],{}),a=(s.codecs=ortc$7.reduceCodecs(s.codecs),utils$9.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(a.codecs=ortc$7.reduceCodecs(a.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:o}),"video"===t.kind&&r&&1<r.length&&(logger$c.debug("send() | enabling simulcast"),o=sdpTransform$5.parse(n.sdp),i=o.media.find(e=>"video"===e.type),sdpPlanBUtils$2.addLegacySimulcast({offerMediaObject:i,track:t,numStreams:r.length}),n={type:"offer",sdp:sdpTransform$5.write(o)}),logger$c.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),o=sdpTransform$5.parse(this._pc.localDescription.sdp),i=o.media.find(e=>e.type===t.kind),s.rtcp.cname=sdpCommonUtils$5.getCname({offerMediaObject:i}),s.encodings=sdpPlanBUtils$2.getRtpEncodings({offerMediaObject:i,track:t}),r)for(let e=0;e<s.encodings.length;++e)r[e]&&Object.assign(s.encodings[e],r[e]);if(1<s.encodings.length&&"video/vp8"===s.codecs[0].mimeType.toLowerCase())for(const d of s.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:s,answerRtpParameters:a,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},a=(logger$c.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId));return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(a,t),{localId:a,rtpParameters:s}}async stopSending(e){this.assertSendDirection(),logger$c.debug("stopSending() [localId:%s]",e);var t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);e=await this._pc.createOffer();logger$c.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$c.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(t={type:"answer",sdp:this._remoteSdp.getSdp()},logger$c.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new errors_1$4.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new errors_1$4.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new errors_1$4.UnsupportedError("not supported")}async getSenderStats(e){throw new errors_1$4.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n},t=(logger$c.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$5.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$5.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$c.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$c.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[];for(const f of e){var{trackId:a,kind:n,rtpParameters:o,streamId:i}=f,s=(logger$c.debug("receive() [trackId:%s, kind:%s]",a,n),n);this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:o,streamId:i||o.rtcp.cname,trackId:a})}var c={type:"offer",sdp:this._remoteSdp.getSdp()},c=(logger$c.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c),await this._pc.createAnswer()),d=sdpTransform$5.parse(c.sdp);for(const _ of e){var{kind:l,rtpParameters:p}=_;const y=l;l=d.media.find(e=>String(e.mid)===y);sdpCommonUtils$5.applyCodecParameters({offerRtpParameters:p,answerMediaObject:l})}c={type:"answer",sdp:sdpTransform$5.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:d}),logger$c.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const v of e){var{kind:u,trackId:h,rtpParameters:m}=v;const b=v.streamId||m.rtcp.cname;var g=this._pc.getRemoteStreams().find(e=>e.id===b).getTrackById(h);if(!g)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(h,{mid:u,rtpParameters:m}),r.push({localId:h,track:g})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$c.debug("stopReceiving() [localId:%s]",a);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(a)||{};this._mapRecvLocalIdInfo.delete(a),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$c.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$c.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new errors_1$4.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:r},a=(logger$c.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$5.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$c.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$5.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$5.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Chrome55$1.Chrome55=Chrome55;var Firefox60$1={},__createBinding$7=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$7=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$7=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$7(t,e,r);return __setModuleDefault$7(t,e),t};Object.defineProperty(Firefox60$1,"__esModule",{value:!0}),Firefox60$1.Firefox60=void 0;const sdpTransform$4=__importStar$7(lib$1),Logger_1$7=Logger$9,errors_1$3=errors,utils$8=__importStar$7(utils$g),ortc$6=__importStar$7(ortc$c),sdpCommonUtils$4=__importStar$7(commonUtils),sdpUnifiedPlanUtils$2=__importStar$7(unifiedPlanUtils),HandlerInterface_1$5=HandlerInterface$1,RemoteSdp_1$4=RemoteSdp$1,logger$b=new Logger_1$7.Logger("Firefox60"),SCTP_NUM_STREAMS$4={OS:16,MIS:2048};class Firefox60 extends HandlerInterface_1$5.HandlerInterface{static createFactory(){return()=>new Firefox60}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(logger$b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$b.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),r=document.createElement("canvas");r.getContext("2d");var a=r.captureStream().getVideoTracks()[0];try{t.addTransceiver("audio",{direction:"sendrecv"});var e=t.addTransceiver(a,{direction:"sendrecv"}),n=e.sender.getParameters(),o=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],i=(n.encodings=o,await e.sender.setParameters(n),await t.createOffer());try{r.remove()}catch(e){}try{a.stop()}catch(e){}try{t.close()}catch(e){}var s=sdpTransform$4.parse(i.sdp);return sdpCommonUtils$4.extractRtpCapabilities({sdpObject:s})}catch(e){try{r.remove()}catch(e){}try{a.stop()}catch(e){}try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$b.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$4}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$b.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$4.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:ortc$6.getSendingRtpParameters("audio",d),video:ortc$6.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$6.getSendingRemoteRtpParameters("audio",d),video:ortc$6.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){throw new errors_1$3.UnsupportedError("not supported")}async restartIce(e){logger$b.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this.assertSendDirection(),logger$b.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<(t=utils$8.clone(t,[])).length&&(t.forEach((e,t)=>{e.rid="r"+t}),t.reverse());var n=utils$8.clone(this._sendingRtpParametersByKind[e.kind],{}),o=(n.codecs=ortc$6.reduceCodecs(n.codecs,a),utils$8.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),a=(o.codecs=ortc$6.reduceCodecs(o.codecs,a),this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]})),e=(t&&((e=a.sender.getParameters()).encodings=t,await a.sender.setParameters(e)),await this._pc.createOffer()),i=sdpTransform$4.parse(e.sdp),e=(this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:i}),logger$b.debug("send() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),a.mid),i=(n.mid=e,(i=sdpTransform$4.parse(this._pc.localDescription.sdp)).media[i.media.length-1]);if(n.rtcp.cname=sdpCommonUtils$4.getCname({offerMediaObject:i}),t?1===t.length?(s=sdpUnifiedPlanUtils$2.getRtpEncodings({offerMediaObject:i}),Object.assign(s[0],t[0]),n.encodings=s):n.encodings=t.reverse():n.encodings=sdpUnifiedPlanUtils$2.getRtpEncodings({offerMediaObject:i}),1<n.encodings.length&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const c of n.encodings)c.scalabilityMode="S1T2";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:n,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});var s={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",s),await this._pc.setRemoteDescription(s),this._mapMidTransceiver.set(e,a),{localId:e,rtpParameters:n,rtpSender:a.sender}}async stopSending(e){logger$b.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);t=await this._pc.createOffer(),logger$b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),logger$b.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),logger$b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};logger$b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),logger$b.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);t=await this._pc.createOffer(),logger$b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};logger$b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async replaceTrack(e,t){this.assertSendDirection(),t?logger$b.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$b.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated transceiver not found");var t=e.sender.getParameters();r=t.encodings.length-1-r,t.encodings.forEach((e,t)=>{e.active=r<=t}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const a=e.sender.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.sender.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n},logger$b.debug("sendDataChannel() [options:%o]",e),t=this._pc.createDataChannel(a,e),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$4.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$4.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:n}),logger$b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),n={type:"answer",sdp:this._remoteSdp.getSdp()},logger$b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._hasDataChannelMediaSection=!0),r={streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits};return{dataChannel:t,sctpStreamParameters:r}}async receive(e){this.assertRecvDirection();var t=[],r=new Map;for(const m of e){var{trackId:a,kind:n,rtpParameters:o,streamId:i}=m,s=(logger$b.debug("receive() [trackId:%s, kind:%s]",a,n),o.mid||String(this._mapMidTransceiver.size));r.set(a,s),this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:o,streamId:i||o.rtcp.cname,trackId:a})}var c={type:"offer",sdp:this._remoteSdp.getSdp()};logger$b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer();var l=sdpTransform$4.parse(d.sdp);for(const g of e){var{trackId:p,rtpParameters:u}=g;const f=r.get(p);p=l.media.find(e=>String(e.mid)===f);sdpCommonUtils$4.applyCodecParameters({offerRtpParameters:u,answerMediaObject:p}),d={type:"answer",sdp:sdpTransform$4.write(l)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:l}),logger$b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const y=r.get(h);h=this._pc.getTransceivers().find(e=>e.mid===y);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(y,h),t.push({localId:y,track:h.receiver.track,rtpReceiver:h.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$b.debug("stopReceiving() [localId:%s]",a);var t=this._mapMidTransceiver.get(a);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(logger$b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());logger$b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){logger$b.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){logger$b.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o,protocol:r},a=(logger$b.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$4.parse(o.sdp),await this.setupTransport({localDtlsRole:"client",localSdpObject:r})),logger$b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$4.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$4.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Firefox60$1.Firefox60=Firefox60;var Safari12$1={},__createBinding$6=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$6=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$6=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$6(t,e,r);return __setModuleDefault$6(t,e),t};Object.defineProperty(Safari12$1,"__esModule",{value:!0}),Safari12$1.Safari12=void 0;const sdpTransform$3=__importStar$6(lib$1),Logger_1$6=Logger$9,utils$7=__importStar$6(utils$g),ortc$5=__importStar$6(ortc$c),sdpCommonUtils$3=__importStar$6(commonUtils),sdpUnifiedPlanUtils$1=__importStar$6(unifiedPlanUtils),HandlerInterface_1$4=HandlerInterface$1,RemoteSdp_1$3=RemoteSdp$1,logger$a=new Logger_1$6.Logger("Safari12"),SCTP_NUM_STREAMS$3={OS:1024,MIS:1024};class Safari12 extends HandlerInterface_1$4.HandlerInterface{static createFactory(){return()=>new Safari12}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(logger$a.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$a.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=sdpTransform$3.parse(e.sdp);return sdpCommonUtils$3.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$a.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$3}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$a.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$3.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:ortc$5.getSendingRtpParameters("audio",d),video:ortc$5.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$5.getSendingRemoteRtpParameters("audio",d),video:ortc$5.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$a.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$a.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$a.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$a.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$a.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$a.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$a.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this.assertSendDirection(),logger$a.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);var n=utils$7.clone(this._sendingRtpParametersByKind[e.kind],{}),o=(n.codecs=ortc$5.reduceCodecs(n.codecs,a),utils$7.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),a=(o.codecs=ortc$5.reduceCodecs(o.codecs,a),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let i=await this._pc.createOffer(),s=sdpTransform$3.parse(i.sdp),c;this._transportReady||await this.setupTransport({localDtlsRole:null!=(d=this._forcedLocalDtlsRole)?d:"client",localSdpObject:s}),t&&1<t.length&&(logger$a.debug("send() | enabling legacy simulcast"),s=sdpTransform$3.parse(i.sdp),c=s.media[a.idx],sdpUnifiedPlanUtils$1.addLegacySimulcast({offerMediaObject:c,numStreams:t.length}),i={type:"offer",sdp:sdpTransform$3.write(s)}),logger$a.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i);var d=e.mid;if(n.mid=d,s=sdpTransform$3.parse(this._pc.localDescription.sdp),c=s.media[a.idx],n.rtcp.cname=sdpCommonUtils$3.getCname({offerMediaObject:c}),n.encodings=sdpUnifiedPlanUtils$1.getRtpEncodings({offerMediaObject:c}),t)for(let e=0;e<n.encodings.length;++e)t[e]&&Object.assign(n.encodings[e],t[e]);if(1<n.encodings.length&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const l of n.encodings)l.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:o,codecOptions:r});a={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$a.debug("send() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._mapMidTransceiver.set(d,e),{localId:d,rtpParameters:n,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),logger$a.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),logger$a.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$a.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),logger$a.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),logger$a.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};logger$a.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),logger$a.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);t=await this._pc.createOffer(),logger$a.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};logger$a.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async replaceTrack(e,t){this.assertSendDirection(),t?logger$a.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$a.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$a.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$a.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const a=e.sender.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.sender.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n},t=(logger$a.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$3.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$3.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$a.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$a.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[],a=new Map;for(const m of e){var{trackId:n,kind:o,rtpParameters:i,streamId:s}=m,c=(logger$a.debug("receive() [trackId:%s, kind:%s]",n,o),i.mid||String(this._mapMidTransceiver.size));a.set(n,c),this._remoteSdp.receive({mid:c,kind:o,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(logger$a.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),l=sdpTransform$3.parse(d.sdp);for(const g of e){var{trackId:p,rtpParameters:u}=g;const f=a.get(p);p=l.media.find(e=>String(e.mid)===f);sdpCommonUtils$3.applyCodecParameters({offerRtpParameters:u,answerMediaObject:p})}d={type:"answer",sdp:sdpTransform$3.write(l)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:l}),logger$a.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const y=a.get(h);h=this._pc.getTransceivers().find(e=>e.mid===y);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(y,h),r.push({localId:y,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$a.debug("stopReceiving() [localId:%s]",a);var t=this._mapMidTransceiver.get(a);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(logger$a.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());logger$a.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){logger$a.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$a.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$a.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){logger$a.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$a.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$a.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o,protocol:r},a=(logger$a.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$a.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$3.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$a.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$3.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$3.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Safari12$1.Safari12=Safari12;var Safari11$1={},__createBinding$5=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$5=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$5=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$5(t,e,r);return __setModuleDefault$5(t,e),t};Object.defineProperty(Safari11$1,"__esModule",{value:!0}),Safari11$1.Safari11=void 0;const sdpTransform$2=__importStar$5(lib$1),Logger_1$5=Logger$9,utils$6=__importStar$5(utils$g),ortc$4=__importStar$5(ortc$c),sdpCommonUtils$2=__importStar$5(commonUtils),sdpPlanBUtils$1=__importStar$5(planBUtils),HandlerInterface_1$3=HandlerInterface$1,RemoteSdp_1$2=RemoteSdp$1,logger$9=new Logger_1$5.Logger("Safari11"),SCTP_NUM_STREAMS$2={OS:1024,MIS:1024};class Safari11 extends HandlerInterface_1$3.HandlerInterface{static createFactory(){return()=>new Safari11}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(logger$9.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$9.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=sdpTransform$2.parse(e.sdp);return sdpCommonUtils$2.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$9.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$2}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$9.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$2.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$4.getSendingRtpParameters("audio",d),video:ortc$4.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$4.getSendingRemoteRtpParameters("audio",d),video:ortc$4.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$9.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$9.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$9.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$9.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$9.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$9.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$9.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:a}){this.assertSendDirection(),logger$9.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),a&&logger$9.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addTrack(t,this._sendStream);let n=await this._pc.createOffer(),o=sdpTransform$2.parse(n.sdp),i;var s=utils$6.clone(this._sendingRtpParametersByKind[t.kind],{}),a=(s.codecs=ortc$4.reduceCodecs(s.codecs),utils$6.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(a.codecs=ortc$4.reduceCodecs(a.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:o}),"video"===t.kind&&r&&1<r.length&&(logger$9.debug("send() | enabling simulcast"),o=sdpTransform$2.parse(n.sdp),i=o.media.find(e=>"video"===e.type),sdpPlanBUtils$1.addLegacySimulcast({offerMediaObject:i,track:t,numStreams:r.length}),n={type:"offer",sdp:sdpTransform$2.write(o)}),logger$9.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),o=sdpTransform$2.parse(this._pc.localDescription.sdp),i=o.media.find(e=>e.type===t.kind),s.rtcp.cname=sdpCommonUtils$2.getCname({offerMediaObject:i}),s.encodings=sdpPlanBUtils$1.getRtpEncodings({offerMediaObject:i,track:t}),r)for(let e=0;e<s.encodings.length;++e)r[e]&&Object.assign(s.encodings[e],r[e]);if(1<s.encodings.length&&"video/vp8"===s.codecs[0].mimeType.toLowerCase())for(const d of s.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:s,answerRtpParameters:a,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},a=(logger$9.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId)),e=(this._nextSendLocalId++,this._pc.getSenders().find(e=>e.track===t));return this._mapSendLocalIdRtpSender.set(a,e),{localId:a,rtpParameters:s,rtpSender:e}}async stopSending(e){this.assertSendDirection();var t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);t=await this._pc.createOffer();logger$9.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$9.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$9.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?logger$9.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$9.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var r=e.track;await e.replaceTrack(t),r&&this._sendStream.removeTrack(r),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$9.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var t=e.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$9.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");const a=e.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapSendLocalIdRtpSender.get(e);if(e)return e.getStats();throw new Error("associated RTCRtpSender not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n},t=(logger$9.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$2.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$2.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$9.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$9.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[];for(const g of e){var{trackId:a,kind:n,rtpParameters:o,streamId:i}=g,s=(logger$9.debug("receive() [trackId:%s, kind:%s]",a,n),n);this._remoteSdp.receive({mid:s,kind:n,offerRtpParameters:o,streamId:i||o.rtcp.cname,trackId:a})}var c={type:"offer",sdp:this._remoteSdp.getSdp()},c=(logger$9.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c),await this._pc.createAnswer()),d=sdpTransform$2.parse(c.sdp);for(const f of e){var{kind:l,rtpParameters:p}=f;const _=l;l=d.media.find(e=>String(e.mid)===_);sdpCommonUtils$2.applyCodecParameters({offerRtpParameters:p,answerMediaObject:l})}c={type:"answer",sdp:sdpTransform$2.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:d}),logger$9.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const y of e){var{kind:u,trackId:h,rtpParameters:m}=y;const v=h;h=this._pc.getReceivers().find(e=>e.track&&e.track.id===v);if(!h)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(v,{mid:u,rtpParameters:m,rtpReceiver:h}),r.push({localId:v,track:h.track,rtpReceiver:h})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$9.debug("stopReceiving() [localId:%s]",a);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(a)||{};this._mapRecvLocalIdInfo.delete(a),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$9.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$9.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=(this._mapRecvLocalIdInfo.get(e)||{}).rtpReceiver;if(e)return e.getStats();throw new Error("associated RTCRtpReceiver not found")}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o,protocol:r},a=(logger$9.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$9.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$2.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$9.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$2.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$2.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Safari11$1.Safari11=Safari11;var Edge11$1={},edgeUtils$1={},__createBinding$4=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$4=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$4=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$4(t,e,r);return __setModuleDefault$4(t,e),t};Object.defineProperty(edgeUtils$1,"__esModule",{value:!0}),edgeUtils$1.mangleRtpParameters=edgeUtils$1.getCapabilities=void 0;const utils$5=__importStar$4(utils$g);function getCapabilities(){var e,t=RTCRtpReceiver.getCapabilities(),t=utils$5.clone(t,{});for(const r of t.codecs){r.channels=r.numChannels,delete r.numChannels,r.mimeType=r.mimeType||r.kind+"/"+r.name,r.parameters&&((e=r.parameters).apt&&(e.apt=Number(e.apt)),e["packetization-mode"])&&(e["packetization-mode"]=Number(e["packetization-mode"]));for(const a of r.rtcpFeedback||[])a.parameter||(a.parameter="")}return t}function mangleRtpParameters(e){e=utils$5.clone(e,{});e.mid&&(e.muxId=e.mid,delete e.mid);for(const t of e.codecs)t.channels&&(t.numChannels=t.channels,delete t.channels),t.mimeType&&!t.name&&(t.name=t.mimeType.split("/")[1]),delete t.mimeType;return e}edgeUtils$1.getCapabilities=getCapabilities,edgeUtils$1.mangleRtpParameters=mangleRtpParameters;var __createBinding$3=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$3=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$3=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$3(t,e,r);return __setModuleDefault$3(t,e),t};Object.defineProperty(Edge11$1,"__esModule",{value:!0}),Edge11$1.Edge11=void 0;const Logger_1$4=Logger$9,errors_1$2=errors,utils$4=__importStar$3(utils$g),ortc$3=__importStar$3(ortc$c),edgeUtils=__importStar$3(edgeUtils$1),HandlerInterface_1$2=HandlerInterface$1,logger$8=new Logger_1$4.Logger("Edge11");class Edge11 extends HandlerInterface_1$2.HandlerInterface{static createFactory(){return()=>new Edge11}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){logger$8.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const t of this._rtpReceivers.values())try{t.stop()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){return logger$8.debug("getNativeRtpCapabilities()"),edgeUtils.getCapabilities()}async getNativeSctpCapabilities(){return logger$8.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({iceParameters:e,iceCandidates:t,dtlsParameters:r,iceServers:a,iceTransportPolicy:n,extendedRtpCapabilities:o}){logger$8.debug("run()"),this._sendingRtpParametersByKind={audio:ortc$3.getSendingRtpParameters("audio",o),video:ortc$3.getSendingRtpParameters("video",o)},this._remoteIceParameters=e,this._remoteIceCandidates=t,this._remoteDtlsParameters=r,this._cname="CNAME-"+utils$4.generateRandomNumber(),this.setIceGatherer({iceServers:a,iceTransportPolicy:n}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new errors_1$2.UnsupportedError("not supported")}async restartIce(e){if(logger$8.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){logger$8.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codec:r}){logger$8.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),logger$8.debug("send() | calling new RTCRtpSender()");var a=new RTCRtpSender(e,this._dtlsTransport),e=utils$4.clone(this._sendingRtpParametersByKind[e.kind],{}),n=(e.codecs=ortc$3.reduceCodecs(e.codecs,r),e.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType)));for(const o of t=t||[{}])o.ssrc=utils$4.generateRandomNumber(),n&&(o.rtx={ssrc:utils$4.generateRandomNumber()});e.encodings=t,e.rtcp={cname:this._cname,reducedSize:!0,mux:!0};r=edgeUtils.mangleRtpParameters(e),logger$8.debug("send() | calling rtpSender.send() [params:%o]",r),await a.send(r),t=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(t,a),{localId:t,rtpParameters:e,rtpSender:a}}async stopSending(e){logger$8.debug("stopSending() [localId:%s]",e);var t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{logger$8.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw logger$8.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?logger$8.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$8.debug("replaceTrack() [localId:%s, no track]",e);e=this._rtpSenders.get(e);if(!e)throw new Error("RTCRtpSender not found");e.setTrack(t)}async setMaxSpatialLayer(e,r){logger$8.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._rtpSenders.get(e);if(!e)throw new Error("RTCRtpSender not found");var t=e.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.setParameters(t)}async setRtpEncodingParameters(e,r){logger$8.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._rtpSenders.get(e);if(!e)throw new Error("RTCRtpSender not found");const a=e.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.setParameters(a)}async getSenderStats(e){e=this._rtpSenders.get(e);if(e)return e.getStats();throw new Error("RTCRtpSender not found")}async sendDataChannel(e){throw new errors_1$2.UnsupportedError("not implemented")}async receive(e){var t=[];for(const s of e){var{trackId:r,kind:a}=s;logger$8.debug("receive() [trackId:%s, kind:%s]",r,a)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const c of e){var{trackId:n,kind:o,rtpParameters:i}=c,o=(logger$8.debug("receive() | calling new RTCRtpReceiver()"),new RTCRtpReceiver(this._dtlsTransport,o)),i=(o.addEventListener("error",e=>{logger$8.error('rtpReceiver "error" event [event:%o]',e)}),edgeUtils.mangleRtpParameters(i)),i=(logger$8.debug("receive() | calling rtpReceiver.receive() [params:%o]",i),await o.receive(i),n);this._rtpReceivers.set(i,o),t.push({localId:i,track:o.track,rtpReceiver:o})}return t}async stopReceiving(e){for(const r of e){logger$8.debug("stopReceiving() [localId:%s]",r);var t=this._rtpReceivers.get(r);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(r);try{logger$8.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){logger$8.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){e=this._rtpReceivers.get(e);if(e)return e.getStats();throw new Error("RTCRtpReceiver not found")}async receiveDataChannel(e){throw new errors_1$2.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){e=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});e.addEventListener("error",e=>{logger$8.error('iceGatherer "error" event [event:%o]',e)});try{e.gather()}catch(e){logger$8.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=e}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("candidatepairchange",e=>{logger$8.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{logger$8.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{logger$8.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{logger$8.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){logger$8.debug("setupTransport()");const r=this._dtlsTransport.getLocalParameters();r.role=e,await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}Edge11$1.Edge11=Edge11;var ReactNativeUnifiedPlan$1={},__createBinding$2=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$2=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$2=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$2(t,e,r);return __setModuleDefault$2(t,e),t};Object.defineProperty(ReactNativeUnifiedPlan$1,"__esModule",{value:!0}),ReactNativeUnifiedPlan$1.ReactNativeUnifiedPlan=void 0;const sdpTransform$1=__importStar$2(lib$1),Logger_1$3=Logger$9,utils$3=__importStar$2(utils$g),ortc$2=__importStar$2(ortc$c),sdpCommonUtils$1=__importStar$2(commonUtils),sdpUnifiedPlanUtils=__importStar$2(unifiedPlanUtils),HandlerInterface_1$1=HandlerInterface$1,RemoteSdp_1$1=RemoteSdp$1,scalabilityModes_1=scalabilityModes,logger$7=new Logger_1$3.Logger("ReactNativeUnifiedPlan"),SCTP_NUM_STREAMS$1={OS:1024,MIS:1024};class ReactNativeUnifiedPlan extends HandlerInterface_1$1.HandlerInterface{static createFactory(){return()=>new ReactNativeUnifiedPlan}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(logger$7.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$7.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=sdpTransform$1.parse(e.sdp);return sdpCommonUtils$1.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$7.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS$1}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$7.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1$1.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}),this._sendingRtpParametersByKind={audio:ortc$2.getSendingRtpParameters("audio",d),video:ortc$2.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$2.getSendingRemoteRtpParameters("audio",d),video:ortc$2.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$7.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$7.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$7.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$7.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$7.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$7.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$7.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:a}){this.assertSendDirection(),logger$7.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<t.length&&t.forEach((e,t)=>{e.rid="r"+t});var n=utils$3.clone(this._sendingRtpParametersByKind[e.kind],{}),o=(n.codecs=ortc$2.reduceCodecs(n.codecs,a),utils$3.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),a=(o.codecs=ortc$2.reduceCodecs(o.codecs,a),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let i=await this._pc.createOffer(),s=sdpTransform$1.parse(i.sdp),c,d=(this._transportReady||await this.setupTransport({localDtlsRole:null!=(l=this._forcedLocalDtlsRole)?l:"client",localSdpObject:s}),!1);var l=(0,scalabilityModes_1.parse)((t||[{}])[0].scalabilityMode),l=(t&&1===t.length&&1<l.spatialLayers&&"video/vp9"===n.codecs[0].mimeType.toLowerCase()&&(logger$7.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,s=sdpTransform$1.parse(i.sdp),c=s.media[a.idx],sdpUnifiedPlanUtils.addLegacySimulcast({offerMediaObject:c,numStreams:l.spatialLayers}),i={type:"offer",sdp:sdpTransform$1.write(s)}),logger$7.debug("send() | calling pc.setLocalDescription() [offer:%o]",i),await this._pc.setLocalDescription(i),e.mid);if(n.mid=l,s=sdpTransform$1.parse(this._pc.localDescription.sdp),c=s.media[a.idx],n.rtcp.cname=sdpCommonUtils$1.getCname({offerMediaObject:c}),t)if(1===t.length){let e=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:c});Object.assign(e[0],t[0]),d&&(e=[e[0]]),n.encodings=e}else n.encodings=t;else n.encodings=sdpUnifiedPlanUtils.getRtpEncodings({offerMediaObject:c});if(1<n.encodings.length&&("video/vp8"===n.codecs[0].mimeType.toLowerCase()||"video/h264"===n.codecs[0].mimeType.toLowerCase()))for(const p of n.encodings)p.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,reuseMid:a.reuseMid,offerRtpParameters:n,answerRtpParameters:o,codecOptions:r,extmapAllowMixed:!0});t={type:"answer",sdp:this._remoteSdp.getSdp()};return logger$7.debug("send() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.set(l,e),{localId:l,rtpParameters:n,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),logger$7.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),logger$7.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),logger$7.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),logger$7.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),logger$7.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";e=await this._pc.createOffer(),logger$7.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),t={type:"answer",sdp:this._remoteSdp.getSdp()};logger$7.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async replaceTrack(e,t){this.assertSendDirection(),t?logger$7.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):logger$7.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),logger$7.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),logger$7.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const a=e.sender.getParameters();a.encodings.forEach((e,t)=>{a.encodings[t]={...e,...r}}),await e.sender.setParameters(a)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:n},t=(logger$7.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS$1.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform$1.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$7.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$7.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[],a=new Map;for(const m of e){var{trackId:n,kind:o,rtpParameters:i,streamId:s}=m,c=(logger$7.debug("receive() [trackId:%s, kind:%s]",n,o),i.mid||String(this._mapMidTransceiver.size));a.set(n,c),this._remoteSdp.receive({mid:c,kind:o,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(logger$7.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),l=sdpTransform$1.parse(d.sdp);for(const g of e){var{trackId:p,rtpParameters:u}=g;const f=a.get(p);p=l.media.find(e=>String(e.mid)===f);sdpCommonUtils$1.applyCodecParameters({offerRtpParameters:u,answerMediaObject:p})}d={type:"answer",sdp:sdpTransform$1.write(l)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:l}),logger$7.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const y=a.get(h);h=this._pc.getTransceivers().find(e=>e.mid===y);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(y,h),r.push({localId:y,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$7.debug("stopReceiving() [localId:%s]",a);var t=this._mapMidTransceiver.get(a);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(logger$7.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());logger$7.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const n of e)this._mapMidTransceiver.delete(n)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){logger$7.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$7.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$7.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){logger$7.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$7.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$7.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o,protocol:r},a=(logger$7.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$7.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform$1.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$7.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform$1.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils$1.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}ReactNativeUnifiedPlan$1.ReactNativeUnifiedPlan=ReactNativeUnifiedPlan;var ReactNative$1={},__createBinding$1=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault$1=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar$1=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding$1(t,e,r);return __setModuleDefault$1(t,e),t};Object.defineProperty(ReactNative$1,"__esModule",{value:!0}),ReactNative$1.ReactNative=void 0;const sdpTransform=__importStar$1(lib$1),Logger_1$2=Logger$9,errors_1$1=errors,utils$2=__importStar$1(utils$g),ortc$1=__importStar$1(ortc$c),sdpCommonUtils=__importStar$1(commonUtils),sdpPlanBUtils=__importStar$1(planBUtils),HandlerInterface_1=HandlerInterface$1,RemoteSdp_1=RemoteSdp$1,logger$6=new Logger_1$2.Logger("ReactNative"),SCTP_NUM_STREAMS={OS:1024,MIS:1024};class ReactNative extends HandlerInterface_1.HandlerInterface{static createFactory(){return()=>new ReactNative}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(logger$6.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){logger$6.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=sdpTransform.parse(e.sdp);return sdpCommonUtils.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return logger$6.debug("getNativeSctpCapabilities()"),{numStreams:SCTP_NUM_STREAMS}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,extendedRtpCapabilities:d}){logger$6.debug("run()"),this._direction=e,this._remoteSdp=new RemoteSdp_1.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,planB:!0}),this._sendingRtpParametersByKind={audio:ortc$1.getSendingRtpParameters("audio",d),video:ortc$1.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ortc$1.getSendingRemoteRtpParameters("audio",d),video:ortc$1.getSendingRemoteRtpParameters("video",d)},a.role&&"auto"!==a.role&&(this._forcedLocalDtlsRole="server"===a.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:o||[],iceTransportPolicy:i||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...s},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(logger$6.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){logger$6.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){logger$6.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),logger$6.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},logger$6.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$6.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),logger$6.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:a}){this.assertSendDirection(),logger$6.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),a&&logger$6.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addStream(this._sendStream);let n=await this._pc.createOffer(),o=sdpTransform.parse(n.sdp),i;var s=utils$2.clone(this._sendingRtpParametersByKind[t.kind],{}),a=(s.codecs=ortc$1.reduceCodecs(s.codecs),utils$2.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(a.codecs=ortc$1.reduceCodecs(a.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:o}),"video"===t.kind&&r&&1<r.length&&(logger$6.debug("send() | enabling simulcast"),o=sdpTransform.parse(n.sdp),i=o.media.find(e=>"video"===e.type),sdpPlanBUtils.addLegacySimulcast({offerMediaObject:i,track:t,numStreams:r.length}),n={type:"offer",sdp:sdpTransform.write(o)}),logger$6.debug("send() | calling pc.setLocalDescription() [offer:%o]",n),await this._pc.setLocalDescription(n),o=sdpTransform.parse(this._pc.localDescription.sdp),i=o.media.find(e=>e.type===t.kind),s.rtcp.cname=sdpCommonUtils.getCname({offerMediaObject:i}),s.encodings=sdpPlanBUtils.getRtpEncodings({offerMediaObject:i,track:t}),r)for(let e=0;e<s.encodings.length;++e)r[e]&&Object.assign(s.encodings[e],r[e]);if(1<s.encodings.length&&("video/vp8"===s.codecs[0].mimeType.toLowerCase()||"video/h264"===s.codecs[0].mimeType.toLowerCase()))for(const d of s.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:i,offerRtpParameters:s,answerRtpParameters:a,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},a=(logger$6.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId));return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(a,t),{localId:a,rtpParameters:s}}async stopSending(e){this.assertSendDirection(),logger$6.debug("stopSending() [localId:%s]",e);var t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);e=await this._pc.createOffer();logger$6.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(e){if(0===this._sendStream.getTracks().length)return void logger$6.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(t={type:"answer",sdp:this._remoteSdp.getSdp()},logger$6.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new errors_1$1.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new errors_1$1.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new errors_1$1.UnsupportedError("not implemented")}async getSenderStats(e){throw new errors_1$1.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:a,protocol:n}){this.assertSendDirection();var o,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:n},t=(logger$6.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(a,e)),n=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%SCTP_NUM_STREAMS.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),a=(n=sdpTransform.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(o=this._forcedLocalDtlsRole)?o:"client",localSdpObject:n}),logger$6.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:a}),o={type:"answer",sdp:this._remoteSdp.getSdp()},logger$6.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:n}}async receive(e){this.assertRecvDirection();var t,r=[],a=new Map;for(const _ of e){var{trackId:n,kind:o,rtpParameters:i}=_,s=(logger$6.debug("receive() [trackId:%s, kind:%s]",n,o),o),c=_.streamId||i.rtcp.cname;logger$6.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),c+="-hack-"+utils$2.generateRandomNumber(),a.set(n,c),this._remoteSdp.receive({mid:s,kind:o,offerRtpParameters:i,streamId:c,trackId:n})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(logger$6.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),l=sdpTransform.parse(d.sdp);for(const y of e){var{kind:p,rtpParameters:u}=y;const v=p;p=l.media.find(e=>String(e.mid)===v);sdpCommonUtils.applyCodecParameters({offerRtpParameters:u,answerMediaObject:p})}d={type:"answer",sdp:sdpTransform.write(l)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:l}),logger$6.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const b of e){var{kind:h,trackId:m,rtpParameters:g}=b,f=m;const w=a.get(m);m=this._pc.getRemoteStreams().find(e=>e.id===w).getTrackById(f);if(!m)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(f,{mid:h,rtpParameters:g}),r.push({localId:f,track:m})}return r}async stopReceiving(e){this.assertRecvDirection();for(const a of e){logger$6.debug("stopReceiving() [localId:%s]",a);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(a)||{};this._mapRecvLocalIdInfo.delete(a),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},logger$6.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();logger$6.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new errors_1$1.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:a,maxPacketLifeTime:n,maxRetransmits:o}=e,e={negotiated:!0,id:e,ordered:a,maxPacketLifeTime:n,maxRetransmitTime:n,maxRetransmits:o,protocol:r},a=(logger$6.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),n={type:"offer",sdp:this._remoteSdp.getSdp()},logger$6.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",n),await this._pc.setRemoteDescription(n),o=await this._pc.createAnswer(),this._transportReady||(r=sdpTransform.parse(o.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),logger$6.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setLocalDescription(o),this._hasDataChannelMediaSection=!0),{dataChannel:a}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||sdpTransform.parse(this._pc.localDescription.sdp);const r=sdpCommonUtils.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}ReactNative$1.ReactNative=ReactNative;var __createBinding=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),__setModuleDefault=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),__importStar=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&__createBinding(t,e,r);return __setModuleDefault(t,e),t},__importDefault=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Device$1,"__esModule",{value:!0}),Device$1.Device=Device$1.detectDevice=void 0;const bowser_1=__importDefault(es5.exports),Logger_1$1=Logger$9,EnhancedEventEmitter_1$1=EnhancedEventEmitter$4,errors_1=errors,utils$1=__importStar(utils$g),ortc=__importStar(ortc$c),Transport_1=Transport$1,Chrome74_1=Chrome74$1,Chrome70_1=Chrome70$1,Chrome67_1=Chrome67$1,Chrome55_1=Chrome55$1,Firefox60_1=Firefox60$1,Safari12_1=Safari12$1,Safari11_1=Safari11$1,Edge11_1=Edge11$1,ReactNativeUnifiedPlan_1=ReactNativeUnifiedPlan$1,ReactNative_1=ReactNative$1,logger$5=new Logger_1$1.Logger("Device");function detectDevice(){if("object"==typeof navigator&&"ReactNative"===navigator.product){if("undefined"!=typeof RTCPeerConnection)return"undefined"!=typeof RTCRtpTransceiver?(logger$5.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(logger$5.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");logger$5.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?")}else{var e,t,r;if("object"==typeof navigator&&"string"==typeof navigator.userAgent)return r=navigator.userAgent,t=(e=bowser_1.default.getParser(r)).getEngine(),e.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"})?"Chrome74":e.satisfies({chrome:">=70",chromium:">=70"})?"Chrome70":e.satisfies({chrome:">=67",chromium:">=67"})?"Chrome67":e.satisfies({chrome:">=55",chromium:">=55"})?"Chrome55":e.satisfies({firefox:">=60"})?"Firefox60":e.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}})||e.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")?"Safari12":e.satisfies({safari:">=11"})?"Safari11":e.satisfies({"microsoft edge":">=11"})&&e.satisfies({"microsoft edge":"<=18"})?"Edge11":t.name&&"blink"===t.name.toLowerCase()?!(t=r.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i))||74<=(r=Number(t[1]))?"Chrome74":70<=r?"Chrome70":67<=r?"Chrome67":"Chrome55":void logger$5.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",e.getBrowserName(),e.getBrowserVersion());logger$5.warn("this._detectDevice() | unknown device")}}Device$1.detectDevice=detectDevice;class Device{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new EnhancedEventEmitter_1$1.EnhancedEventEmitter,logger$5.debug("constructor()"),r){if(logger$5.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)logger$5.debug("constructor() | handler given: %s",e);else{if(!(e=detectDevice()))throw new errors_1.UnsupportedError("device not supported");logger$5.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=Chrome74_1.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=Chrome70_1.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=Chrome67_1.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=Chrome55_1.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=Firefox60_1.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=Safari12_1.Safari12.createFactory();break;case"Safari11":this._handlerFactory=Safari11_1.Safari11.createFactory();break;case"Edge11":this._handlerFactory=Edge11_1.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=ReactNativeUnifiedPlan_1.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=ReactNative_1.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}r=this._handlerFactory();this._handlerName=r.name,r.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(this._loaded)return this._recvRtpCapabilities;throw new errors_1.InvalidStateError("not loaded")}get sctpCapabilities(){if(this._loaded)return this._sctpCapabilities;throw new errors_1.InvalidStateError("not loaded")}get observer(){return this._observer}async load({routerRtpCapabilities:e}){logger$5.debug("load() [routerRtpCapabilities:%o]",e),e=utils$1.clone(e,void 0);let t;try{if(this._loaded)throw new errors_1.InvalidStateError("already loaded");ortc.validateRtpCapabilities(e);var r=await(t=this._handlerFactory()).getNativeRtpCapabilities();logger$5.debug("load() | got native RTP capabilities:%o",r),ortc.validateRtpCapabilities(r),this._extendedRtpCapabilities=ortc.getExtendedRtpCapabilities(r,e),logger$5.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=ortc.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=ortc.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=ortc.getRecvRtpCapabilities(this._extendedRtpCapabilities),ortc.validateRtpCapabilities(this._recvRtpCapabilities),logger$5.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),logger$5.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),ortc.validateSctpCapabilities(this._sctpCapabilities),logger$5.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,appData:d}){return logger$5.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,appData:d}){return logger$5.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:o,iceTransportPolicy:i,additionalSettings:s,proprietaryConstraints:c,appData:d})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:d,appData:l}){if(!this._loaded)throw new errors_1.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(a))throw new TypeError("missing iceCandidates");if("object"!=typeof n)throw new TypeError("missing dtlsParameters");if(o&&"object"!=typeof o)throw new TypeError("wrong sctpParameters");if(l&&"object"!=typeof l)throw new TypeError("if given, appData must be an object");e=new Transport_1.Transport({direction:e,id:t,iceParameters:r,iceCandidates:a,dtlsParameters:n,sctpParameters:o,iceServers:i,iceTransportPolicy:s,additionalSettings:c,proprietaryConstraints:d,appData:l,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",e),e}}Device$1.Device=Device;var types={},RtpParameters={},SctpParameters=(Object.defineProperty(RtpParameters,"__esModule",{value:!0}),{}),lib=(Object.defineProperty(SctpParameters,"__esModule",{value:!0}),!function(e){var a=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),t=commonjsGlobal&&commonjsGlobal.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||a(t,e,r)};Object.defineProperty(e,"__esModule",{value:!0}),t(Device$1,e),t(Transport$1,e),t(Producer$1,e),t(Consumer$1,e),t(DataProducer$1,e),t(DataConsumer$1,e),t(RtpParameters,e),t(SctpParameters,e),t(HandlerInterface$1,e),t(errors,e)}(types),getDefaultExportFromCjs(types),!function(e){var a=commonjsGlobal&&commonjsGlobal.__createBinding||(Object.create?function(e,t,r,a){void 0===a&&(a=r);var n=Object.getOwnPropertyDescriptor(t,r);n&&("get"in n?t.__esModule:!n.writable&&!n.configurable)||(n={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,a,n)}:function(e,t,r,a){e[a=void 0===a?r:a]=t[r]}),n=commonjsGlobal&&commonjsGlobal.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),t=commonjsGlobal&&commonjsGlobal.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&a(t,e,r);return n(t,e),t},r=commonjsGlobal&&commonjsGlobal.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},r=(Object.defineProperty(e,"__esModule",{value:!0}),e.debug=e.parseScalabilityMode=e.detectDevice=e.Device=e.version=e.types=void 0,r(browser.exports));e.debug=r.default;const o=Device$1;Object.defineProperty(e,"Device",{enumerable:!0,get:function(){return o.Device}}),Object.defineProperty(e,"detectDevice",{enumerable:!0,get:function(){return o.detectDevice}});var r=t(types),i=(e.types=r,e.version="3.6.72",scalabilityModes);Object.defineProperty(e,"parseScalabilityMode",{enumerable:!0,get:function(){return i.parse}})}(lib$3),getDefaultExportFromCjs(lib$3),{}),name="protoo-client",version$2="4.0.6",description="protoo JavaScript client module",author="Iñaki Baz Castillo <ibc@aliax.net>",homepage="https://protoo.versatica.com",license="MIT",repository={type:"git",url:"https://github.com/ibc/protoo.git"},main="lib/index.js",keywords=["nodejs","browser","websocket"],engines={node:">=8.0.0"},scripts={lint:"eslint -c .eslintrc.js lib"},dependencies={debug:"^4.3.1",events:"^3.2.0",retry:"^0.12.0"},devDependencies={eslint:"^5.16.0"},optionalDependencies={websocket:"^1.0.33"},__npminstall_done=!0,_from="protoo-client@4.0.6",_resolved="https://registry.npmmirror.com/protoo-client/-/protoo-client-4.0.6.tgz",require$$0={name:name,version:version$2,description:description,author:author,homepage:homepage,license:license,repository:repository,main:main,keywords:keywords,engines:engines,scripts:scripts,dependencies:dependencies,devDependencies:devDependencies,optionalDependencies:optionalDependencies,__npminstall_done:__npminstall_done,_from:_from,_resolved:_resolved};const debug=browser.exports,APP_NAME$1="protoo-client";class Logger$5{constructor(e){e?(this._debug=debug(APP_NAME$1+":"+e),this._warn=debug(APP_NAME$1+":WARN:"+e),this._error=debug(APP_NAME$1+":ERROR:"+e)):(this._debug=debug(APP_NAME$1),this._warn=debug(APP_NAME$1+":WARN"),this._error=debug(APP_NAME$1+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}var Logger_1=Logger$5;const EventEmitter=require$$0$1["EventEmitter"],Logger$4=Logger_1;class EnhancedEventEmitter$2 extends EventEmitter{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new Logger$4("EnhancedEventEmitter")}safeEmit(t,...e){try{this.emit(t,...e)}catch(e){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e)}}async safeEmitAsPromise(r,...a){return new Promise((e,t)=>{this.safeEmit(r,...a,e,t)})}}var EnhancedEventEmitter_1=EnhancedEventEmitter$2,utils={generateRandomNumber:function(){return Math.round(1e7*Math.random())}};const Logger$3=Logger_1,generateRandomNumber=utils["generateRandomNumber"],logger$4=new Logger$3("Message");class Message$2{static parse(e){let t;var r={};try{t=JSON.parse(e)}catch(e){return void logger$4.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void logger$4.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void logger$4.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void logger$4.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void logger$4.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void logger$4.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}logger$4.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:generateRandomNumber(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}}var Message_1=Message$2;const Logger$2=Logger_1,EnhancedEventEmitter$1=EnhancedEventEmitter_1,Message$1=Message_1,logger$3=new Logger$2("Peer");class Peer$1 extends EnhancedEventEmitter$1{constructor(e){super(logger$3),logger$3.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){logger$3.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t=void 0){const n=Message$1.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,n.id),await this._transport.send(n),new Promise((t,r)=>{var e=1500*(15+.1*this._sents.size);const a={id:n.id,method:n.method,resolve:e=>{this._sents.delete(n.id)&&(clearTimeout(a.timer),t(e))},reject:e=>{this._sents.delete(n.id)&&(clearTimeout(a.timer),r(e))},timer:setTimeout(()=>{this._sents.delete(n.id)&&r(new Error("request timeout"))},e),close:()=>{clearTimeout(a.timer),r(new Error("peer closed"))}};this._sents.set(n.id,a)})}async notify(e,t=void 0){t=Message$1.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(t)}_handleTransport(){this._transport.closed?(this._closed=!0,setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))})):(this._transport.on("open",()=>{this._closed||(logger$3.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(logger$3.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(logger$3.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,logger$3.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(r){try{this.emit("request",r,e=>{e=Message$1.createSuccessResponse(r,e);this._transport.send(e).catch(()=>{})},(e,t)=>{e instanceof Error?(t=e.message,e=500):"number"==typeof e&&t instanceof Error&&(t=t.message);e=Message$1.createErrorResponse(r,e,t);this._transport.send(e).catch(()=>{})})}catch(e){var t=Message$1.createErrorResponse(r,500,String(e));this._transport.send(t).catch(()=>{})}}_handleResponse(e){var t,r=this._sents.get(e.id);r?e.ok?r.resolve(e.data):((t=new Error(e.errorReason)).code=e.errorCode,r.reject(t)):logger$3.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}var Peer_1=Peer$1,_retry_0_12_0_retry={exports:{}},retry$1={};function RetryOperation(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var retry_operation=RetryOperation;RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var r=this,e=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref)&&r._timeout.unref(),r._fn(r._attempts)},t);return this._options.unref&&e.unref(),!0},RetryOperation.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb)&&(this._operationTimeoutCb=t.cb);var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},RetryOperation.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],o=n.message,i=(e[o]||0)+1;r<=(e[o]=i)&&(t=n,r=i)}return t},function(s){var r=retry_operation;s.operation=function(e){var t=s.timeouts(e);return new r(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},s.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t,r={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(t in e)r[t]=e[t];if(r.maxTimeout<r.minTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<r.retries;n++)a.push(this.createTimeout(n,r));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,r)),a.sort(function(e,t){return e-t}),a},s.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,r=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},s.wrap=function(n,o,e){if(o instanceof Array&&(e=o,o=null),!e)for(var t in e=[],n)"function"==typeof n[t]&&e.push(t);for(var r=0;r<e.length;r++){var a=e[r],i=n[a];n[a]=function(e){var t=s.operation(o),r=Array.prototype.slice.call(arguments,1),a=r.pop();r.push(function(e){t.retry(e)||(e&&(arguments[0]=t.mainError()),a.apply(this,arguments))}),t.attempt(function(){e.apply(n,r)})}.bind(n,i),n[a].options=o}}}(retry$1),_retry_0_12_0_retry.exports=retry$1,getDefaultExportFromCjs(_retry_0_12_0_retry.exports);const W3CWebSocket=browser$2.w3cwebsocket,retry=_retry_0_12_0_retry.exports,Logger$1=Logger_1,EnhancedEventEmitter=EnhancedEventEmitter_1,Message=Message_1,WS_SUBPROTOCOL="protoo",DEFAULT_RETRY_OPTIONS={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},logger$2=new Logger$1("WebSocketTransport");class WebSocketTransport$1 extends EnhancedEventEmitter{constructor(e,t){super(logger$2),logger$2.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){logger$2.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){logger$2.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw logger$2.warn("send() failed:%o",e),e}}_runWebSocket(){const r=retry.operation(this._options.retry||DEFAULT_RETRY_OPTIONS);let a=!1;r.attempt(t=>{this._closed?r.stop():(logger$2.debug("_runWebSocket() [currentAttempt:%s]",t),this._ws=new W3CWebSocket(this._url,WS_SUBPROTOCOL,this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(a=!0,this.safeEmit("open"))},this._ws.onclose=e=>{if(!this._closed){if(logger$2.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',e.wasClean,e.code,e.reason),4e3!==e.code){if(a)return r.stop(),this.safeEmit("disconnected"),this._closed?void 0:void this._runWebSocket();if(this.safeEmit("failed",t),this._closed)return;if(r.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||logger$2.error('WebSocket "error" event')},this._ws.onmessage=e=>{this._closed||(e=Message.parse(e.data))&&(0===this.listenerCount("message")?logger$2.error('no listeners for WebSocket "message" event, ignoring received message'):this.safeEmit("message",e))})})}}var WebSocketTransport_1=WebSocketTransport$1;const version$1=require$$0["version"],Peer=Peer_1,WebSocketTransport=WebSocketTransport$1,APP_NAME=(lib.version=version$1,lib.Peer=Peer,lib.WebSocketTransport=WebSocketTransport,"mediasoup-demo");class Logger{constructor(e){e?(this._debug=debug$1(APP_NAME+":"+e),this._warn=debug$1(APP_NAME+":WARN:"+e),this._error=debug$1(APP_NAME+":ERROR:"+e)):(this._debug=debug$1(APP_NAME),this._warn=debug$1(APP_NAME+":WARN"),this._error=debug$1(APP_NAME+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}let protooPortParam="8888";function getProtooUrl(e){var{myhostname:e,roomId:t,peerId:r,protooPort:a,ishttps:n}=e;return`${n?"wss:":"ws:"}//${e}:${protooPortParam=a?a:protooPortParam}/wscloud/?roomId=${t}&peerId=`+r}"test.mediasoup.org"===window.location.hostname&&(protooPortParam=4443);const logger$1=new Logger("e2e");let e2eSupported=void 0,worker=void 0;function isSupported(){if(void 0===e2eSupported)if(RTCRtpSender.prototype.createEncodedStreams)try{var e=new ReadableStream;window.postMessage(e,"*",[e]),worker=new Worker("/resources/js/e2e-worker.js",{name:"e2e worker"}),logger$1.debug("isSupported() | supported"),e2eSupported=!0}catch(e){logger$1.debug("isSupported() | not supported: "+e),e2eSupported=!1}else logger$1.debug("isSupported() | not supported"),e2eSupported=!1;return e2eSupported}function setCryptoKey(e,t,r){logger$1.debug("setCryptoKey() [operation:%o, useCryptoOffset:%o]",e,r),assertSupported(),worker.postMessage({operation:e,currentCryptoKey:t,useCryptoOffset:r})}function setupReceiverTransform(e){logger$1.debug("setupReceiverTransform()"),assertSupported();var e=e.createEncodedStreams(),t=e.readable||e.readableStream,e=e.writable||e.writableStream;worker.postMessage({operation:"decode",readableStream:t,writableStream:e},[t,e])}function assertSupported(){if(!1===e2eSupported)throw new Error("e2e not supported");if(void 0===e2eSupported)throw new Error("e2e not initialized, must call isSupported() first")}function deviceInfo(){var e=navigator.userAgent,e=bowser.getParser(e);let t;return{flag:t=e.satisfies({chrome:">=0",chromium:">=0"})?"chrome":e.satisfies({firefox:">=0"})?"firefox":e.satisfies({safari:">=0"})?"safari":e.satisfies({opera:">=0"})?"opera":e.satisfies({"microsoft edge":">=0"})?"edge":"unknown",name:e.getBrowserName(),version:e.getBrowserVersion()}}function styleInject(e,t){var r,a,t=(t=void 0===t?{}:t).insertAt;e&&"undefined"!=typeof document&&(r=document.head||document.getElementsByTagName("head")[0],(a=document.createElement("style")).type="text/css","top"===t&&r.firstChild?r.insertBefore(a,r.firstChild):r.appendChild(a),a.styleSheet?a.styleSheet.cssText=e:a.appendChild(document.createTextNode(e)))}var css_248z=".index-module_progress_bar__plqyh {\n    display: inline-block;\n    width: 300px;\n}\n\n.index-module_process__ODoW8 {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n}\n\n.index-module_progress_bar__outer__rPAtx {\n    background: url('https://minio.smartyunzhou.com/public/loadingGif2.gif');\n    background-size: 100% 100%;\n    background-repeat: no-repeat;\n    width: 270px;\n    height: 250px;\n    padding: 5px;\n    display: inline-block;\n}\n\n.index-module_tip__Wl6-9 {\n    margin-top: 20px;\n    font-style: normal;\n    font-weight: 400;\n    line-height: 21px;\n    text-align: center;\n    letter-spacing: 0.02em;\n    font-family: 'FontName';\n    font-size: 15px;\n    color: #EA913E;\n    letter-spacing: 4px;\n}\n\n.index-module_box__INJYU {\n    text-align: center;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n    top: 0;\n    /* height: 100vh; */\n    background: rgba(0, 0, 0, 0.6);\n}\n\n.index-module_loadingText__33IIf {\n    font-size: 32px;\n    color: rgb(2, 95, 116);\n    text-transform: uppercase;\n    letter-spacing: 8px;\n    width: 600px;\n    height: 200px;\n    text-align: center;\n    background: #fff;\n    border-radius: 4px;\n    padding-top: 30px;\n}\n\n.index-module_fail__ohdIh {\n    z-index: 1;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: rgba(0, 0, 0, 0.6);\n}\n\n.index-module_success__hMF8Z {\n    width: 100%;\n    object-fit: fill;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    z-index: 0;\n}\n\n.index-module_tip1__OjcWh {\n    width: 45px;\n    height: 45px;\n    display: inline-block;\n    background-image: url('../image/tip.svg');\n}\n\n.index-module_loadFailTitle__8aKST {\n    font-family: 'PingFang SC';\n    font-style: normal;\n    font-weight: 600;\n    font-size: 14px;\n    line-height: 22px;\n    /* or 157% */\n\n    text-align: center;\n\n    /* Neutral/10强调、正文标题 */\n\n    color: #1D2129;\n}\n\n.index-module_loadFailText__oedDA {\n    font-family: 'PingFang SC';\n    font-style: normal;\n    font-weight: 600;\n    font-size: 12px;\n    line-height: 22px;\n    text-align: center;\n    color: #1D2129;\n}\n\n.index-module_logout__OQjzv,\n.index-module_reload__vRmQ4 {\n    width: 68px;\n    height: 36px;\n    font-family: 'Nunito Sans';\n    font-style: normal;\n    font-weight: 400;\n    font-size: 14px;\n    line-height: 22px;\n    color: #FFFFFF;\n    padding: 8px 20px;\n    margin-top: 20px;\n    cursor: pointer;\n}\n\n.index-module_logout__OQjzv {\n    background: #F2F3F5;\n    color: #1D2129;\n}\n\n.index-module_reload__vRmQ4 {\n    background: #EA913E;\n}\n\n.index-module_btnGroup__BnLL6 {\n    margin-top: 30px;\n}\n.index-module_zhyzPayBox__hHgOJ{\n    width: 100%;\n    flex: 1;\n    position: relative;\n}\n\n.index-module_preload__eawHG{\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    right: 0;\n    left: 0;\n    bottom: 0;\n    background-color: #6e7077; \n }\n .index-module_preload__eawHG:before {\n     border-radius: 10px;\n     font-size: 50px;\n     color: #fff;\n       content: '请求云渲染中...';\n       width: 400px;\n       display: block;\n       position: absolute;\n       top: 50%;\n       left: calc(50% - 200px);\n   }\n\n   .index-module_notSupport__cGA2B{\n     display: flex;\n     justify-content: center;\n     align-items: center;\n     width: 100%;\n     height: 100%;\n     font-size: 24px;\n     color: rgb(32, 32, 189);\n   }\n",style={progress_bar:"index-module_progress_bar__plqyh",process:"index-module_process__ODoW8",progress_bar__outer:"index-module_progress_bar__outer__rPAtx",tip:"index-module_tip__Wl6-9",box:"index-module_box__INJYU",loadingText:"index-module_loadingText__33IIf",fail:"index-module_fail__ohdIh",success:"index-module_success__hMF8Z",tip1:"index-module_tip1__OjcWh",loadFailTitle:"index-module_loadFailTitle__8aKST",loadFailText:"index-module_loadFailText__oedDA",logout:"index-module_logout__OQjzv",reload:"index-module_reload__vRmQ4",btnGroup:"index-module_btnGroup__BnLL6",zhyzPayBox:"index-module_zhyzPayBox__hHgOJ",preload:"index-module_preload__eawHG",notSupport:"index-module_notSupport__cGA2B"};styleInject(css_248z);const store$4={_origin:"https://api.emailjs.com"},init=(e,t="https://api.emailjs.com")=>{store$4._userID=e,store$4._origin=t},validateParams=(e,t,r)=>{if(!e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(r)return!0;throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};class EmailJSResponseStatus{constructor(e){this.status=e?e.status:0,this.text=e?e.responseText:"Network Error"}}const sendPost=(e,n,o={})=>new Promise((t,r)=>{const a=new XMLHttpRequest;a.addEventListener("load",({target:e})=>{e=new EmailJSResponseStatus(e);(200===e.status||"OK"===e.text?t:r)(e)}),a.addEventListener("error",({target:e})=>{r(new EmailJSResponseStatus(e))}),a.open("POST",store$4._origin+e,!0),Object.keys(o).forEach(e=>{a.setRequestHeader(e,o[e])}),a.send(n)}),send$1=(e,t,r,a)=>{a=a||store$4._userID,validateParams(a,e,t),a={lib_version:"3.10.0",user_id:a,service_id:e,template_id:t,template_params:r};return sendPost("/api/v1.0/email/send",JSON.stringify(a),{"Content-type":"application/json"})},findHTMLForm=e=>{let t;if((t="string"==typeof e?document.querySelector(e):e)&&"FORM"===t.nodeName)return t;throw"The 3rd parameter is expected to be the HTML form element or the style selector of form"},sendForm=(e,t,r,a)=>{a=a||store$4._userID,r=findHTMLForm(r),validateParams(a,e,t),r=new FormData(r);return r.append("lib_version","3.10.0"),r.append("service_id",e),r.append("template_id",t),r.append("user_id",a),sendPost("/api/v1.0/email/send-form",r)};var emailjs={init:init,send:send$1,sendForm:sendForm};const constant="file_cache",FAILED="failed",SUCCESS="success",fail_template_id="template_823ux9e",public_key="SSC2E9WV2Y2FfK_JX",send=(e,t)=>{e={to_name:"郝哲坤",...e,roomId:e.roomId,host:e.myhostname};emailjs.send("service_jz5i5y9",t,e,public_key).then(()=>{writeCache("yes")},()=>{writeCache("no")})},sendEmail=(e,t)=>{var r=getCache();e==FAILED?"no"!=r&&r||(writeCache("yes"),send(t,fail_template_id)):"yes"==r&&writeCache("no")},writeCache=e=>{localStorage.setItem(constant,e)},getCache=()=>localStorage.getItem(constant);let event$1=document.createEvent("HTMLEvents");event$1.initEvent(NOTIFACTION_RENDER,!0,!0);const setHandler=()=>{return"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?"Safari12":lib$3.detectDevice()},defaultParams={peerId:"YunZhou"+Date.parse(new Date),displayName:"YunZhou"+Math.round(100*Math.random()),device:deviceInfo(),handlerName:setHandler(),useSimulcast:!1,useSharingSimulcast:!1,forceTcp:!0,produce:!0,consume:!0,forceH264:!0,forceVP9:!1,svc:"",datachannel:!0,externalVideo:!1,e2eKey:""},PC_PROPRIETARY_CONSTRAINTS={optional:[{googDscp:!0}]},logger=new Logger("RoomClient");class RoomClient{constructor(e){var{myhostname:e,roomId:t,displayName:r,protooPort:a,ishttps:n,renderEle:o,peerId:i,device:s,handlerName:c,useSimulcast:d,useSharingSimulcast:l,forceTcp:p,produce:u,consume:h,forceH264:m,forceVP9:g,datachannel:f,externalVideo:_,e2eKey:y}=e;this._closed=!1,this.roomId=t,this.ishttps=n||!1,this.myhostname=e,this.renderEle=o,this._displayName=r||defaultParams.displayName,this._device=s||defaultParams.device,this._forceTcp=p||defaultParams.forceTcp,this._produce=u||defaultParams.produce,this._consume=h||defaultParams.consume,this._useDataChannel=f||defaultParams.datachannel,this._forceH264=Boolean(m)||Boolean(defaultParams.forceH264),this._forceVP9=Boolean(g)||Boolean(defaultParams.forceVP9),this._externalVideo=null,this._e2eKey=y||defaultParams.e2eKey,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,_&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.muted=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=_.src,this._externalVideo.play().catch(e=>logger.warn("externalVideo.play() failed:%o",e))),this._handlerName=c||defaultParams.handlerName,this._useSimulcast=d||defaultParams.useSimulcast,this._useSharingSimulcast=l||defaultParams.useSharingSimulcast,this._protooUrl=getProtooUrl({myhostname:e,roomId:t,peerId:i||defaultParams.peerId,protooPort:a,ishttps:this.ishttps}),this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._webcams=new Map,this._webcam={device:null,resolution:"hd"},this._e2eKey&&isSupported()&&setCryptoKey("setCryptoKey",this._e2eKey,!0)}close(){this._closed||(this._closed=!0,logger.debug("close()"),this._protoo.close(),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close())}async join(){var e=new lib.WebSocketTransport(this._protooUrl);this._protoo=new lib.Peer(e),this._protoo.on("open",()=>this._joinRoom()),this._protoo.on("failed",()=>{sendEmail(FAILED,{roomId:this.roomId,myhostname:this.myhostname})}),this._protoo.on("disconnected",()=>{this._sendTransport&&(this._sendTransport.close(),this._sendTransport=null),this._recvTransport&&(this._recvTransport.close(),this._recvTransport=null)}),this._protoo.on("close",()=>{this._closed||this.close()}),this._protoo.on("request",async(e,t,r)=>{logger.debug('proto "request" event [method:%s, data:%o]',e.method,e.data);var a=(new Date).valueOf();switch(logger.debug("var timestamp = (new Date()).valueOf() = "+a),e.method){case"newConsumer":if(this._consume){var{peerId:n,producerId:o,id:i,kind:s,rtpParameters:c,type:d,appData:l,producerPaused:p}=e.data;logger.debug("type"+d+" producerPaused"+p);try{const m=await this._recvTransport.consume({id:i,producerId:o,kind:s,rtpParameters:c,appData:{...l,peerId:n}});store$5.commit(SET_STREAM,{[this.roomId]:m}),store$5.commit(SET_WEBRTC_OBJ,{[this.roomId]:this}),this._e2eKey&&isSupported()&&setupReceiverTransform(m.rtpReceiver),this._consumers.set(m.id,m),m.on("transportclose",()=>{this._consumers.delete(m.id)});var{spatialLayers:u,temporalLayers:h}=lib$3.parseScalabilityMode(m.rtpParameters.encodings[0].scalabilityMode);logger.debug("spatialLayers "+u+"temporalLayers "+h),sendEmail(SUCCESS,{roomId:this.roomId,myhostname:this.myhostname}),event$1.data={appli_id:this.roomId},window.dispatchEvent(event$1),t()}catch(e){throw logger.error('"newConsumer" request failed:%o',e),e}}else r(403,"I do not want to consume");break;case"newDataConsumer":if(this._consume)if(this._useDataChannel){var{peerId:d,dataProducerId:p,id:i,sctpStreamParameters:o,label:s,protocol:c,appData:l}=e.data;try{const g=await this._recvTransport.consumeData({id:i,dataProducerId:p,sctpStreamParameters:o,label:s,protocol:c,appData:{...l,peerId:d}});this._dataConsumers.set(g.id,g),g.on("transportclose",()=>{this._dataConsumers.delete(g.id)}),g.on("open",()=>{logger.debug('DataConsumer "open" event')}),g.on("close",()=>{logger.warn('DataConsumer "close" event'),this._dataConsumers.delete(g.id)}),g.on("error",e=>{logger.error('DataConsumer "error" event:%o',e)}),g.on("message",e=>{var t;if(logger.debug('DataConsumer "message" event [streamId:%d]',g.sctpStreamParameters.streamId),e instanceof ArrayBuffer)return(t=new DataView(e).getUint32())==Math.pow(2,32)-1?(logger.warn("dataChannelTest finished!"),void(this._nextDataChannelTestNumber=0)):(t>this._nextDataChannelTestNumber&&logger.warn("dataChannelTest: %s packets missing",t-this._nextDataChannelTestNumber),void(this._nextDataChannelTestNumber=t+1));"string"!=typeof e?logger.warn('ignoring DataConsumer "message" (not a string)'):g.label}),t()}catch(e){throw logger.error('"newDataConsumer" request failed:%o',e),e}}else r(403,"I do not want DataChannels");else r(403,"I do not want to data consume")}}),this._protoo.on("notification",e=>{switch(logger.debug('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"producerScore":var{producerId:t,score:r}=e.data;logger.debug("producerId "+t+" score "+r);break;case"newPeer":t=e.data;logger.debug("newPeer "+t);break;case"peerClosed":r=e.data["peerId"];logger.debug("peerClose "+r);break;case"peerDisplayNameChanged":var{peerId:t,displayName:r,oldDisplayName:a}=e.data;logger.debug("peerClose "+t+" displayName "+r+" oldDisplayName"+a);break;case"downlinkBwe":logger.debug("'downlinkBwe' event:%o",e.data);break;case"consumerClosed":t=e.data["consumerId"],r=this._consumers.get(t);r&&(r.close(),this._consumers.delete(t),a=r.appData["peerId"],logger.debug("peerId "+a));break;case"consumerPaused":t=e.data["consumerId"],r=this._consumers.get(t);r&&r.pause();break;case"consumerResumed":a=e.data["consumerId"],t=this._consumers.get(a);t&&t.resume();break;case"consumerLayersChanged":var{consumerId:r,spatialLayer:a,temporalLayer:t}=e.data;logger.debug("spatialLayer "+a+" temporalLayer "+t),this._consumers.get(r);break;case"consumerScore":var{consumerId:a,score:t}=e.data;logger.debug("consumerId "+a+" score "+t);break;case"dataConsumerClosed":r=e.data["dataConsumerId"],a=this._dataConsumers.get(r);a&&(a.close(),this._dataConsumers.delete(r),t=a.appData["peerId"],logger.debug("peerId"+t));break;case"activeSpeaker":r=e.data["peerId"];logger.debug("peerId "+r);break;default:logger.error('unknown protoo notification.method "%s"',e.method)}})}async _joinRoom(){logger.debug("_joinRoom() this._forceTcp = "+this._forceTcp+", _produce = "+this._produce+", _useDataChannel = "+this._useDataChannel);try{this._mediasoupDevice=new lib$3.Device({handlerName:this._handlerName});var e,t,r,a,n,o,i,s,c,d,l=await this._protoo.request("getRouterRtpCapabilities"),{}=(await this._mediasoupDevice.load({routerRtpCapabilities:l}),this._produce&&({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n}=await this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0}),logger.debug("create send transport ---\x3e "),this._sendTransport=this._mediasoupDevice.createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:a,sctpParameters:n,iceServers:[],proprietaryConstraints:PC_PROPRIETARY_CONSTRAINTS,additionalSettings:{encodedInsertableStreams:this._e2eKey&&isSupported()}}),logger.debug("send transport on ---\x3e "),this._sendTransport.on("connect",(e,t,r)=>{e=e.dtlsParameters;logger.debug("send transport connectWebRtcTransport ^_^ !!! ---\x3e "),this._protoo.request("connectWebRtcTransport",{transportId:this._sendTransport.id,dtlsParameters:e}).then(t).catch(r)}),this._sendTransport.on("produce",async(e,t,r)=>{var{kind:e,rtpParameters:a,appData:n}=e;try{var o=(await this._protoo.request("produce",{transportId:this._sendTransport.id,kind:e,rtpParameters:a,appData:n}))["id"];t({id:o})}catch(e){r(e)}}),logger.debug("send _sendTransport on producedata ---\x3e ^_^ !!! ---\x3e "),this._sendTransport.on("producedata",async(e,t,r)=>{var{sctpStreamParameters:e,label:a,protocol:n,appData:o}=e;logger.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',e,o);try{logger.debug("_protoo.request produceData ---\x3e ^_^ !!! ---\x3e ");var i=(await this._protoo.request("produceData",{transportId:this._sendTransport.id,sctpStreamParameters:e,label:a,protocol:n,appData:o}))["id"];t({id:i})}catch(e){r(e)}})),this._consume&&({id:o,iceParameters:i,iceCandidates:s,dtlsParameters:c,sctpParameters:d}=await this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0}),this._recvTransport=this._mediasoupDevice.createRecvTransport({id:o,iceParameters:i,iceCandidates:s,dtlsParameters:c,sctpParameters:d,iceServers:[],additionalSettings:{encodedInsertableStreams:this._e2eKey&&isSupported()}}),this._recvTransport.on("connect",(e,t,r)=>{e=e.dtlsParameters;this._protoo.request("connectWebRtcTransport",{transportId:this._recvTransport.id,dtlsParameters:e}).then(t).catch(r)})),await this._protoo.request("join",{displayName:this._displayName,device:this._device,rtpCapabilities:this._consume?this._mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this._useDataChannel&&this._consume?this._mediasoupDevice.sctpCapabilities:void 0}));this._produce&&(this.enableChatDataProducer(),logger.debug(" _sendTransport ----\x3e ^_^ -> connectionstatechange ----\x3e   , <--------\x3e"),this._sendTransport.on("connectionstatechange",e=>{logger.debug("%%%% ok ^_^ connectionstatechange ----\x3e  "+e+" , <--------\x3e"),"connected"===e&&this.enableBotDataProducer()}))}catch(e){logger.error("_joinRoom() failed:%o",e),"UnsupportedError"===e.name&&(this.renderEle.innerHTML="浏览器不支持,建议使用其他浏览器"),this.renderEle.classList.add(style.notSupport)}}async enableChatDataProducer(){if(logger.debug("enableChatDataProducer()"),this._useDataChannel)try{this._chatDataProducer=await this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}}),this._chatDataProducer.on("transportclose",()=>{this._chatDataProducer=null}),this._chatDataProducer.on("open",()=>{logger.debug('chat DataProducer "open" event')}),this._chatDataProducer.on("close",()=>{logger.error('chat DataProducer "close" event'),this._chatDataProducer=null}),this._chatDataProducer.on("error",e=>{logger.error('chat DataProducer "error" event:%o',e)}),this._chatDataProducer.on("bufferedamountlow",()=>{logger.debug('chat DataProducer "bufferedamountlow" event')})}catch(e){throw logger.error("enableChatDataProducer() | failed:%o",e),e}}async sendMoveMessage(e){if(this._chatDataProducer)try{this._chatDataProducer.send(e)}catch(e){logger.error("chat DataProducer.send() failed:%o",e)}}}const joinRoomClient=e=>{let t="";e.protooPort&&(t=e.protooPort);var{roomId:e,myhostname:r,displayName:a,ishttps:n,renderEle:o}=e;new RoomClient({myhostname:r,roomId:e,displayName:a,protooPort:t,ishttps:n,renderEle:o}).join()},MessageType={IFrameRequest:0,RequestQualityControl:1,MaxFpsRequest:2,AverageBitrateRequest:3,StartStreaming:4,StopStreaming:5,LatencyTest:6,RequestInitialSettings:7,UIInteraction:50,Command:51,KeyDown:60,KeyUp:61,KeyPress:62,MouseEnter:70,MouseLeave:71,MouseDown:72,MouseUp:73,MouseMove:74,MouseWheel:75,TouchStart:80,TouchEnd:81,TouchMove:82},MouseButton={MainButton:0,AuxiliaryButton:1,SecondaryButton:2,FourthButton:3,FifthButton:4},MouseButtonsMask={PrimaryButton:1,SecondaryButton:2,AuxiliaryButton:4,FourthButton:8,FifthButton:16};function isKeyCodeBrowserKey(e){return 112<=e&&e<=123||9===e}const SpecialKeyCodes={BackSpace:8,Shift:16,Control:17,Alt:18,RightShift:253,RightControl:254,RightAlt:255};function getKeyCode(e){return e.keyCode===SpecialKeyCodes.Shift&&"ShiftRight"===e.code?SpecialKeyCodes.RightShift:e.keyCode===SpecialKeyCodes.Control&&"ControlRight"===e.code?SpecialKeyCodes.RightControl:e.keyCode===SpecialKeyCodes.Alt&&"AltRight"===e.code?SpecialKeyCodes.RightAlt:e.keyCode}function registerKeyboardEvents(t,r){t.setAttribute("tabindex","10"),t.focus(),t.onkeydown=function(e){sendInputData(new Uint8Array([MessageType.KeyDown,getKeyCode(e),e.repeat]).buffer,r),e.keyCode===SpecialKeyCodes.BackSpace&&t.onkeypress({charCode:SpecialKeyCodes.BackSpace}),isKeyCodeBrowserKey(e.keyCode)&&e.preventDefault()},t.onkeyup=function(e){sendInputData(new Uint8Array([MessageType.KeyUp,getKeyCode(e)]).buffer,r),isKeyCodeBrowserKey(e.keyCode)&&e.preventDefault()},t.onkeypress=function(e){var t=new DataView(new ArrayBuffer(3));t.setUint8(0,MessageType.KeyPress),t.setUint16(1,e.charCode,!0),sendInputData(t.buffer,r)}}function releaseMouseButtons(e,t,r){e&MouseButtonsMask.PrimaryButton&&emitMouseUp(MouseButton.MainButton,t,r),e&MouseButtonsMask.SecondaryButton&&emitMouseUp(MouseButton.SecondaryButton,t,r),e&MouseButtonsMask.AuxiliaryButton&&emitMouseUp(MouseButton.AuxiliaryButton,t,r),e&MouseButtonsMask.FourthButton&&emitMouseUp(MouseButton.FourthButton,t,r),e&MouseButtonsMask.FifthButton&&emitMouseUp(MouseButton.FifthButton,t,r)}function pressMouseButtons(e,t,r){e&MouseButtonsMask.PrimaryButton&&emitMouseDown(MouseButton.MainButton,t,r),e&MouseButtonsMask.SecondaryButton&&emitMouseDown(MouseButton.SecondaryButton,t,r),e&MouseButtonsMask.AuxiliaryButton&&emitMouseDown(MouseButton.AuxiliaryButton,t,r),e&MouseButtonsMask.FourthButton&&emitMouseDown(MouseButton.FourthButton,t,r),e&MouseButtonsMask.FifthButton&&emitMouseDown(MouseButton.FifthButton,t,r)}var normalizeAndQuantizeUnsigned=void 0,normalizeAndQuantizeSigned=void 0;function setupNormalizeAndQuantize(e,t){let a=e;if(a&&0<t.length){e=a.clientHeight/a.clientWidth,t=t[0].videoHeight/t[0].videoWidth;if(t<e){let r=1;normalizeAndQuantizeUnsigned=(e,t)=>{r=1;e/=a.clientWidth,t=r*(t/a.clientHeight-.5)+.5;return e<0||1<e||t<0||1<t?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*e,y:65536*t}},normalizeAndQuantizeSigned=(e,t)=>{return{x:32767*(e/(.5*a.clientWidth)),y:32767*(r*t/(.5*a.clientHeight))}}}else{let r=t/e;normalizeAndQuantizeUnsigned=(e,t)=>{e=(r=1)*(e/a.clientWidth-.5)+.5,t/=a.clientHeight;return e<0||1<e||t<0||1<t?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*e,y:65536*t}},normalizeAndQuantizeSigned=(e,t)=>{return{x:32767*(r*e/(.5*a.clientWidth)),y:32767*(t/(.5*a.clientHeight))}}}}}let touchX0=0,touchY0=0,touchLength=1;function registerMouseEnterAndLeaveEvents(r,a){r.onmouseenter=function(e){var t=new DataView(new ArrayBuffer(1));t.setUint8(0,MessageType.MouseEnter),sendInputData(t.buffer,a),r.pressMouseButtons(e,a)},r.onmouseleave=function(e){var t=new DataView(new ArrayBuffer(1));t.setUint8(0,MessageType.MouseLeave),sendInputData(t.buffer,a),r.releaseMouseButtons(e)}}function registerHoveringMouseEvents(t,r){t.onmousemove=function(e){emitMouseMove(e.offsetX,e.offsetY,e.movementX,e.movementY,r),e.preventDefault()},t.onmousedown=function(e){t.focus(),emitMouseDown(e.button,e.offsetX,e.offsetY,r),e.preventDefault()},t.onmouseup=function(e){emitMouseUp(e.button,e.offsetX,e.offsetY,r),e.preventDefault()},t.oncontextmenu=function(e){e.preventDefault()},"onmousewheel"in t?t.onmousewheel=function(e){emitMouseWheel(e.wheelDelta,e.offsetX,e.offsetY,r),e.preventDefault()}:t.addEventListener("DOMMouseScroll",function(e){emitMouseWheel(-120*e.detail,e.offsetX,e.offsetY,r),e.preventDefault()},!1),t.pressMouseButtons=function(e){pressMouseButtons(e.buttons,e.offsetX,e.offsetY)},t.releaseMouseButtons=function(e){releaseMouseButtons(e.buttons,e.offsetX,e.offsetY)},t.ontouchmove=function(e){touchY0=(touchLength,emitMouseMove(e.touches[0].clientX,e.touches[0].clientY,1,1,r),touchX0=e.touches[0].clientX,e.touches[0].clientY),e.preventDefault()},t.ontouchstart=function(e){1==(touchLength=e.touches.length)?(emitMouseUp(2,e.touches[0].clientX,e.touches[0].clientY,r),emitMouseDown(0,e.touches[0].clientX,e.touches[0].clientY,r),touchX0=e.touches[0].clientX,touchY0=e.touches[0].clientY):(touchX0=e.touches[0].clientX,touchY0=e.touches[0].clientY,emitMouseUp(0,touchX0,touchY0,r),emitMouseDown(2,touchX0,touchY0,r)),e.preventDefault()},t.ontouchend=function(e){emitMouseUp(0,touchX0,touchY0,r),emitMouseUp(2,touchX0,touchY0,r),2==touchLength&&emitMouseDown(2,touchX0,touchY0,r),e.preventDefault()}}function emitMouseMove(e,t,r,a,n){e=normalizeAndQuantizeUnsigned(e,t),t=normalizeAndQuantizeSigned(r,a),r=new DataView(new ArrayBuffer(9));r.setUint8(0,MessageType.MouseMove),r.setUint16(1,e.x,!0),r.setUint16(3,e.y,!0),r.setInt16(5,t.x,!0),r.setInt16(7,t.y,!0),sendInputData(r.buffer,n)}function emitMouseDown(e,t,r,a){t=normalizeAndQuantizeUnsigned(t,r),r=new DataView(new ArrayBuffer(6));r.setUint8(0,MessageType.MouseDown),r.setUint8(1,e),r.setUint16(2,t.x,!0),r.setUint16(4,t.y,!0),sendInputData(r.buffer,a)}function emitMouseUp(e,t,r,a){t=normalizeAndQuantizeUnsigned(t,r),r=new DataView(new ArrayBuffer(6));r.setUint8(0,MessageType.MouseUp),r.setUint8(1,e),r.setUint16(2,t.x,!0),r.setUint16(4,t.y,!0),sendInputData(r.buffer,a)}function emitMouseWheel(e,t,r,a){t=normalizeAndQuantizeUnsigned(t,r),r=new DataView(new ArrayBuffer(7));r.setUint8(0,MessageType.MouseWheel),r.setInt16(1,e,!0),r.setUint16(3,t.x,!0),r.setUint16(5,t.y,!0),sendInputData(r.buffer,a)}function sendInputData(e,t){store$5.state.stream.cc[t]&&store$5.state.stream.wc[t].sendMoveMessage(e)}function registerInputs(e,t){e&&registerMouseEnterAndLeaveEvents(e,t)}function setup(e,t,r){registerKeyboardEvents(e,r),registerInputs(t,r),setupNormalizeAndQuantize(e,t),registerHoveringMouseEvents(e,r)}var match,version,set,get,store,STATE,check=function(e){return e&&e.Math==Math&&e},global$a=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof commonjsGlobal&&commonjsGlobal)||function(){return this}()||Function("return this")(),objectGetOwnPropertyDescriptor={},fails$9=function(e){try{return!!e()}catch(e){return!0}},fails$8=fails$9,descriptors=!fails$9(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),fails$7=fails$9,functionBindNative=!fails$9(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),NATIVE_BIND$1=functionBindNative,call$4=Function.prototype.call,functionCall=NATIVE_BIND$1?call$4.bind(call$4):function(){return call$4.apply(call$4,arguments)},objectPropertyIsEnumerable={},$propertyIsEnumerable={}.propertyIsEnumerable,getOwnPropertyDescriptor$2=Object.getOwnPropertyDescriptor,NASHORN_BUG=getOwnPropertyDescriptor$2&&!$propertyIsEnumerable.call({1:2},1),createPropertyDescriptor$2=(objectPropertyIsEnumerable.f=NASHORN_BUG?function(e){e=getOwnPropertyDescriptor$2(this,e);return!!e&&e.enumerable}:$propertyIsEnumerable,function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}),NATIVE_BIND=functionBindNative,FunctionPrototype$1=Function.prototype,call$3=FunctionPrototype$1.call,uncurryThisWithBind=NATIVE_BIND&&FunctionPrototype$1.bind.bind(call$3,call$3),functionUncurryThis=NATIVE_BIND?uncurryThisWithBind:function(e){return function(){return call$3.apply(e,arguments)}},uncurryThis$8=functionUncurryThis,toString$1=uncurryThis$8({}.toString),stringSlice$1=uncurryThis$8("".slice),classofRaw=function(e){return stringSlice$1(toString$1(e),8,-1)},uncurryThis$7=functionUncurryThis,fails$6=fails$9,classof$1=classofRaw,$Object$2=Object,split=functionUncurryThis("".split),indexedObject=fails$6(function(){return!$Object$2("z").propertyIsEnumerable(0)})?function(e){return"String"==classof$1(e)?split(e,""):$Object$2(e)}:$Object$2,isNullOrUndefined$2=function(e){return null==e},isNullOrUndefined$1=isNullOrUndefined$2,$TypeError$7=TypeError,requireObjectCoercible$2=function(e){if(isNullOrUndefined$1(e))throw $TypeError$7("Can't call method on "+e);return e},IndexedObject=indexedObject,requireObjectCoercible$1=requireObjectCoercible$2,toIndexedObject$3=function(e){return IndexedObject(requireObjectCoercible$1(e))},documentAll$2="object"==typeof document&&document.all,IS_HTMLDDA=void 0===documentAll$2&&void 0!==documentAll$2,documentAll_1={all:documentAll$2,IS_HTMLDDA:IS_HTMLDDA},$documentAll$1=documentAll_1,documentAll$1=$documentAll$1.all,isCallable$a=$documentAll$1.IS_HTMLDDA?function(e){return"function"==typeof e||e===documentAll$1}:function(e){return"function"==typeof e},isCallable$9=isCallable$a,$documentAll=documentAll_1,documentAll=$documentAll.all,isObject$5=$documentAll.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:isCallable$9(e)||e===documentAll}:function(e){return"object"==typeof e?null!==e:isCallable$9(e)},global$9=global$a,isCallable$8=isCallable$a,aFunction=function(e){return isCallable$8(e)?e:void 0},getBuiltIn$2=function(e,t){return arguments.length<2?aFunction(global$9[e]):global$9[e]&&global$9[e][t]},uncurryThis$6=functionUncurryThis,objectIsPrototypeOf=functionUncurryThis({}.isPrototypeOf),engineUserAgent="undefined"!=typeof navigator&&String(navigator.userAgent)||"",global$8=global$a,userAgent=engineUserAgent,process=global$8.process,Deno=global$8.Deno,versions=process&&process.versions||Deno&&Deno.version,v8=versions&&versions.v8,engineV8Version=version=!(version=v8?0<(match=v8.split("."))[0]&&match[0]<4?1:+(match[0]+match[1]):version)&&userAgent&&(!(match=userAgent.match(/Edge\/(\d+)/))||74<=match[1])&&(match=userAgent.match(/Chrome\/(\d+)/))?+match[1]:version,V8_VERSION=version,fails$5=fails$9,symbolConstructorDetection=!!Object.getOwnPropertySymbols&&!fails$5(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&V8_VERSION&&V8_VERSION<41}),NATIVE_SYMBOL$1=symbolConstructorDetection,useSymbolAsUid=symbolConstructorDetection&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,getBuiltIn$1=getBuiltIn$2,isCallable$7=isCallable$a,isPrototypeOf=objectIsPrototypeOf,USE_SYMBOL_AS_UID$1=useSymbolAsUid,$Object$1=Object,isSymbol$2=useSymbolAsUid?function(e){return"symbol"==typeof e}:function(e){var t=getBuiltIn$1("Symbol");return isCallable$7(t)&&isPrototypeOf(t.prototype,$Object$1(e))},$String$2=String,tryToString$1=function(e){try{return $String$2(e)}catch(e){return"Object"}},isCallable$6=isCallable$a,tryToString=tryToString$1,$TypeError$6=TypeError,aCallable$1=function(e){if(isCallable$6(e))return e;throw $TypeError$6(tryToString(e)+" is not a function")},aCallable=aCallable$1,isNullOrUndefined=isNullOrUndefined$2,getMethod$1=function(e,t){e=e[t];return isNullOrUndefined(e)?void 0:aCallable(e)},call$2=functionCall,isCallable$5=isCallable$a,isObject$4=isObject$5,$TypeError$5=TypeError,ordinaryToPrimitive$1=function(e,t){var r,a;if("string"===t&&isCallable$5(r=e.toString)&&!isObject$4(a=call$2(r,e)))return a;if(isCallable$5(r=e.valueOf)&&!isObject$4(a=call$2(r,e)))return a;if("string"!==t&&isCallable$5(r=e.toString)&&!isObject$4(a=call$2(r,e)))return a;throw $TypeError$5("Can't convert object to primitive value")},shared$3={exports:{}},global$7=global$a,defineProperty$1=Object.defineProperty,defineGlobalProperty$3=function(t,r){try{defineProperty$1(global$7,t,{value:r,configurable:!0,writable:!0})}catch(e){global$7[t]=r}return r},global$6=global$a,defineGlobalProperty$2=defineGlobalProperty$3,SHARED="__core-js_shared__",store$3=global$a[SHARED]||defineGlobalProperty$2(SHARED,{}),sharedStore=store$3,store$2=sharedStore,requireObjectCoercible=((shared$3.exports=function(e,t){return store$2[e]||(store$2[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.27.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.2/LICENSE",source:"https://github.com/zloirock/core-js"}),requireObjectCoercible$2),$Object=Object,toObject$2=function(e){return $Object(requireObjectCoercible(e))},uncurryThis$5=functionUncurryThis,toObject$1=toObject$2,hasOwnProperty=functionUncurryThis({}.hasOwnProperty),hasOwnProperty_1=Object.hasOwn||function(e,t){return hasOwnProperty(toObject$1(e),t)},uncurryThis$4=functionUncurryThis,id=0,postfix=Math.random(),toString=uncurryThis$4(1..toString),uid$2=function(e){return"Symbol("+(void 0===e?"":e)+")_"+toString(++id+postfix,36)},global$5=global$a,shared$2=shared$3.exports,hasOwn$6=hasOwnProperty_1,uid$1=uid$2,NATIVE_SYMBOL=symbolConstructorDetection,USE_SYMBOL_AS_UID=useSymbolAsUid,Symbol$1=global$5.Symbol,WellKnownSymbolsStore=shared$2("wks"),createWellKnownSymbol=USE_SYMBOL_AS_UID?Symbol$1.for||Symbol$1:Symbol$1&&Symbol$1.withoutSetter||uid$1,wellKnownSymbol$1=function(e){return hasOwn$6(WellKnownSymbolsStore,e)||(WellKnownSymbolsStore[e]=NATIVE_SYMBOL&&hasOwn$6(Symbol$1,e)?Symbol$1[e]:createWellKnownSymbol("Symbol."+e)),WellKnownSymbolsStore[e]},call$1=functionCall,isObject$3=isObject$5,isSymbol$1=isSymbol$2,getMethod=getMethod$1,ordinaryToPrimitive=ordinaryToPrimitive$1,wellKnownSymbol=wellKnownSymbol$1,$TypeError$4=TypeError,TO_PRIMITIVE=wellKnownSymbol$1("toPrimitive"),toPrimitive$1=function(e,t){if(!isObject$3(e)||isSymbol$1(e))return e;var r=getMethod(e,TO_PRIMITIVE);if(r){if(r=call$1(r,e,t=void 0===t?"default":t),!isObject$3(r)||isSymbol$1(r))return r;throw $TypeError$4("Can't convert object to primitive value")}return ordinaryToPrimitive(e,t=void 0===t?"number":t)},toPrimitive=toPrimitive$1,isSymbol=isSymbol$2,toPropertyKey$2=function(e){e=toPrimitive(e,"string");return isSymbol(e)?e:e+""},global$4=global$a,isObject$2=isObject$5,document$1=global$a.document,EXISTS$1=isObject$2(document$1)&&isObject$2(document$1.createElement),documentCreateElement=function(e){return EXISTS$1?document$1.createElement(e):{}},DESCRIPTORS$7=descriptors,fails$4=fails$9,createElement=documentCreateElement,ie8DomDefine=!descriptors&&!fails$9(function(){return 7!=Object.defineProperty(createElement("div"),"a",{get:function(){return 7}}).a}),DESCRIPTORS$6=descriptors,call=functionCall,propertyIsEnumerableModule=objectPropertyIsEnumerable,createPropertyDescriptor$1=createPropertyDescriptor$2,toIndexedObject$2=toIndexedObject$3,toPropertyKey$1=toPropertyKey$2,hasOwn$5=hasOwnProperty_1,IE8_DOM_DEFINE$1=ie8DomDefine,$getOwnPropertyDescriptor$1=Object.getOwnPropertyDescriptor,objectDefineProperty=(objectGetOwnPropertyDescriptor.f=DESCRIPTORS$6?$getOwnPropertyDescriptor$1:function(e,t){if(e=toIndexedObject$2(e),t=toPropertyKey$1(t),IE8_DOM_DEFINE$1)try{return $getOwnPropertyDescriptor$1(e,t)}catch(e){}if(hasOwn$5(e,t))return createPropertyDescriptor$1(!call(propertyIsEnumerableModule.f,e,t),e[t])},{}),DESCRIPTORS$5=descriptors,fails$3=fails$9,v8PrototypeDefineBug=descriptors&&fails$9(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),isObject$1=isObject$5,$String$1=String,$TypeError$3=TypeError,anObject$2=function(e){if(isObject$1(e))return e;throw $TypeError$3($String$1(e)+" is not an object")},DESCRIPTORS$4=descriptors,IE8_DOM_DEFINE=ie8DomDefine,V8_PROTOTYPE_DEFINE_BUG=v8PrototypeDefineBug,anObject$1=anObject$2,toPropertyKey=toPropertyKey$2,$TypeError$2=TypeError,$defineProperty=Object.defineProperty,$getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,ENUMERABLE="enumerable",CONFIGURABLE$1="configurable",WRITABLE="writable",DESCRIPTORS$3=(objectDefineProperty.f=DESCRIPTORS$4?V8_PROTOTYPE_DEFINE_BUG?function(e,t,r){var a;return anObject$1(e),t=toPropertyKey(t),anObject$1(r),"function"==typeof e&&"prototype"===t&&"value"in r&&WRITABLE in r&&!r[WRITABLE]&&(a=$getOwnPropertyDescriptor(e,t))&&a[WRITABLE]&&(e[t]=r.value,r={configurable:(CONFIGURABLE$1 in r?r:a)[CONFIGURABLE$1],enumerable:(ENUMERABLE in r?r:a)[ENUMERABLE],writable:!1}),$defineProperty(e,t,r)}:$defineProperty:function(e,t,r){if(anObject$1(e),t=toPropertyKey(t),anObject$1(r),IE8_DOM_DEFINE)try{return $defineProperty(e,t,r)}catch(e){}if("get"in r||"set"in r)throw $TypeError$2("Accessors not supported");return"value"in r&&(e[t]=r.value),e},descriptors),definePropertyModule$2=objectDefineProperty,createPropertyDescriptor=createPropertyDescriptor$2,createNonEnumerableProperty$2=DESCRIPTORS$3?function(e,t,r){return definePropertyModule$2.f(e,t,createPropertyDescriptor(1,r))}:function(e,t,r){return e[t]=r,e},makeBuiltIn$2={exports:{}},DESCRIPTORS$2=descriptors,hasOwn$4=hasOwnProperty_1,FunctionPrototype=Function.prototype,getDescriptor=DESCRIPTORS$2&&Object.getOwnPropertyDescriptor,EXISTS=hasOwn$4(FunctionPrototype,"name"),PROPER=EXISTS&&"something"===function(){}.name,CONFIGURABLE=EXISTS&&(!DESCRIPTORS$2||getDescriptor(FunctionPrototype,"name").configurable),functionName={EXISTS:EXISTS,PROPER:PROPER,CONFIGURABLE:CONFIGURABLE},uncurryThis$3=functionUncurryThis,isCallable$4=isCallable$a,store$1=sharedStore,functionToString=functionUncurryThis(Function.toString),inspectSource$1=(isCallable$4(store$1.inspectSource)||(store$1.inspectSource=function(e){return functionToString(e)}),store$1.inspectSource),global$3=global$a,isCallable$3=isCallable$a,WeakMap$2=global$a.WeakMap,weakMapBasicDetection=isCallable$3(WeakMap$2)&&/native code/.test(String(WeakMap$2)),shared$1=shared$3.exports,uid=uid$2,keys=shared$1("keys"),sharedKey$1=function(e){return keys[e]||(keys[e]=uid(e))},hiddenKeys$3={},NATIVE_WEAK_MAP=weakMapBasicDetection,global$2=global$a,isObject=isObject$5,createNonEnumerableProperty$1=createNonEnumerableProperty$2,hasOwn$3=hasOwnProperty_1,shared=sharedStore,sharedKey=sharedKey$1,hiddenKeys$2=hiddenKeys$3,OBJECT_ALREADY_INITIALIZED="Object already initialized",TypeError$1=global$2.TypeError,WeakMap$1=global$2.WeakMap,enforce=function(e){return has(e)?get(e):set(e,{})},getterFor=function(t){return function(e){if(isObject(e)&&(e=get(e)).type===t)return e;throw TypeError$1("Incompatible receiver, "+t+" required")}},has=NATIVE_WEAK_MAP||shared.state?((store=shared.state||(shared.state=new WeakMap$1)).get=store.get,store.has=store.has,store.set=store.set,set=function(e,t){if(store.has(e))throw TypeError$1(OBJECT_ALREADY_INITIALIZED);return t.facade=e,store.set(e,t),t},get=function(e){return store.get(e)||{}},function(e){return store.has(e)}):(STATE=sharedKey("state"),hiddenKeys$2[STATE]=!0,set=function(e,t){if(hasOwn$3(e,STATE))throw TypeError$1(OBJECT_ALREADY_INITIALIZED);return t.facade=e,createNonEnumerableProperty$1(e,STATE,t),t},get=function(e){return hasOwn$3(e,STATE)?e[STATE]:{}},function(e){return hasOwn$3(e,STATE)}),internalState={set:set,get:get,has:has,enforce:enforce,getterFor:getterFor},uncurryThis$2=functionUncurryThis,fails$2=fails$9,isCallable$2=isCallable$a,hasOwn$2=hasOwnProperty_1,DESCRIPTORS$1=descriptors,CONFIGURABLE_FUNCTION_NAME=functionName.CONFIGURABLE,inspectSource=inspectSource$1,InternalStateModule=internalState,enforceInternalState=InternalStateModule.enforce,getInternalState=InternalStateModule.get,$String=String,defineProperty=Object.defineProperty,stringSlice=uncurryThis$2("".slice),replace=uncurryThis$2("".replace),join=uncurryThis$2([].join),CONFIGURABLE_LENGTH=DESCRIPTORS$1&&!fails$2(function(){return 8!==defineProperty(function(){},"length",{value:8}).length}),TEMPLATE=String(String).split("String"),makeBuiltIn$1=makeBuiltIn$2.exports=function(e,t,r){"Symbol("===stringSlice($String(t),0,7)&&(t="["+replace($String(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!hasOwn$2(e,"name")||CONFIGURABLE_FUNCTION_NAME&&e.name!==t)&&(DESCRIPTORS$1?defineProperty(e,"name",{value:t,configurable:!0}):e.name=t),CONFIGURABLE_LENGTH&&r&&hasOwn$2(r,"arity")&&e.length!==r.arity&&defineProperty(e,"length",{value:r.arity});try{r&&hasOwn$2(r,"constructor")&&r.constructor?DESCRIPTORS$1&&defineProperty(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}r=enforceInternalState(e);return hasOwn$2(r,"source")||(r.source=join(TEMPLATE,"string"==typeof t?t:"")),e},isCallable$1=(Function.prototype.toString=makeBuiltIn$1(function(){return isCallable$2(this)&&getInternalState(this).source||inspectSource(this)},"toString"),isCallable$a),definePropertyModule$1=objectDefineProperty,makeBuiltIn=makeBuiltIn$2.exports,defineGlobalProperty$1=defineGlobalProperty$3,defineBuiltIn$1=function(e,t,r,a){var n=(a=a||{}).enumerable,o=void 0!==a.name?a.name:t;if(isCallable$1(r)&&makeBuiltIn(r,o,a),a.global)n?e[t]=r:defineGlobalProperty$1(t,r);else{try{a.unsafe?e[t]&&(n=!0):delete e[t]}catch(e){}n?e[t]=r:definePropertyModule$1.f(e,t,{value:r,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return e},objectGetOwnPropertyNames={},ceil=Math.ceil,floor=Math.floor,mathTrunc=Math.trunc||function(e){e=+e;return(0<e?floor:ceil)(e)},trunc=mathTrunc,toIntegerOrInfinity$2=function(e){e=+e;return e!=e||0==e?0:trunc(e)},toIntegerOrInfinity$1=toIntegerOrInfinity$2,max=Math.max,min$1=Math.min,toAbsoluteIndex$1=function(e,t){e=toIntegerOrInfinity$1(e);return e<0?max(e+t,0):min$1(e,t)},toIntegerOrInfinity=toIntegerOrInfinity$2,min=Math.min,toLength$1=function(e){return 0<e?min(toIntegerOrInfinity(e),9007199254740991):0},toLength=toLength$1,lengthOfArrayLike$2=function(e){return toLength(e.length)},toIndexedObject$1=toIndexedObject$3,toAbsoluteIndex=toAbsoluteIndex$1,lengthOfArrayLike$1=lengthOfArrayLike$2,createMethod=function(s){return function(e,t,r){var a,n=toIndexedObject$1(e),o=lengthOfArrayLike$1(n),i=toAbsoluteIndex(r,o);if(s&&t!=t){for(;i<o;)if((a=n[i++])!=a)return!0}else for(;i<o;i++)if((s||i in n)&&n[i]===t)return s||i||0;return!s&&-1}},arrayIncludes={includes:createMethod(!0),indexOf:createMethod(!1)},uncurryThis$1=functionUncurryThis,hasOwn$1=hasOwnProperty_1,toIndexedObject=toIndexedObject$3,indexOf=arrayIncludes.indexOf,hiddenKeys$1=hiddenKeys$3,push=uncurryThis$1([].push),objectKeysInternal=function(e,t){var r,a=toIndexedObject(e),n=0,o=[];for(r in a)!hasOwn$1(hiddenKeys$1,r)&&hasOwn$1(a,r)&&push(o,r);for(;t.length>n;)!hasOwn$1(a,r=t[n++])||~indexOf(o,r)||push(o,r);return o},enumBugKeys$1=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],internalObjectKeys=objectKeysInternal,enumBugKeys=enumBugKeys$1,hiddenKeys=enumBugKeys$1.concat("length","prototype"),objectGetOwnPropertySymbols=(objectGetOwnPropertyNames.f=Object.getOwnPropertyNames||function(e){return internalObjectKeys(e,hiddenKeys)},{}),getBuiltIn=(objectGetOwnPropertySymbols.f=Object.getOwnPropertySymbols,getBuiltIn$2),uncurryThis=functionUncurryThis,getOwnPropertyNamesModule=objectGetOwnPropertyNames,getOwnPropertySymbolsModule=objectGetOwnPropertySymbols,anObject=anObject$2,concat=functionUncurryThis([].concat),ownKeys$1=getBuiltIn("Reflect","ownKeys")||function(e){var t=getOwnPropertyNamesModule.f(anObject(e)),r=getOwnPropertySymbolsModule.f;return r?concat(t,r(e)):t},hasOwn=hasOwnProperty_1,ownKeys=ownKeys$1,getOwnPropertyDescriptorModule=objectGetOwnPropertyDescriptor,definePropertyModule=objectDefineProperty,copyConstructorProperties$1=function(e,t,r){for(var a=ownKeys(t),n=definePropertyModule.f,o=getOwnPropertyDescriptorModule.f,i=0;i<a.length;i++){var s=a[i];hasOwn(e,s)||r&&hasOwn(r,s)||n(e,s,o(t,s))}},fails$1=fails$9,isCallable=isCallable$a,replacement=/#|\.prototype\./,isForced$1=function(e,t){e=data[normalize(e)];return e==POLYFILL||e!=NATIVE&&(isCallable(t)?fails$1(t):!!t)},normalize=isForced$1.normalize=function(e){return String(e).replace(replacement,".").toLowerCase()},data=isForced$1.data={},NATIVE=isForced$1.NATIVE="N",POLYFILL=isForced$1.POLYFILL="P",isForced_1=isForced$1,global$1=global$a,getOwnPropertyDescriptor$1=objectGetOwnPropertyDescriptor.f,createNonEnumerableProperty=createNonEnumerableProperty$2,defineBuiltIn=defineBuiltIn$1,defineGlobalProperty=defineGlobalProperty$3,copyConstructorProperties=copyConstructorProperties$1,isForced=isForced_1,_export=function(e,t){var r,a,n,o=e.target,i=e.global,s=e.stat,c=i?global$1:s?global$1[o]||defineGlobalProperty(o,{}):(global$1[o]||{}).prototype;if(c)for(r in t){if(a=t[r],n=e.dontCallGetSet?(n=getOwnPropertyDescriptor$1(c,r))&&n.value:c[r],!isForced(i?r:o+(s?".":"#")+r,e.forced)&&void 0!==n){if(typeof a==typeof n)continue;copyConstructorProperties(a,n)}(e.sham||n&&n.sham)&&createNonEnumerableProperty(a,"sham",!0),defineBuiltIn(c,r,a,e)}},classof=classofRaw,isArray$1=Array.isArray||function(e){return"Array"==classof(e)},DESCRIPTORS=descriptors,isArray=isArray$1,$TypeError$1=TypeError,getOwnPropertyDescriptor=Object.getOwnPropertyDescriptor,SILENT_ON_NON_WRITABLE_LENGTH_SET=DESCRIPTORS&&!function(){if(void 0!==this)return 1;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),arraySetLength=SILENT_ON_NON_WRITABLE_LENGTH_SET?function(e,t){if(isArray(e)&&!getOwnPropertyDescriptor(e,"length").writable)throw $TypeError$1("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},$TypeError=TypeError,MAX_SAFE_INTEGER=9007199254740991,doesNotExceedSafeInteger$1=function(e){if(MAX_SAFE_INTEGER<e)throw $TypeError("Maximum allowed index exceeded");return e},$=_export,toObject=toObject$2,lengthOfArrayLike=lengthOfArrayLike$2,setArrayLength=arraySetLength,doesNotExceedSafeInteger=doesNotExceedSafeInteger$1,fails=fails$9,INCORRECT_TO_LENGTH=fails$9(function(){return 4294967297!==[].push.call({length:4294967296},1)}),properErrorOnNonWritableLength=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}},FORCED=INCORRECT_TO_LENGTH||!properErrorOnNonWritableLength();$({target:"Array",proto:!0,arity:1,forced:FORCED},{push:function(e){var t=toObject(this),r=lengthOfArrayLike(t),a=arguments.length;doesNotExceedSafeInteger(r+a);for(var n=0;n<a;n++)t[r]=arguments[n],r++;return setArrayLength(t,r),r}});const userLogin="/Pac/User/login",getUser="/Pac/User/getUser",getUserList="/Pac/User/getUserList",getCloudAppsList="/Pac/CloudApps/getCloudAppsList",getCloudAppsCloudRender="/Pac/CloudApps/getCloudAppsCloudRender",openCloudApps="/Pac/CloudApps/openCloudApps",closeCloudApps="/Pac/CloudApps/closeCloudApps",deleteCloudAgents="/Pac/CloudAgents/deleteCloudAgents",getCloudAgentsList="/Pac/CloudAgents/getCloudAgentsList",getAppSceneList="/Pac/AppScene/getAppSceneList",getAppSceneLoadState="/Pac/AppScene/getAppSceneLoadState",getSceneCloudRender="/Pac/Scene/getSceneCloudRender",getScenePage="/Pac/Scene/getScenePage",getChildSceneList="/Pac/Scene/getChildSceneList",AggregationV4GetFlag="/Pac/Rte/Aggregation/V4/",AggregationV4GetFlagList="/Pac/Rte/Aggregation/V4/",AggregationV4GetFlagTagList="/Pac/Rte/Aggregation/V4",AggregationV4DisplayObject="/Pac/Rte/Aggregation/V4",AggregationV4MoveAlongThePath="/Pac/Rte/Aggregation/V4",AggregationV4FlagPlus="/Pac/Rte/Aggregation/V4",AggregationV4FlagTag="/Pac/Rte/Aggregation/V4",getPoiTemplate="/Pac/Rte/PoiTemplate/V4/getPoiTemplate",getPoiTemplateList="/Pac/Rte/PoiTemplate/V4/getPoiTemplateList",addPoi="/Pac/Rte/Poi/V4/addPoi",deletePoi="/Pac/Rte/Poi/V4/deletePoi",updatePoi="/Pac/Rte/Poi/V4/updatePoi",getPoi="/Pac/Rte/Poi/V4/getPoi",getPoiList="/Pac/Rte/Poi/V4/getPoiList",getPoiTagList="/Pac/Rte/Poi/V4/getPoiTagList",setDisplayPoi="/Pac/Rte/Poi/V4/setDisplayPoi",setPoiPluse="/Pac/Rte/Poi/V4/setPoiPluse",setPoiTag="/Pac/Rte/Poi/V4/setPoiTag",getObjectList="/Pac/Rte/Tag/V4/getObjectList",getTagList="/Pac/Rte/Tag/V4/getTagList",setObjectTag="/Pac/Rte/Tag/V4/setObjectTag",getContourStyle="/Pac/Rte/ContourStyle/V4/getContourStyle",getContourStyleList="/Pac/Rte/ContourStyle/V4/getContourStyleList",addContour="/Pac/Rte/Contour/V4/addContour",deleteContour="/Pac/Rte/Contour/V4/deleteContour",updateContour="/Pac/Rte/Contour/V4/updateContour",getContour="/Pac/Rte/Contour/V4/getContour",getContourList="/Pac/Rte/Contour/V4/getContourList",getContourTagList="/Pac/Rte/Contour/V4/getContourTagList",setContourDynamicTexture="/Pac/Rte/Contour/V4/setContourDynamicTexture",setContourPluse="/Pac/Rte/Contour/V4/setContourPluse",setContourTag="/Pac/Rte/Contour/V4/setContourTag",setContourWidthHigh="/Pac/Rte/Contour/V4/setContourWidthHigh",setDisplayContour="/Pac/Rte/Contour/V4/setDisplayContour",getScene="/Pac/Rte/Scene/V4/getScene",getSceneList="/Pac/Rte/Scene/V4/getSceneList",getArchitecture="/Pac/Rte/Architecture/V4/getArchitecture",getArchitectureList="/Pac/Rte/Architecture/V4/getArchitectureList",setDispersedArchitecture="/Pac/Rte/Architecture/V4/setDispersedArchitecture",setDisplayArchitecture="/Pac/Rte/Architecture/V4/setDisplayArchitecture",setHighlightArchitecture="/Pac/Rte/Architecture/V4/setHighlightArchitecture",addDataPannel="/Pac/Rte/DataPannel/V4/addDataPannel",updateDataPannel="/Pac/Rte/DataPannel/V4/updateDataPannel",getDataPannel="/Pac/Rte/DataPannel/V4/getDataPannel",getDataPannelList="/Pac/Rte/DataPannel/V4/getDataPannelList",getDataPannelTagList="/Pac/Rte/DataPannel/V4/getDataPannelTagList",setDataPannelTag="/Pac/Rte/DataPannel/V4/setDataPannelTag",setDisplayDataPannel="/Pac/Rte/DataPannel/V4/setDisplayDataPannel",setDataPannelAlwaysFaceScreen="/Pac/Rte/DataPannel/V4/setDataPannelAlwaysFaceScreen",setDataPannelUrl="/Pac/Rte/DataPannel/V4/setDataPannelUrl",setDataPannelVisibleDistance="/Pac/Rte/DataPannel/V4/setDataPannelVisibleDistance",deleteDataPannel="/Pac/Rte/DataPannel/V4/deleteDataPannel",addHeatMap="/Pac/Rte/HeatMap/V4/addHeatMap",addPathHeatMap="/Pac/Rte/HeatMap/V4/addPathHeatMap",deleteHeatMap="/Pac/Rte/HeatMap/V4/deleteHeatMap",updateHeatMap="/Pac/Rte/HeatMap/V4/updateHeatMap",getHeatMap="/Pac/Rte/HeatMap/V4/getHeatMap",getHeatMapList="/Pac/Rte/HeatMap/V4/getHeatMapList",getHeatMapTagList="/Pac/Rte/HeatMap/V4/getHeatMapTagList",setDisplayHeatMap="/Pac/Rte/HeatMap/V4/setDisplayHeatMap",setHeatMapTag="/Pac/Rte/HeatMap/V4/setHeatMapTag",setPathHeatMapWidthHigh="/Pac/Rte/HeatMap/V4/setPathHeatMapWidthHigh",getEffectTemplate="/Pac/Rte/EffectTemplate/V4/getEffectTemplate",getEffectTemplateList="/Pac/Rte/EffectTemplate/V4/getEffectTemplateList",addEffect="/Pac/Rte/Effect/V4/addEffect",deleteEffect="/Pac/Rte/Effect/V4/deleteEffect",updateEffect="/Pac/Rte/Effect/V4/updateEffect",getEffect="/Pac/Rte/Effect/V4/getEffect",getEffectList="/Pac/Rte/Effect/V4/getEffectList",getEffectTagList="/Pac/Rte/Effect/V4/getEffectTagList",setDisplayEffect="/Pac/Rte/Effect/V4/setDisplayEffect",setEffectMoveAlongThePath="/Pac/Rte/Effect/V4/setEffectMoveAlongThePath",setEffectPluse="/Pac/Rte/Effect/V4/setEffectPluse",setEffectTag="/Pac/Rte/Effect/V4/setEffectTag",addSceneViewPath="/Pac/Rte/SceneViewPath/V4/addSceneViewPath",deleteSceneViewPath="/Pac/Rte/SceneViewPath/V4/deleteSceneViewPath",updateSceneViewPath="/Pac/Rte/SceneViewPath/V4/updateSceneViewPath",getSceneViewPath="/Pac/Rte/SceneViewPath/V4/getSceneViewPath",getSceneViewPathList="/Pac/Rte/SceneViewPath/V4/getSceneViewPathList",getSceneViewPathTagList="/Pac/Rte/SceneViewPath/V4/getSceneViewPathTagList",playSceneViewPath="/Pac/Rte/SceneViewPath/V4/playSceneViewPath",setSceneViewPathTag="/Pac/Rte/SceneViewPath/V4/setSceneViewPathTag",updateSceneViewPoint="/Pac/Rte/SceneViewPoint/V4/updateSceneViewPoint",getSceneViewPoint="/Pac/Rte/SceneViewPoint/V4/getSceneViewPoint",getSceneViewPointList="/Pac/Rte/SceneViewPoint/V4/getSceneViewPointList",setDefaultSceneViewPoint="/Pac/Rte/SceneViewPoint/V4/setDefaultSceneViewPoint",setSceneViewPointMoveAlongThePath="/Pac/Rte/SceneViewPoint/V4/setSceneViewPointMoveAlongThePath",updateVideoPannel="/Pac/Rte/VideoPannel/V4/updateVideoPannel",getVideoPannel="/Pac/Rte/VideoPannel/V4/getVideoPannel",getVideoPannelList="/Pac/Rte/VideoPannel/V4/getVideoPannelList",getAreaVideoPannelList="/Pac/Rte/VideoPannel/V4/getAreaVideoPannelList",getVideoPannelTagList="/Pac/Rte/VideoPannel/V4/getVideoPannelTagList",setDisplayVideoPannel="/Pac/Rte/VideoPannel/V4/setDisplayVideoPannel",setVideoPannelMoveAlongThePath="/Pac/Rte/VideoPannel/V4/setVideoPannelMoveAlongThePath",setVideoPannelPlay="/Pac/Rte/VideoPannel/V4/setVideoPannelPlay",setVideoPannelSource="/Pac/Rte/VideoPannel/V4/setVideoPannelSource",setVideoPannelTag="/Pac/Rte/VideoPannel/V4/setVideoPannelTag",getPathBrowserStyle="/Pac/Rte/PathBrowserStyle/V4/getPathBrowserStyle",getPathBrowserStyleList="/Pac/Rte/PathBrowserStyle/V4/getPathBrowserStyleList",addPathBrowser="/Pac/Rte/PathBrowser/V4/addPathBrowser",deletePathBrowser="/Pac/Rte/PathBrowser/V4/deletePathBrowser",updatePathBrowser="/Pac/Rte/PathBrowser/V4/updatePathBrowser",getPathBrowser="/Pac/Rte/PathBrowser/V4/getPathBrowser",getPathBrowserList="/Pac/Rte/PathBrowser/V4/getPathBrowserList",getPathBrowserTagList="/Pac/Rte/PathBrowser/V4/getPathBrowserTagList",setDisplayPathBrowser="/Pac/Rte/PathBrowser/V4/setDisplayPathBrowser",setPathBrowserDynamicTexture="/Pac/Rte/PathBrowser/V4/setPathBrowserDynamicTexture",setPathBrowserPulse="/Pac/Rte/PathBrowser/V4/setPathBrowserPulse",setPathBrowserTag="/Pac/Rte/PathBrowser/V4/setPathBrowserTag",setPathBrowserWidthHigh="/Pac/Rte/PathBrowser/V4/setPathBrowserWidthHigh",getGeneralModelTemplate="/Pac/Rte/GeneralModelTemplate/V4/getGeneralModelTemplate",getGeneralModelTemplateList="/Pac/Rte/GeneralModelTemplate/V4/getGeneralModelTemplateList",addGeneralModel="/Pac/Rte/GeneralModel/V4/addGeneralModel",deleteGeneralModel="/Pac/Rte/GeneralModel/V4/deleteGeneralModel",updateGeneralModel="/Pac/Rte/GeneralModel/V4/updateGeneralModel",getGeneralModel="/Pac/Rte/GeneralModel/V4/getGeneralModel",getGeneralModelList="/Pac/Rte/GeneralModel/V4/getGeneralModelList",getGeneralModelTagList="/Pac/Rte/GeneralModel/V4/getGeneralModelTagList",setDisplayGeneralModel="/Pac/Rte/GeneralModel/V4/setDisplayGeneralModel",setGeneralModelMoveAlongThePath="/Pac/Rte/GeneralModel/V4/setGeneralModelMoveAlongThePath",setGeneralModelTag="/Pac/Rte/GeneralModel/V4/setGeneralModelTag",displayObject="/Pac/Rte/Project/V4/displayObject",locationSceneObject="/Pac/Rte/Project/V4/locationSceneObject",quitProject="/Pac/Rte/Project/V4/quitProject",saveProject="/Pac/Rte/Project/V4/saveProject",setLoLaLine="/Pac/Rte/Project/V4/setLoLaLine",setMoveObject="/Pac/Rte/Project/V4/setMoveObject",setSurround="/Pac/Rte/Project/V4/setSurround",switchCallback="/Pac/Rte/Project/V4/switchCallback",switchProjectScene="/Pac/Rte/Project/V4/switchProjectScene",addHighlightArea="/Pac/Rte/HighlightArea/V4/addHighlightArea",deleteHighlightArea="/Pac/Rte/HighlightArea/V4/deleteHighlightArea",updateHighlightArea="/Pac/Rte/HighlightArea/V4/updateHighlightArea",getHighlightArea="/Pac/Rte/HighlightArea/V4/getHighlightArea",getHighlightAreaList="/Pac/Rte/HighlightArea/V4/getHighlightAreaList",getHighlightAreaTagList="/Pac/Rte/HighlightArea/V4/getHighlightAreaTagList",setDisplayHighlightArea="/Pac/Rte/HighlightArea/V4/setDisplayHighlightArea",setHighlightAreaTag="/Pac/Rte/HighlightArea/V4/setHighlightAreaTag";let token=null,defaultHeader={cache:"no-store",keepalive:!0},baseInfo={},cacheApi=[],isFetchIng=!1;const isFunction=e=>"[object Function]"===Object.prototype.toString.call(e),initBaseInfo=e=>{baseInfo=e},initFetchHeader=e=>{defaultHeader={...defaultHeader,...e}},fetchFn=(e,a,n)=>{fetch(baseInfo.passUrl+e,{...a,headers:{...a.headers,...defaultHeader,"X-Token":token}}).then(e=>(cacheApi.length&&cacheApi.shift(),e.json())).then(e=>{var t=baseInfo.event,e=e.data||e,r=a.headers.func_name;r&&(t.data={type:r,data:e},window.dispatchEvent(t)),n&&isFunction(n)&&n(e)}).catch(()=>{n&&isFunction(n)&&n("网络异常,请检查网络后重连")})},fetchApi=(e,t,r)=>{var{passUrl:a,username:n,password:o}=baseInfo;token?fetchFn(e,t,r):(cacheApi.push({url:e,options:t,callback:r}),isFetchIng||(isFetchIng=!0,fetch(""+a+userLogin,{method:"post",headers:{"Content-Type":"application/json",func_name:"userLogin"},body:JSON.stringify({loginName:n,password:o})}).then(e=>e.json()).then(e=>{token=e.data.accessToken,cacheApi.forEach(e=>{var{url:e,options:t,callback:r}=e;fetchFn(e,t,r)})}).catch(e=>{console.log("网络异常,请检查网络后重连",e)}).finally(()=>{isFetchIng=!1})))};class DefaultApi{constructor(){this.appliId=""}setTaskId(e){this.appliId=e}userLogin(e,t){fetchApi(userLogin,{method:"post",headers:{"Content-Type":"application/json",func_name:"userLogin"},body:JSON.stringify(e)},t)}getUser(e,t){fetchApi(getUser+"?userId="+e.userId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUser"}},t)}getUserList(e){fetchApi(getUserList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUserList"}},e)}getCloudAppsList(e){fetchApi(getCloudAppsList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUserList"}},e)}getCloudAppsCloudRender(e,t){fetchApi(getCloudAppsCloudRender+"?appliId="+this.appliId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUserList"},params:e},t)}closeCloudApps(e){fetchApi(closeCloudApps+"?appliId="+this.appliId,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"closeCloudApps"}},e)}openCloudApps(e){fetchApi(openCloudApps+"?appliId="+this.appliId,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"openCloudApps"}},e)}getAppSceneLoadState(e){fetchApi(getAppSceneLoadState+"?appliId="+this.appliId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getAppSceneLoadState"}},e)}deleteCloudAgents(e,t){fetchApi(deleteCloudAgents,{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteCloudAgents"},body:JSON.stringify({agentId:e.agentId})},t)}getCloudAgentsList(e){fetchApi(getCloudAgentsList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getCloudAgentsList"}},e)}getAppSceneList(e){fetchApi(""+getAppSceneList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getAppSceneList"}},e)}getSceneCloudRender(e,t){fetchApi(`${getSceneCloudRender}?contentId=${e.contentId}&sid=${e.sid}&XToken=`+e.XToken,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getSceneCloudRender"}},t)}getScenePage(e){fetchApi(getScenePage,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getScenePage"}},e)}getChildSceneList(e,t){fetchApi(getChildSceneList+"?sid="+e.sid,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getChildSceneList"}},t)}AggregationV4GetFlagList(e,t){fetchApi(`${AggregationV4GetFlagList}/get${e.flag}List?tag=${e.tag}&view=`+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"AggregationV4GetFlagList"},params:e},t)}AggregationV4GetFlag(e,t){fetchApi(`${AggregationV4GetFlag}get${e.flag}?home=${e.home}&id=`+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"AggregationV4GetFlag"},params:e},t)}AggregationV4GetFlagTagList(e,t){fetchApi(`${AggregationV4GetFlagTagList}/get${e.flag}TagList?id=`+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"AggregationV4GetFlagTagList"}},t)}AggregationV4DisplayObject(e,t){fetchApi(`${AggregationV4DisplayObject}/setDisplay${e.flag}Object`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4DisplayObject"},body:JSON.stringify(e)},t)}AggregationV4MoveAlongThePath(e,t){fetchApi(`${AggregationV4MoveAlongThePath}/set${e.flag}MoveAlongThePath`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4MoveAlongThePath"},body:JSON.stringify(e)},t)}AggregationV4FlagPlus(e,t){fetchApi(`${AggregationV4FlagPlus}/set${e.flag}Pulse`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4FlagPlus"},body:JSON.stringify(e)},t)}AggregationV4FlagTag(e,t){fetchApi(`${AggregationV4FlagTag}/set${e.flag}Tag`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4FlagTag"},body:JSON.stringify(e)},t)}getPoiTemplate(e,t){fetchApi(getPoiTemplate+"?resourceId="+e.resourceId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiTemplate"}},t)}getPoiTemplateList(e){fetchApi(""+getPoiTemplateList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiTemplateList"}},e)}addPoi(e,t){fetchApi(addPoi,{method:"post",headers:{"Content-Type":"application/json",func_name:"addPoi"},body:JSON.stringify(e)},t)}deletePoi(e,t){fetchApi(deletePoi+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deletePoi"}},t)}updatePoi(e,t){fetchApi(updatePoi,{method:"put",headers:{"Content-Type":"application/json",func_name:"updatePoi"},body:JSON.stringify(e)},t)}getPoi(e,t){fetchApi(getPoi+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoi"}},t)}getPoiList(e,t){fetchApi(getPoiList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiList"}},t)}getPoiTagList(e,t){fetchApi(getPoiTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiTagList"}},t)}setDisplayPoi(e,t){fetchApi(setDisplayPoi,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayPoi"},body:JSON.stringify(e)},t)}setPoiPluse(e,t){fetchApi(setPoiPluse,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPoiPluse"},body:JSON.stringify(e)},t)}setPoiTag(e,t){fetchApi(setPoiTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPoiTag"},body:JSON.stringify(e)},t)}getObjectList(e,t){fetchApi(getObjectList,{method:"post",headers:{"Content-Type":"application/json",func_name:"getObjectList"},body:JSON.stringify(e)},t)}getTagList(e){fetchApi(getTagList,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getTagList"}},e)}setObjectTag(e,t){fetchApi(setObjectTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setObjectTag"},body:JSON.stringify(e)},t)}getContourStyle(e,t){fetchApi(getContourStyle+"?resourceId="+e.resourceId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourStyle"}},t)}getContourStyleList(e){fetchApi(""+getContourStyleList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourStyleList"}},e)}addContour(e,t){fetchApi(addContour,{method:"post",headers:{"Content-Type":"application/json",func_name:"addContour"},body:JSON.stringify(e)},t)}getContourList(e,t){fetchApi(getContourList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourList"}},t)}getContourTagList(e,t){fetchApi(getContourTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourTagList"}},t)}updateContour(e,t){fetchApi(updateContour,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateContour"},body:JSON.stringify(e)},t)}getContour(e,t){fetchApi(getContour+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContour"}},t)}setContourPluse(e,t){fetchApi(""+setContourPluse,{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourPluse"},body:JSON.stringify(e)},t)}setContourTag(e,t){fetchApi(""+setContourTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourTag"},body:JSON.stringify(e)},t)}setContourHight(e,t){fetchApi(""+setContourWidthHigh,{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourHight"},body:JSON.stringify({dhigh:e.height,id:e.id})},t)}setDisplayContour(e,t){fetchApi(""+setDisplayContour,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayContour"},body:JSON.stringify(e)},t)}setContourDynamicTexture(e,t){fetchApi(""+setContourDynamicTexture,{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourDynamicTexture"},body:JSON.stringify(e)},t)}deleteContour(e,t){fetchApi(deleteContour+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/json",func_name:"deleteContour"}},t)}getScene(e,t){fetchApi(getScene+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/json",func_name:"getScene"}},t)}getSceneList(e,t){fetchApi(getSceneList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/json",func_name:"getSceneList"}},t)}getArchitecture(e,t){fetchApi(getArchitecture+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getArchitecture"}},t)}getArchitectureList(e,t){fetchApi(getArchitectureList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getArchitectureList"}},t)}setDispersedArchitecture(e,t){fetchApi(""+setDispersedArchitecture,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDispersedArchitecture"},body:JSON.stringify(e)},t)}setDisplayArchitecture(e,t){fetchApi(""+setDisplayArchitecture,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayArchitecture"},body:JSON.stringify(e)},t)}setHighlightArchitecture(e,t){fetchApi(""+setHighlightArchitecture,{method:"post",headers:{"Content-Type":"application/json",func_name:"setHighlightArchitecture"},body:JSON.stringify(e)},t)}deleteDataPannel(e,t){fetchApi(deleteDataPannel+"?id="+e.id,{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteDataPannel"}},t)}addDataPannel(e,t){fetchApi(""+addDataPannel,{method:"post",headers:{"Content-Type":"application/json",func_name:"addDataPannel"},body:JSON.stringify(e)},t)}setDataPannelToward(e,t){fetchApi(""+setDataPannelAlwaysFaceScreen,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelToward"},body:JSON.stringify(e)},t)}setDataPannelUrl(e,t){fetchApi(""+setDataPannelUrl,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelUrl"},body:JSON.stringify(e)},t)}setDataPannelVisibleDistance(e,t){fetchApi(""+setDataPannelVisibleDistance,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelVisibleDistance"},body:JSON.stringify(e)},t)}getDataPannelList(e,t){fetchApi(getDataPannelList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getDataPannelList"}},t)}getDataPannel(e,t){fetchApi(getDataPannel+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getDataPannel"}},t)}updateDataPannel(e,t){fetchApi(""+updateDataPannel,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateDataPannel"},body:JSON.stringify(e)},t)}getDataPannelTagList(e,t){fetchApi(getDataPannelTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getDataPannelTagList"}},t)}setDataPannelTag(e,t){fetchApi(""+setDataPannelTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelTag"},body:JSON.stringify(e)},t)}setDisplayDataPannel(e,t){fetchApi(""+setDisplayDataPannel,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayDataPannel"},body:JSON.stringify(e)},t)}addHeatMap(e,t){fetchApi(""+addHeatMap,{method:"post",headers:{"Content-Type":"application/json",func_name:"addHeatMap"},body:JSON.stringify(e)},t)}addPathHeatMap(e,t){fetchApi(""+addPathHeatMap,{method:"post",headers:{"Content-Type":"application/json",func_name:"addPathHeatMap"},body:JSON.stringify(e)},t)}getHeatMapList(e,t){fetchApi(getHeatMapList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHeatMapList"}},t)}getHeatMapTagList(e,t){fetchApi(getHeatMapTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHeatMapTagList"}},t)}getHeatMap(e,t){fetchApi(getHeatMap+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHeatMap"}},t)}updateHeatMap(e,t){fetchApi(""+updateHeatMap,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateHeatMap"},body:JSON.stringify(e)},t)}setDisplayHeatMap(e,t){fetchApi(""+setDisplayHeatMap,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayHeatMap"},body:JSON.stringify(e)},t)}setHeatMapTag(e,t){fetchApi(""+setHeatMapTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setHeatMapTag"},body:JSON.stringify(e)},t)}setPathHeatMapWidthHigh(e,t){fetchApi(""+setPathHeatMapWidthHigh,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathHeatMapWidthHigh"},body:JSON.stringify(e)},t)}deleteHeatMap(e,t){fetchApi(deleteHeatMap+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteHeatMap"}},t)}getEffectTemplate(e,t){fetchApi(getEffectTemplate+"?resourceId="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectTemplate"}},t)}getEffectTemplateList(e){fetchApi(""+getEffectTemplateList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectTemplateList"}},e)}addEffect(e,t){fetchApi(addEffect,{method:"post",headers:{"Content-Type":"application/json",func_name:"addEffect"},body:JSON.stringify(e)},t)}updateEffect(e,t){fetchApi(updateEffect,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateEffect"},body:JSON.stringify(e)},t)}getEffect(e,t){fetchApi(getEffect+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffect"}},t)}getEffectList(e,t){fetchApi(getEffectList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectList"}},t)}setDisplayEffect(e,t){fetchApi(""+setDisplayEffect,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayEffect"},body:JSON.stringify(e)},t)}setEffectMoveAlongThePath(e,t){fetchApi(""+setEffectMoveAlongThePath,{method:"post",headers:{"Content-Type":"application/json",func_name:"setEffectMoveAlongThePath"},body:JSON.stringify(e)},t)}setEffectPluse(e,t){fetchApi(""+setEffectPluse,{method:"post",headers:{"Content-Type":"application/json",func_name:"setEffectPluse"},body:JSON.stringify(e)},t)}setEffectTag(e,t){fetchApi(""+setEffectTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setEffectTag"},body:JSON.stringify(e)},t)}getEffectTagList(e,t){fetchApi(getEffectTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectTagList"}},t)}deleteEffect(e,t){fetchApi(deleteEffect+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteEffect"}},t)}addViewPath(e,t){fetchApi(""+addSceneViewPath,{method:"post",headers:{"Content-Type":"application/json",func_name:"addViewPath"},body:JSON.stringify(e)},t)}updateViewPath(e,t){fetchApi(""+updateSceneViewPath,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateViewPath"},body:JSON.stringify(e)},t)}getViewPathList(e,t){fetchApi(`${getSceneViewPathList}?tag=${e.tag}&view=`+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPathList"}},t)}getViewPath(e,t){fetchApi(getSceneViewPath+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPath"}},t)}getViewPathTagList(e,t){fetchApi(getSceneViewPathTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPathTagList"}},t)}playViewPath(e,t){fetchApi(""+playSceneViewPath,{method:"post",headers:{"Content-Type":"application/json",func_name:"playViewPath"},body:JSON.stringify(e)},t)}setViewPathTag(e,t){fetchApi(""+setSceneViewPathTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setViewPathTag"},body:JSON.stringify(e)},t)}deleteViewPath(e,t){fetchApi(deleteSceneViewPath+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteViewPath"}},t)}getViewPointList(e){fetchApi(""+getSceneViewPointList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPointList"}},e)}getViewPoint(e,t){fetchApi(getSceneViewPoint+"?home="+e.home,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPoint"}},t)}setDefaultViewPoint(e,t){fetchApi(""+setDefaultSceneViewPoint,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDefaultViewPoint"},body:JSON.stringify(e)},t)}updateViewPoint(e,t){fetchApi(""+updateSceneViewPoint,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateViewPoint"},body:JSON.stringify(e)},t)}moveAlongThePath(e,t){fetchApi(""+setSceneViewPointMoveAlongThePath,{method:"post",headers:{"Content-Type":"application/json",func_name:"moveAlongThePath"},body:JSON.stringify(e)},t)}getVideoPannelList(e,t){fetchApi(getVideoPannelList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getVideoPannelList"}},t)}getVideoPannel(e,t){fetchApi(getVideoPannel+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getVideoPannel"}},t)}getAreaVideoPannelList(e,t){fetchApi(""+getAreaVideoPannelList,{method:"post",headers:{"Content-Type":"application/json",func_name:"getAreaVideoPannelList"},body:JSON.stringify(e)},t)}getVideoPannelTagList(e,t){fetchApi(getVideoPannelTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getVideoPannelTagList"}},t)}updateVideoPannel(e,t){fetchApi(""+updateVideoPannel,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateVideoPannel"},body:JSON.stringify(e)},t)}setDisplayVideoPannel(e,t){fetchApi(""+setDisplayVideoPannel,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayVideoPannel"},body:JSON.stringify(e)},t)}setVideoPannelMoveAlongThePath(e,t){fetchApi(""+setVideoPannelMoveAlongThePath,{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelMoveAlongThePath"},body:JSON.stringify(e)},t)}setVideoPannelPlay(e,t){fetchApi(""+setVideoPannelPlay,{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelPlay"},body:JSON.stringify(e)},t)}setVideoPannelSource(e,t){fetchApi(""+setVideoPannelSource,{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelSource"},body:JSON.stringify(e)},t)}setVideoPannelTag(e,t){fetchApi(""+setVideoPannelTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelTag"},body:JSON.stringify(e)},t)}getPathStyleList(e){fetchApi(""+getPathBrowserStyleList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathStyleList"}},e)}getPathBrowserStyle(e,t){fetchApi(getPathBrowserStyle+"?resourceId="+e.resourceId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathBrowserStyle"}},t)}getPathList(e,t){fetchApi(getPathBrowserList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathList"}},t)}getPath(e,t){fetchApi(getPathBrowser+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPath"}},t)}updatePath(e,t){fetchApi(""+updatePathBrowser,{method:"put",headers:{"Content-Type":"application/json",func_name:"updatePath"},body:JSON.stringify(e)},t)}addPath(e,t){fetchApi(""+addPathBrowser,{method:"post",headers:{"Content-Type":"application/json",func_name:"addPath"},body:JSON.stringify(e)},t)}getPathTagList(e,t){fetchApi(getPathBrowserTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathTagList"}},t)}setDisplayPath(e,t){fetchApi(""+setDisplayPathBrowser,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayPath"},body:JSON.stringify(e)},t)}setPathDynamicTexture(e,t){fetchApi(""+setPathBrowserDynamicTexture,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathDynamicTexture"},body:JSON.stringify(e)},t)}setPathPulse(e,t){fetchApi(""+setPathBrowserPulse,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathPulse"},body:JSON.stringify(e)},t)}setPathTag(e,t){fetchApi(""+setPathBrowserTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathTag"},body:JSON.stringify(e)},t)}setPathWidth(e,t){fetchApi(""+setPathBrowserWidthHigh,{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathWidth"},body:JSON.stringify({id:e.id,dwidth:e.width})},t)}deletePath(e,t){fetchApi(deletePathBrowser+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deletePath"}},t)}getGeneralModelTemplate(e,t){fetchApi(getGeneralModelTemplate+"?resourceId="+encodeURIComponent(e.resourceId),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelTemplate"}},t)}getGeneralModelTemplateList(e){fetchApi(""+getGeneralModelTemplateList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelTemplateList"}},e)}addGeneralModel(e,t){fetchApi(""+addGeneralModel,{method:"post",headers:{"Content-Type":"application/json",func_name:"addGeneralModel"},body:JSON.stringify(e)},t)}updateGeneralModel(e,t){fetchApi(""+updateGeneralModel,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateGeneralModel"},body:JSON.stringify(e)},t)}getGeneralModel(e,t){fetchApi(getGeneralModel+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelList"}},t)}getGeneralModelList(e,t){fetchApi(getGeneralModelList+"?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelList"}},t)}getGeneralModelTagList(e,t){fetchApi(getGeneralModelTagList+"?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelTagList"}},t)}setDisplayGeneralModel(e,t){fetchApi(""+setDisplayGeneralModel,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayGeneralModel"},body:JSON.stringify(e)},t)}setGeneralModelMoveAlongThePath(e,t){fetchApi(""+setGeneralModelMoveAlongThePath,{method:"post",headers:{"Content-Type":"application/json",func_name:"setGeneralModelMoveAlongThePath"},body:JSON.stringify(e)},t)}setGeneralModelTag(e,t){fetchApi(""+setGeneralModelTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setGeneralModelTag"},body:JSON.stringify(e)},t)}deleteGeneralModel(e,t){fetchApi(deleteGeneralModel+"?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteGeneralModel"}},t)}addHighlightArea(e,t){fetchApi(""+addHighlightArea,{method:"post",headers:{"Content-Type":"application/json",func_name:"addHighlightArea"},body:JSON.stringify(e)},t)}deleteHighlightArea(e,t){fetchApi(deleteHighlightArea+"?id="+e.id,{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteHighlightArea"}},t)}updateHighlightArea(e,t){fetchApi(""+updateHighlightArea,{method:"put",headers:{"Content-Type":"application/json",func_name:"updateHighlightArea"},body:JSON.stringify(e)},t)}getHighlightArea(e,t){fetchApi(getHighlightArea+"?id="+e.id,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHighlightArea"}},t)}getHighlightAreaList(e,t){fetchApi(""+getHighlightAreaList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHighlightAreaList"},params:e},t)}getHighlightAreaTagList(e,t){fetchApi(""+getHighlightAreaTagList,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHighlightAreaTagList"},params:e},t)}setDisplayHighlightArea(e,t){fetchApi(""+setDisplayHighlightArea,{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayHighlightArea"},body:JSON.stringify(e)},t)}setHighlightAreaTag(e,t){fetchApi(""+setHighlightAreaTag,{method:"post",headers:{"Content-Type":"application/json",func_name:"setHighlightAreaTag"},body:JSON.stringify(e)},t)}displayObject(e,t){fetchApi(""+displayObject,{method:"post",headers:{"Content-Type":"application/json",func_name:"displayObject"},body:JSON.stringify(e)},t)}locationSceneObject(e,t){fetchApi(locationSceneObject+"?objectId="+e.objectId,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"locationSceneObject"}},t)}quitProject(e,t){fetchApi(""+quitProject,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"quitProject"},body:JSON.stringify(e)},t)}saveProject(e){fetchApi(""+saveProject,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"saveProject"}},e)}setLoLaLine(e,t){fetchApi(""+setLoLaLine,{method:"post",headers:{"Content-Type":"application/json",func_name:"setLoLaLine"},body:JSON.stringify(e)},t)}setMoveObject(e,t){fetchApi(""+setMoveObject,{method:"post",headers:{"Content-Type":"application/json",func_name:"setMoveObject"},body:JSON.stringify(e)},t)}setSurround(e,t){fetchApi(""+setSurround,{method:"post",headers:{"Content-Type":"application/json",func_name:"setSurround"},body:JSON.stringify(e)},t)}switchCallback(e,t){fetchApi(""+switchCallback,{method:"post",headers:{"Content-Type":"application/json",func_name:"switchCallback"},body:JSON.stringify(e)},t)}switchProjectScene(e,t){fetchApi(""+switchProjectScene,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"switchProjectScene"},body:`projectId=${encodeURIComponent(e.projectId)}&sceneId=`+encodeURIComponent(e.sceneId)},t)}}const isJSON=e=>{if("string"==typeof e)try{var t=JSON.parse(e);return"object"==typeof t&&t?t:{}}catch(e){return{}}console.log("It is not a string!")},INFORMATION_MONITORING="InformationMonitoring";let event=document.createEvent("HTMLEvents");event.initEvent(INFORMATION_MONITORING,!0,!0);class CloudRender extends DefaultApi{constructor(e,t,r){var a,n=e=>super[e],o=3<arguments.length&&void 0!==arguments[3]&&arguments[3],o=(super(),(a=this).url=e,this.username=t,this.password=r,this.appliId="",this.dropFn=null,this.logoutFn=null,this.process=0,this.protooPort="",this.height="80vh",this.ishttps=o,this.videoEle=null,(async()=>(initBaseInfo({event:event,passUrl:e,username:t,password:r}),delete this.then,this))());this.then=o.then.bind(o),this.renderEle=e=>{let t=null,r=!0;var a;store$5.state.stream.cc[this.appliId]?((t=new MediaStream).addTrack(store$5.state.stream.cc[this.appliId].track),(a=e.getElementsByTagName("video")[0]).srcObject=t,a.autofocus="autofocus",a.preload="auto",a.playsInline=!0,a.webkitPlaysinline=!0,a.x5VideoPlayerType="h5",a.x5VideoPlayerFullscreen=!0,a.x5VideoOrientation="portraint",a.className=style.success,this.videoEle=a,setTimeout(()=>{setup(e,e.getElementsByTagName("video"),this.appliId),window.addEventListener("resize",()=>{setup(e,e.getElementsByTagName("video"),this.appliId)})},2e3),setTimeout(()=>{setup(e,e.getElementsByTagName("video"),this.appliId),window.addEventListener("resize",()=>{setup(e,e.getElementsByTagName("video"),this.appliId)})},4e3),a.addEventListener("dragover",e=>{e.preventDefault()}),a.addEventListener("drop",e=>{r=!0,super.switchCallback({coordinate:!0,pixelPoint:!0},()=>{emitMouseMove(e.offsetX,e.offsetY,0,0,this.appliId),emitMouseDown(0,e.offsetX,e.offsetY,this.appliId),emitMouseUp(0,e.offsetX,e.offsetY,this.appliId)})}),this.dropFn&&(a=`${this.ishttps?"wss":"ws"}://${(this.ishttps?this.url.split("https://"):this.url.split("http://"))[1]}websocket/`+(this.appliId+100*Math.random()),new WebSocket(a).onmessage=e=>{r&&this.dropFn&&(this.dropFn({type:"drop",...JSON.parse(e.data).PICKPOINT}),r=!1)})):this.setRenderStatus(e,FAIL)},this.setRenderStatus=(e,t)=>{var r;t==LOADING?e.innerHTML=`
                <div class="${style.box}">
                <div class="${style.process}">
                <div class=${style.progress_bar__outer}>
                </div>
                <div class="${style.tip}">孪生世界正在加载中[${this.process}%] , 请稍等...</div>
                </div>
                </div> 
              `:t==FAIL&&(e.style.display="inline-block",e.innerHTML=`
                <div class=${style.fail}>
                <div class=${style.loadingText}>
                  <div >
                    <span class=${style.tip1} ></span>
                  </div>
                  <div class=${style.loadFailTitle}>加载失败</div>
                  <div class=${style.loadFailText}>抱歉,由于当前场景加载失败,无法正常体验</div>
                  <div class=${style.btnGroup}>
                    <span class=${style.logout} id="zhyz_logout" style="display: ${this.logoutFn?"inline":"none"}">退出</span>
                    <span class=${style.reload} id="zhyz_reload">刷新</span>
                  </div>
                </div> 
                </div>
              `,t=document.getElementById("zhyz_reload"),r=document.getElementById("zhyz_logout"),t&&(t.onclick=()=>{super.closeCloudApps({appliId:this.appliId},()=>{super.openCloudApps({appliId:this.appliId})}),this.joinRoom({ele:e,roomId:this.appliId,myhostname:this.myhostname,protooPort:this.protooPort,displayName:this.username})}),r)&&(r.onclick=()=>{this.logoutFn&&this.logoutFn()})},this.setLoading=(e,t)=>{e=isJSON(e.data),e=e.LOADPROJECT_PROCESS||{};let r=null;(e.result&&e.process||null==e.result&&e.process)&&(r=e.process?e.process.toFixed(0):0,this.process=r),100<=r?(this.process=100,this.setRenderStatus(t,LOADING),setTimeout(()=>{t.style.display="none",t.style.zIndex="0",store$5.state.stream.cc[this.appliId](this.appliId)||this.setRenderStatus(t,FAIL)},1e3)):!r&&0!=r||(t.style.display="inline-block",t.style.zIndex="2",this.setRenderStatus(t,LOADING))},this.ws=null,this.socketServe=null,this.myhostname=null,this.handleResponseFunction=t=>{var e=this.url.replace("http://","ws://").replace("https://","wss://")+"/websocket/"+this.appliId;this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("ws连接状态："+this.ws.readyState)},this.ws.onmessage=e=>{console.log("接收到来自服务器的消息："),t(e.data)},this.ws.onclose=()=>{console.log("ws连接状态："+this.ws.readyState)},this.ws.onerror=function(e){console.log(e)}},this.RegisterCloudResponse=t=>{window.addEventListener(INFORMATION_MONITORING,e=>{t(e.data)})},this.playVideo=e=>{this.videoEle&&this.videoEle.play(),e(this.videoEle)},this.registerWebscoket=t=>{var e=`${this.ishttps?"wss":"ws"}://${(this.ishttps?this.url.split("https://"):this.url.split("http://"))[1]}websocket/`+this.appliId+Math.random();this.socketServe=new websocket(e,e=>{t(e)})},this.closeWebscoket=e=>{e(JSON.stringify({msg:"关闭长连接"})),this.socketServe.websocketclose()},this.enlarge=e=>{emitMouseWheel(120,e.offsetX||0,e.offsetY||0,this.appliId)},this.narrow=e=>{emitMouseWheel(-120,e.offsetX||0,e.offsetY||0,this.appliId)},this.backToOrigin=()=>{var e=new DataView(new ArrayBuffer(3));e.setUint8(0,62),e.setUint16(1,32,!0),sendInputData(e.buffer,this.appliId)},this.joinRoom=(t,e)=>{var r={ele:t.ele,roomId:t.appliId,myhostname:t.myhostname,protooPort:t.protooPort,displayName:this.username};t.protooPort&&(r.protooPort=t.protooPort,this.protooPort=t.protooPort),this.appliId=t.appliId,super.setTaskId(t.appliId),initFetchHeader({"App-TaskId":t.appliId});let a=document.createElement("div");var n=navigator.userAgent,o=t.ele.getElementsByTagName("video")[0],n=("micromessenger"==n.toLowerCase().match(/MicroMessenger/i)&&n.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?o.controls=!0:(o.muted=!0,o.autoplay=!0),a.id="cloudrender-loading",t.ele.classList.add(style.zhyzPayBox),0!=t.ele.parentNode.clientHeight&&(this.height=t.ele.parentNode.clientHeight+"px"),t.ele.style.height=this.height,t.ele.insertBefore(a,null),this.myhostname=t.myhostname,joinRoomClient({...r,ishttps:this.ishttps,renderEle:t.ele}),`${this.ishttps?"wss":"ws"}://${(this.ishttps?this.url.split("https://"):this.url.split("http://"))[1]}websocket/`+(this.appliId+100*Math.random()));let i=new WebSocket(n);i.onmessage=e=>{this.setLoading(e,a,i)},i.onerror=e=>{console.log("连接失败",e)},window.onload=()=>{a.style.display="none",a.style.zIndex="0"},window.addEventListener(NOTIFACTION_RENDER,e=>{e.data.appli_id==this.appliId&&this.renderEle(t.ele)}),e&&e(i)},this.registerDropFn=e=>{e&&(this.dropFn=e)},this.registerLogoutFn=e=>{e&&(this.logoutFn=e)},this.RtAPI=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];a[t[0]]?a[t[0]](t[1],t[2]):n(t[0]).call(a,t[1],t[2])}}}window.CloudRender=CloudRender;export{CloudRender as default};
