!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self)["cloudRender-umd"]=t()}(this,function(){"use strict";const N="loading",A="fail",V="notifactionRender";var F,e="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function B(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}function U(r){var n,e=r.default;return"function"==typeof e?(n=function(){return e.apply(this,arguments)}).prototype=e.prototype:n={},Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(r).forEach(function(e){var t=Object.getOwnPropertyDescriptor(r,e);Object.defineProperty(n,e,t.get?t:{enumerable:!0,get:function(){return r[e]}})}),n}var z,t="1.0.34";if("object"==typeof globalThis)n=globalThis;else try{r||(r=1,z=function(){if("object"==typeof self&&self)return self;if("object"==typeof window&&window)return window;throw new Error("Unable to resolve global `this`")},F=function(){if(this)return this;if("object"==typeof globalThis&&globalThis)return globalThis;try{Object.defineProperty(Object.prototype,"__global__",{get:function(){return this},configurable:!0})}catch(e){return z()}try{return __global__?__global__:z()}finally{delete Object.prototype.__global__}}()),n=F}catch(e){}finally{if(!(n=n||"undefined"==typeof window?n:window))throw new Error("Could not determine global this")}var H=n.WebSocket||n.MozWebSocket,r=t;function G(e,t){t=t?new H(e,t):new H(e);return t}H&&["CONNECTING","OPEN","CLOSING","CLOSED"].forEach(function(e){Object.defineProperty(G,e,{get:function(){return H[e]}})});var $={w3cwebsocket:H?G:null,version:r};class J{constructor(e,t){this.global_callback=t&&"function"==typeof t?t:null,this.lockReconnect=!1,this.initWebSocket(e,t)}initWebSocket(e,t){this.websock=new $.w3cwebsocket(e),this.websock.onopen=()=>{t(JSON.stringify({msg:"连接成功"}))},this.websock.onerror=()=>{this.lockReconnect||(this.lockReconnect=!0,setTimeout(()=>{new J(e,t),this.lockReconnect=!1},2e3))},this.websock.onmessage=e=>{this.websocketOnMessage(e)},this.websock.onclose=()=>{this.websocketclose()}}sendSock(e,t){t&&("function"==typeof t?this.global_callback=t:(this.global_callback=e=>{},alert("sendSock，传参没有回调"))),this.websock.readyState===this.websock.OPEN?this.websock.send(e):setTimeout(()=>{this.sendSock(e)},1e3)}websocketclose(){this.websock.close(),this.global_callback=null}websocketOnMessage(e){try{this.global_callback(e.data)}catch(e){}}}var n=void 0!==W?W:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},W=void 0!==n?n:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{};function q(){throw new Error("setTimeout has not been defined")}function K(){throw new Error("clearTimeout has not been defined")}var Q=q,X=K;function Y(t){if(Q===setTimeout)return setTimeout(t,0);if((Q===q||!Q)&&setTimeout)return(Q=setTimeout)(t,0);try{return Q(t,0)}catch(e){try{return Q.call(null,t,0)}catch(e){return Q.call(this,t,0)}}}"function"==typeof W.setTimeout&&(Q=setTimeout),"function"==typeof W.clearTimeout&&(X=clearTimeout);var Z,ee=[],te=!1,re=-1;function ne(){te&&Z&&(te=!1,Z.length?ee=Z.concat(ee):re=-1,ee.length)&&ae()}function ae(){if(!te){for(var e=Y(ne),t=(te=!0,ee.length);t;){for(Z=ee,ee=[];++re<t;)Z&&Z[re].run();re=-1,t=ee.length}Z=null,te=!1,!function(t){if(X===clearTimeout)return clearTimeout(t);if((X===K||!X)&&clearTimeout)return(X=clearTimeout)(t);try{X(t)}catch(e){try{return X.call(null,t)}catch(e){return X.call(this,t)}}}(e)}}function ie(e,t){this.fun=e,this.array=t}ie.prototype.run=function(){this.fun.apply(null,this.array)};function se(){}var t=se,r=se,n=se,a=se,oe=se,i=se,ce=se;var de=W.performance||{},pe=de.now||de.mozNow||de.msNow||de.oNow||de.webkitNow||function(){return(new Date).getTime()};var le=new Date;var y={nextTick:function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];ee.push(new ie(e,t)),1!==ee.length||te||Y(ae)},title:"browser",browser:!0,env:{},argv:[],version:"",versions:{},on:t,addListener:r,once:n,off:a,removeListener:oe,removeAllListeners:i,emit:ce,binding:function(e){throw new Error("process.binding is not supported")},cwd:function(){return"/"},chdir:function(e){throw new Error("process.chdir is not supported")},umask:function(){return 0},hrtime:function(e){var t=.001*pe.call(de),r=Math.floor(t),t=Math.floor(t%1*1e9);return e&&(r-=e[0],(t-=e[1])<0)&&(r--,t+=1e9),[r,t]},platform:"browser",release:{},config:{},uptime:function(){return(new Date-le)/1e3}};function ue(e,t){const r=Object.create(null);var n=e.split(",");for(let e=0;e<n.length;e++)r[n[e]]=!0;return t?e=>!!r[e.toLowerCase()]:e=>!!r[e]}const he=ue("Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt");function me(t){if(R(t)){var r={};for(let e=0;e<t.length;e++){var n=t[e],a=(Oe(n)?function(e){const t={};return e.replace(_e,"").split(fe).forEach(e=>{e&&1<(e=e.split(ge)).length&&(t[e[0].trim()]=e[1].trim())}),t}:me)(n);if(a)for(const i in a)r[i]=a[i]}return r}return Oe(t)||Ie(t)?t:void 0}const fe=/;(?![^(]*\))/g,ge=/:([^]+)/,_e=/\/\*.*?\*\//gs;function ve(t){let r="";if(Oe(t))r=t;else if(R(t))for(let e=0;e<t.length;e++){var n=ve(t[e]);n&&(r+=n+" ")}else if(Ie(t))for(const e in t)t[e]&&(r+=e+" ");return r.trim()}ue("html,body,base,head,link,meta,style,title,address,article,aside,footer,header,h1,h2,h3,h4,h5,h6,nav,section,div,dd,dl,dt,figcaption,figure,picture,hr,img,li,main,ol,p,pre,ul,a,b,abbr,bdi,bdo,br,cite,code,data,dfn,em,i,kbd,mark,q,rp,rt,ruby,s,samp,small,span,strong,sub,sup,time,u,var,wbr,area,audio,map,track,video,embed,object,param,source,canvas,script,noscript,del,ins,caption,col,colgroup,table,thead,tbody,td,th,tr,button,datalist,fieldset,form,input,label,legend,meter,optgroup,option,output,progress,select,textarea,details,dialog,menu,summary,template,blockquote,iframe,tfoot"),ue("svg,animate,animateMotion,animateTransform,circle,clipPath,color-profile,defs,desc,discard,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistanceLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feImage,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,foreignObject,g,hatch,hatchpath,image,line,linearGradient,marker,mask,mesh,meshgradient,meshpatch,meshrow,metadata,mpath,path,pattern,polygon,polyline,radialGradient,rect,set,solidcolor,stop,switch,symbol,text,textPath,title,tspan,unknown,use,view"),ue("area,base,br,col,embed,hr,img,input,link,meta,param,source,track,wbr");t="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly";const ye=ue(t);function we(e){return!!e||""===e}ue(t+",async,autofocus,autoplay,controls,default,defer,disabled,hidden,loop,open,required,reversed,scoped,seamless,checked,muted,multiple,selected"),ue("accept,accept-charset,accesskey,action,align,allow,alt,async,autocapitalize,autocomplete,autofocus,autoplay,background,bgcolor,border,buffered,capture,challenge,charset,checked,cite,class,code,codebase,color,cols,colspan,content,contenteditable,contextmenu,controls,coords,crossorigin,csp,data,datetime,decoding,default,defer,dir,dirname,disabled,download,draggable,dropzone,enctype,enterkeyhint,for,form,formaction,formenctype,formmethod,formnovalidate,formtarget,headers,height,hidden,high,href,hreflang,http-equiv,icon,id,importance,integrity,ismap,itemprop,keytype,kind,label,lang,language,loading,list,loop,low,manifest,max,maxlength,minlength,media,min,multiple,muted,name,novalidate,open,optimum,pattern,ping,placeholder,poster,preload,radiogroup,readonly,referrerpolicy,rel,required,reversed,rows,rowspan,sandbox,scope,scoped,selected,shape,size,sizes,slot,span,spellcheck,src,srcdoc,srclang,srcset,start,step,style,summary,tabindex,target,title,translate,type,usemap,value,width,wrap"),ue("xmlns,accent-height,accumulate,additive,alignment-baseline,alphabetic,amplitude,arabic-form,ascent,attributeName,attributeType,azimuth,baseFrequency,baseline-shift,baseProfile,bbox,begin,bias,by,calcMode,cap-height,class,clip,clipPathUnits,clip-path,clip-rule,color,color-interpolation,color-interpolation-filters,color-profile,color-rendering,contentScriptType,contentStyleType,crossorigin,cursor,cx,cy,d,decelerate,descent,diffuseConstant,direction,display,divisor,dominant-baseline,dur,dx,dy,edgeMode,elevation,enable-background,end,exponent,fill,fill-opacity,fill-rule,filter,filterRes,filterUnits,flood-color,flood-opacity,font-family,font-size,font-size-adjust,font-stretch,font-style,font-variant,font-weight,format,from,fr,fx,fy,g1,g2,glyph-name,glyph-orientation-horizontal,glyph-orientation-vertical,glyphRef,gradientTransform,gradientUnits,hanging,height,href,hreflang,horiz-adv-x,horiz-origin-x,id,ideographic,image-rendering,in,in2,intercept,k,k1,k2,k3,k4,kernelMatrix,kernelUnitLength,kerning,keyPoints,keySplines,keyTimes,lang,lengthAdjust,letter-spacing,lighting-color,limitingConeAngle,local,marker-end,marker-mid,marker-start,markerHeight,markerUnits,markerWidth,mask,maskContentUnits,maskUnits,mathematical,max,media,method,min,mode,name,numOctaves,offset,opacity,operator,order,orient,orientation,origin,overflow,overline-position,overline-thickness,panose-1,paint-order,path,pathLength,patternContentUnits,patternTransform,patternUnits,ping,pointer-events,points,pointsAtX,pointsAtY,pointsAtZ,preserveAlpha,preserveAspectRatio,primitiveUnits,r,radius,referrerPolicy,refX,refY,rel,rendering-intent,repeatCount,repeatDur,requiredExtensions,requiredFeatures,restart,result,rotate,rx,ry,scale,seed,shape-rendering,slope,spacing,specularConstant,specularExponent,speed,spreadMethod,startOffset,stdDeviation,stemh,stemv,stitchTiles,stop-color,stop-opacity,strikethrough-position,strikethrough-thickness,string,stroke,stroke-dasharray,stroke-dashoffset,stroke-linecap,stroke-linejoin,stroke-miterlimit,stroke-opacity,stroke-width,style,surfaceScale,systemLanguage,tabindex,tableValues,target,targetX,targetY,text-anchor,text-decoration,text-rendering,textLength,to,transform,transform-origin,type,u1,u2,underline-position,underline-thickness,unicode,unicode-bidi,unicode-range,units-per-em,v-alphabetic,v-hanging,v-ideographic,v-mathematical,values,vector-effect,version,vert-adv-y,vert-origin-x,vert-origin-y,viewBox,viewTarget,visibility,width,widths,word-spacing,writing-mode,x,x-height,x1,x2,xChannelSelector,xlink:actuate,xlink:arcrole,xlink:href,xlink:role,xlink:show,xlink:title,xlink:type,xml:base,xml:lang,xml:space,y,y1,y2,yChannelSelector,z,zoomAndPan");const be="production"!==y.env.NODE_ENV?Object.freeze({}):{},Se=("production"!==y.env.NODE_ENV&&Object.freeze([]),()=>{}),Pe=/^on[^a-z]/,Re=e=>Pe.test(e),Ce=Object.assign,Te=(e,t)=>{t=e.indexOf(t);-1<t&&e.splice(t,1)},De=Object.prototype.hasOwnProperty,u=(e,t)=>De.call(e,t),R=Array.isArray,ke=e=>"[object Map]"===Ne(e),xe=e=>"[object Set]"===Ne(e),Ee=e=>"function"==typeof e,Oe=e=>"string"==typeof e,Me=e=>"symbol"==typeof e,Ie=e=>null!==e&&"object"==typeof e,Le=e=>Ie(e)&&Ee(e.then)&&Ee(e.catch),je=Object.prototype.toString,Ne=e=>je.call(e),Ae=e=>Ne(e).slice(8,-1),Ve=e=>"[object Object]"===Ne(e),Fe=e=>Oe(e)&&"NaN"!==e&&"-"!==e[0]&&""+parseInt(e,10)===e;ue(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ue("bind,cloak,else-if,else,for,html,if,model,on,once,pre,show,slot,text,memo");r=t=>{const r=Object.create(null);return e=>{return r[e]||(r[e]=t(e))}};const Be=/-(\w)/g,Ue=r(e=>e.replace(Be,(e,t)=>t?t.toUpperCase():"")),ze=/\B([A-Z])/g,He=r(e=>e.replace(ze,"-$1").toLowerCase()),Ge=r(e=>e.charAt(0).toUpperCase()+e.slice(1)),$e=r(e=>e?"on"+Ge(e):""),Je=(e,t)=>!Object.is(e,t),We=(e,t,r)=>{Object.defineProperty(e,t,{configurable:!0,enumerable:!1,value:r})},qe=e=>{var t=parseFloat(e);return isNaN(t)?e:t};let Ke;function Qe(e,...t){console.warn("[Vue warn] "+e,...t)}let Xe;class Ye{constructor(e=!1){this.detached=e,this.active=!0,this.effects=[],this.cleanups=[],this.parent=Xe,!e&&Xe&&(this.index=(Xe.scopes||(Xe.scopes=[])).push(this)-1)}run(e){if(this.active){var t=Xe;try{return Xe=this,e()}finally{Xe=t}}else"production"!==y.env.NODE_ENV&&Qe("cannot run an inactive effect scope.")}on(){Xe=this}off(){Xe=this.parent}stop(r){if(this.active){let e,t;for(e=0,t=this.effects.length;e<t;e++)this.effects[e].stop();for(e=0,t=this.cleanups.length;e<t;e++)this.cleanups[e]();if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].stop(!0);this.detached||!this.parent||r||(r=this.parent.scopes.pop())&&r!==this&&((this.parent.scopes[this.index]=r).index=this.index),this.parent=void 0,this.active=!1}}}const Ze=e=>{e=new Set(e);return e.w=0,e.n=0,e},et=e=>0<(e.w&at),tt=e=>0<(e.n&at),rt=new WeakMap;let nt=0,at=1;const it=30;let st;const ot=Symbol("production"!==y.env.NODE_ENV?"iterate":""),ct=Symbol("production"!==y.env.NODE_ENV?"Map key iterate":"");class dt{constructor(e,t=null,r){this.fn=e,this.scheduler=t,this.active=!0,this.deps=[],this.parent=void 0,[e,t=Xe]=[this,r],t&&t.active&&t.effects.push(e)}run(){if(!this.active)return this.fn();let e=st;for(var t=lt;e;){if(e===this)return;e=e.parent}try{if(this.parent=st,st=this,lt=!0,at=1<<++nt,nt<=it){var r=[this["deps"]][0];if(r.length)for(let e=0;e<r.length;e++)r[e].w|=at}else pt(this);return this.fn()}finally{if(nt<=it){var n=this,a=n["deps"];if(a.length){let t=0;for(let e=0;e<a.length;e++){var i=a[e];et(i)&&!tt(i)?i.delete(n):a[t++]=i,i.w&=~at,i.n&=~at}a.length=t}}at=1<<--nt,st=this.parent,lt=t,this.parent=void 0,this.deferStop&&this.stop()}}stop(){st===this?this.deferStop=!0:this.active&&(pt(this),this.onStop&&this.onStop(),this.active=!1)}}function pt(t){var r=t["deps"];if(r.length){for(let e=0;e<r.length;e++)r[e].delete(t);r.length=0}}let lt=!0;const ut=[];function ht(){ut.push(lt),lt=!1}function mt(){var e=ut.pop();lt=void 0===e||e}function ft(r,n,a){if(lt&&st){let e=rt.get(r),t=(e||rt.set(r,e=new Map),e.get(a));t||e.set(a,t=Ze());r="production"!==y.env.NODE_ENV?{effect:st,target:r,type:n,key:a}:void 0;gt(t,r)}}function gt(e,t){let r=!1;nt<=it?tt(e)||(e.n|=at,r=!et(e)):r=!e.has(st),r&&(e.add(st),st.deps.push(e),"production"!==y.env.NODE_ENV)&&st.onTrack&&st.onTrack(Object.assign({effect:st},t))}function _t(e,t,n,a,i,s){var o=rt.get(e);if(o){let r=[];if("clear"===t)r=[...o.values()];else if("length"===n&&R(e)){const d=qe(a);o.forEach((e,t)=>{("length"===t||t>=d)&&r.push(e)})}else switch(void 0!==n&&r.push(o.get(n)),t){case"add":R(e)?Fe(n)&&r.push(o.get("length")):(r.push(o.get(ot)),ke(e)&&r.push(o.get(ct)));break;case"delete":R(e)||(r.push(o.get(ot)),ke(e)&&r.push(o.get(ct)));break;case"set":ke(e)&&r.push(o.get(ot))}t="production"!==y.env.NODE_ENV?{target:e,type:t,key:n,newValue:a,oldValue:i,oldTarget:s}:void 0;if(1===r.length)r[0]&&("production"!==y.env.NODE_ENV?vt(r[0],t):vt(r[0]));else{var c=[];for(const p of r)p&&c.push(...p);"production"!==y.env.NODE_ENV?vt(Ze(c),t):vt(Ze(c))}}}function vt(e,t){e=R(e)?e:[...e];for(const r of e)r.computed&&yt(r,t);for(const n of e)n.computed||yt(n,t)}function yt(e,t){e===st&&!e.allowRecurse||("production"!==y.env.NODE_ENV&&e.onTrigger&&e.onTrigger(Ce({effect:e},t)),e.scheduler?e.scheduler():e.run())}const wt=ue("__proto__,__v_isRef,__isVue"),bt=new Set(Object.getOwnPropertyNames(Symbol).filter(e=>"arguments"!==e&&"caller"!==e).map(e=>Symbol[e]).filter(Me));n=Pt(),a=Pt(!1,!0),oe=Pt(!0),i=Pt(!0,!0);const St=function(){const e={};return["includes","indexOf","lastIndexOf"].forEach(n=>{e[n]=function(...e){var r=h(this);for(let e=0,t=this.length;e<t;e++)ft(r,"get",e+"");var t=r[n](...e);return-1===t||!1===t?r[n](...e.map(h)):t}}),["push","pop","shift","unshift","splice"].forEach(t=>{e[t]=function(...e){ht();e=h(this)[t].apply(this,e);return mt(),e}}),e}();function Pt(a=!1,i=!1){return function(e,t,r){var n;return"__v_isReactive"===t?!a:"__v_isReadonly"===t?a:"__v_isShallow"===t?i:"__v_raw"===t&&r===(a?i?Zt:Yt:i?Xt:Qt).get(e)?e:(n=R(e),!a&&n&&u(St,t)?Reflect.get(St,t,r):(r=Reflect.get(e,t,r),(Me(t)?bt.has(t):wt(t))||(a||ft(e,"get",t),i)?r:pr(r)?n&&Fe(t)?r:r.value:Ie(r)?(a?tr:er)(r):r))}}var Rt,ce=Ct(),t=Ct(!0);function Ct(o=!1){return function(e,t,r,n){let a=e[t];var i,s;return!(ir(a)&&pr(a)&&!pr(r))&&(o||(sr(r)||ir(r)||(a=h(a),r=h(r)),R(e))||!pr(a)||pr(r)?(i=R(e)&&Fe(t)?Number(t)<e.length:u(e,t),s=Reflect.set(e,t,r,n),e===h(n)&&(i?Je(r,a)&&_t(e,"set",t,r,a):_t(e,"add",t,r)),s):(a.value=r,!0))}}const Tt={get:n,set:ce,deleteProperty:function(e,t){var r=u(e,t),n=e[t],a=Reflect.deleteProperty(e,t);return a&&r&&_t(e,"delete",t,void 0,n),a},has:function(e,t){var r=Reflect.has(e,t);return Me(t)&&bt.has(t)||ft(e,"has",t),r},ownKeys:function(e){return ft(e,"iterate",R(e)?"length":ot),Reflect.ownKeys(e)}},Dt={get:oe,set(e,t){return"production"!==y.env.NODE_ENV&&Qe(`Set operation on key "${String(t)}" failed: target is readonly.`,e),!0},deleteProperty(e,t){return"production"!==y.env.NODE_ENV&&Qe(`Delete operation on key "${String(t)}" failed: target is readonly.`,e),!0}},kt=(Ce({},Tt,{get:a,set:t}),Ce({},Dt,{get:i})),xt=e=>e,Et=e=>Reflect.getPrototypeOf(e);function Ot(e,t,r=!1,n=!1){var a=h(e=e.__v_raw),i=h(t),s=(r||(t!==i&&ft(a,"get",t),ft(a,"get",i)),Et(a))["has"],n=n?xt:r?dr:cr;return s.call(a,t)?n(e.get(t)):s.call(a,i)?n(e.get(i)):void(e!==a&&e.get(t))}function Mt(e,t=!1){var r=this.__v_raw,n=h(r),a=h(e);return t||(e!==a&&ft(n,"has",e),ft(n,"has",a)),e===a?r.has(e):r.has(e)||r.has(a)}function It(e,t=!1){return e=e.__v_raw,t||ft(h(e),"iterate",ot),Reflect.get(e,"size",e)}function Lt(e){e=h(e);var t=h(this);return Et(t).has.call(t,e)||(t.add(e),_t(t,"add",e,e)),this}function jt(e,t){t=h(t);var r=h(this),{has:n,get:a}=Et(r);let i=n.call(r,e);i?"production"!==y.env.NODE_ENV&&Kt(r,n,e):(e=h(e),i=n.call(r,e));n=a.call(r,e);return r.set(e,t),i?Je(t,n)&&_t(r,"set",e,t,n):_t(r,"add",e,t),this}function Nt(e){var t=h(this),{has:r,get:n}=Et(t);let a=r.call(t,e);a?"production"!==y.env.NODE_ENV&&Kt(t,r,e):(e=h(e),a=r.call(t,e));r=n?n.call(t,e):void 0,n=t.delete(e);return a&&_t(t,"delete",e,void 0,r),n}function At(){var e=h(this),t=0!==e.size,r="production"!==y.env.NODE_ENV?new(ke(e)?Map:Set)(e):void 0,n=e.clear();return t&&_t(e,"clear",void 0,void 0,r),n}function Vt(s,o){return function(r,n){const a=this;var e=a.__v_raw,t=h(e);const i=o?xt:s?dr:cr;return s||ft(t,"iterate",ot),e.forEach((e,t)=>r.call(n,i(e),i(t),a))}}function Ft(o,c,d){return function(...e){var t=this.__v_raw,r=h(t),n=ke(r);const a="entries"===o||o===Symbol.iterator&&n;n="keys"===o&&n;const i=t[o](...e),s=d?xt:c?dr:cr;return c||ft(r,"iterate",n?ct:ot),{next(){var{value:e,done:t}=i.next();return t?{value:e,done:t}:{value:a?[s(e[0]),s(e[1])]:s(e),done:t}},[Symbol.iterator](){return this}}}}function Bt(t){return function(...e){return"production"!==y.env.NODE_ENV&&(e=e[0]?`on key "${e[0]}" `:"",console.warn(Ge(t)+` operation ${e}failed: target is readonly.`,h(this))),"delete"!==t&&this}}const[Ut,zt,Ht,Gt]=function(){const t={get(e){return Ot(this,e)},get size(){return It(this)},has:Mt,add:Lt,set:jt,delete:Nt,clear:At,forEach:Vt(!1,!1)},r={get(e){return Ot(this,e,!1,!0)},get size(){return It(this)},has:Mt,add:Lt,set:jt,delete:Nt,clear:At,forEach:Vt(!1,!0)},n={get(e){return Ot(this,e,!0)},get size(){return It(this,!0)},has(e){return Mt.call(this,e,!0)},add:Bt("add"),set:Bt("set"),delete:Bt("delete"),clear:Bt("clear"),forEach:Vt(!0,!1)},a={get(e){return Ot(this,e,!0,!0)},get size(){return It(this,!0)},has(e){return Mt.call(this,e,!0)},add:Bt("add"),set:Bt("set"),delete:Bt("delete"),clear:Bt("clear"),forEach:Vt(!0,!0)};return["keys","values","entries",Symbol.iterator].forEach(e=>{t[e]=Ft(e,!1,!1),n[e]=Ft(e,!0,!1),r[e]=Ft(e,!1,!0),a[e]=Ft(e,!0,!0)}),[t,n,r,a]}();function $t(n,e){const a=e?n?Gt:Ht:n?zt:Ut;return(e,t,r)=>"__v_isReactive"===t?!n:"__v_isReadonly"===t?n:"__v_raw"===t?e:Reflect.get(u(a,t)&&t in e?a:e,t,r)}const Jt={get:$t(!1,!1)},Wt={get:$t(!0,!1)},qt={get:$t(!0,!0)};function Kt(e,t,r){var n=h(r);n!==r&&t.call(e,n)&&(r=Ae(e),console.warn(`Reactive ${r} contains both the raw and reactive `+`versions of the same object${"Map"===r?" as keys":""}, `+"which can lead to inconsistencies. Avoid differentiating between the raw and reactive versions of an object and only use the reactive version if possible."))}const Qt=new WeakMap,Xt=new WeakMap,Yt=new WeakMap,Zt=new WeakMap;function er(e){return ir(e)?e:nr(e,!1,Tt,Jt,Qt)}function tr(e){return nr(e,!0,Dt,Wt,Yt)}function rr(e){return nr(e,!0,kt,qt,Zt)}function nr(e,t,r,n,a){return Ie(e)?!e.__v_raw||t&&e.__v_isReactive?a.get(e)||(0===(t=function(e){if(e.__v_skip||!Object.isExtensible(e))return 0;switch(Ae(e)){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}(e))?e:(t=new Proxy(e,2===t?n:r),a.set(e,t),t)):e:("production"!==y.env.NODE_ENV&&console.warn("value cannot be made reactive: "+String(e)),e)}function ar(e){return ir(e)?ar(e.__v_raw):!(!e||!e.__v_isReactive)}function ir(e){return!(!e||!e.__v_isReadonly)}function sr(e){return!(!e||!e.__v_isShallow)}function or(e){return ar(e)||ir(e)}function h(e){var t=e&&e.__v_raw;return t?h(t):e}const cr=e=>Ie(e)?er(e):e,dr=e=>Ie(e)?tr(e):e;function pr(e){return e&&!0===e.__v_isRef}const lr={get:(e,t,r)=>{return pr(e=Reflect.get(e,t,r))?e.value:e},set:(e,t,r,n)=>{var a=e[t];return pr(a)&&!pr(r)?(a.value=r,!0):Reflect.set(e,t,r,n)}};class ur{constructor(e,t,r,n){this._setter=t,this.dep=void 0,this.__v_isRef=!0,this[Rt]=!1,this._dirty=!0,this.effect=new dt(e,()=>{var e,t;this._dirty||(this._dirty=!0,(e=h(e=this)).dep&&("production"!==y.env.NODE_ENV?vt(e.dep,{target:e,type:"set",key:"value",newValue:t}):vt(e.dep)))}),(this.effect.computed=this).effect.active=this._cacheable=!n,this.__v_isReadonly=r}get value(){var e,t=h(this);return e=t,lt&&st&&(e=h(e),"production"!==y.env.NODE_ENV?gt(e.dep||(e.dep=Ze()),{target:e,type:"get",key:"value"}):gt(e.dep||(e.dep=Ze()))),!t._dirty&&t._cacheable||(t._dirty=!1,t._value=t.effect.run()),t._value}set value(e){this._setter(e)}}Rt="__v_isReadonly",Promise.resolve();const hr=[];function w(e,...t){if("production"!==y.env.NODE_ENV){ht();const a=hr.length?hr[hr.length-1].component:null;var r=a&&a.appContext.config.warnHandler,n=function(){let e=hr[hr.length-1];if(!e)return[];var t=[];for(;e;){var r=t[0],r=(r&&r.vnode===e?r.recurseCount++:t.push({vnode:e,recurseCount:0}),e.component&&e.component.parent);e=r&&r.vnode}return t}();r?fr(r,a,11,[e+t.join(""),a&&a.proxy,n.map(({vnode:e})=>`at <${Bn(a,e.type)}>`).join("\n"),n]):(r=["[Vue warn]: "+e,...t],n.length&&r.push(`
`,...function(e){const n=[];return e.forEach((e,t)=>{var r;n.push(...0===t?[]:[`
`],...({vnode:t,recurseCount:e}=[e][0],e=0<e?`... (${e} recursive calls)`:"",r=!!t.component&&null==t.component.parent,r=" at <"+Bn(t.component,t.type,r),e=">"+e,t.props?[r,...function(t){const r=[],e=Object.keys(t);e.slice(0,3).forEach(e=>{r.push(...function e(t,r,n){return Oe(r)?(r=JSON.stringify(r),n?r:[t+"="+r]):"number"==typeof r||"boolean"==typeof r||null==r?n?r:[t+"="+r]:pr(r)?(r=e(t,h(r.value),!0),n?r:[t+"=Ref<",r,">"]):Ee(r)?[t+"=fn"+(r.name?`<${r.name}>`:"")]:(r=h(r),n?r:[t+"=",r])}(e,t[e]))}),3<e.length&&r.push(" ...");return r}(t.props),e]:[r+e]))}),n}(n)),console.warn(...r)),mt()}}const mr={sp:"serverPrefetch hook",bc:"beforeCreate hook",c:"created hook",bm:"beforeMount hook",m:"mounted hook",bu:"beforeUpdate hook",u:"updated",bum:"beforeUnmount hook",um:"unmounted hook",a:"activated hook",da:"deactivated hook",ec:"errorCaptured hook",rtc:"renderTracked hook",rtg:"renderTriggered hook",[0]:"setup function",1:"render function",2:"watcher getter",3:"watcher callback",4:"watcher cleanup function",5:"native event handler",6:"component event handler",7:"vnode hook",8:"directive hook",9:"transition hook",10:"app errorHandler",11:"app warnHandler",12:"ref function",13:"async component loader",14:"scheduler flush. This is likely a Vue internals bug. Please open an issue at https://new-issue.vuejs.org/?repo=vuejs/core"};function fr(e,t,r,n){let a;try{a=n?e(...n):e()}catch(e){_r(e,t,r)}return a}function gr(t,r,n,a){var e;if(Ee(t))return(e=fr(t,r,n,a))&&Le(e)&&e.catch(e=>{_r(e,r,n)}),e;var i=[];for(let e=0;e<t.length;e++)i.push(gr(t[e],r,n,a));return i}function _r(t,r,n,e=!0){var a=r?r.vnode:null;if(r){let e=r.parent;for(var i=r.proxy,s="production"!==y.env.NODE_ENV?mr[n]:n;e;){var o=e.ec;if(o)for(let e=0;e<o.length;e++)if(!1===o[e](t,i,s))return;e=e.parent}r=r.appContext.config.errorHandler;if(r)return void fr(r,null,10,[t,i,s])}var[r,n,a,e=!0]=[t,n,a,e];if("production"!==y.env.NODE_ENV){n=mr[n];if(a&&!function(e){hr.push(e)}(a),w("Unhandled error"+(n?" during execution of "+n:"")),a&&hr.pop(),e)throw r}console.error(r)}let vr=!1,yr=!1;const wr=[];let br=0;const Sr=[];let Pr=null,Rr=0;const Cr=Promise.resolve();let Tr=null;const Dr=100;function kr(e){wr.length&&wr.includes(e,vr&&e.allowRecurse?br+1:br)||(null==e.id?wr.push(e):wr.splice(function(e){let t=br+1,r=wr.length;for(;t<r;){var n=t+r>>>1;Or(wr[n])<e?t=1+n:r=n}return t}(e.id),0,e),xr())}function xr(){vr||yr||(yr=!0,Tr=Cr.then(Ir))}function Er(e){R(e)?Sr.push(...e):Pr&&Pr.includes(e,e.allowRecurse?Rr+1:Rr)||Sr.push(e),xr()}const Or=e=>null==e.id?1/0:e.id,Mr=(e,t)=>{var r=Or(e)-Or(t);if(0==r){if(e.pre&&!t.pre)return-1;if(t.pre&&!e.pre)return 1}return r};function Ir(t){yr=!1,vr=!0,"production"!==y.env.NODE_ENV&&(t=t||new Map),wr.sort(Mr);var e="production"!==y.env.NODE_ENV?e=>Lr(t,e):Se;try{for(br=0;br<wr.length;br++){var r=wr[br];!r||!1===r.active||"production"!==y.env.NODE_ENV&&e(r)||fr(r,null,14)}}finally{br=0,wr.length=0;var n=t;if(Sr.length){var a=[...new Set(Sr)];if(Sr.length=0,Pr)Pr.push(...a);else{for(Pr=a,"production"!==y.env.NODE_ENV&&(n=n||new Map),Pr.sort((e,t)=>Or(e)-Or(t)),Rr=0;Rr<Pr.length;Rr++)"production"!==y.env.NODE_ENV&&Lr(n,Pr[Rr])||Pr[Rr]();Pr=null,Rr=0}}vr=!1,Tr=null,(wr.length||Sr.length)&&Ir(t)}}function Lr(e,t){if(e.has(t)){var r,n=e.get(t);if(n>Dr)return w(`Maximum recursive updates exceeded${(r=(r=t.ownerInstance)&&Fn(r.type))?` in component <${r}>`:""}. `+"This means you have a reactive effect that is mutating its own dependencies and thus recursively triggering itself. Possible sources include component template, render function, updated hook or watcher source function."),!0;e.set(t,n+1)}else e.set(t,1)}const jr=new Set,Nr=("production"!==y.env.NODE_ENV&&((Ke=Ke||("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==W?W:{})).__VUE_HMR_RUNTIME__={createRecord:Fr(function(e,t){if(Nr.has(e))return!1;return Nr.set(e,{initialDef:Ar(t),instances:new Set}),!0}),rerender:Fr(function(e,t){e=Nr.get(e);e&&(e.initialDef.render=t,[...e.instances].forEach(e=>{t&&(e.render=t,Ar(e.type).render=t),e.renderCache=[],e.update()}))}),reload:Fr(function(e,t){var r=Nr.get(e);if(r){t=Ar(t),Vr(r.initialDef,t);const a=[...r.instances];for(const i of a){var n=Ar(i.type);jr.has(n)||(n!==r.initialDef&&Vr(n,t),jr.add(n)),i.appContext.optionsCache.delete(i.type),i.ceReload?(jr.add(n),i.ceReload(t.styles),jr.delete(n)):i.parent?kr(i.parent.update):i.appContext.reload?i.appContext.reload():"undefined"!=typeof window?window.location.reload():console.warn("[HMR] Root or manually mounted instance modified. Full reload required.")}Er(()=>{for(const e of a)jr.delete(Ar(e.type))})}})}),new Map);function Ar(e){return Un(e)?e.__vccOpts:e}function Vr(e,t){Ce(e,t);for(const r in e)"__file"===r||r in t||delete e[r]}function Fr(r){return(e,t)=>{try{return r(e,t)}catch(e){console.error(e),console.warn("[HMR] Something went wrong during Vue component hot-reload. Full reload required.")}}}let Br=null,Ur=null;const zr=e=>e.__isSuspense;const Hr={};function Gr(e,t,r){return"production"===y.env.NODE_ENV||Ee(t)||w("`watch(fn, options?)` signature has been moved to a separate API. Use `watchEffect(fn, options?)` instead. `watch` now only supports `watch(source, cb, options?) signature."),$r(e,t,r)}function $r(e,t,{immediate:r,deep:n,flush:a,onTrack:i,onTrigger:s}=be){"production"===y.env.NODE_ENV||t||(void 0!==r&&w('watch() "immediate" option is only respected when using the watch(source, callback, options?) signature.'),void 0!==n&&w('watch() "deep" option is only respected when using the watch(source, callback, options?) signature.'));const o=e=>{w("Invalid watch source: ",e,"A watch source can only be a getter/effect function, a ref, a reactive object, or an array of these types.")},c=In;let d,p=!1,l=!1;if(pr(e)?(d=()=>e.value,p=sr(e)):ar(e)?(d=()=>e,n=!0):R(e)?(l=!0,p=e.some(e=>ar(e)||sr(e)),d=()=>e.map(e=>pr(e)?e.value:ar(e)?Wr(e):Ee(e)?fr(e,c,2):void("production"!==y.env.NODE_ENV&&o(e)))):Ee(e)?d=t?()=>fr(e,c,2):()=>{if(!c||!c.isUnmounted)return u&&u(),gr(e,c,3,[h])}:(d=Se,"production"!==y.env.NODE_ENV&&o(e)),t&&n){const v=d;d=()=>Wr(v())}let u,h=e=>{u=_.onStop=()=>{fr(e,c,4)}},m=l?new Array(e.length).fill(Hr):Hr;const f=()=>{var e;_.active&&(t?(e=_.run(),(n||p||(l?e.some((e,t)=>Je(e,m[t])):Je(e,m)))&&(u&&u(),gr(t,c,3,[e,m===Hr?void 0:l&&m[0]===Hr?[]:m,h]),m=e)):_.run())};f.allowRecurse=!!t;let g;g="sync"===a?f:"post"===a?()=>_n(f,c&&c.suspense):(f.pre=!0,c&&(f.id=c.uid),()=>kr(f));const _=new dt(d,g);"production"!==y.env.NODE_ENV&&(_.onTrack=i,_.onTrigger=s),t?r?f():m=_.run():"post"===a?_n(_.run.bind(_),c&&c.suspense):_.run();return()=>{_.stop(),c&&c.scope&&Te(c.scope.effects,_)}}function Jr(e,t,r){const n=this.proxy;var a=Oe(e)?e.includes(".")?function(e,t){const r=t.split(".");return()=>{let t=e;for(let e=0;e<r.length&&t;e++)t=t[r[e]];return t}}(n,e):()=>n[e]:e.bind(n,n);let i;Ee(t)?i=t:(i=t.handler,r=t);t=In,jn(this),a=$r(a,i.bind(n),r);return t?jn(t):Nn(),a}function Wr(t,r){if(Ie(t)&&!t.__v_skip&&!(r=r||new Set).has(t))if(r.add(t),pr(t))Wr(t.value,r);else if(R(t))for(let e=0;e<t.length;e++)Wr(t[e],r);else if(xe(t)||ke(t))t.forEach(e=>{Wr(e,r)});else if(Ve(t))for(const e in t)Wr(t[e],r);return t}function qr(){const e={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return rn(()=>{e.isMounted=!0}),nn(()=>{e.isUnmounting=!0}),e}r=[Function,Array],n={name:"BaseTransition",props:{mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:r,onEnter:r,onAfterEnter:r,onEnterCancelled:r,onBeforeLeave:r,onLeave:r,onAfterLeave:r,onLeaveCancelled:r,onBeforeAppear:r,onAppear:r,onAfterAppear:r,onAppearCancelled:r},setup(d,{slots:e}){const p=Ln(),l=qr();let u;return()=>{var r=e.default&&en(e.default(),!0);if(r&&r.length){let t=r[0];if(1<r.length){let e=!1;for(const c of r)if(c.type!==bn){if("production"!==y.env.NODE_ENV&&e){w("<transition> can only be used on a single element or component. Use <transition-group> for lists.");break}if(t=c,e=!0,"production"===y.env.NODE_ENV)break}}var r=h(d),n=r["mode"];if("production"!==y.env.NODE_ENV&&n&&"in-out"!==n&&"out-in"!==n&&"default"!==n&&w("invalid <transition> mode: "+n),l.isLeaving)return Xr(t);var a=Yr(t);if(!a)return Xr(t);const s=Qr(a,r,l,p);Zr(a,s);var i=p.subTree;const o=i&&Yr(i);let e=!1;var i=a.type["getTransitionKey"];if(i&&(i=i(),void 0===u?u=i:i!==u&&(u=i,e=!0)),o&&o.type!==bn&&(!Pn(a,o)||e)){i=Qr(o,r,l,p);if(Zr(o,i),"out-in"===n)return l.isLeaving=!0,i.afterLeave=()=>{(l.isLeaving=!1)!==p.update.active&&p.update()},Xr(t);"in-out"===n&&a.type!==bn&&(i.delayLeave=(e,t,r)=>{Kr(l,o)[String(o.key)]=o,e._leaveCb=()=>{t(),e._leaveCb=void 0,delete s.delayedLeave},s.delayedLeave=r})}return t}}}};function Kr(e,t){e=e.leavingVNodes;let r=e.get(t.type);return r||(r=Object.create(null),e.set(t.type,r)),r}function Qr(i,t,s,r){const{appear:o,mode:e,persisted:n=!1,onBeforeEnter:a,onEnter:c,onAfterEnter:d,onEnterCancelled:p,onBeforeLeave:l,onLeave:u,onAfterLeave:h,onLeaveCancelled:m,onBeforeAppear:f,onAppear:g,onAfterAppear:_,onAppearCancelled:v}=t,y=String(i.key),w=Kr(s,i),b=(e,t)=>{e&&gr(e,r,9,t)},S=(e,t)=>{var r=t[1];b(e,t),R(e)?e.every(e=>e.length<=1)&&r():e.length<=1&&r()},P={mode:e,persisted:n,beforeEnter(e){let t=a;if(!s.isMounted){if(!o)return;t=f||a}e._leaveCb&&e._leaveCb(!0);var r=w[y];r&&Pn(i,r)&&r.el._leaveCb&&r.el._leaveCb(),b(t,[e])},enter(t){let e=c,r=d,n=p;if(!s.isMounted){if(!o)return;e=g||c,r=_||d,n=v||p}let a=!1;var i=t._enterCb=e=>{a||(a=!0,e?b(n,[t]):b(r,[t]),P.delayedLeave&&P.delayedLeave(),t._enterCb=void 0)};e?S(e,[t,i]):i()},leave(t,r){const n=String(i.key);if(t._enterCb&&t._enterCb(!0),s.isUnmounting)return r();b(l,[t]);let a=!1;var e=t._leaveCb=e=>{a||(a=!0,r(),e?b(m,[t]):b(h,[t]),t._leaveCb=void 0,w[n]===i&&delete w[n])};w[n]=i,u?S(u,[t,e]):e()},clone(e){return Qr(e,t,s,r)}};return P}function Xr(e){if(tn(e))return(e=En(e)).children=null,e}function Yr(e){return tn(e)?e.children?e.children[0]:void 0:e}function Zr(e,t){6&e.shapeFlag&&e.component?Zr(e.component.subTree,t):128&e.shapeFlag?(e.ssContent.transition=t.clone(e.ssContent),e.ssFallback.transition=t.clone(e.ssFallback)):e.transition=t}function en(t,r=!1,n){let a=[],i=0;for(let e=0;e<t.length;e++){var s=t[e],o=null==n?s.key:String(n)+String(null!=s.key?s.key:e);s.type===yn?(128&s.patchFlag&&i++,a=a.concat(en(s.children,r,o))):!r&&s.type===bn||a.push(null!=o?En(s,{key:o}):s)}if(1<i)for(let e=0;e<a.length;e++)a[e].patchFlag=-2;return a}const tn=e=>e.type.__isKeepAlive;ce=o=>(t,e=In)=>{var r,n,[a,i,s=In,e=!1]=[o,(...e)=>t(...e),e];if(s)return r=s[a]||(s[a]=[]),n=i.__weh||(i.__weh=(...e)=>{if(!s.isUnmounted)return ht(),jn(s),e=gr(i,s,a,e),Nn(),mt(),e}),e?r.unshift(n):r.push(n),n;"production"!==y.env.NODE_ENV&&w($e(mr[a].replace(/ hook$/,""))+" is called when there is no active component instance to be associated with. Lifecycle injection APIs can only be used during execution of setup(). If you are using async setup(), make sure to register lifecycle hooks before the first await statement.")};const rn=ce("m"),nn=(ce("u"),ce("bum")),an=Symbol(),sn=e=>e?4&e.vnode.shapeFlag?function(r){if(r.exposed)return r.exposeProxy||(r.exposeProxy=new Proxy(function(e){return ar(e)?e:new Proxy(e,lr)}(function(e){return We(e,"__v_skip",!0),e}(r.exposed)),{get(e,t){return t in e?e[t]:t in on?on[t](r):void 0},has(e,t){return t in e||t in on}}))}(e)||e.proxy:sn(e.parent):null,on=Ce(Object.create(null),{$:e=>e,$el:e=>e.vnode.el,$data:e=>e.data,$props:e=>"production"!==y.env.NODE_ENV?rr(e.props):e.props,$attrs:e=>"production"!==y.env.NODE_ENV?rr(e.attrs):e.attrs,$slots:e=>"production"!==y.env.NODE_ENV?rr(e.slots):e.slots,$refs:e=>"production"!==y.env.NODE_ENV?rr(e.refs):e.refs,$parent:e=>sn(e.parent),$root:e=>sn(e.root),$emit:e=>e.emit,$options:e=>{if(__VUE_OPTIONS_API__){var r=e;const n=r.type,{mixins:a,extends:i}=n,{mixins:s,optionsCache:o,config:{optionMergeStrategies:c}}=r.appContext,d=o.get(n);let t;return d?t=d:s.length||a||i?(t={},s.length&&s.forEach(e=>ln(t,e,c,!0)),ln(t,n,c)):t=n,Ie(n)&&o.set(n,t),t}return e.type},$forceUpdate:e=>e.f||(e.f=()=>kr(e.update)),$nextTick:e=>e.n||(e.n=function(e){var t=Tr||Cr;return e?t.then(this?e.bind(this):e):t}.bind(e.proxy)),$watch:e=>__VUE_OPTIONS_API__?Jr.bind(e):Se}),cn=(e,t)=>e!==be&&!e.__isScriptSetup&&u(e,t),dn={get({_:e},t){var{ctx:r,setupState:n,data:a,props:i,accessCache:s,type:o,appContext:c}=e;if("production"!==y.env.NODE_ENV&&"__isVue"===t)return!0;if("$"!==t[0]){var d=s[t];if(void 0!==d)switch(d){case 1:return n[t];case 2:return a[t];case 4:return r[t];case 3:return i[t]}else{if(cn(n,t))return s[t]=1,n[t];if(a!==be&&u(a,t))return s[t]=2,a[t];if((d=e.propsOptions[0])&&u(d,t))return s[t]=3,i[t];if(r!==be&&u(r,t))return s[t]=4,r[t];__VUE_OPTIONS_API__&&!pn||(s[t]=0)}}var d=on[t];let p,l;return d?("$attrs"===t&&(ft(e,"get",t),y.env.NODE_ENV),d(e)):(p=(p=o.__cssModules)&&p[t])||(r!==be&&u(r,t)?(s[t]=4,r[t]):(l=c.config.globalProperties,u(l,t)?l[t]:void("production"===y.env.NODE_ENV||!Br||Oe(t)&&0===t.indexOf("__v")||(a===be||"_"!==(d=t[0])&&"$"!==d||!u(a,t)?e===Br&&w(`Property ${JSON.stringify(t)} was accessed during render `+"but is not defined on instance."):w(`Property ${JSON.stringify(t)} must be accessed via $data because it starts with a reserved `+'character ("$" or "_") and is not proxied on the render context.')))))},set({_:e},t,r){var{data:n,setupState:a,ctx:i}=e;if(cn(a,t))a[t]=r;else{if("production"!==y.env.NODE_ENV&&a.__isScriptSetup&&u(a,t))return w(`Cannot mutate <script setup> binding "${t}" from Options API.`),!1;if(n!==be&&u(n,t))n[t]=r;else{if(u(e.props,t))return"production"!==y.env.NODE_ENV&&w(`Attempting to mutate prop "${t}". Props are readonly.`),!1;if("$"===t[0]&&t.slice(1)in e)return"production"!==y.env.NODE_ENV&&w(`Attempting to mutate public property "${t}". `+"Properties starting with $ are reserved and readonly."),!1;"production"!==y.env.NODE_ENV&&t in e.appContext.config.globalProperties?Object.defineProperty(i,t,{enumerable:!0,configurable:!0,value:r}):i[t]=r}}return!0},has({_:{data:e,setupState:t,accessCache:r,ctx:n,appContext:a,propsOptions:i}},s){return!!r[s]||e!==be&&u(e,s)||cn(t,s)||(r=i[0])&&u(r,s)||u(n,s)||u(on,s)||u(a.config.globalProperties,s)},defineProperty(e,t,r){return null!=r.get?e._.accessCache[t]=0:u(r,"value")&&this.set(e,t,r.value,null),Reflect.defineProperty(e,t,r)}};"production"!==y.env.NODE_ENV&&(dn.ownKeys=e=>(w("Avoid app logic that relies on enumerating keys on a component instance. The keys will be empty in production mode to avoid performance overhead."),Reflect.ownKeys(e))),Ce({},dn,{get(e,t){if(t!==Symbol.unscopables)return dn.get(e,t,e)},has(e,t){var r="_"!==t[0]&&!he(t);return"production"!==y.env.NODE_ENV&&!r&&dn.has(e,t)&&w(`Property ${JSON.stringify(t)} should not start with _ which is a reserved prefix for Vue internals.`),r}});let pn=!0;function ln(t,e,r,n=!1){var a,{mixins:i,extends:s}=e;s&&ln(t,s,r,!0),i&&i.forEach(e=>ln(t,e,r,!0));for(const o in e)n&&"expose"===o?"production"!==y.env.NODE_ENV&&w('"expose" option is ignored when declared in mixins or extends. It should only be declared in the base component itself.'):(a=un[o]||r&&r[o],t[o]=a?a(t[o],e[o]):e[o]);return t}const un={data:hn,props:gn,emits:gn,methods:gn,computed:gn,beforeCreate:fn,created:fn,beforeMount:fn,mounted:fn,beforeUpdate:fn,updated:fn,beforeDestroy:fn,beforeUnmount:fn,destroyed:fn,unmounted:fn,activated:fn,deactivated:fn,errorCaptured:fn,serverPrefetch:fn,components:gn,directives:gn,watch:function(e,t){if(!e)return t;if(!t)return e;var r=Ce(Object.create(null),e);for(const n in t)r[n]=fn(e[n],t[n]);return r},provide:hn,inject:function(e,t){return gn(mn(e),mn(t))}};function hn(e,t){return t?e?function(){return Ce(Ee(e)?e.call(this,this):e,Ee(t)?t.call(this,this):t)}:t:e}function mn(t){if(R(t)){var r={};for(let e=0;e<t.length;e++)r[t[e]]=t[e];return r}return t}function fn(e,t){return e?[...new Set([].concat(e,t))]:t}function gn(e,t){return e?Ce(Ce(Object.create(null),e),t):t}ue("String,Number,Boolean,Function,Symbol,BigInt");const _n=function(e,t){t&&t.pendingBranch?R(e)?t.effects.push(...e):t.effects.push(e):Er(e)},vn=e=>e.__isTeleport,yn=Symbol("production"!==y.env.NODE_ENV?"Fragment":void 0),wn=Symbol("production"!==y.env.NODE_ENV?"Text":void 0),bn=Symbol("production"!==y.env.NODE_ENV?"Comment":void 0);Symbol("production"!==y.env.NODE_ENV?"Static":void 0);let Sn=null;function Pn(e,t){if(!("production"!==y.env.NODE_ENV&&6&t.shapeFlag&&jr.has(t.type)))return e.type===t.type&&e.key===t.key;e.shapeFlag&=-257,t.shapeFlag&=-513}const Rn="__vInternal",Cn=({key:e})=>null!=e?e:null,Tn=({ref:e,ref_key:t,ref_for:r})=>null!=e?Oe(e)||pr(e)||Ee(e)?{i:Br,r:e,k:t,f:!!r}:e:null;function Dn(e,t=null,r=null,n=0,a=null,i=e===yn?0:1,s=!1,o=!1){t={__v_isVNode:!0,__v_skip:!0,type:e,props:t,key:t&&Cn(t),ref:t&&Tn(t),scopeId:Ur,slotScopeIds:null,children:r,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:i,patchFlag:n,dynamicProps:a,dynamicChildren:null,appContext:null,ctx:Br};return o?(Mn(t,r),128&i&&e.normalize(t)):r&&(t.shapeFlag|=Oe(r)?8:16),"production"!==y.env.NODE_ENV&&t.key!=t.key&&w("VNode created with invalid key (NaN). VNode type:",t.type),!s&&Sn&&(0<t.patchFlag||6&i)&&32!==t.patchFlag&&Sn.push(t),t}const kn="production"!==y.env.NODE_ENV?(...e)=>xn(...e):xn;function xn(e,r=null,t=null,n=0,a=null,i=!1){if(e&&e!==an||("production"===y.env.NODE_ENV||e||w(`Invalid vnode type when creating vnode: ${e}.`),e=bn),(s=e)&&!0===s.__v_isVNode)return s=En(e,r,!0),t&&Mn(s,t),!i&&Sn&&(6&s.shapeFlag?Sn[Sn.indexOf(e)]=s:Sn.push(s)),s.patchFlag|=-2,s;if(Un(e)&&(e=e.__vccOpts),r){let{class:e,style:t}=r=(s=r)?or(s)||Rn in s?Ce({},s):s:null;e&&!Oe(e)&&(r.class=ve(e)),Ie(t)&&(or(t)&&!R(t)&&(t=Ce({},t)),r.style=me(t))}var s=Oe(e)?1:zr(e)?128:vn(e)?64:Ie(e)?4:Ee(e)?2:0;return"production"!==y.env.NODE_ENV&&4&s&&or(e)&&w("Vue received a Component which was made a reactive object. This can lead to unnecessary performance overhead, and should be avoided by marking the component with `markRaw` or using `shallowRef` instead of `ref`.",`
Component that was made reactive: `,e=h(e)),Dn(e,r,t,n,a,s,i,!0)}function En(e,t,r=!1){var{props:n,ref:a,patchFlag:i,children:s}=e,n=t?function(t){var r={};for(let e=0;e<t.length;e++){var n,a,i=t[e];for(const s in i)"class"===s?r.class!==i.class&&(r.class=ve([r.class,i.class])):"style"===s?r.style=me([r.style,i.style]):Re(s)?(n=r[s],!(a=i[s])||n===a||R(n)&&n.includes(a)||(r[s]=n?[].concat(n,a):a)):""!==s&&(r[s]=i[s])}return r}([n||{},t]):n;return{__v_isVNode:!0,__v_skip:!0,type:e.type,props:n,key:n&&Cn(n),ref:t&&t.ref?r&&a?R(a)?a.concat(Tn(t)):[a,Tn(t)]:Tn(t):a,scopeId:e.scopeId,slotScopeIds:e.slotScopeIds,children:"production"!==y.env.NODE_ENV&&-1===i&&R(s)?s.map(On):s,target:e.target,targetAnchor:e.targetAnchor,staticCount:e.staticCount,shapeFlag:e.shapeFlag,patchFlag:t&&e.type!==yn?-1===i?16:16|i:i,dynamicProps:e.dynamicProps,dynamicChildren:e.dynamicChildren,appContext:e.appContext,dirs:e.dirs,transition:e.transition,component:e.component,suspense:e.suspense,ssContent:e.ssContent&&En(e.ssContent),ssFallback:e.ssFallback&&En(e.ssFallback),el:e.el,anchor:e.anchor,ctx:e.ctx}}function On(e){var t=En(e);return R(e.children)&&(t.children=e.children.map(On)),t}function Mn(e,t){let r=0;var n,a=e["shapeFlag"];if(null==t)t=null;else if(R(t))r=16;else if("object"==typeof t){if(65&a)return void((n=t.default)&&(n._c&&(n._d=!1),Mn(e,n()),n._c)&&(n._d=!0));r=32,(n=t._)||Rn in t?3===n&&Br&&(1===Br.slots._?t._=1:(t._=2,e.patchFlag|=1024)):t._ctx=Br}else Ee(t)?(t={default:t,_ctx:Br},r=32):(t=String(t),64&a?(r=16,t=[([n=" ",a=0]=[t],kn(wn,null,n,a))]):r=8);e.children=t,e.shapeFlag|=r}let In=null;const Ln=()=>In||Br,jn=e=>{(In=e).scope.on()},Nn=()=>{In&&In.scope.off(),In=null};ue("slot,component");const An=/(?:^|[-_])(\w)/g,Vn=e=>e.replace(An,e=>e.toUpperCase()).replace(/[-_]/g,"");function Fn(e,t=!0){return Ee(e)?e.displayName||e.name:e.name||t&&e.__name}function Bn(e,r,t=!1){let n=Fn(r);var a;return!(n=!n&&r.__file&&(a=r.__file.match(/([^/\\]+)\.\w+$/))?a[1]:n)&&e&&e.parent&&(a=e=>{for(const t in e)if(e[t]===r)return t},n=a(e.components||e.parent.type.components)||a(e.appContext.components)),n?Vn(n):t?"App":"Anonymous"}function Un(e){return Ee(e)&&"__vccOpts"in e}const zn=(r,n)=>{{var a=!1;let e,t;var i=Ee(r),r=(t=i?(e=r,"production"!==y.env.NODE_ENV?()=>{console.warn("Write operation failed: computed value is readonly")}:Se):(e=r.get,r.set),new ur(e,t,i||!t,a));return"production"!==y.env.NODE_ENV&&n&&!a&&(r.effect.onTrack=n.onTrack,r.effect.onTrigger=n.onTrigger),r}};function Hn(e){return e&&e.__v_isShallow}function Gn(){if("production"!==y.env.NODE_ENV&&"undefined"!=typeof window){const t={style:"color:#3ba776"},i={style:"color:#0b1bc9"},s={style:"color:#b62e24"},o={style:"color:#9d288c"};var e={header(e){return Ie(e)?e.__isVue?["div",t,"VueInstance"]:pr(e)?["div",{},["span",t,function(e){if(Hn(e))return"ShallowRef";if(e.effect)return"ComputedRef";return"Ref"}(e)],"<",r(e.value),">"]:ar(e)?["div",{},["span",t,Hn(e)?"ShallowReactive":"Reactive"],"<",r(e),">"+(ir(e)?" (readonly)":"")]:ir(e)?["div",{},["span",t,Hn(e)?"ShallowReadonly":"Readonly"],"<",r(e),">"]:null:null},hasBody(e){return e&&e.__isVue},body(e){if(e&&e.__isVue)return["div",{},...function(e){var t=[];e.type.props&&e.props&&t.push(n("props",h(e.props)));e.setupState!==be&&t.push(n("setup",e.setupState));e.data!==be&&t.push(n("data",h(e.data)));var r=a(e,"computed");r&&t.push(n("computed",r));r=a(e,"inject");r&&t.push(n("injected",r));return t.push(["div",{},["span",{style:o.style+";opacity:0.66"},"$ (internal): "],["object",{object:e}]]),t}(e.$)]}};function n(e,t){return t=Ce({},t),Object.keys(t).length?["div",{style:"line-height:1.25em;margin-bottom:0.6em"},["div",{style:"color:#476582"},e],["div",{style:"padding-left:1.25em"},...Object.keys(t).map(e=>["div",{},["span",o,e+": "],r(t[e],!1)])]]:["span",{}]}function r(e,t=!0){return"number"==typeof e?["span",i,e]:"string"==typeof e?["span",s,JSON.stringify(e)]:"boolean"==typeof e?["span",o,e]:Ie(e)?["object",{object:t?h(e):e}]:["span",s,String(e)]}function a(e,t){var r=e.type;if(!Ee(r)){var n={};for(const a in e.ctx)!function t(e,r,n){const a=e[n];if(R(a)&&a.includes(r)||Ie(a)&&r in a)return!0;if(e.extends&&t(e.extends,r,n))return!0;if(e.mixins&&e.mixins.some(e=>t(e,r,n)))return!0}(r,a,t)||(n[a]=e.ctx[a]);return n}}window.devtoolsFormatters?window.devtoolsFormatters.push(e):window.devtoolsFormatters=[e]}}Symbol("production"!==y.env.NODE_ENV?"ssrContext":"");const $n="undefined"!=typeof document?document:null,Jn=$n&&$n.createElement("template");oe={insert:(e,t,r)=>{t.insertBefore(e,r||null)},remove:e=>{var t=e.parentNode;t&&t.removeChild(e)},createElement:(e,t,r,n)=>{t=t?$n.createElementNS("http://www.w3.org/2000/svg",e):$n.createElement(e,r?{is:r}:void 0);return"select"===e&&n&&null!=n.multiple&&t.setAttribute("multiple",n.multiple),t},createText:e=>$n.createTextNode(e),createComment:e=>$n.createComment(e),setText:(e,t)=>{e.nodeValue=t},setElementText:(e,t)=>{e.textContent=t},parentNode:e=>e.parentNode,nextSibling:e=>e.nextSibling,querySelector:e=>$n.querySelector(e),setScopeId(e,t){e.setAttribute(t,"")},insertStaticContent(e,t,r,n,a,i){var s=r?r.previousSibling:t.lastChild;if(a&&(a===i||a.nextSibling)){for(;;)if(t.insertBefore(a.cloneNode(!0),r),a===i||!(a=a.nextSibling))break}else{Jn.innerHTML=n?`<svg>${e}</svg>`:e;var o=Jn.content;if(n){for(var c=o.firstChild;c.firstChild;)o.appendChild(c.firstChild);o.removeChild(c)}t.insertBefore(o,r)}return[s?s.nextSibling:t.firstChild,r?r.previousSibling:t.lastChild]}};const Wn=/[^\\];\s*$/,qn=/\s*!important$/;function Kn(t,r,e){var n;R(e)?e.forEach(e=>Kn(t,r,e)):(null==e&&(e=""),"production"!==y.env.NODE_ENV&&Wn.test(e)&&w(`Unexpected semicolon at the end of '${r}' style value: '${e}'`),r.startsWith("--")?t.setProperty(r,e):(n=function(t,r){var e=Xn[r];if(e)return e;var n=Ue(r);if("filter"!==n&&n in t)return Xn[r]=n;n=Ge(n);for(let e=0;e<Qn.length;e++){var a=Qn[e]+n;if(a in t)return Xn[r]=a}return r}(t,r),qn.test(e)?t.setProperty(He(n),e.replace(qn,""),"important"):t[n]=e))}const Qn=["Webkit","Moz","ms"],Xn={};const Yn="http://www.w3.org/1999/xlink";function Zn(e,t,r,n,a=null){var i,s,o=e._vei||(e._vei={}),c=o[t];n&&c?c.value=n:([i,s]=function(e){let t;if(ea.test(e)){var r;for(t={};r=e.match(ea);)e=e.slice(0,e.length-r[0].length),t[r[0].toLowerCase()]=!0}var n=":"===e[2]?e.slice(3):He(e.slice(2));return[n,t]}(t),n?(n=o[t]=function(e,t){const r=e=>{if(e._vts){if(e._vts<=r.attached)return}else e._vts=Date.now();gr(function(e,t){{if(R(t)){const r=e.stopImmediatePropagation;return e.stopImmediatePropagation=()=>{r.call(e),e._stopped=!0},t.map(t=>e=>!e._stopped&&t&&t(e))}return t}}(e,r.value),t,5,[e])};return r.value=e,r.attached=na(),r}(n,a),e.addEventListener(i,n,s)):c&&(e.removeEventListener(i,c,s),o[t]=void 0))}const ea=/(?:Once|Passive|Capture)$/;let ta=0;const ra=Promise.resolve(),na=()=>ta||(ra.then(()=>ta=0),ta=Date.now());const aa=/^on[a-z]/;const ia={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String};a=Ce({},n.props,ia);new WeakMap,new WeakMap;function sa(){return"undefined"!=typeof navigator&&"undefined"!=typeof window?window:void 0!==W?W:{}}Ce({},a,{tag:String,moveClass:String}),Ce({patchProp:(e,t,r,n,a=!1,i,s,o,c)=>{if("class"===t)g=n,p=a,d=(h=e)._vtc,null==(g=d?(g?[g,...d]:[...d]).join(" "):g)?h.removeAttribute("class"):p?h.setAttribute("class",g):h.className=g;else if("style"===t){var d=e,p=r,l=n,u=d.style,h=Oe(l);if(l&&!h){for(const _ in l)Kn(u,_,l[_]);if(p&&!Oe(p))for(const v in p)null==l[v]&&Kn(u,v,"")}else{g=u.display;h?p!==l&&(u.cssText=l):p&&d.removeAttribute("style"),"_vod"in d&&(u.display=g)}}else if(Re(t))t.startsWith("onUpdate:")||Zn(e,t,0,n,s);else if("."===t[0]?(t=t.slice(1),1):"^"===t[0]?(t=t.slice(1),0):function(e,t,r,n){if(n)return"innerHTML"===t||"textContent"===t||!!(t in e&&aa.test(t)&&Ee(r));if("spellcheck"===t||"draggable"===t||"translate"===t)return;if("form"===t)return;if("list"===t&&"INPUT"===e.tagName)return;if("type"===t&&"TEXTAREA"===e.tagName)return;if(aa.test(t)&&Oe(r))return;return t in e}(e,t,n,a)){var r=e,m=t,f=n;if("innerHTML"===m||"textContent"===m)i&&c(i,s,o),r[m]=null==f?"":f;else if("value"!==m||"PROGRESS"===r.tagName||r.tagName.includes("-")){let t=!1;""!==f&&null!=f||("boolean"==(c=typeof r[m])?f=we(f):null==f&&"string"==c?(f="",t=!0):"number"==c&&(f=0,t=!0));try{r[m]=f}catch(e){"production"===y.env.NODE_ENV||t||w(`Failed setting prop "${m}" on <${r.tagName.toLowerCase()}>: `+`value ${f} is invalid.`,e)}t&&r.removeAttribute(m)}else i=null==(r._value=f)?"":f,r.value===i&&"OPTION"!==r.tagName||(r.value=i),null==f&&r.removeAttribute(m)}else"true-value"===t?e._trueValue=n:"false-value"===t&&(e._falseValue=n),s=e,o=t,c=n,(i=a)&&o.startsWith("xlink:")?null==c?s.removeAttributeNS(Yn,o.slice(6,o.length)):s.setAttributeNS(Yn,o,c):(i=ye(o),null==c||i&&!we(c)?s.removeAttribute(o):s.setAttribute(o,i?"":c));var h,g,p,d}},oe),"production"!==y.env.NODE_ENV&&Gn();const oa="function"==typeof Proxy,ca="devtools-plugin:setup";let da,pa;function la(){return void 0===da&&("undefined"!=typeof window&&window.performance?(da=!0,pa=window.performance):void 0!==W&&null!=(e=W.perf_hooks)&&e.performance?(da=!0,pa=W.perf_hooks.performance):da=!1),(da?pa:Date).now();var e}class ua{constructor(e,t){this.target=null,this.targetQueue=[],this.onQueue=[],this.plugin=e,this.hook=t;var r={};if(e.settings)for(const c in e.settings){var n=e.settings[c];r[c]=n.defaultValue}const a="__vue-devtools-plugin-settings__"+e.id;let i=Object.assign({},r);try{var s=localStorage.getItem(a),o=JSON.parse(s);Object.assign(i,o)}catch(e){}this.fallbacks={getSettings(){return i},setSettings(e){try{localStorage.setItem(a,JSON.stringify(e))}catch(e){}i=e},now(){return la()}},t&&t.on("plugin:settings:set",(e,t)=>{e===this.plugin.id&&this.fallbacks.setSettings(t)}),this.proxiedOn=new Proxy({},{get:(e,t)=>this.target?this.target.on[t]:(...e)=>{this.onQueue.push({method:t,args:e})}}),this.proxiedTarget=new Proxy({},{get:(e,r)=>this.target?this.target[r]:"on"===r?this.proxiedOn:Object.keys(this.fallbacks).includes(r)?(...e)=>(this.targetQueue.push({method:r,args:e,resolve:()=>{}}),this.fallbacks[r](...e)):(...t)=>new Promise(e=>{this.targetQueue.push({method:r,args:t,resolve:e})})})}async setRealTarget(e){this.target=e;for(const t of this.onQueue)this.target.on[t.method](...t.args);for(const r of this.targetQueue)r.resolve(await this.target[r.method](...r.args))}}function ha(e,t){var r=e,n=sa(),a=sa().__VUE_DEVTOOLS_GLOBAL_HOOK__,i=oa&&r.enableEarlyProxy;!a||!n.__VUE_DEVTOOLS_PLUGIN_API_AVAILABLE__&&i?(i=i?new ua(r,a):null,(n.__VUE_DEVTOOLS_PLUGINS__=n.__VUE_DEVTOOLS_PLUGINS__||[]).push({pluginDescriptor:r,setupFn:t,proxy:i}),i&&t(i.proxiedTarget)):a.emit(ca,e,t)}function ma(t,r){var e,n;return void 0===r&&(r=[]),null===t||"object"!=typeof t?t:(e=function(e){return e.original===t},(e=r.filter(e)[0])?e.copy:(n=Array.isArray(t)?[]:{},r.push({original:t,copy:n}),Object.keys(t).forEach(function(e){n[e]=ma(t[e],r)}),n))}function fa(t,r){Object.keys(t).forEach(function(e){return r(t[e],e)})}function ga(e,t){if(!e)throw new Error("[vuex] "+t)}function _a(t,r,e){return r.indexOf(t)<0&&(e&&e.prepend?r.unshift(t):r.push(t)),function(){var e=r.indexOf(t);-1<e&&r.splice(e,1)}}function va(e,t){e._actions=Object.create(null),e._mutations=Object.create(null),e._wrappedGetters=Object.create(null),e._modulesNamespaceMap=Object.create(null);var r=e.state;wa(e,r,[],e._modules.root,!0),ya(e,r,t)}function ya(a,e,t){var r,n=a._state,i=a._scope,s=(a.getters={},a._makeLocalGettersCache=Object.create(null),a._wrappedGetters),o={},c={},d=new Ye(!0);d.run(function(){fa(s,function(e,t){var r,n;o[t]=(r=e,n=a,function(){return r(n)}),c[t]=zn(function(){return o[t]()}),Object.defineProperty(a.getters,t,{get:function(){return c[t].value},enumerable:!0})})}),a._state=er({data:e}),a._scope=d,a.strict&&(r=a,Gr(function(){return r._state.data},function(){"production"!==y.env.NODE_ENV&&ga(r._committing,"do not mutate vuex store state outside mutation handlers.")},{deep:!0,flush:"sync"})),n&&t&&a._withCommit(function(){n.data=null}),i&&i.stop()}function wa(i,r,n,e,a){var t,s,o,c,d,p,l=!n.length,u=i._modules.getNamespace(n),h=(e.namespaced&&(i._modulesNamespaceMap[u]&&"production"!==y.env.NODE_ENV&&console.error("[vuex] duplicate namespace "+u+" for the namespaced module "+n.join("/")),i._modulesNamespaceMap[u]=e),l||a||(t=Sa(r,n.slice(0,-1)),s=n[n.length-1],i._withCommit(function(){"production"!==y.env.NODE_ENV&&s in t&&console.warn('[vuex] state field "'+s+'" was overridden by a module with the same name at "'+n.join(".")+'"'),t[s]=e.state})),e.context=(o=i,d=n,p={dispatch:(l=""===(c=u))?o.dispatch:function(e,t,r){var e=Pa(e,t,r),t=e.payload,r=e.options,n=e.type;if(r&&r.root||(n=c+n,"production"===y.env.NODE_ENV)||o._actions[n])return o.dispatch(n,t);console.error("[vuex] unknown local action type: "+e.type+", global type: "+n)},commit:l?o.commit:function(e,t,r){var e=Pa(e,t,r),t=e.payload,r=e.options,n=e.type;r&&r.root||(n=c+n,"production"===y.env.NODE_ENV)||o._mutations[n]?o.commit(n,t,r):console.error("[vuex] unknown local mutation type: "+e.type+", global type: "+n)}},Object.defineProperties(p,{getters:{get:l?function(){return o.getters}:function(){return ba(o,c)}},state:{get:function(){return Sa(o.state,d)}}}),p));e.forEachMutation(function(e,t){var r,n,a;t=u+t,n=e,a=h,((r=i)._mutations[t]||(r._mutations[t]=[])).push(function(e){n.call(r,a.state,e)})}),e.forEachAction(function(e,t){var r,n,a,t=e.root?t:u+t,e=e.handler||e;t=t,n=e,a=h,((r=i)._actions[t]||(r._actions[t]=[])).push(function(e){var t,e=n.call(r,{dispatch:a.dispatch,commit:a.commit,getters:a.getters,state:a.state,rootGetters:r.getters,rootState:r.state},e);return(t=e)&&"function"==typeof t.then||(e=Promise.resolve(e)),r._devtoolHook?e.catch(function(e){throw r._devtoolHook.emit("vuex:error",e),e}):e})}),e.forEachGetter(function(e,t){var r,n;t=u+t,r=e,n=h,(e=i)._wrappedGetters[t]?"production"!==y.env.NODE_ENV&&console.error("[vuex] duplicate getter key: "+t):e._wrappedGetters[t]=function(e){return r(n.state,n.getters,e.state,e.getters)}}),e.forEachChild(function(e,t){wa(i,r,n.concat(t),e,a)})}function ba(r,n){var a,i;return r._makeLocalGettersCache[n]||(a={},i=n.length,Object.keys(r.getters).forEach(function(e){var t;e.slice(0,i)===n&&(t=e.slice(i),Object.defineProperty(a,t,{get:function(){return r.getters[e]},enumerable:!0}))}),r._makeLocalGettersCache[n]=a),r._makeLocalGettersCache[n]}function Sa(e,t){return t.reduce(function(e,t){return e[t]},e)}function Pa(e,t,r){var n;return null!==(n=e)&&"object"==typeof n&&e.type&&(r=t,e=(t=e).type),"production"!==y.env.NODE_ENV&&ga("string"==typeof e,"expects string as the type, but found "+typeof e+"."),{type:e,payload:t,options:r}}var Ra="vuex:mutations",Ca="vuex:actions",Ta="vuex",Da=0;function ka(i,s){ha({id:"org.vuejs.vuex",app:i,label:"Vuex",homepage:"https://next.vuex.vuejs.org/",logo:"https://vuejs.org/images/icons/favicon-96x96.png",packageName:"vuex",componentStateTypes:["vuex bindings"]},function(a){a.addTimelineLayer({id:Ra,label:"Vuex Mutations",color:8702998}),a.addTimelineLayer({id:Ca,label:"Vuex Actions",color:8702998}),a.addInspector({id:Ta,label:"Vuex",icon:"storage",treeFilterPlaceholder:"Filter stores..."}),a.on.getInspectorTree(function(e){var t;e.app===i&&e.inspectorId===Ta&&(e.filter?(function t(r,n,a,i){i.includes(a)&&r.push({id:i||"root",label:i.endsWith("/")?i.slice(0,i.length-1):i||"Root",tags:n.namespaced?[xa]:[]});Object.keys(n._children).forEach(function(e){t(r,n._children[e],a,i+e+"/")})}(t=[],s._modules.root,e.filter,""),e.rootNodes=t):e.rootNodes=[function t(r,n){return{id:n||"root",label:Ea(n),tags:r.namespaced?[xa]:[],children:Object.keys(r._children).map(function(e){return t(r._children[e],n+e+"/")})}}(s._modules.root,"")])}),a.on.getInspectorState(function(e){var t,n,a;e.app===i&&e.inspectorId===Ta&&(t=e.nodeId,ba(s,t),e.state=function(t,e,r){e="root"===r?e:e[r];var r=Object.keys(e),n={state:Object.keys(t.state).map(function(e){return{key:e,editable:!0,value:t.state[e]}})};{var a;r.length&&(a=function(a){var i={};return Object.keys(a).forEach(function(e){var t,r,n=e.split("/");1<n.length?(t=i,r=n.pop(),n.forEach(function(e){t[e]||(t[e]={_custom:{value:{},display:e,tooltip:"Module",abstract:!0}}),t=t[e]._custom.value}),t[r]=Oa(function(){return a[e]})):i[e]=Oa(function(){return a[e]})}),i}(e),n.getters=Object.keys(a).map(function(e){return{key:e.endsWith("/")?Ea(e):e,editable:!1,value:Oa(function(){return a[e]})}}))}return n}((e=s._modules,(a=(n=t).split("/").filter(function(e){return e})).reduce(function(e,t,r){e=e[t];if(e)return r===a.length-1?e:e._children;throw new Error('Missing module "'+t+'" for path "'+n+'".')},"root"===n?e:e.root._children)),"root"===t?s.getters:s._makeLocalGettersCache,t))}),a.on.editInspectorState(function(e){var t,r;e.app===i&&e.inspectorId===Ta&&(t=e.nodeId,r=e.path,"root"!==t&&(r=t.split("/").filter(Boolean).concat(r)),s._withCommit(function(){e.set(s._state.data,r,e.state.value)}))}),s.subscribe(function(e,t){var r={};e.payload&&(r.payload=e.payload),r.state=t,a.notifyComponentUpdate(),a.sendInspectorTree(Ta),a.sendInspectorState(Ta),a.addTimelineEvent({layerId:Ra,event:{time:Date.now(),title:e.type,data:r}})}),s.subscribeAction({before:function(e,t){var r={};e.payload&&(r.payload=e.payload),e._id=Da++,e._time=Date.now(),r.state=t,a.addTimelineEvent({layerId:Ca,event:{time:e._time,title:e.type,groupId:e._id,subtitle:"start",data:r}})},after:function(e,t){var r={},n=Date.now()-e._time;r.duration={_custom:{type:"duration",display:n+"ms",tooltip:"Action duration",value:n}},e.payload&&(r.payload=e.payload),r.state=t,a.addTimelineEvent({layerId:Ca,event:{time:Date.now(),title:e.type,groupId:e._id,subtitle:"end",data:r}})}})})}var xa={label:"namespaced",textColor:16777215,backgroundColor:6710886};function Ea(e){return e&&"root"!==e?e.split("/").slice(-2,-1)[0]:"Root"}function Oa(e){try{return e()}catch(e){return e}}function Ma(e,t){this.runtime=t,this._children=Object.create(null),t=(this._rawModule=e).state,this.state=("function"==typeof t?t():t)||{}}function Ia(e){this.register([],e,!1)}t={namespaced:{configurable:!0}};t.namespaced.get=function(){return!!this._rawModule.namespaced},Ma.prototype.addChild=function(e,t){this._children[e]=t},Ma.prototype.removeChild=function(e){delete this._children[e]},Ma.prototype.getChild=function(e){return this._children[e]},Ma.prototype.hasChild=function(e){return e in this._children},Ma.prototype.update=function(e){this._rawModule.namespaced=e.namespaced,e.actions&&(this._rawModule.actions=e.actions),e.mutations&&(this._rawModule.mutations=e.mutations),e.getters&&(this._rawModule.getters=e.getters)},Ma.prototype.forEachChild=function(e){fa(this._children,e)},Ma.prototype.forEachGetter=function(e){this._rawModule.getters&&fa(this._rawModule.getters,e)},Ma.prototype.forEachAction=function(e){this._rawModule.actions&&fa(this._rawModule.actions,e)},Ma.prototype.forEachMutation=function(e){this._rawModule.mutations&&fa(this._rawModule.mutations,e)},Object.defineProperties(Ma.prototype,t);Ia.prototype.get=function(e){return e.reduce(function(e,t){return e.getChild(t)},this.root)},Ia.prototype.getNamespace=function(e){var r=this.root;return e.reduce(function(e,t){return e+((r=r.getChild(t)).namespaced?t+"/":"")},"")},Ia.prototype.update=function(e){!function e(t,r,n){"production"!==y.env.NODE_ENV&&ja(t,n);r.update(n);if(n.modules)for(var a in n.modules){if(!r.getChild(a))return void("production"!==y.env.NODE_ENV&&console.warn("[vuex] trying to add a new module '"+a+"' on hot reloading, manual reload is needed"));e(t.concat(a),r.getChild(a),n.modules[a])}}([],this.root,e)},Ia.prototype.register=function(r,e,n){var a=this,t=(void 0===n&&(n=!0),"production"!==y.env.NODE_ENV&&ja(r,e),new Ma(e,n));0===r.length?this.root=t:this.get(r.slice(0,-1)).addChild(r[r.length-1],t),e.modules&&fa(e.modules,function(e,t){a.register(r.concat(t),e,n)})},Ia.prototype.unregister=function(e){var t=this.get(e.slice(0,-1)),e=e[e.length-1],r=t.getChild(e);r?r.runtime&&t.removeChild(e):"production"!==y.env.NODE_ENV&&console.warn("[vuex] trying to unregister module '"+e+"', which is not registered")},Ia.prototype.isRegistered=function(e){var t=this.get(e.slice(0,-1)),e=e[e.length-1];return!!t&&t.hasChild(e)};var i={assert:function(e){return"function"==typeof e},expected:"function"},La={getters:i,mutations:i,actions:{assert:function(e){return"function"==typeof e||"object"==typeof e&&"function"==typeof e.handler},expected:'function or object with "handler" function'}};function ja(a,e){Object.keys(La).forEach(function(r){var n;e[r]&&(n=La[r],fa(e[r],function(e,t){ga(n.assert(e),function(e,t,r,n,a){a=t+" should be "+a+' but "'+t+"."+r+'"';0<e.length&&(a+=' in module "'+e.join(".")+'"');return a+=" is "+JSON.stringify(n)+"."}(a,r,t,e,n.expected))}))})}function Na(e){var t=this,r=(void 0===e&&(e={}),"production"!==y.env.NODE_ENV&&(ga("undefined"!=typeof Promise,"vuex requires a Promise polyfill in this browser."),ga(this instanceof Na,"store must be called with the new operator.")),e.plugins),n=(void 0===r&&(r=[]),e.strict),a=(void 0===n&&(n=!1),e.devtools),i=(this._committing=!1,this._actions=Object.create(null),this._actionSubscribers=[],this._mutations=Object.create(null),this._wrappedGetters=Object.create(null),this._modules=new Ia(e),this._modulesNamespaceMap=Object.create(null),this._subscribers=[],this._makeLocalGettersCache=Object.create(null),this._scope=null,this._devtools=a,this),s=this.dispatch,o=this.commit,e=(this.dispatch=function(e,t){return s.call(i,e,t)},this.commit=function(e,t,r){return o.call(i,e,t,r)},this.strict=n,this._modules.root.state);wa(this,e,[],this._modules.root),ya(this,e),r.forEach(function(e){return e(t)})}r={state:{configurable:!0}};function Aa(t,r,e){e=e?t.groupCollapsed:t.group;try{e.call(t,r)}catch(e){t.log(r)}}function Va(t){try{t.groupEnd()}catch(e){t.log("—— log end ——")}}function Fa(){var e=new Date;return" @ "+Ba(e.getHours(),2)+":"+Ba(e.getMinutes(),2)+":"+Ba(e.getSeconds(),2)+"."+Ba(e.getMilliseconds(),3)}function Ba(e,t){return r="0",t=t-e.toString().length,new Array(t+1).join(r)+e;var r}Na.prototype.install=function(e,t){e.provide(t||"store",this),(void 0!==(e.config.globalProperties.$store=this)._devtools?this._devtools:"production"!==y.env.NODE_ENV||__VUE_PROD_DEVTOOLS__)&&ka(e,this)},r.state.get=function(){return this._state.data},r.state.set=function(e){"production"!==y.env.NODE_ENV&&ga(!1,"use store.replaceState() to explicit replace store state.")},Na.prototype.commit=function(e,t,r){var n=this,e=Pa(e,t,r),t=e.type,a=e.payload,r=e.options,i={type:t,payload:a},s=this._mutations[t];s?(this._withCommit(function(){s.forEach(function(e){e(a)})}),this._subscribers.slice().forEach(function(e){return e(i,n.state)}),"production"!==y.env.NODE_ENV&&r&&r.silent&&console.warn("[vuex] mutation type: "+t+". Silent option has been removed. Use the filter functionality in the vue-devtools")):"production"!==y.env.NODE_ENV&&console.error("[vuex] unknown mutation type: "+t)},Na.prototype.dispatch=function(e,t){var r=this,e=Pa(e,t),t=e.type,n=e.payload,a={type:t,payload:n},e=this._actions[t];if(e){try{this._actionSubscribers.slice().filter(function(e){return e.before}).forEach(function(e){return e.before(a,r.state)})}catch(e){"production"!==y.env.NODE_ENV&&(console.warn("[vuex] error in before action subscribers: "),console.error(e))}var i=1<e.length?Promise.all(e.map(function(e){return e(n)})):e[0](n);return new Promise(function(t,e){i.then(function(e){try{r._actionSubscribers.filter(function(e){return e.after}).forEach(function(e){return e.after(a,r.state)})}catch(e){"production"!==y.env.NODE_ENV&&(console.warn("[vuex] error in after action subscribers: "),console.error(e))}t(e)},function(t){try{r._actionSubscribers.filter(function(e){return e.error}).forEach(function(e){return e.error(a,r.state,t)})}catch(e){"production"!==y.env.NODE_ENV&&(console.warn("[vuex] error in error action subscribers: "),console.error(e))}e(t)})})}"production"!==y.env.NODE_ENV&&console.error("[vuex] unknown action type: "+t)},Na.prototype.subscribe=function(e,t){return _a(e,this._subscribers,t)},Na.prototype.subscribeAction=function(e,t){return _a("function"==typeof e?{before:e}:e,this._actionSubscribers,t)},Na.prototype.watch=function(e,t,r){var n=this;return"production"!==y.env.NODE_ENV&&ga("function"==typeof e,"store.watch only accepts a function."),Gr(function(){return e(n.state,n.getters)},t,Object.assign({},r))},Na.prototype.replaceState=function(e){var t=this;this._withCommit(function(){t._state.data=e})},Na.prototype.registerModule=function(e,t,r){void 0===r&&(r={}),"string"==typeof e&&(e=[e]),"production"!==y.env.NODE_ENV&&(ga(Array.isArray(e),"module path must be a string or an Array."),ga(0<e.length,"cannot register the root module by using registerModule.")),this._modules.register(e,t),wa(this,this.state,e,this._modules.get(e),r.preserveState),ya(this,this.state)},Na.prototype.unregisterModule=function(e){var t=this;"string"==typeof e&&(e=[e]),"production"!==y.env.NODE_ENV&&ga(Array.isArray(e),"module path must be a string or an Array."),this._modules.unregister(e),this._withCommit(function(){delete Sa(t.state,e.slice(0,-1))[e[e.length-1]]}),va(this)},Na.prototype.hasModule=function(e){return"string"==typeof e&&(e=[e]),"production"!==y.env.NODE_ENV&&ga(Array.isArray(e),"module path must be a string or an Array."),this._modules.isRegistered(e)},Na.prototype.hotUpdate=function(e){this._modules.update(e),va(this,!0)},Na.prototype._withCommit=function(e){var t=this._committing;this._committing=!0,e(),this._committing=t},Object.defineProperties(Na.prototype,r);const Ua="setStream",za="setWebrtcObj";ce={modules:{stream:{state:{cc:{},wc:{}},mutations:{setStream(e,t){e.cc={...e.cc,...t}},setWebrtcObj(e,t){e.wc={...e.wc,...t}}}}},strict:!0,plugins:[(void 0===(Ha=(s=void 0===s?{}:s).collapsed)&&(Ha=!0),void 0===(Ga=s.filter)&&(Ga=function(e,t,r){return!0}),void 0===($a=s.transformer)&&($a=function(e){return e}),void 0===(Ja=s.mutationTransformer)&&(Ja=function(e){return e}),void 0===(Wa=s.actionFilter)&&(Wa=function(e,t){return!0}),void 0===(qa=s.actionTransformer)&&(qa=function(e){return e}),void 0===(Ka=s.logMutations)&&(Ka=!0),void 0===(Qa=s.logActions)&&(Qa=!0),void 0===(Xa=s.logger)&&(Xa=console),function(e){var a=ma(e.state);void 0!==Xa&&(Ka&&e.subscribe(function(e,t){var r,n,t=ma(t);Ga(e,a,t)&&(r=Fa(),n=Ja(e),e="mutation "+e.type+r,Aa(Xa,e,Ha),Xa.log("%c prev state","color: #9E9E9E; font-weight: bold",$a(a)),Xa.log("%c mutation","color: #03A9F4; font-weight: bold",n),Xa.log("%c next state","color: #4CAF50; font-weight: bold",$a(t)),Va(Xa)),a=t}),Qa)&&e.subscribeAction(function(e,t){var r;Wa(e,t)&&(t=Fa(),r=qa(e),e="action "+e.type+t,Aa(Xa,e,Ha),Xa.log("%c action","color: #03A9F4; font-weight: bold",r),Va(Xa))})})]};var Ha,Ga,$a,Ja,Wa,qa,Ka,Qa,Xa,Ya,Za,ei=new Na(ce),ti={},n={exports:{}};function ri(){var a,i,s,o,c,d;return Za||(Za=1,c=7*(o=24*(s=60*(i=60*(a=1e3)))),d=365.25*o,Ya=function(e,t){t=t||{};var r=typeof e;if(!("string"==r&&0<e.length)){if("number"==r&&isFinite(e))return(t.long?function(e){var t=Math.abs(e);if(o<=t)return p(e,t,o,"day");if(s<=t)return p(e,t,s,"hour");if(i<=t)return p(e,t,i,"minute");if(a<=t)return p(e,t,a,"second");return e+" ms"}:function(e){var t=Math.abs(e);if(o<=t)return Math.round(e/o)+"d";if(s<=t)return Math.round(e/s)+"h";if(i<=t)return Math.round(e/i)+"m";if(a<=t)return Math.round(e/a)+"s";return e+"ms"})(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}r=e;if(!(100<(r=String(r)).length)){r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(r){var n=parseFloat(r[1]);switch((r[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return n*d;case"weeks":case"week":case"w":return n*c;case"days":case"day":case"d":return n*o;case"hours":case"hour":case"hrs":case"hr":case"h":return n*s;case"minutes":case"minute":case"mins":case"min":case"m":return n*i;case"seconds":case"second":case"secs":case"sec":case"s":return n*a;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return n;default:return}}}}),Ya;function p(e,t,r,n){t=1.5*r<=t;return Math.round(e/r)+" "+n+(t?"s":"")}}var ni,ai,ii,si,a=function(t){function o(e){let r,t=null,n,a;function s(...a){if(s.enabled){const i=s;var e=Number(new Date),t=e-(r||e);i.diff=t,i.prev=r,i.curr=e,r=e,a[0]=o.coerce(a[0]),"string"!=typeof a[0]&&a.unshift("%O");let n=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(e,t)=>{if("%%"===e)return"%";n++;var r,t=o.formatters[t];return"function"==typeof t&&(r=a[n],e=t.call(i,r),a.splice(n,1),n--),e}),o.formatArgs.call(i,a),(i.log||o.log).apply(i,a)}}return s.namespace=e,s.useColors=o.useColors(),s.color=o.selectColor(e),s.extend=i,s.destroy=o.destroy,Object.defineProperty(s,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==t?t:(n!==o.namespaces&&(n=o.namespaces,a=o.enabled(e)),a),set:e=>{t=e}}),"function"==typeof o.init&&o.init(s),s}function i(e,t){t=o(this.namespace+(void 0===t?":":t)+e);return t.log=this.log,t}function r(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return((o.debug=o).default=o).coerce=function(e){if(e instanceof Error)return e.stack||e.message;return e},o.disable=function(){var e=[...o.names.map(r),...o.skips.map(r).map(e=>"-"+e)].join(",");return o.enable(""),e},o.enable=function(e){o.save(e),o.namespaces=e,o.names=[],o.skips=[];let t;var r=("string"==typeof e?e:"").split(/[\s,]+/),n=r.length;for(t=0;t<n;t++)r[t]&&("-"===(e=r[t].replace(/\*/g,".*?"))[0]?o.skips.push(new RegExp("^"+e.slice(1)+"$")):o.names.push(new RegExp("^"+e+"$")))},o.enabled=function(e){if("*"===e[e.length-1])return!0;let t,r;for(t=0,r=o.skips.length;t<r;t++)if(o.skips[t].test(e))return!1;for(t=0,r=o.names.length;t<r;t++)if(o.names[t].test(e))return!0;return!1},o.humanize=ri(),o.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach(e=>{o[e]=t[e]}),o.names=[],o.skips=[],o.formatters={},o.selectColor=function(t){let r=0;for(let e=0;e<t.length;e++)r=(r<<5)-r+t.charCodeAt(e),r|=0;return o.colors[Math.abs(r)%o.colors.length]},o.enable(o.load()),o},oi=((ai=(ni=n).exports).formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+ni.exports.humanize(this.diff),this.useColors){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");let t=0,r=0;e[0].replace(/%[a-zA-Z%]/g,e=>{"%%"!==e&&(t++,"%c"===e)&&(r=t)}),e.splice(r,0,n)}},ai.save=function(e){try{e?ai.storage.setItem("debug",e):ai.storage.removeItem("debug")}catch(e){}},ai.load=function(){let e;try{e=ai.storage.getItem("debug")}catch(e){}!e&&void 0!==y&&"env"in y&&(e=y.env.DEBUG);return e},ai.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},ai.storage=function(){try{return localStorage}catch(e){}}(),ai.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),ai.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],ai.log=console.debug||console.log||(()=>{}),ni.exports=a(ai),ni.exports.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},n.exports),oe={},t={exports:{}};function ci(e){var t;return(si[e]||(t=si[e]={i:e,l:!1,exports:{}},ii[e].call(t.exports,t,t.exports,ci),t.l=!0,t)).exports}ii={17:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=r(18);function c(){}c.getFirstMatch=function(e,t){t=t.match(e);return t&&0<t.length&&t[1]||""},c.getSecondMatch=function(e,t){t=t.match(e);return t&&1<t.length&&t[2]||""},c.matchAndReturnConst=function(e,t,r){if(e.test(t))return r},c.getWindowsVersionName=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}},c.getMacOSVersionName=function(e){e=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(e.push(0),10===e[0])switch(e[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}},c.getAndroidVersionName=function(e){e=e.split(".").splice(0,2).map(function(e){return parseInt(e,10)||0});if(e.push(0),!(1===e[0]&&e[1]<5))return 1===e[0]&&e[1]<6?"Cupcake":1===e[0]&&6<=e[1]?"Donut":2===e[0]&&e[1]<2?"Eclair":2===e[0]&&2===e[1]?"Froyo":2===e[0]&&2<e[1]?"Gingerbread":3===e[0]?"Honeycomb":4===e[0]&&e[1]<1?"Ice Cream Sandwich":4===e[0]&&e[1]<4?"Jelly Bean":4===e[0]&&4<=e[1]?"KitKat":5===e[0]?"Lollipop":6===e[0]?"Marshmallow":7===e[0]?"Nougat":8===e[0]?"Oreo":9===e[0]?"Pie":void 0},c.getVersionPrecision=function(e){return e.split(".").length},c.compareVersions=function(e,t,r){void 0===r&&(r=!1);var n=c.getVersionPrecision(e),a=c.getVersionPrecision(t),i=Math.max(n,a),s=0,o=c.map([e,t],function(e){var t=i-c.getVersionPrecision(e),e=e+new Array(1+t).join(".0");return c.map(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});for(r&&(s=i-Math.min(n,a)),--i;s<=i;){if(o[0][i]>o[1][i])return 1;if(o[0][i]===o[1][i]){if(i===s)return 0;--i}else if(o[0][i]<o[1][i])return-1}},c.map=function(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r+=1)n.push(t(e[r]));return n},c.find=function(e,t){var r,n;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,n=e.length;r<n;r+=1){var a=e[r];if(t(a,r))return a}},c.assign=function(e){for(var r=e,t=arguments.length,n=new Array(1<t?t-1:0),a=1;a<t;a++)n[a-1]=arguments[a];if(Object.assign)return Object.assign.apply(Object,[e].concat(n));for(var i=0,s=n.length;i<s;i+=1)!function(){var t=n[i];"object"==typeof t&&null!==t&&Object.keys(t).forEach(function(e){r[e]=t[e]})}();return e},c.getBrowserAlias=function(e){return n.BROWSER_ALIASES_MAP[e]},c.getBrowserTypeByAlias=function(e){return n.BROWSER_MAP[e]||""},t.default=c,e.exports=t.default},18:function(e,t,r){t.__esModule=!0,t.ENGINE_MAP=t.OS_MAP=t.PLATFORMS_MAP=t.BROWSER_MAP=t.BROWSER_ALIASES_MAP=void 0,t.BROWSER_ALIASES_MAP={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},t.BROWSER_MAP={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},t.PLATFORMS_MAP={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},t.OS_MAP={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},t.ENGINE_MAP={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"}},90:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,a=(n=r(91))&&n.__esModule?n:{default:n},i=r(18);function s(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(){}o.getParser=function(e,t){if(void 0===t&&(t=!1),"string"!=typeof e)throw new Error("UserAgent should be a string");return new a.default(e,t)},o.parse=function(e){return new a.default(e).getResult()},n=o,r=[{key:"BROWSER_MAP",get:function(){return i.BROWSER_MAP}},{key:"ENGINE_MAP",get:function(){return i.ENGINE_MAP}},{key:"OS_MAP",get:function(){return i.OS_MAP}},{key:"PLATFORMS_MAP",get:function(){return i.PLATFORMS_MAP}}],null&&s(n.prototype,null),s(n,r),t.default=o,e.exports=t.default},91:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=o(r(92)),a=o(r(93)),i=o(r(94)),s=o(r(95)),c=o(r(17));function o(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(void 0===t&&(t=!1),null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}(r=d.prototype).getUA=function(){return this._ua},r.test=function(e){return e.test(this._ua)},r.parseBrowser=function(){var t=this,e=(this.parsedResult.browser={},c.default.find(n.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser},r.getBrowser=function(){return this.parsedResult.browser||this.parseBrowser()},r.getBrowserName=function(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""},r.getBrowserVersion=function(){return this.getBrowser().version},r.getOS=function(){return this.parsedResult.os||this.parseOS()},r.parseOS=function(){var t=this,e=(this.parsedResult.os={},c.default.find(a.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os},r.getOSName=function(e){var t=this.getOS().name;return e?String(t).toLowerCase()||"":t||""},r.getOSVersion=function(){return this.getOS().version},r.getPlatform=function(){return this.parsedResult.platform||this.parsePlatform()},r.getPlatformType=function(e){void 0===e&&(e=!1);var t=this.getPlatform().type;return e?String(t).toLowerCase()||"":t||""},r.parsePlatform=function(){var t=this,e=(this.parsedResult.platform={},c.default.find(i.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform},r.getEngine=function(){return this.parsedResult.engine||this.parseEngine()},r.getEngineName=function(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""},r.parseEngine=function(){var t=this,e=(this.parsedResult.engine={},c.default.find(s.default,function(e){if("function"==typeof e.test)return e.test(t);if(e.test instanceof Array)return e.test.some(function(e){return t.test(e)});throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine},r.parse=function(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this},r.getResult=function(){return c.default.assign({},this.parsedResult)},r.satisfies=function(r){var t=this,n={},a=0,i={},s=0;if(Object.keys(r).forEach(function(e){var t=r[e];"string"==typeof t?(i[e]=t,s+=1):"object"==typeof t&&(n[e]=t,a+=1)}),0<a){var e=Object.keys(n),o=c.default.find(e,function(e){return t.isOS(e)});if(o){o=this.satisfies(n[o]);if(void 0!==o)return o}o=c.default.find(e,function(e){return t.isPlatform(e)});if(o){e=this.satisfies(n[o]);if(void 0!==e)return e}}if(0<s){o=Object.keys(i),e=c.default.find(o,function(e){return t.isBrowser(e,!0)});if(void 0!==e)return this.compareVersion(i[e])}},r.isBrowser=function(e,t){void 0===t&&(t=!1);var r=this.getBrowserName().toLowerCase(),e=e.toLowerCase(),n=c.default.getBrowserTypeByAlias(e);return(e=t&&n?n.toLowerCase():e)===r},r.compareVersion=function(e){var t=[0],r=e,n=!1,a=this.getBrowserVersion();if("string"==typeof a)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(n=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(n=!0,r=e.substr(1)),-1<t.indexOf(c.default.compareVersions(a,r,n))},r.isOS=function(e){return this.getOSName(!0)===String(e).toLowerCase()},r.isPlatform=function(e){return this.getPlatformType(!0)===String(e).toLowerCase()},r.isEngine=function(e){return this.getEngineName(!0)===String(e).toLowerCase()},r.is=function(e,t){return this.isBrowser(e,t=void 0===t?!1:t)||this.isOS(e)||this.isPlatform(e)},r.some=function(e){var t=this;return(e=void 0===e?[]:e).some(function(e){return t.is(e)})},t.default=d,e.exports=t.default},92:function(e,t,r){t.__esModule=!0,t.default=void 0;var n=(r=r(17))&&r.__esModule?r:{default:r},a=/version\/(\d+(\.?_?\d+)+)/i;t.default=[{test:[/googlebot/i],describe:function(e){var t={name:"Googlebot"},e=n.default.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/opera/i],describe:function(e){var t={name:"Opera"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/opr\/|opios/i],describe:function(e){var t={name:"Opera"},e=n.default.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/SamsungBrowser/i],describe:function(e){var t={name:"Samsung Internet for Android"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/Whale/i],describe:function(e){var t={name:"NAVER Whale Browser"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/MZBrowser/i],describe:function(e){var t={name:"MZ Browser"},e=n.default.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/focus/i],describe:function(e){var t={name:"Focus"},e=n.default.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/swing/i],describe:function(e){var t={name:"Swing"},e=n.default.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/coast/i],describe:function(e){var t={name:"Opera Coast"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe:function(e){var t={name:"Opera Touch"},e=n.default.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/yabrowser/i],describe:function(e){var t={name:"Yandex Browser"},e=n.default.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/ucbrowser/i],describe:function(e){var t={name:"UC Browser"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/Maxthon|mxios/i],describe:function(e){var t={name:"Maxthon"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/epiphany/i],describe:function(e){var t={name:"Epiphany"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/puffin/i],describe:function(e){var t={name:"Puffin"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/sleipnir/i],describe:function(e){var t={name:"Sleipnir"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/k-meleon/i],describe:function(e){var t={name:"K-Meleon"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/micromessenger/i],describe:function(e){var t={name:"WeChat"},e=n.default.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/qqbrowser/i],describe:function(e){var t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},e=n.default.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/msie|trident/i],describe:function(e){var t={name:"Internet Explorer"},e=n.default.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/\sedg\//i],describe:function(e){var t={name:"Microsoft Edge"},e=n.default.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/edg([ea]|ios)/i],describe:function(e){var t={name:"Microsoft Edge"},e=n.default.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/vivaldi/i],describe:function(e){var t={name:"Vivaldi"},e=n.default.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/seamonkey/i],describe:function(e){var t={name:"SeaMonkey"},e=n.default.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/sailfish/i],describe:function(e){var t={name:"Sailfish"},e=n.default.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return e&&(t.version=e),t}},{test:[/silk/i],describe:function(e){var t={name:"Amazon Silk"},e=n.default.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/phantom/i],describe:function(e){var t={name:"PhantomJS"},e=n.default.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/slimerjs/i],describe:function(e){var t={name:"SlimerJS"},e=n.default.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){var t={name:"BlackBerry"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var t={name:"WebOS Browser"},e=n.default.getFirstMatch(a,e)||n.default.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/bada/i],describe:function(e){var t={name:"Bada"},e=n.default.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/tizen/i],describe:function(e){var t={name:"Tizen"},e=n.default.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/qupzilla/i],describe:function(e){var t={name:"QupZilla"},e=n.default.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/firefox|iceweasel|fxios/i],describe:function(e){var t={name:"Firefox"},e=n.default.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/electron/i],describe:function(e){var t={name:"Electron"},e=n.default.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/MiuiBrowser/i],describe:function(e){var t={name:"Miui"},e=n.default.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/chromium/i],describe:function(e){var t={name:"Chromium"},e=n.default.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/chrome|crios|crmo/i],describe:function(e){var t={name:"Chrome"},e=n.default.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/GSA/i],describe:function(e){var t={name:"Google Search"},e=n.default.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:function(e){var t=!e.test(/like android/i),e=e.test(/android/i);return t&&e},describe:function(e){var t={name:"Android Browser"},e=n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/playstation 4/i],describe:function(e){var t={name:"PlayStation 4"},e=n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/safari|applewebkit/i],describe:function(e){var t={name:"Safari"},e=n.default.getFirstMatch(a,e);return e&&(t.version=e),t}},{test:[/.*/i],describe:function(e){var t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:n.default.getFirstMatch(t,e),version:n.default.getSecondMatch(t,e)}}}],e.exports=t.default},93:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=r(18);t.default=[{test:[/Roku\/DVP/],describe:function(e){e=a.default.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:i.OS_MAP.Roku,version:e}}},{test:[/windows phone/i],describe:function(e){e=a.default.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.WindowsPhone,version:e}}},{test:[/windows /i],describe:function(e){var e=a.default.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),t=a.default.getWindowsVersionName(e);return{name:i.OS_MAP.Windows,version:e,versionName:t}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(e){var t={name:i.OS_MAP.iOS},e=a.default.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return e&&(t.version=e),t}},{test:[/macintosh/i],describe:function(e){var e=a.default.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),t=a.default.getMacOSVersionName(e),e={name:i.OS_MAP.MacOS,version:e};return t&&(e.versionName=t),e}},{test:[/(ipod|iphone|ipad)/i],describe:function(e){e=a.default.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:i.OS_MAP.iOS,version:e}}},{test:function(e){var t=!e.test(/like android/i),e=e.test(/android/i);return t&&e},describe:function(e){var e=a.default.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),t=a.default.getAndroidVersionName(e),e={name:i.OS_MAP.Android,version:e};return t&&(e.versionName=t),e}},{test:[/(web|hpw)[o0]s/i],describe:function(e){var e=a.default.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),t={name:i.OS_MAP.WebOS};return e&&e.length&&(t.version=e),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe:function(e){e=a.default.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||a.default.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||a.default.getFirstMatch(/\bbb(\d+)/i,e);return{name:i.OS_MAP.BlackBerry,version:e}}},{test:[/bada/i],describe:function(e){e=a.default.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Bada,version:e}}},{test:[/tizen/i],describe:function(e){e=a.default.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.Tizen,version:e}}},{test:[/linux/i],describe:function(){return{name:i.OS_MAP.Linux}}},{test:[/CrOS/],describe:function(){return{name:i.OS_MAP.ChromeOS}}},{test:[/PlayStation 4/],describe:function(e){e=a.default.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:i.OS_MAP.PlayStation4,version:e}}}],e.exports=t.default},94:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=r(18);t.default=[{test:[/googlebot/i],describe:function(){return{type:"bot",vendor:"Google"}}},{test:[/huawei/i],describe:function(e){var e=a.default.getFirstMatch(/(can-l01)/i,e)&&"Nova",t={type:i.PLATFORMS_MAP.mobile,vendor:"Huawei"};return e&&(t.model=e),t}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Nexus"}}},{test:[/ipad/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Apple",model:"iPad"}}},{test:[/kftt build/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"}}},{test:[/silk/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet,vendor:"Amazon"}}},{test:[/tablet(?! pc)/i],describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){var t=e.test(/ipod|iphone/i),e=e.test(/like (ipod|iphone)/i);return t&&!e},describe:function(e){e=a.default.getFirstMatch(/(ipod|iphone)/i,e);return{type:i.PLATFORMS_MAP.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Nexus"}}},{test:[/[^-]mobi/i],describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"blackberry"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"BlackBerry"}}},{test:function(e){return"bada"===e.getBrowserName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"windows phone"===e.getBrowserName()},describe:function(){return{type:i.PLATFORMS_MAP.mobile,vendor:"Microsoft"}}},{test:function(e){var t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&3<=t},describe:function(){return{type:i.PLATFORMS_MAP.tablet}}},{test:function(e){return"android"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.mobile}}},{test:function(e){return"macos"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop,vendor:"Apple"}}},{test:function(e){return"windows"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"linux"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.desktop}}},{test:function(e){return"playstation 4"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}},{test:function(e){return"roku"===e.getOSName(!0)},describe:function(){return{type:i.PLATFORMS_MAP.tv}}}],e.exports=t.default},95:function(e,t,r){t.__esModule=!0,t.default=void 0;var n,a=(n=r(17))&&n.__esModule?n:{default:n},i=r(18);t.default=[{test:function(e){return"microsoft edge"===e.getBrowserName(!0)},describe:function(e){return/\sedg\//i.test(e)?{name:i.ENGINE_MAP.Blink}:(e=a.default.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e),{name:i.ENGINE_MAP.EdgeHTML,version:e})}},{test:[/trident/i],describe:function(e){var t={name:i.ENGINE_MAP.Trident},e=a.default.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:function(e){return e.test(/presto/i)},describe:function(e){var t={name:i.ENGINE_MAP.Presto},e=a.default.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:function(e){var t=e.test(/gecko/i),e=e.test(/like gecko/i);return t&&!e},describe:function(e){var t={name:i.ENGINE_MAP.Gecko},e=a.default.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}},{test:[/(apple)?webkit\/537\.36/i],describe:function(){return{name:i.ENGINE_MAP.Blink}}},{test:[/(apple)?webkit/i],describe:function(e){var t={name:i.ENGINE_MAP.WebKit},e=a.default.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return e&&(t.version=e),t}}],e.exports=t.default}},si={},ci.m=ii,ci.c=si,ci.d=function(e,t,r){ci.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},ci.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},ci.t=function(t,e){if(1&e&&(t=ci(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(ci.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)ci.d(r,n,function(e){return t[e]}.bind(null,n));return r},ci.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return ci.d(t,"a",t),t},ci.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},ci.p="";var di=B(t.exports=ci(ci.s=90)),i={},r=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(i,"__esModule",{value:!0}),i.Logger=void 0;const pi=r(n.exports),li="mediasoup-client";i.Logger=class{constructor(e){e?(this._debug=(0,pi.default)(li+":"+e),this._warn=(0,pi.default)(li+":WARN:"+e),this._error=(0,pi.default)(li+":ERROR:"+e)):(this._debug=(0,pi.default)(li),this._warn=(0,pi.default)(li+":WARN"),this._error=(0,pi.default)(li+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}};var s={};function ui(){}function o(){o.init.call(this)}function hi(e){return void 0===e._maxListeners?o.defaultMaxListeners:e._maxListeners}function mi(e,t,r,n){var a,i;if("function"!=typeof r)throw new TypeError('"listener" argument must be a function');return(a=e._events)?(a.newListener&&(e.emit("newListener",t,r.listener||r),a=e._events),i=a[t]):(a=e._events=new ui,e._eventsCount=0),i?("function"==typeof i?i=a[t]=n?[r,i]:[i,r]:n?i.unshift(r):i.push(r),i.warned||(n=hi(e))&&0<n&&i.length>n&&(i.warned=!0,(n=new Error("Possible EventEmitter memory leak detected. "+i.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",n.emitter=e,n.type=t,n.count=i.length,n=n,"function"==typeof console.warn?console.warn(n):console.log(n))):(i=a[t]=r,++e._eventsCount),e}function fi(e,t,r){var n=!1;function a(){e.removeListener(t,a),n||(n=!0,r.apply(e,arguments))}return a.listener=r,a}function gi(e){var t=this._events;if(t){t=t[e];if("function"==typeof t)return 1;if(t)return t.length}return 0}function _i(e,t){for(var r=new Array(t);t--;)r[t]=e[t];return r}ui.prototype=Object.create(null),(o.EventEmitter=o).usingDomains=!1,o.prototype.domain=void 0,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.init=function(){this.domain=null,o.usingDomains&&(void 0).active,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new ui,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},o.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},o.prototype.getMaxListeners=function(){return hi(this)},o.prototype.emit=function(e){var t,r,n,a="error"===e,i=this._events;if(i)a=a&&null==i.error;else if(!a)return!1;if(s=this.domain,a){var s,a=arguments[1];if(s)return(a=a||new Error('Uncaught, unspecified "error" event')).domainEmitter=this,a.domain=s,a.domainThrown=!1,s.emit("error",a),!1;throw a instanceof Error?a:((s=new Error('Uncaught, unspecified "error" event. ('+a+")")).context=a,s)}if(!(t=i[e]))return!1;var o,c="function"==typeof t;switch(o=arguments.length){case 1:var d=t,p=c,l=this;if(p)d.call(l);else for(var u=d.length,j=_i(d,u),h=0;h<u;++h)j[h].call(l);break;case 2:var p=t,d=c,m=this,f=arguments[1];if(d)p.call(m,f);else for(var g=p.length,N=_i(p,g),_=0;_<g;++_)N[_].call(m,f);break;case 3:var v=t,y=c,w=this,b=arguments[1],S=arguments[2];if(y)v.call(w,b,S);else for(var P=v.length,A=_i(v,P),R=0;R<P;++R)A[R].call(w,b,S);break;case 4:var y=t,v=c,C=this,T=arguments[1],D=arguments[2],k=arguments[3];if(v)y.call(C,T,D,k);else for(var x=y.length,V=_i(y,x),E=0;E<x;++E)V[E].call(C,T,D,k);break;default:for(r=new Array(o-1),n=1;n<o;n++)r[n-1]=arguments[n];var O=t,F=c,M=this,I=r;if(F)O.apply(M,I);else for(var B=O.length,U=_i(O,B),L=0;L<B;++L)U[L].apply(M,I)}return!0},o.prototype.on=o.prototype.addListener=function(e,t){return mi(this,e,t,!1)},o.prototype.prependListener=function(e,t){return mi(this,e,t,!0)},o.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,fi(this,e,t)),this},o.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,fi(this,e,t)),this},o.prototype.removeListener=function(e,t){var r,n,a,i,s;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if((n=this._events)&&(r=n[e]))if(r===t||r.listener&&r.listener===t)0==--this._eventsCount?this._events=new ui:(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(a=-1,i=r.length;0<i--;)if(r[i]===t||r[i].listener&&r[i].listener===t){s=r[i].listener,a=i;break}if(a<0)return this;if(1===r.length){if(r[0]=void 0,0==--this._eventsCount)return this._events=new ui,this;delete n[e]}else{for(var o=r,c=a,d=c+1,p=o.length;d<p;c+=1,d+=1)o[c]=o[d];o.pop()}n.removeListener&&this.emit("removeListener",e,s||t)}return this},o.prototype.removeAllListeners=function(e){var t,r=this._events;if(r)if(r.removeListener){if(0===arguments.length){for(var n,a=Object.keys(r),i=0;i<a.length;++i)"removeListener"!==(n=a[i])&&this.removeAllListeners(n);this.removeAllListeners("removeListener"),this._events=new ui,this._eventsCount=0}else if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(t)for(;this.removeListener(e,t[t.length-1]),t[0];);}else 0===arguments.length?(this._events=new ui,this._eventsCount=0):r[e]&&(0==--this._eventsCount?this._events=new ui:delete r[e]);return this},o.prototype.listeners=function(e){var t=this._events,e=t&&(t=t[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(t):[];return e},o.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):gi.call(e,t)},o.prototype.listenerCount=gi,o.prototype.eventNames=function(){return 0<this._eventsCount?Reflect.ownKeys(this._events):[]};ce=U(Object.freeze({__proto__:null,default:o,EventEmitter:o})),Object.defineProperty(s,"__esModule",{value:!0}),s.EnhancedEventEmitter=void 0,a=ce;const vi=new i.Logger("EnhancedEventEmitter");class yi extends a.EventEmitter{constructor(){super(),this.setMaxListeners(1/0)}emit(e,...t){return super.emit(e,...t)}safeEmit(t,...e){var r=super.listenerCount(t);try{return super.emit(t,...e)}catch(e){return vi.error("safeEmit() | event listener threw an error [eventName:%s]:%o",t,e),Boolean(r)}}on(e,t){return super.on(e,t),this}off(e,t){return super.off(e,t),this}addListener(e,t){return super.on(e,t),this}prependListener(e,t){return super.prependListener(e,t),this}once(e,t){return super.once(e,t),this}prependOnceListener(e,t){return super.prependOnceListener(e,t),this}removeListener(e,t){return super.off(e,t),this}removeAllListeners(e){return super.removeAllListeners(e),this}listenerCount(e){return super.listenerCount(e)}listeners(e){return super.listeners(e)}rawListeners(e){return super.rawListeners(e)}}s.EnhancedEventEmitter=yi;r={};Object.defineProperty(r,"__esModule",{value:!0}),r.InvalidStateError=r.UnsupportedError=void 0;class wi extends Error{constructor(e){super(e),this.name="UnsupportedError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,wi):this.stack=new Error(e).stack}}r.UnsupportedError=wi;class bi extends Error{constructor(e){super(e),this.name="InvalidStateError",Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(this,bi):this.stack=new Error(e).stack}}r.InvalidStateError=bi;a={};Object.defineProperty(a,"__esModule",{value:!0}),a.generateRandomNumber=a.clone=void 0,a.clone=function(e,t){return void 0===e?t:JSON.parse(JSON.stringify(e))},a.generateRandomNumber=function(){return Math.round(1e7*Math.random())};var c={},Si={};{var d=Si;const Im=n.exports("h264-profile-level-id"),Lm=(Im.log=console.info.bind(console),d.ProfileConstrainedBaseline=1,d.ProfileBaseline=2,d.ProfileMain=3,d.ProfileConstrainedHigh=4,d.ProfileHigh=5,0),jm=10;d.Level1_b=Lm,d.Level1=jm,d.Level1_1=11,d.Level1_2=12,d.Level1_3=13,d.Level2=20,d.Level2_1=21,d.Level2_2=22,d.Level3=30,d.Level3_1=31,d.Level3_2=32,d.Level4=40,d.Level4_1=41,d.Level4_2=42,d.Level5=50,d.Level5_1=51,d.Level5_2=52;class Nm{constructor(e,t){this.profile=e,this.level=t}}const Am=new(d.ProfileLevelId=Nm)(1,31);class Vm{constructor(e){this._mask=~Pi("x",e),this._maskedValue=Pi("1",e)}isMatch(e){return this._maskedValue===(e&this._mask)}}class Fm{constructor(e,t,r){this.profile_idc=e,this.profile_iop=t,this.profile=r}}const Bm=[new Fm(66,new Vm("x1xx0000"),1),new Fm(77,new Vm("1xxx0000"),1),new Fm(88,new Vm("11xx0000"),1),new Fm(66,new Vm("x0xx0000"),2),new Fm(88,new Vm("10xx0000"),2),new Fm(77,new Vm("0x0x0000"),3),new Fm(100,new Vm("00000000"),5),new Fm(100,new Vm("00001100"),4)];function Pi(e,t){return(t[0]===e)<<7|(t[1]===e)<<6|(t[2]===e)<<5|(t[3]===e)<<4|(t[4]===e)<<3|(t[5]===e)<<2|(t[6]===e)<<1|(t[7]===e)<<0}function Ri(e={}){e=e["level-asymmetry-allowed"];return 1===e||"1"===e}d.parseProfileLevelId=function(t){if("string"==typeof t&&6===t.length){t=parseInt(t,16);if(0!==t){var r=255&t,n=t>>8&255,a=t>>16&255;let e;switch(r){case 11:e=0!=(16&n)?Lm:11;break;case jm:case 12:case 13:case 20:case 21:case 22:case 30:case 31:case 32:case 40:case 41:case 42:case 50:case 51:case 52:e=r;break;default:return Im("parseProfileLevelId() | unrecognized level_idc:%s",r),null}for(const i of Bm)if(a===i.profile_idc&&i.profile_iop.isMatch(n))return new Nm(i.profile,e);Im("parseProfileLevelId() | unrecognized profile_idc/profile_iop combination")}}return null},d.profileLevelIdToString=function(e){if(e.level==Lm)switch(e.profile){case 1:return"42f00b";case 2:return"42100b";case 3:return"4d100b";default:return Im("profileLevelIdToString() | Level 1_b not is allowed for profile:%s",e.profile),null}let t;switch(e.profile){case 1:t="42e0";break;case 2:t="4200";break;case 3:t="4d00";break;case 4:t="640c";break;case 5:t="6400";break;default:return Im("profileLevelIdToString() | unrecognized profile:%s",e.profile),null}let r=e.level.toString(16);return 1===r.length&&(r="0"+r),""+t+r},d.parseSdpProfileLevelId=function(e={}){e=e["profile-level-id"];return e?d.parseProfileLevelId(e):Am},d.isSameProfile=function(e={},t={}){e=d.parseSdpProfileLevelId(e),t=d.parseSdpProfileLevelId(t);return Boolean(e&&t&&e.profile===t.profile)},d.generateProfileLevelIdForAnswer=function(e={},t={}){if(!e["profile-level-id"]&&!t["profile-level-id"])return Im("generateProfileLevelIdForAnswer() | no profile-level-id in local and remote params"),null;var r=d.parseSdpProfileLevelId(e),n=d.parseSdpProfileLevelId(t);if(!r)throw new TypeError("invalid local_profile_level_id");if(!n)throw new TypeError("invalid remote_profile_level_id");if(r.profile!==n.profile)throw new TypeError("H264 Profile mismatch");var e=Ri(e)&&Ri(t),t=r.level,n=n.level,a=function(e,t){return e===Lm?t!==jm&&t!==Lm:t===Lm?e!==jm:e<t}(a=t,n=n)?a:n,n=e?t:a;return Im("generateProfileLevelIdForAnswer() | result: [profile:%s, level:%s]",r.profile,n),d.profileLevelIdToString(new Nm(r.profile,n))}}var Ci=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Ti=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),p=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ci(t,e,r);return Ti(t,e),t};Object.defineProperty(c,"__esModule",{value:!0}),c.canReceive=c.canSend=c.generateProbatorRtpParameters=c.reduceCodecs=c.getSendingRemoteRtpParameters=c.getSendingRtpParameters=c.getRecvRtpCapabilities=c.getExtendedRtpCapabilities=c.validateSctpStreamParameters=c.validateSctpParameters=c.validateNumSctpStreams=c.validateSctpCapabilities=c.validateRtcpParameters=c.validateRtpEncodingParameters=c.validateRtpHeaderExtensionParameters=c.validateRtpCodecParameters=c.validateRtpParameters=c.validateRtpHeaderExtension=c.validateRtcpFeedback=c.validateRtpCodecCapability=c.validateRtpCapabilities=void 0;const Di=p(Si),ki=p(a);function xi(t){var e=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof t)throw new TypeError("codec is not an object");if(!t.mimeType||"string"!=typeof t.mimeType)throw new TypeError("missing codec.mimeType");e=e.exec(t.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");if(t.kind=e[1].toLowerCase(),t.preferredPayloadType&&"number"!=typeof t.preferredPayloadType)throw new TypeError("invalid codec.preferredPayloadType");if("number"!=typeof t.clockRate)throw new TypeError("missing codec.clockRate");"audio"===t.kind?"number"!=typeof t.channels&&(t.channels=1):delete t.channels,t.parameters&&"object"==typeof t.parameters||(t.parameters={});for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(void 0===e&&(t.parameters[r]="",e=""),"string"!=typeof e&&"number"!=typeof e)throw new TypeError(`invalid codec parameter [key:${r}s, value:${e}]`);if("apt"===r&&"number"!=typeof e)throw new TypeError("invalid codec apt parameter")}t.rtcpFeedback&&Array.isArray(t.rtcpFeedback)||(t.rtcpFeedback=[]);for(const n of t.rtcpFeedback)Ei(n)}function Ei(e){if("object"!=typeof e)throw new TypeError("fb is not an object");if(!e.type||"string"!=typeof e.type)throw new TypeError("missing fb.type");e.parameter&&"string"==typeof e.parameter||(e.parameter="")}function Oi(e){if("object"!=typeof e)throw new TypeError("ext is not an object");if("audio"!==e.kind&&"video"!==e.kind)throw new TypeError("invalid ext.kind");if(!e.uri||"string"!=typeof e.uri)throw new TypeError("missing ext.uri");if("number"!=typeof e.preferredId)throw new TypeError("missing ext.preferredId");if(e.preferredEncrypt&&"boolean"!=typeof e.preferredEncrypt)throw new TypeError("invalid ext.preferredEncrypt");if(e.preferredEncrypt||(e.preferredEncrypt=!1),e.direction&&"string"!=typeof e.direction)throw new TypeError("invalid ext.direction");e.direction||(e.direction="sendrecv")}function Mi(e){if("object"!=typeof e)throw new TypeError("params is not an object");if(e.mid&&"string"!=typeof e.mid)throw new TypeError("params.mid is not a string");if(!Array.isArray(e.codecs))throw new TypeError("missing params.codecs");for(const t of e.codecs)Ii(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("params.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const r of e.headerExtensions)Li(r);if(e.encodings&&!Array.isArray(e.encodings))throw new TypeError("params.encodings is not an array");e.encodings||(e.encodings=[]);for(const n of e.encodings)ji(n);if(e.rtcp&&"object"!=typeof e.rtcp)throw new TypeError("params.rtcp is not an object");e.rtcp||(e.rtcp={}),Ni(e.rtcp)}function Ii(t){var e=new RegExp("^(audio|video)/(.+)","i");if("object"!=typeof t)throw new TypeError("codec is not an object");if(!t.mimeType||"string"!=typeof t.mimeType)throw new TypeError("missing codec.mimeType");e=e.exec(t.mimeType);if(!e)throw new TypeError("invalid codec.mimeType");if("number"!=typeof t.payloadType)throw new TypeError("missing codec.payloadType");if("number"!=typeof t.clockRate)throw new TypeError("missing codec.clockRate");"audio"===e[1].toLowerCase()?"number"!=typeof t.channels&&(t.channels=1):delete t.channels,t.parameters&&"object"==typeof t.parameters||(t.parameters={});for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(void 0===e&&(t.parameters[r]="",e=""),"string"!=typeof e&&"number"!=typeof e)throw new TypeError(`invalid codec parameter [key:${r}s, value:${e}]`);if("apt"===r&&"number"!=typeof e)throw new TypeError("invalid codec apt parameter")}t.rtcpFeedback&&Array.isArray(t.rtcpFeedback)||(t.rtcpFeedback=[]);for(const n of t.rtcpFeedback)Ei(n)}function Li(t){if("object"!=typeof t)throw new TypeError("ext is not an object");if(!t.uri||"string"!=typeof t.uri)throw new TypeError("missing ext.uri");if("number"!=typeof t.id)throw new TypeError("missing ext.id");if(t.encrypt&&"boolean"!=typeof t.encrypt)throw new TypeError("invalid ext.encrypt");t.encrypt||(t.encrypt=!1),t.parameters&&"object"==typeof t.parameters||(t.parameters={});for(const r of Object.keys(t.parameters)){let e=t.parameters[r];if(void 0===e&&(t.parameters[r]="",e=""),"string"!=typeof e&&"number"!=typeof e)throw new TypeError("invalid header extension parameter")}}function ji(e){if("object"!=typeof e)throw new TypeError("encoding is not an object");if(e.ssrc&&"number"!=typeof e.ssrc)throw new TypeError("invalid encoding.ssrc");if(e.rid&&"string"!=typeof e.rid)throw new TypeError("invalid encoding.rid");if(e.rtx&&"object"!=typeof e.rtx)throw new TypeError("invalid encoding.rtx");if(e.rtx&&"number"!=typeof e.rtx.ssrc)throw new TypeError("missing encoding.rtx.ssrc");if(e.dtx&&"boolean"==typeof e.dtx||(e.dtx=!1),e.scalabilityMode&&"string"!=typeof e.scalabilityMode)throw new TypeError("invalid encoding.scalabilityMode")}function Ni(e){if("object"!=typeof e)throw new TypeError("rtcp is not an object");if(e.cname&&"string"!=typeof e.cname)throw new TypeError("invalid rtcp.cname");e.reducedSize&&"boolean"==typeof e.reducedSize||(e.reducedSize=!0)}function Ai(e){if("object"!=typeof e)throw new TypeError("numStreams is not an object");if("number"!=typeof e.OS)throw new TypeError("missing numStreams.OS");if("number"!=typeof e.MIS)throw new TypeError("missing numStreams.MIS")}function Vi(e){return!!e&&/.+\/rtx$/i.test(e.mimeType)}function Fi(t,r,{strict:e=!1,modify:n=!1}={}){var a=t.mimeType.toLowerCase();if(a!==r.mimeType.toLowerCase())return!1;if(t.clockRate!==r.clockRate)return!1;if(t.channels!==r.channels)return!1;switch(a){case"video/h264":if(e){if((t.parameters["packetization-mode"]||0)!==(r.parameters["packetization-mode"]||0))return!1;if(!Di.isSameProfile(t.parameters,r.parameters))return!1;let e;try{e=Di.generateProfileLevelIdForAnswer(t.parameters,r.parameters)}catch(e){return!1}n&&(e?(t.parameters["profile-level-id"]=e,r.parameters["profile-level-id"]=e):(delete t.parameters["profile-level-id"],delete r.parameters["profile-level-id"]))}break;case"video/vp9":if(e)if((t.parameters["profile-id"]||0)!==(r.parameters["profile-id"]||0))return!1}return!0}c.validateRtpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(e.codecs&&!Array.isArray(e.codecs))throw new TypeError("caps.codecs is not an array");e.codecs||(e.codecs=[]);for(const t of e.codecs)xi(t);if(e.headerExtensions&&!Array.isArray(e.headerExtensions))throw new TypeError("caps.headerExtensions is not an array");e.headerExtensions||(e.headerExtensions=[]);for(const r of e.headerExtensions)Oi(r)},c.validateRtpCodecCapability=xi,c.validateRtcpFeedback=Ei,c.validateRtpHeaderExtension=Oi,c.validateRtpParameters=Mi,c.validateRtpCodecParameters=Ii,c.validateRtpHeaderExtensionParameters=Li,c.validateRtpEncodingParameters=ji,c.validateRtcpParameters=Ni,c.validateSctpCapabilities=function(e){if("object"!=typeof e)throw new TypeError("caps is not an object");if(!e.numStreams||"object"!=typeof e.numStreams)throw new TypeError("missing caps.numStreams");Ai(e.numStreams)},c.validateNumSctpStreams=Ai,c.validateSctpParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.port)throw new TypeError("missing params.port");if("number"!=typeof e.OS)throw new TypeError("missing params.OS");if("number"!=typeof e.MIS)throw new TypeError("missing params.MIS");if("number"!=typeof e.maxMessageSize)throw new TypeError("missing params.maxMessageSize")},c.validateSctpStreamParameters=function(e){if("object"!=typeof e)throw new TypeError("params is not an object");if("number"!=typeof e.streamId)throw new TypeError("missing params.streamId");let t=!1;if("boolean"==typeof e.ordered?t=!0:e.ordered=!0,e.maxPacketLifeTime&&"number"!=typeof e.maxPacketLifeTime)throw new TypeError("invalid params.maxPacketLifeTime");if(e.maxRetransmits&&"number"!=typeof e.maxRetransmits)throw new TypeError("invalid params.maxRetransmits");if(e.maxPacketLifeTime&&e.maxRetransmits)throw new TypeError("cannot provide both maxPacketLifeTime and maxRetransmits");if(t&&e.ordered&&(e.maxPacketLifeTime||e.maxRetransmits))throw new TypeError("cannot be ordered with maxPacketLifeTime or maxRetransmits");if(t||!e.maxPacketLifeTime&&!e.maxRetransmits||(e.ordered=!1),e.label&&"string"!=typeof e.label)throw new TypeError("invalid params.label");if(e.protocol&&"string"!=typeof e.protocol)throw new TypeError("invalid params.protocol")},c.getExtendedRtpCapabilities=function(e,t){var r,n={codecs:[],headerExtensions:[]};for(const c of t.codecs||[])Vi(c)||(r=(e.codecs||[]).find(e=>Fi(e,c,{strict:!0,modify:!0})))&&(r={mimeType:r.mimeType,kind:r.kind,clockRate:r.clockRate,channels:r.channels,localPayloadType:r.preferredPayloadType,localRtxPayloadType:void 0,remotePayloadType:c.preferredPayloadType,remoteRtxPayloadType:void 0,localParameters:r.parameters,remoteParameters:c.parameters,rtcpFeedback:function(e,t){var r=[];for(const a of e.rtcpFeedback||[]){var n=(t.rtcpFeedback||[]).find(e=>e.type===a.type&&(e.parameter===a.parameter||!e.parameter&&!a.parameter));n&&r.push(n)}return r}(r,c)},n.codecs.push(r));for(const d of n.codecs){var a=e.codecs.find(e=>Vi(e)&&e.parameters.apt===d.localPayloadType),i=t.codecs.find(e=>Vi(e)&&e.parameters.apt===d.remotePayloadType);a&&i&&(d.localRtxPayloadType=a.preferredPayloadType,d.remoteRtxPayloadType=i.preferredPayloadType)}for(const p of t.headerExtensions){var s=e.headerExtensions.find(e=>{return e=e,t=p,!(e.kind&&t.kind&&e.kind!==t.kind||e.uri!==t.uri);var t});if(s){var o={kind:p.kind,uri:p.uri,sendId:s.preferredId,recvId:p.preferredId,encrypt:s.preferredEncrypt,direction:"sendrecv"};switch(p.direction){case"sendrecv":o.direction="sendrecv";break;case"recvonly":o.direction="sendonly";break;case"sendonly":o.direction="recvonly";break;case"inactive":o.direction="inactive"}n.headerExtensions.push(o)}}return n},c.getRecvRtpCapabilities=function(e){var t,r={codecs:[],headerExtensions:[]};for(const a of e.codecs){var n={mimeType:a.mimeType,kind:a.kind,preferredPayloadType:a.remotePayloadType,clockRate:a.clockRate,channels:a.channels,parameters:a.localParameters,rtcpFeedback:a.rtcpFeedback};r.codecs.push(n),a.remoteRtxPayloadType&&(n={mimeType:a.kind+"/rtx",kind:a.kind,preferredPayloadType:a.remoteRtxPayloadType,clockRate:a.clockRate,parameters:{apt:a.remotePayloadType},rtcpFeedback:[]},r.codecs.push(n))}for(const i of e.headerExtensions)"sendrecv"!==i.direction&&"recvonly"!==i.direction||(t={kind:i.kind,uri:i.uri,preferredId:i.recvId,preferredEncrypt:i.encrypt,direction:i.direction},r.headerExtensions.push(t));return r},c.getSendingRtpParameters=function(e,t){var r,n,a={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const i of t.codecs)i.kind===e&&(r={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.localParameters,rtcpFeedback:i.rtcpFeedback},a.codecs.push(r),i.localRtxPayloadType)&&(r={mimeType:i.kind+"/rtx",payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]},a.codecs.push(r));for(const s of t.headerExtensions)s.kind&&s.kind!==e||"sendrecv"!==s.direction&&"sendonly"!==s.direction||(n={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}},a.headerExtensions.push(n));return a},c.getSendingRemoteRtpParameters=function(e,t){var r,n,a={mid:void 0,codecs:[],headerExtensions:[],encodings:[],rtcp:{}};for(const i of t.codecs)i.kind===e&&(r={mimeType:i.mimeType,payloadType:i.localPayloadType,clockRate:i.clockRate,channels:i.channels,parameters:i.remoteParameters,rtcpFeedback:i.rtcpFeedback},a.codecs.push(r),i.localRtxPayloadType)&&(r={mimeType:i.kind+"/rtx",payloadType:i.localRtxPayloadType,clockRate:i.clockRate,parameters:{apt:i.localPayloadType},rtcpFeedback:[]},a.codecs.push(r));for(const s of t.headerExtensions)s.kind&&s.kind!==e||"sendrecv"!==s.direction&&"sendonly"!==s.direction||(n={uri:s.uri,id:s.sendId,encrypt:s.encrypt,parameters:{}},a.headerExtensions.push(n));if(a.headerExtensions.some(e=>"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"===e.uri))for(const o of a.codecs)o.rtcpFeedback=(o.rtcpFeedback||[]).filter(e=>"goog-remb"!==e.type);else if(a.headerExtensions.some(e=>"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"===e.uri))for(const c of a.codecs)c.rtcpFeedback=(c.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type);else for(const d of a.codecs)d.rtcpFeedback=(d.rtcpFeedback||[]).filter(e=>"transport-cc"!==e.type&&"goog-remb"!==e.type);return a},c.reduceCodecs=function(t,r){var n=[];if(r){for(let e=0;e<t.length;++e)if(Fi(t[e],r)){n.push(t[e]),Vi(t[e+1])&&n.push(t[e+1]);break}if(0===n.length)throw new TypeError("no matching codec found")}else n.push(t[0]),Vi(t[1])&&n.push(t[1]);return n},c.generateProbatorRtpParameters=function(e){Mi(e=ki.clone(e,{}));var t={mid:"probator",codecs:[],headerExtensions:[],encodings:[{ssrc:1234}],rtcp:{cname:"probator"}};return t.codecs.push(e.codecs[0]),t.codecs[0].payloadType=127,t.headerExtensions=e.headerExtensions,t},c.canSend=function(t,e){return e.codecs.some(e=>e.kind===t)},c.canReceive=function(e,t){if(Mi(e),0===e.codecs.length)return!1;const r=e.codecs[0];return t.codecs.some(e=>e.remotePayloadType===r.payloadType)};var Si={},p={},Bi={},Ui=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.Logger=void 0;const zi=Ui(n.exports),Hi="awaitqueue";Bi.Logger=class{constructor(e){e?(this._debug=(0,zi.default)(Hi+":"+e),this._warn=(0,zi.default)(Hi+":WARN:"+e),this._error=(0,zi.default)(Hi+":ERROR:"+e)):(this._debug=(0,zi.default)(Hi),this._warn=(0,zi.default)(Hi+":WARN"),this._error=(0,zi.default)(Hi+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}},Object.defineProperty(p,"__esModule",{value:!0}),p.AwaitQueue=p.AwaitQueueRemovedTaskError=p.AwaitQueueStoppedError=void 0;const Gi=new Bi.Logger;class $i extends Error{constructor(e){super(null!=e?e:"AwaitQueue stopped"),this.name="AwaitQueueStoppedError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,$i)}}p.AwaitQueueStoppedError=$i;class Ji extends Error{constructor(e){super(null!=e?e:"AwaitQueue task removed"),this.name="AwaitQueueRemovedTaskError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,Ji)}}p.AwaitQueueRemovedTaskError=Ji;p.AwaitQueue=class{constructor(){this.pendingTasks=new Map,this.nextTaskId=0,this.stopping=!1}get size(){return this.pendingTasks.size}async push(e,a){if(a=null!=a?a:e.name,Gi.debug(`push() [name:${a}]`),"function"!=typeof e)throw new TypeError("given task is not a function");if(a)try{Object.defineProperty(e,"name",{value:a})}catch(e){}return new Promise((t,r)=>{const n={id:this.nextTaskId++,task:e,name:a,enqueuedAt:Date.now(),executedAt:void 0,completed:!1,resolve:e=>{n.completed||(n.completed=!0,this.pendingTasks.delete(n.id),Gi.debug(`resolving task [name:${n.name}]`),t(e),[e]=this.pendingTasks.values(),e&&!e.executedAt&&this.execute(e))},reject:e=>{n.completed||(n.completed=!0,this.pendingTasks.delete(n.id),Gi.debug(`rejecting task [name:${n.name}]: %s`,String(e)),r(e),this.stopping)||([e]=this.pendingTasks.values(),e&&!e.executedAt&&this.execute(e))}};this.pendingTasks.set(n.id,n),1===this.pendingTasks.size&&this.execute(n)})}stop(){Gi.debug("stop()"),this.stopping=!0;for(const e of this.pendingTasks.values())Gi.debug(`stop() | stopping task [name:${e.name}]`),e.reject(new $i);this.stopping=!1}remove(e){Gi.debug(`remove() [taskIdx:${e}]`);var t=Array.from(this.pendingTasks.values())[e];t?t.reject(new Ji):Gi.debug(`stop() | no task with given idx [taskIdx:${e}]`)}dump(){const t=Date.now();let r=0;return Array.from(this.pendingTasks.values()).map(e=>({idx:r++,task:e.task,name:e.name,enqueuedTime:e.executedAt?e.executedAt-e.enqueuedAt:t-e.enqueuedAt,executionTime:e.executedAt?t-e.executedAt:0}))}async execute(t){if(Gi.debug(`execute() [name:${t.name}]`),t.executedAt)throw new Error("task already being executed");t.executedAt=Date.now();try{var e=await t.task();t.resolve(e)}catch(e){t.reject(e)}}};Ui={};Object.defineProperty(Ui,"__esModule",{value:!0}),Ui.Producer=void 0;const Wi=s,qi=r,Ki=new i.Logger("Producer");class Qi extends Wi.EnhancedEventEmitter{constructor({id:e,localId:t,rtpSender:r,track:n,rtpParameters:a,stopTracks:i,disableTrackOnPause:s,zeroRtpOnPause:o,appData:c}){super(),this._closed=!1,this._observer=new Wi.EnhancedEventEmitter,Ki.debug("constructor()"),this._id=e,this._localId=t,this._rtpSender=r,this._track=n,this._kind=n.kind,this._rtpParameters=a,this._paused=!!s&&!n.enabled,this._maxSpatialLayer=void 0,this._stopTracks=i,this._disableTrackOnPause=s,this._zeroRtpOnPause=o,this._appData=c||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get closed(){return this._closed}get kind(){return this._kind}get rtpSender(){return this._rtpSender}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get maxSpatialLayer(){return this._maxSpatialLayer}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(Ki.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Ki.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new qi.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){Ki.debug("pause()"),this._closed?Ki.error("pause() | Producer closed"):(this._paused=!0,this._track&&this._disableTrackOnPause&&(this._track.enabled=!1),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@pause",e,t)}).catch(()=>{}),this._observer.safeEmit("pause"))}resume(){Ki.debug("resume()"),this._closed?Ki.error("resume() | Producer closed"):(this._paused=!1,this._track&&this._disableTrackOnPause&&(this._track.enabled=!0),this._zeroRtpOnPause&&new Promise((e,t)=>{this.safeEmit("@resume",e,t)}).catch(()=>{}),this._observer.safeEmit("resume"))}async replaceTrack({track:r}){if(Ki.debug("replaceTrack() [track:%o]",r),this._closed){if(r&&this._stopTracks)try{r.stop()}catch(e){}throw new qi.InvalidStateError("closed")}if(r&&"ended"===r.readyState)throw new qi.InvalidStateError("track ended");r===this._track?Ki.debug("replaceTrack() | same track, ignored"):(await new Promise((e,t)=>{this.safeEmit("@replacetrack",r,e,t)}),this.destroyTrack(),this._track=r,this._track&&this._disableTrackOnPause&&(this._paused?this._paused&&(this._track.enabled=!1):this._track.enabled=!0),this.handleTrack())}async setMaxSpatialLayer(r){if(this._closed)throw new qi.InvalidStateError("closed");if("video"!==this._kind)throw new qi.UnsupportedError("not a video Producer");if("number"!=typeof r)throw new TypeError("invalid spatialLayer");r!==this._maxSpatialLayer&&(await new Promise((e,t)=>{this.safeEmit("@setmaxspatiallayer",r,e,t)}).catch(()=>{}),this._maxSpatialLayer=r)}async setRtpEncodingParameters(r){if(this._closed)throw new qi.InvalidStateError("closed");if("object"!=typeof r)throw new TypeError("invalid params");await new Promise((e,t)=>{this.safeEmit("@setrtpencodingparameters",r,e,t)})}onTrackEnded(){Ki.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track&&this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){if(this._track)try{this._track.removeEventListener("ended",this.onTrackEnded),this._stopTracks&&this._track.stop()}catch(e){}}}Ui.Producer=Qi;Bi={};Object.defineProperty(Bi,"__esModule",{value:!0}),Bi.Consumer=void 0;const Xi=s,Yi=r,Zi=new i.Logger("Consumer");class es extends Xi.EnhancedEventEmitter{constructor({id:e,localId:t,producerId:r,rtpReceiver:n,track:a,rtpParameters:i,appData:s}){super(),this._closed=!1,this._observer=new Xi.EnhancedEventEmitter,Zi.debug("constructor()"),this._id=e,this._localId=t,this._producerId=r,this._rtpReceiver=n,this._track=a,this._rtpParameters=i,this._paused=!a.enabled,this._appData=s||{},this.onTrackEnded=this.onTrackEnded.bind(this),this.handleTrack()}get id(){return this._id}get localId(){return this._localId}get producerId(){return this._producerId}get closed(){return this._closed}get kind(){return this._track.kind}get rtpReceiver(){return this._rtpReceiver}get track(){return this._track}get rtpParameters(){return this._rtpParameters}get paused(){return this._paused}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(Zi.debug("close()"),this._closed=!0,this.destroyTrack(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(Zi.debug("transportClosed()"),this._closed=!0,this.destroyTrack(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}async getStats(){if(this._closed)throw new Yi.InvalidStateError("closed");return new Promise((e,t)=>{this.safeEmit("@getstats",e,t)})}pause(){Zi.debug("pause()"),this._closed?Zi.error("pause() | Consumer closed"):this._paused?Zi.debug("pause() | Consumer is already paused"):(this._paused=!0,this._track.enabled=!1,this.emit("@pause"),this._observer.safeEmit("pause"))}resume(){Zi.debug("resume()"),this._closed?Zi.error("resume() | Consumer closed"):this._paused?(this._paused=!1,this._track.enabled=!0,this.emit("@resume"),this._observer.safeEmit("resume")):Zi.debug("resume() | Consumer is already resumed")}onTrackEnded(){Zi.debug('track "ended" event'),this.safeEmit("trackended"),this._observer.safeEmit("trackended")}handleTrack(){this._track.addEventListener("ended",this.onTrackEnded)}destroyTrack(){try{this._track.removeEventListener("ended",this.onTrackEnded),this._track.stop()}catch(e){}}}Bi.Consumer=es;var ts={};Object.defineProperty(ts,"__esModule",{value:!0}),ts.DataProducer=void 0;const rs=s,ns=r,as=new i.Logger("DataProducer");class is extends rs.EnhancedEventEmitter{constructor({id:e,dataChannel:t,sctpStreamParameters:r,appData:n}){super(),this._closed=!1,this._observer=new rs.EnhancedEventEmitter,as.debug("constructor()"),this._id=e,this._dataChannel=t,this._sctpStreamParameters=r,this._appData=n||{},this.handleDataChannel()}get id(){return this._id}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get bufferedAmount(){return this._dataChannel.bufferedAmount}get bufferedAmountLowThreshold(){return this._dataChannel.bufferedAmountLowThreshold}set bufferedAmountLowThreshold(e){this._dataChannel.bufferedAmountLowThreshold=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(as.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(as.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}send(e){if(as.debug("send()"),this._closed)throw new ns.InvalidStateError("closed");this._dataChannel.send(e)}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(as.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",t=>{if(!this._closed){let e=t["error"];"sctp-failure"===(e=e||new Error("unknown DataChannel error")).errorDetail?as.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.sctpCauseCode,e.message):as.error('DataChannel "error" event: %o',e),this.safeEmit("error",e)}}),this._dataChannel.addEventListener("close",()=>{this._closed||(as.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",()=>{this._closed||as.warn('DataChannel "message" event in a DataProducer, message discarded')}),this._dataChannel.addEventListener("bufferedamountlow",()=>{this._closed||this.safeEmit("bufferedamountlow")})}}ts.DataProducer=is;var ss={};Object.defineProperty(ss,"__esModule",{value:!0}),ss.DataConsumer=void 0;const os=s,cs=new i.Logger("DataConsumer");class ds extends os.EnhancedEventEmitter{constructor({id:e,dataProducerId:t,dataChannel:r,sctpStreamParameters:n,appData:a}){super(),this._closed=!1,this._observer=new os.EnhancedEventEmitter,cs.debug("constructor()"),this._id=e,this._dataProducerId=t,this._dataChannel=r,this._sctpStreamParameters=n,this._appData=a||{},this.handleDataChannel()}get id(){return this._id}get dataProducerId(){return this._dataProducerId}get closed(){return this._closed}get sctpStreamParameters(){return this._sctpStreamParameters}get readyState(){return this._dataChannel.readyState}get label(){return this._dataChannel.label}get protocol(){return this._dataChannel.protocol}get binaryType(){return this._dataChannel.binaryType}set binaryType(e){this._dataChannel.binaryType=e}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){this._closed||(cs.debug("close()"),this._closed=!0,this._dataChannel.close(),this.emit("@close"),this._observer.safeEmit("close"))}transportClosed(){this._closed||(cs.debug("transportClosed()"),this._closed=!0,this._dataChannel.close(),this.safeEmit("transportclose"),this._observer.safeEmit("close"))}handleDataChannel(){this._dataChannel.addEventListener("open",()=>{this._closed||(cs.debug('DataChannel "open" event'),this.safeEmit("open"))}),this._dataChannel.addEventListener("error",t=>{if(!this._closed){let e=t["error"];"sctp-failure"===(e=e||new Error("unknown DataChannel error")).errorDetail?cs.error("DataChannel SCTP error [sctpCauseCode:%s]: %s",e.sctpCauseCode,e.message):cs.error('DataChannel "error" event: %o',e),this.safeEmit("error",e)}}),this._dataChannel.addEventListener("close",()=>{this._closed||(cs.warn('DataChannel "close" event'),this._closed=!0,this.emit("@close"),this.safeEmit("close"),this._observer.safeEmit("close"))}),this._dataChannel.addEventListener("message",e=>{this._closed||this.safeEmit("message",e.data)})}}ss.DataConsumer=ds;var ps=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),ls=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),us=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&ps(t,e,r);return ls(t,e),t};Object.defineProperty(Si,"__esModule",{value:!0}),Si.Transport=void 0;const hs=p;p=i;const ms=s,fs=r,gs=us(a),_s=us(c),vs=Ui,ys=Bi,ws=ts,bs=ss,Ss=new p.Logger("Transport");class Ps{constructor(e){this.consumerOptions=e,this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Rs extends ms.EnhancedEventEmitter{constructor({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:p,handlerFactory:l,extendedRtpCapabilities:u,canProduceByKind:h}){super(),this._closed=!1,this._connectionState="new",this._producers=new Map,this._consumers=new Map,this._dataProducers=new Map,this._dataConsumers=new Map,this._probatorConsumerCreated=!1,this._awaitQueue=new hs.AwaitQueue,this._pendingConsumerTasks=[],this._consumerCreationInProgress=!1,this._pendingPauseConsumers=new Map,this._consumerPauseInProgress=!1,this._pendingResumeConsumers=new Map,this._consumerResumeInProgress=!1,this._pendingCloseConsumers=new Map,this._consumerCloseInProgress=!1,this._observer=new ms.EnhancedEventEmitter,Ss.debug("constructor() [id:%s, direction:%s]",t,e),this._id=t,this._direction=e,this._extendedRtpCapabilities=u,this._canProduceByKind=h,this._maxSctpMessageSize=i?i.maxMessageSize:null,delete(c=gs.clone(c,{})).iceServers,delete c.iceTransportPolicy,delete c.bundlePolicy,delete c.rtcpMuxPolicy,delete c.sdpSemantics,this._handler=l(),this._handler.run({direction:e,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,extendedRtpCapabilities:u}),this._appData=p||{},this.handleHandler()}get id(){return this._id}get closed(){return this._closed}get direction(){return this._direction}get handler(){return this._handler}get connectionState(){return this._connectionState}get appData(){return this._appData}set appData(e){throw new Error("cannot override appData object")}get observer(){return this._observer}close(){if(!this._closed){Ss.debug("close()"),this._closed=!0,this._awaitQueue.stop(),this._handler.close();for(const e of this._producers.values())e.transportClosed();this._producers.clear();for(const t of this._consumers.values())t.transportClosed();this._consumers.clear();for(const r of this._dataProducers.values())r.transportClosed();this._dataProducers.clear();for(const n of this._dataConsumers.values())n.transportClosed();this._dataConsumers.clear(),this._observer.safeEmit("close")}}async getStats(){if(this._closed)throw new fs.InvalidStateError("closed");return this._handler.getTransportStats()}async restartIce({iceParameters:e}){if(Ss.debug("restartIce()"),this._closed)throw new fs.InvalidStateError("closed");if(e)return this._awaitQueue.push(async()=>this._handler.restartIce(e),"transport.restartIce()");throw new TypeError("missing iceParameters")}async updateIceServers({iceServers:e}={}){if(Ss.debug("updateIceServers()"),this._closed)throw new fs.InvalidStateError("closed");if(Array.isArray(e))return this._awaitQueue.push(async()=>this._handler.updateIceServers(e),"transport.updateIceServers()");throw new TypeError("missing iceServers")}async produce({track:s,encodings:o,codecOptions:c,codec:d,stopTracks:p=!0,disableTrackOnPause:l=!0,zeroRtpOnPause:u=!1,appData:h={}}={}){if(Ss.debug("produce() [track:%o]",s),this._closed)throw new fs.InvalidStateError("closed");if(!s)throw new TypeError("missing track");if("send"!==this._direction)throw new fs.UnsupportedError("not a sending Transport");if(!this._canProduceByKind[s.kind])throw new fs.UnsupportedError("cannot produce "+s.kind);if("ended"===s.readyState)throw new fs.InvalidStateError("track ended");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("produce"))throw new TypeError('no "produce" listener set into this transport');if(h&&"object"!=typeof h)throw new TypeError("if given, appData must be an object");return this._awaitQueue.push(async()=>{let e;if(o&&!Array.isArray(o))throw TypeError("encodings must be an array");o&&0===o.length?e=void 0:o&&(e=o.map(e=>{var t={active:!0};return!1===e.active&&(t.active=!1),"boolean"==typeof e.dtx&&(t.dtx=e.dtx),"string"==typeof e.scalabilityMode&&(t.scalabilityMode=e.scalabilityMode),"number"==typeof e.scaleResolutionDownBy&&(t.scaleResolutionDownBy=e.scaleResolutionDownBy),"number"==typeof e.maxBitrate&&(t.maxBitrate=e.maxBitrate),"number"==typeof e.maxFramerate&&(t.maxFramerate=e.maxFramerate),"boolean"==typeof e.adaptivePtime&&(t.adaptivePtime=e.adaptivePtime),"string"==typeof e.priority&&(t.priority=e.priority),"string"==typeof e.networkPriority&&(t.networkPriority=e.networkPriority),t}));const{localId:t,rtpParameters:r,rtpSender:n}=await this._handler.send({track:s,encodings:e,codecOptions:c,codec:d});try{_s.validateRtpParameters(r);var a=(await new Promise((e,t)=>{this.safeEmit("produce",{kind:s.kind,rtpParameters:r,appData:h},e,t)}))["id"],i=new vs.Producer({id:a,localId:t,rtpSender:n,track:s,rtpParameters:r,stopTracks:p,disableTrackOnPause:l,zeroRtpOnPause:u,appData:h});return this._producers.set(i.id,i),this.handleProducer(i),this._observer.safeEmit("newproducer",i),i}catch(e){throw this._handler.stopSending(t).catch(()=>{}),e}},"transport.produce()").catch(e=>{if(p)try{s.stop()}catch(e){}throw e})}async consume({id:e,producerId:t,kind:r,rtpParameters:n,streamId:a,appData:i={}}){if(Ss.debug("consume()"),n=gs.clone(n,void 0),this._closed)throw new fs.InvalidStateError("closed");if("recv"!==this._direction)throw new fs.UnsupportedError("not a receiving Transport");if("string"!=typeof e)throw new TypeError("missing id");if("string"!=typeof t)throw new TypeError("missing producerId");if("audio"!==r&&"video"!==r)throw new TypeError(`invalid kind '${r}'`);if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(i&&"object"!=typeof i)throw new TypeError("if given, appData must be an object");if(_s.canReceive(n,this._extendedRtpCapabilities))return e=new Ps({id:e,producerId:t,kind:r,rtpParameters:n,streamId:a,appData:i}),this._pendingConsumerTasks.push(e),!1===this._consumerCreationInProgress&&this.createPendingConsumers(),e.promise;throw new fs.UnsupportedError("cannot consume this Producer")}async produceData({ordered:n=!0,maxPacketLifeTime:a,maxRetransmits:i,label:s="",protocol:o="",appData:c={}}={}){if(Ss.debug("produceData()"),this._closed)throw new fs.InvalidStateError("closed");if("send"!==this._direction)throw new fs.UnsupportedError("not a sending Transport");if(!this._maxSctpMessageSize)throw new fs.UnsupportedError("SCTP not enabled by remote Transport");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(0===this.listenerCount("producedata"))throw new TypeError('no "producedata" listener set into this transport');if(c&&"object"!=typeof c)throw new TypeError("if given, appData must be an object");return(a||i)&&(n=!1),this._awaitQueue.push(async()=>{const{dataChannel:e,sctpStreamParameters:r}=await this._handler.sendDataChannel({ordered:n,maxPacketLifeTime:a,maxRetransmits:i,label:s,protocol:o});_s.validateSctpStreamParameters(r);var t=(await new Promise((e,t)=>{this.safeEmit("producedata",{sctpStreamParameters:r,label:s,protocol:o,appData:c},e,t)}))["id"],t=new ws.DataProducer({id:t,dataChannel:e,sctpStreamParameters:r,appData:c});return this._dataProducers.set(t.id,t),this.handleDataProducer(t),this._observer.safeEmit("newdataproducer",t),t},"transport.produceData()")}async consumeData({id:t,dataProducerId:r,sctpStreamParameters:n,label:a="",protocol:i="",appData:s={}}){if(Ss.debug("consumeData()"),n=gs.clone(n,void 0),this._closed)throw new fs.InvalidStateError("closed");if("recv"!==this._direction)throw new fs.UnsupportedError("not a receiving Transport");if(!this._maxSctpMessageSize)throw new fs.UnsupportedError("SCTP not enabled by remote Transport");if("string"!=typeof t)throw new TypeError("missing id");if("string"!=typeof r)throw new TypeError("missing dataProducerId");if(0===this.listenerCount("connect")&&"new"===this._connectionState)throw new TypeError('no "connect" listener set into this transport');if(s&&"object"!=typeof s)throw new TypeError("if given, appData must be an object");return _s.validateSctpStreamParameters(n),this._awaitQueue.push(async()=>{var e=(await this._handler.receiveDataChannel({sctpStreamParameters:n,label:a,protocol:i}))["dataChannel"],e=new bs.DataConsumer({id:t,dataProducerId:r,dataChannel:e,sctpStreamParameters:n,appData:s});return this._dataConsumers.set(e.id,e),this.handleDataConsumer(e),this._observer.safeEmit("newdataconsumer",e),e},"transport.consumeData()")}async createPendingConsumers(){this._consumerCreationInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingConsumerTasks.length)Ss.debug("createPendingConsumers() | there is no Consumer to be created");else{var r=[...this._pendingConsumerTasks];this._pendingConsumerTasks=[];let t=void 0;var e=[];for(const w of r){var{id:n,kind:a,rtpParameters:i,streamId:s}=w.consumerOptions;e.push({trackId:n,kind:a,rtpParameters:i,streamId:s})}try{var o=await this._handler.receive(e);for(let e=0;e<o.length;e++){var c=r[e],d=o[e],{id:p,producerId:l,kind:u,rtpParameters:h,appData:m}=c.consumerOptions,{localId:f,rtpReceiver:g,track:_}=d,v=new ys.Consumer({id:p,localId:f,producerId:l,rtpReceiver:g,track:_,rtpParameters:h,appData:m});this._consumers.set(v.id,v),this.handleConsumer(v),this._probatorConsumerCreated||t||"video"!==u||(t=v),this._observer.safeEmit("newconsumer",v),c.resolve(v)}}catch(e){for(const b of r)b.reject(e)}if(t)try{var y=_s.generateProbatorRtpParameters(t.rtpParameters);await this._handler.receive([{trackId:"probator",kind:"video",rtpParameters:y}]),Ss.debug("createPendingConsumers() | Consumer for RTP probation created"),this._probatorConsumerCreated=!0}catch(e){Ss.error("createPendingConsumers() | failed to create Consumer for RTP probation:%o",e)}}},"transport.createPendingConsumers()").then(()=>{this._consumerCreationInProgress=!1,0<this._pendingConsumerTasks.length&&this.createPendingConsumers()}).catch(()=>{})}pausePendingConsumers(){this._consumerPauseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingPauseConsumers.size)Ss.debug("pausePendingConsumers() | there is no Consumer to be paused");else{var e=Array.from(this._pendingPauseConsumers.values());this._pendingPauseConsumers.clear();try{var t=e.map(e=>e.localId);await this._handler.pauseReceiving(t)}catch(e){Ss.error("pausePendingConsumers() | failed to pause Consumers:",e)}}},"transport.pausePendingConsumers").then(()=>{this._consumerPauseInProgress=!1,0<this._pendingPauseConsumers.size&&this.pausePendingConsumers()}).catch(()=>{})}resumePendingConsumers(){this._consumerResumeInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingResumeConsumers.size)Ss.debug("resumePendingConsumers() | there is no Consumer to be resumed");else{var e=Array.from(this._pendingResumeConsumers.values());this._pendingResumeConsumers.clear();try{var t=e.map(e=>e.localId);await this._handler.resumeReceiving(t)}catch(e){Ss.error("resumePendingConsumers() | failed to resume Consumers:",e)}}},"transport.resumePendingConsumers").then(()=>{this._consumerResumeInProgress=!1,0<this._pendingResumeConsumers.size&&this.resumePendingConsumers()}).catch(()=>{})}closePendingConsumers(){this._consumerCloseInProgress=!0,this._awaitQueue.push(async()=>{if(0===this._pendingCloseConsumers.size)Ss.debug("closePendingConsumers() | there is no Consumer to be closed");else{var e=Array.from(this._pendingCloseConsumers.values());this._pendingCloseConsumers.clear();try{await this._handler.stopReceiving(e.map(e=>e.localId))}catch(e){Ss.error("closePendingConsumers() | failed to close Consumers:",e)}}},"transport.closePendingConsumers").then(()=>{this._consumerCloseInProgress=!1,0<this._pendingCloseConsumers.size&&this.closePendingConsumers()}).catch(()=>{})}handleHandler(){var e=this._handler;e.on("@connect",({dtlsParameters:e},t,r)=>{this._closed?r(new fs.InvalidStateError("closed")):this.safeEmit("connect",{dtlsParameters:e},t,r)}),e.on("@connectionstatechange",e=>{e===this._connectionState||(Ss.debug("connection state changed to %s",e),this._connectionState=e,this._closed)||this.safeEmit("connectionstatechange",e)})}handleProducer(n){n.on("@close",()=>{this._producers.delete(n.id),this._closed||this._awaitQueue.push(async()=>this._handler.stopSending(n.localId),"producer @close event").catch(e=>Ss.warn("producer.close() failed:%o",e))}),n.on("@pause",(e,t)=>{this._awaitQueue.push(async()=>this._handler.pauseSending(n.localId),"producer @pause event").then(e).catch(t)}),n.on("@resume",(e,t)=>{this._awaitQueue.push(async()=>this._handler.resumeSending(n.localId),"producer @resume event").then(e).catch(t)}),n.on("@replacetrack",(e,t,r)=>{this._awaitQueue.push(async()=>this._handler.replaceTrack(n.localId,e),"producer @replacetrack event").then(t).catch(r)}),n.on("@setmaxspatiallayer",(e,t,r)=>{this._awaitQueue.push(async()=>this._handler.setMaxSpatialLayer(n.localId,e),"producer @setmaxspatiallayer event").then(t).catch(r)}),n.on("@setrtpencodingparameters",(e,t,r)=>{this._awaitQueue.push(async()=>this._handler.setRtpEncodingParameters(n.localId,e),"producer @setrtpencodingparameters event").then(t).catch(r)}),n.on("@getstats",(e,t)=>{if(this._closed)return t(new fs.InvalidStateError("closed"));this._handler.getSenderStats(n.localId).then(e).catch(t)})}handleConsumer(r){r.on("@close",()=>{this._consumers.delete(r.id),this._pendingPauseConsumers.delete(r.id),this._pendingResumeConsumers.delete(r.id),this._closed||(this._pendingCloseConsumers.set(r.id,r),!1===this._consumerCloseInProgress&&this.closePendingConsumers())}),r.on("@pause",()=>{this._pendingResumeConsumers.has(r.id)&&this._pendingResumeConsumers.delete(r.id),this._pendingPauseConsumers.set(r.id,r),!1===this._consumerPauseInProgress&&this.pausePendingConsumers()}),r.on("@resume",()=>{this._pendingPauseConsumers.has(r.id)&&this._pendingPauseConsumers.delete(r.id),this._pendingResumeConsumers.set(r.id,r),!1===this._consumerResumeInProgress&&this.resumePendingConsumers()}),r.on("@getstats",(e,t)=>{if(this._closed)return t(new fs.InvalidStateError("closed"));this._handler.getReceiverStats(r.localId).then(e).catch(t)})}handleDataProducer(e){e.on("@close",()=>{this._dataProducers.delete(e.id)})}handleDataConsumer(e){e.on("@close",()=>{this._dataConsumers.delete(e.id)})}}Si.Transport=Rs;var us={},p={},l={},m={exports:{}},Cs=m.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%s trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))?(?: (urn:ietf:params:rtp-hdrext:encrypt))? (\S*)(?: (\S*))?/,names:["value","direction","encrypt-uri","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+(e["encrypt-uri"]?" %s":"%v")+" %s"+(e.config?" %s":"")}},{name:"extmapAllowMixed",reg:/^(extmap-allow-mixed)/},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"connectionType",reg:/^connection:(new|existing)/,format:"connection:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*(?:\.\d*)*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*(?:\.\d*)*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s",t=(t+=null!=e.raddr?" raddr %s rport %d":"%v%v")+(null!=e.tcptype?" tcptype %s":"%v");return null!=e.generation&&(t+=" generation %d"),t=(t+=null!=e["network-id"]?" network-id %d":"%v")+(null!=e["network-cost"]?" network-cost %d":"%v")}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_-]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value)&&(t+=":%s"),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{name:"sourceFilter",reg:/^source-filter: *(excl|incl) (\S*) (IP4|IP6|\*) (\S*) (.*)/,names:["filterMode","netType","addressTypes","destAddress","srcList"],format:"source-filter: %s %s %s %s %s"},{name:"bundleOnly",reg:/^(bundle-only)/},{name:"label",reg:/^label:(.+)/,format:"label:%s"},{name:"sctpPort",reg:/^sctp-port:(\d+)$/,format:"sctp-port:%s"},{name:"maxMessageSize",reg:/^max-message-size:(\d+)$/,format:"max-message-size:%s"},{push:"tsRefClocks",reg:/^ts-refclk:([^\s=]*)(?:=(\S*))?/,names:["clksrc","clksrcExt"],format:function(e){return"ts-refclk:%s"+(null!=e.clksrcExt?"=%s":"")}},{name:"mediaClk",reg:/^mediaclk:(?:id=(\S*))? *([^\s=]*)(?:=(\S*))?(?: *rate=(\d+)\/(\d+))?/,names:["id","mediaClockName","mediaClockValue","rateNumerator","rateDenominator"],format:function(e){var t="mediaclk:";return(t+=null!=e.id?"id=%s %s":"%v%s")+(null!=e.mediaClockValue?"=%s":"")+(null!=e.rateNumerator?" rate=%s":"")+(null!=e.rateDenominator?"/%s":"")}},{name:"keywords",reg:/^keywds:(.+)$/,format:"keywds:%s"},{name:"content",reg:/^content:(.+)/,format:"content:%s"},{name:"bfcpFloorCtrl",reg:/^floorctrl:(c-only|s-only|c-s)/,format:"floorctrl:%s"},{name:"bfcpConfId",reg:/^confid:(\d+)/,format:"confid:%s"},{name:"bfcpUserId",reg:/^userid:(\d+)/,format:"userid:%s"},{name:"bfcpFloorId",reg:/^floorid:(.+) (?:m-stream|mstrm):(.+)/,names:["id","mStream"],format:"floorid:%s mstrm:%s"},{push:"invalid",names:["value"]}]},f=(Object.keys(Cs).forEach(function(e){Cs[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})}),l);function Ts(e,t,r){var n=e.name&&e.names,n=(e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={}),e.push?{}:n?t[e.name]:t),a=r.match(e.reg),i=n,s=e.names;if((r=e.name)&&!s)i[r]=xs(a[1]);else for(var o=0;o<s.length;o+=1)null!=a[o+1]&&(i[s[o]]=xs(a[o+1]));e.push&&t[e.push].push(n)}function Ds(e,t){var r=t.split(/=(.+)/,2);return 2===r.length?e[r[0]]=xs(r[1]):1===r.length&&1<t.length&&(e[r[0]]=void 0),e}function ks(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var a=0;a<t.names.length;a+=1){var i=t.names[a];t.name?n.push(r[t.name][i]):n.push(r[t.names[a]])}else n.push(r[t.name]);return Ls.apply(null,n)}var xs=function(e){return String(Number(e))===e?Number(e):e},Es=m.exports,Os=RegExp.prototype.test.bind(/^([a-z])=(.*)/),Ms=(f.parse=function(e){var t={},i=[],s=t;return e.split(/(\r\n|\r|\n)/).filter(Os).forEach(function(e){var t=e[0],r=e.slice(2);"m"===t&&(i.push({rtp:[],fmtp:[]}),s=i[i.length-1]);for(var n=0;n<(Es[t]||[]).length;n+=1){var a=Es[t][n];if(a.reg.test(r))return Ts(a,s,r)}}),t.media=i,t},f.parseParams=function(e){return e.split(/;\s?/).reduce(Ds,{})},f.parseFmtpConfig=f.parseParams,f.parsePayloads=function(e){return e.toString().split(" ").map(Number)},f.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(xs),n=0;n<r.length;n+=3)t.push({component:r[n],ip:r[n+1],port:r[n+2]});return t},f.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(Ds,{})})},f.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=xs(e):(t=xs(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})},m.exports),Is=/%[sdv%]/g,Ls=function(e){var r=1,n=arguments,a=n.length;return e.replace(Is,function(e){if(a<=r)return e;var t=n[r];switch(r+=1,e){case"%%":return"%";case"%s":return String(t);case"%d":return Number(t);case"%v":return""}})},js=["v","o","s","i","u","e","p","c","b","t","r","z","a"],Ns=["i","c","b","a"],f=l,m=(p.write=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||js,n=t.innerOrder||Ns,a=[];return r.forEach(function(r){Ms[r].forEach(function(t){t.name in e&&null!=e[t.name]?a.push(ks(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){a.push(ks(r,t,e))})})}),e.media.forEach(function(e){a.push(ks("m",Ms.m[0],e)),n.forEach(function(r){Ms[r].forEach(function(t){t.name in e&&null!=e[t.name]?a.push(ks(r,t,e)):t.push in e&&null!=e[t.push]&&e[t.push].forEach(function(e){a.push(ks(r,t,e))})})})}),a.join("\r\n")+"\r\n"},p.parse=f.parse,p.parseParams=f.parseParams,p.parseFmtpConfig=f.parseFmtpConfig,p.parsePayloads=f.parsePayloads,p.parseRemoteCandidates=f.parseRemoteCandidates,p.parseImageAttributes=f.parseImageAttributes,p.parseSimulcastStreamList=f.parseSimulcastStreamList,{}),As=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Vs=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),l=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&As(t,e,r);return Vs(t,e),t};Object.defineProperty(m,"__esModule",{value:!0}),m.applyCodecParameters=m.getCname=m.extractDtlsParameters=m.extractRtpCapabilities=void 0;const Fs=l(p);m.extractRtpCapabilities=function({sdpObject:e}){var t=new Map,r=[];let n=!1,a=!1;for(const u of e.media){var i,s=u.type;switch(s){case"audio":if(n)continue;n=!0;break;case"video":if(a)continue;a=!0;break;default:continue}for(const h of u.rtp){var o={kind:s,mimeType:s+"/"+h.codec,preferredPayloadType:h.payload,clockRate:h.rate,channels:h.encoding,parameters:{},rtcpFeedback:[]};t.set(o.preferredPayloadType,o)}for(const m of u.fmtp||[]){var c=Fs.parseParams(m.config),d=t.get(m.payload);d&&(c&&c.hasOwnProperty("profile-level-id")&&(c["profile-level-id"]=String(c["profile-level-id"])),d.parameters=c)}for(const f of u.rtcpFb||[]){var p={type:f.type,parameter:f.subtype};if(p.parameter||delete p.parameter,"*"!==f.payload){var l=t.get(f.payload);l&&l.rtcpFeedback.push(p)}else for(const g of t.values())g.kind!==s||/.+\/rtx$/i.test(g.mimeType)||g.rtcpFeedback.push(p)}for(const _ of u.ext||[])_["encrypt-uri"]||(i={kind:s,uri:_.uri,preferredId:_.value},r.push(i))}return{codecs:Array.from(t.values()),headerExtensions:r}},m.extractDtlsParameters=function({sdpObject:e}){var t=(e.media||[]).find(e=>e.iceUfrag&&0!==e.port);if(!t)throw new Error("no active media section found");e=t.fingerprint||e.fingerprint;let r;switch(t.setup){case"active":r="client";break;case"passive":r="server";break;case"actpass":r="auto"}return{role:r,fingerprints:[{algorithm:e.type,value:e.hash}]}},m.getCname=function({offerMediaObject:e}){return(e=(e.ssrcs||[]).find(e=>"cname"===e.attribute))?e.value:""},m.applyCodecParameters=function({offerRtpParameters:e,answerMediaObject:t}){for(const a of e.codecs){var r=a.mimeType.toLowerCase();if("audio/opus"===r)if((t.rtp||[]).find(e=>e.payload===a.payloadType)){t.fmtp=t.fmtp||[];let e=t.fmtp.find(e=>e.payload===a.payloadType);e||(e={payload:a.payloadType,config:""},t.fmtp.push(e));var n=Fs.parseParams(e.config);"audio/opus"===r&&void 0!==(r=a.parameters["sprop-stereo"])&&(n.stereo=r?1:0),e.config="";for(const i of Object.keys(n))e.config&&(e.config+=";"),e.config+=i+"="+n[i]}}};f={};Object.defineProperty(f,"__esModule",{value:!0}),f.addLegacySimulcast=f.getRtpEncodings=void 0,f.getRtpEncodings=function({offerMediaObject:e}){var t=new Set;for(const p of e.ssrcs||[]){var r=p.id;t.add(r)}if(0===t.size)throw new Error("no a=ssrc lines found");var n,a,i=new Map;for(const l of e.ssrcGroups||[])"FID"===l.semantics&&([n,a]=l.ssrcs.split(/\s+/),n=Number(n),a=Number(a),t.has(n))&&(t.delete(n),t.delete(a),i.set(n,a));for(const u of t)i.set(u,null);var s,o,c=[];for([s,o]of i){var d={ssrc:s};o&&(d.rtx={ssrc:o}),c.push(d)}return c},f.addLegacySimulcast=function({offerMediaObject:t,numStreams:r}){if(r<=1)throw new TypeError("numStreams must be greater than 1");var e=(t.ssrcs||[]).find(e=>"msid"===e.attribute);if(!e)throw new Error("a=ssrc line with msid information not found");var[n,a]=e.value.split(" ");const i=e.id;let s;if((t.ssrcGroups||[]).some(e=>{return"FID"===e.semantics&&(e=e.ssrcs.split(/\s+/),Number(e[0])===i)&&(s=Number(e[1]),!0)}),!(e=t.ssrcs.find(e=>"cname"===e.attribute)))throw new Error("a=ssrc line with cname information not found");var o=e.value,c=[],d=[];for(let e=0;e<r;++e)c.push(i+e),s&&d.push(s+e);t.ssrcGroups=[],t.ssrcs=[],t.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let e=0;e<c.length;++e){var p=c[e];t.ssrcs.push({id:p,attribute:"cname",value:o}),t.ssrcs.push({id:p,attribute:"msid",value:n+" "+a})}for(let e=0;e<d.length;++e){var l=c[e],u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:o}),t.ssrcs.push({id:u,attribute:"msid",value:n+" "+a}),t.ssrcGroups.push({semantics:"FID",ssrcs:l+" "+u})}};var l={},g=(Object.defineProperty(l,"__esModule",{value:!0}),l.HandlerInterface=void 0,s);class Bs extends g.EnhancedEventEmitter{constructor(){super()}}l.HandlerInterface=Bs;var g={},_={},Us=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),zs=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Hs=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Us(t,e,r);return zs(t,e),t};Object.defineProperty(_,"__esModule",{value:!0}),_.OfferMediaSection=_.AnswerMediaSection=_.MediaSection=void 0;const Gs=Hs(a);class $s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:n=!1}){if(this._mediaObject={},this._planB=n,e&&this.setIceParameters(e),t){this._mediaObject.candidates=[];for(const i of t){var a={component:1};a.foundation=i.foundation,a.ip=i.ip,a.port=i.port,a.priority=i.priority,a.transport=i.protocol,a.type=i.type,i.tcpType&&(a.tcptype=i.tcpType),this._mediaObject.candidates.push(a)}this._mediaObject.endOfCandidates="end-of-candidates",this._mediaObject.iceOptions="renomination"}r&&this.setDtlsRole(r.role)}get mid(){return String(this._mediaObject.mid)}get closed(){return 0===this._mediaObject.port}getObject(){return this._mediaObject}setIceParameters(e){this._mediaObject.iceUfrag=e.usernameFragment,this._mediaObject.icePwd=e.password}pause(){this._mediaObject.direction="inactive"}disable(){this.pause(),delete this._mediaObject.ext,delete this._mediaObject.ssrcs,delete this._mediaObject.ssrcGroups,delete this._mediaObject.simulcast,delete this._mediaObject.simulcast_03,delete this._mediaObject.rids,delete this._mediaObject.extmapAllowMixed}close(){this.disable(),this._mediaObject.port=0}}_.MediaSection=$s;_.AnswerMediaSection=class extends $s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:a,planB:i=!1,offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:c,codecOptions:d,extmapAllowMixed:p=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(s.mid),this._mediaObject.type=s.type,this._mediaObject.protocol=s.protocol,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.port=7),s.type){case"audio":case"video":this._mediaObject.direction="recvonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[];for(const R of c.codecs){var l={payload:R.payloadType,codec:Js(R),rate:R.clockRate},u=(1<R.channels&&(l.encoding=R.channels),this._mediaObject.rtp.push(l),Gs.clone(R.parameters,{}));if(d){var{opusStereo:h,opusFec:m,opusDtx:f,opusMaxPlaybackRate:g,opusMaxAverageBitrate:_,opusPtime:v,videoGoogleStartBitrate:y,videoGoogleMaxBitrate:w,videoGoogleMinBitrate:b}=d,S=o.codecs.find(e=>e.payloadType===R.payloadType);switch(R.mimeType.toLowerCase()){case"audio/opus":void 0!==h&&(S.parameters["sprop-stereo"]=h?1:0,u.stereo=h?1:0),void 0!==m&&(S.parameters.useinbandfec=m?1:0,u.useinbandfec=m?1:0),void 0!==f&&(S.parameters.usedtx=f?1:0,u.usedtx=f?1:0),void 0!==g&&(u.maxplaybackrate=g),void 0!==_&&(u.maxaveragebitrate=_),void 0!==v&&(S.parameters.ptime=v,u.ptime=v);break;case"video/vp8":case"video/vp9":case"video/h264":case"video/h265":void 0!==y&&(u["x-google-start-bitrate"]=y),void 0!==w&&(u["x-google-max-bitrate"]=w),void 0!==b&&(u["x-google-min-bitrate"]=b)}}var P={payload:R.payloadType,config:""};for(const C of Object.keys(u))P.config&&(P.config+=";"),P.config+=C+"="+u[C];P.config&&this._mediaObject.fmtp.push(P);for(const T of R.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:R.payloadType,type:T.type,subtype:T.parameter})}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const D of c.headerExtensions)(s.ext||[]).some(e=>e.uri===D.uri)&&this._mediaObject.ext.push({uri:D.uri,value:D.id});if(p&&"extmap-allow-mixed"===s.extmapAllowMixed&&(this._mediaObject.extmapAllowMixed="extmap-allow-mixed"),s.simulcast){this._mediaObject.simulcast={dir1:"recv",list1:s.simulcast.list1},this._mediaObject.rids=[];for(const k of s.rids||[])"send"===k.direction&&this._mediaObject.rids.push({id:k.id,direction:"recv"})}else if(s.simulcast_03){this._mediaObject.simulcast_03={value:s.simulcast_03.value.replace(/send/g,"recv")},this._mediaObject.rids=[];for(const x of s.rids||[])"send"===x.direction&&this._mediaObject.rids.push({id:x.id,direction:"recv"})}this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize",this._planB&&"video"===this._mediaObject.type&&(this._mediaObject.xGoogleFlag="conference");break;case"application":"number"==typeof s.sctpPort?(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize):s.sctpmap&&(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize})}}setDtlsRole(e){switch(e){case"client":this._mediaObject.setup="active";break;case"server":this._mediaObject.setup="passive";break;case"auto":this._mediaObject.setup="actpass"}}resume(){this._mediaObject.direction="recvonly"}};function Js(e){e=new RegExp("^(audio|video)/(.+)","i").exec(e.mimeType);if(e)return e[2];throw new TypeError("invalid codec.mimeType")}_.OfferMediaSection=class extends $s{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:a,planB:i=!1,mid:s,kind:o,offerRtpParameters:c,streamId:d,trackId:p,oldDataChannelSpec:l=!1}){switch(super({iceParameters:e,iceCandidates:t,dtlsParameters:r,planB:i}),this._mediaObject.mid=String(s),this._mediaObject.type=o,a?(this._mediaObject.connection={ip:a.ip,version:a.ipVersion},this._mediaObject.protocol="RTP/AVP",this._mediaObject.port=a.port):(this._mediaObject.connection={ip:"127.0.0.1",version:4},this._mediaObject.protocol=n?"UDP/DTLS/SCTP":"UDP/TLS/RTP/SAVPF",this._mediaObject.port=7),o){case"audio":case"video":this._mediaObject.direction="sendonly",this._mediaObject.rtp=[],this._mediaObject.rtcpFb=[],this._mediaObject.fmtp=[],this._planB||(this._mediaObject.msid=`${d||"-"} `+p);for(const g of c.codecs){var u={payload:g.payloadType,codec:Js(g),rate:g.clockRate},h=(1<g.channels&&(u.encoding=g.channels),this._mediaObject.rtp.push(u),{payload:g.payloadType,config:""});for(const _ of Object.keys(g.parameters))h.config&&(h.config+=";"),h.config+=_+"="+g.parameters[_];h.config&&this._mediaObject.fmtp.push(h);for(const v of g.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:g.payloadType,type:v.type,subtype:v.parameter})}this._mediaObject.payloads=c.codecs.map(e=>e.payloadType).join(" "),this._mediaObject.ext=[];for(const y of c.headerExtensions)this._mediaObject.ext.push({uri:y.uri,value:y.id});this._mediaObject.rtcpMux="rtcp-mux",this._mediaObject.rtcpRsize="rtcp-rsize";var m=c.encodings[0],f=m.ssrc,m=m.rtx&&m.rtx.ssrc?m.rtx.ssrc:void 0;this._mediaObject.ssrcs=[],this._mediaObject.ssrcGroups=[],c.rtcp.cname&&this._mediaObject.ssrcs.push({id:f,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:f,attribute:"msid",value:`${d||"-"} `+p}),m&&(c.rtcp.cname&&this._mediaObject.ssrcs.push({id:m,attribute:"cname",value:c.rtcp.cname}),this._planB&&this._mediaObject.ssrcs.push({id:m,attribute:"msid",value:`${d||"-"} `+p}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:f+" "+m}));break;case"application":l?(this._mediaObject.payloads=n.port,this._mediaObject.sctpmap={app:"webrtc-datachannel",sctpmapNumber:n.port,maxMessageSize:n.maxMessageSize}):(this._mediaObject.payloads="webrtc-datachannel",this._mediaObject.sctpPort=n.port,this._mediaObject.maxMessageSize=n.maxMessageSize)}}setDtlsRole(e){this._mediaObject.setup="actpass"}resume(){this._mediaObject.direction="sendonly"}planBReceive({offerRtpParameters:e,streamId:t,trackId:r}){var n=e.encodings[0],a=n.ssrc,n=n.rtx&&n.rtx.ssrc?n.rtx.ssrc:void 0,i=this._mediaObject.payloads.split(" ");for(const c of e.codecs)if(!i.includes(String(c.payloadType))){var s={payload:c.payloadType,codec:Js(c),rate:c.clockRate},o=(1<c.channels&&(s.encoding=c.channels),this._mediaObject.rtp.push(s),{payload:c.payloadType,config:""});for(const d of Object.keys(c.parameters))o.config&&(o.config+=";"),o.config+=d+"="+c.parameters[d];o.config&&this._mediaObject.fmtp.push(o);for(const p of c.rtcpFeedback)this._mediaObject.rtcpFb.push({payload:c.payloadType,type:p.type,subtype:p.parameter})}this._mediaObject.payloads+=" "+e.codecs.filter(e=>!this._mediaObject.payloads.includes(e.payloadType)).map(e=>e.payloadType).join(" "),this._mediaObject.payloads=this._mediaObject.payloads.trim(),e.rtcp.cname&&this._mediaObject.ssrcs.push({id:a,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:a,attribute:"msid",value:`${t||"-"} `+r}),n&&(e.rtcp.cname&&this._mediaObject.ssrcs.push({id:n,attribute:"cname",value:e.rtcp.cname}),this._mediaObject.ssrcs.push({id:n,attribute:"msid",value:`${t||"-"} `+r}),this._mediaObject.ssrcGroups.push({semantics:"FID",ssrcs:a+" "+n}))}planBStopReceiving({offerRtpParameters:e}){e=e.encodings[0];const t=e.ssrc,r=e.rtx&&e.rtx.ssrc?e.rtx.ssrc:void 0;this._mediaObject.ssrcs=this._mediaObject.ssrcs.filter(e=>e.id!==t&&e.id!==r),r&&(this._mediaObject.ssrcGroups=this._mediaObject.ssrcGroups.filter(e=>e.ssrcs!==t+" "+r))}};var Ws=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),qs=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),Hs=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ws(t,e,r);return qs(t,e),t};Object.defineProperty(g,"__esModule",{value:!0}),g.RemoteSdp=void 0;const Ks=Hs(p),Qs=_,Xs=new i.Logger("RemoteSdp");g.RemoteSdp=class{constructor({iceParameters:e,iceCandidates:t,dtlsParameters:r,sctpParameters:n,plainRtpParameters:a,planB:i=!1}){this._mediaSections=[],this._midToIndex=new Map,this._iceParameters=e,this._iceCandidates=t,this._dtlsParameters=r,this._sctpParameters=n,this._plainRtpParameters=a,this._planB=i,this._sdpObject={version:0,origin:{address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:1e4,sessionVersion:0,username:"mediasoup-client"},name:"-",timing:{start:0,stop:0},media:[]},e&&e.iceLite&&(this._sdpObject.icelite="ice-lite"),r&&(this._sdpObject.msidSemantic={semantic:"WMS",token:"*"},t=this._dtlsParameters.fingerprints.length,this._sdpObject.fingerprint={type:r.fingerprints[t-1].algorithm,hash:r.fingerprints[t-1].value},this._sdpObject.groups=[{type:"BUNDLE",mids:""}]),a&&(this._sdpObject.origin.address=a.ip,this._sdpObject.origin.ipVer=a.ipVersion)}updateIceParameters(e){Xs.debug("updateIceParameters() [iceParameters:%o]",e),this._iceParameters=e,this._sdpObject.icelite=e.iceLite?"ice-lite":void 0;for(const t of this._mediaSections)t.setIceParameters(e)}updateDtlsRole(e){Xs.debug("updateDtlsRole() [role:%s]",e),this._dtlsParameters.role=e;for(const t of this._mediaSections)t.setDtlsRole(e)}getNextMediaSectionIdx(){for(let e=0;e<this._mediaSections.length;++e){var t=this._mediaSections[e];if(t.closed)return{idx:e,reuseMid:t.mid}}return{idx:this._mediaSections.length}}send({offerMediaObject:e,reuseMid:t,offerRtpParameters:r,answerRtpParameters:n,codecOptions:a,extmapAllowMixed:i=!1}){e=new Qs.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,offerMediaObject:e,offerRtpParameters:r,answerRtpParameters:n,codecOptions:a,extmapAllowMixed:i});t?this._replaceMediaSection(e,t):this._midToIndex.has(e.mid)?this._replaceMediaSection(e):this._addMediaSection(e)}receive({mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:a}){var i=this._midToIndex.get(e);let s;(s=void 0!==i?this._mediaSections[i]:s)?(s.planBReceive({offerRtpParameters:r,streamId:n,trackId:a}),this._replaceMediaSection(s)):(s=new Qs.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,plainRtpParameters:this._plainRtpParameters,planB:this._planB,mid:e,kind:t,offerRtpParameters:r,streamId:n,trackId:a}),(i=this._mediaSections.find(e=>e.closed))?this._replaceMediaSection(s,i.mid):this._addMediaSection(s))}pauseMediaSection(e){this._findMediaSection(e).pause()}resumeSendingMediaSection(e){this._findMediaSection(e).resume()}resumeReceivingMediaSection(e){this._findMediaSection(e).resume()}disableMediaSection(e){this._findMediaSection(e).disable()}closeMediaSection(e){var t=this._findMediaSection(e);return e===this._firstMid?(Xs.debug("closeMediaSection() | cannot close first media section, disabling it instead [mid:%s]",e),this.disableMediaSection(e),!1):(t.close(),this._regenerateBundleMids(),!0)}planBStopReceiving({mid:e,offerRtpParameters:t}){var r=this._midToIndex.get(e);if(void 0===r)throw new Error(`no media section found with mid '${e}'`);e=this._mediaSections[r];e.planBStopReceiving({offerRtpParameters:t}),this._replaceMediaSection(e)}sendSctpAssociation({offerMediaObject:e}){e=new Qs.AnswerMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,offerMediaObject:e});this._addMediaSection(e)}receiveSctpAssociation({oldDataChannelSpec:e=!1}={}){e=new Qs.OfferMediaSection({iceParameters:this._iceParameters,iceCandidates:this._iceCandidates,dtlsParameters:this._dtlsParameters,sctpParameters:this._sctpParameters,plainRtpParameters:this._plainRtpParameters,mid:"datachannel",kind:"application",oldDataChannelSpec:e});this._addMediaSection(e)}getSdp(){return this._sdpObject.origin.sessionVersion++,Ks.write(this._sdpObject)}_addMediaSection(e){this._firstMid||(this._firstMid=e.mid),this._mediaSections.push(e),this._midToIndex.set(e.mid,this._mediaSections.length-1),this._sdpObject.media.push(e.getObject()),this._regenerateBundleMids()}_replaceMediaSection(e,t){if("string"==typeof t){var r=this._midToIndex.get(t);if(void 0===r)throw new Error(`no media section found for reuseMid '${t}'`);t=this._mediaSections[r];this._mediaSections[r]=e,this._midToIndex.delete(t.mid),this._midToIndex.set(e.mid,r),this._sdpObject.media[r]=e.getObject(),this._regenerateBundleMids()}else{t=this._midToIndex.get(e.mid);if(void 0===t)throw new Error(`no media section found with mid '${e.mid}'`);this._mediaSections[t]=e,this._sdpObject.media[t]=e.getObject()}}_findMediaSection(e){var t=this._midToIndex.get(e);if(void 0===t)throw new Error(`no media section found with mid '${e}'`);return this._mediaSections[t]}_regenerateBundleMids(){this._dtlsParameters&&(this._sdpObject.groups[0].mids=this._mediaSections.filter(e=>!e.closed).map(e=>e.mid).join(" "))}};Hs={};Object.defineProperty(Hs,"__esModule",{value:!0}),Hs.parse=void 0;const Ys=new RegExp("^[LS]([1-9]\\d{0,1})T([1-9]\\d{0,1})");Hs.parse=function(e){return(e=Ys.exec(e||""))?{spatialLayers:Number(e[1]),temporalLayers:Number(e[2])}:{spatialLayers:1,temporalLayers:1}};var Zs=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),eo=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),_=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Zs(t,e,r);return eo(t,e),t};Object.defineProperty(us,"__esModule",{value:!0}),us.Chrome74=void 0;const to=_(p);var ro=i;const no=_(a),ao=_(c),io=_(m),so=_(f);_=l;const oo=g,co=Hs,b=new ro.Logger("Chrome74"),po={OS:1024,MIS:1024};class lo extends _.HandlerInterface{static createFactory(){return()=>new lo}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome74"}close(){if(b.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){b.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=to.parse(e.sdp);return io.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return b.debug("getNativeSctpCapabilities()"),{numStreams:po}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){b.debug("run()"),this._direction=e,this._remoteSdp=new oo.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a}),this._sendingRtpParametersByKind={audio:ao.getSendingRtpParameters("audio",d),video:ao.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:ao.getSendingRemoteRtpParameters("audio",d),video:ao.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):(b.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.addEventListener("iceconnectionstatechange",()=>{switch(this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}))}async updateIceServers(e){b.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){b.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),b.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),b.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),b.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<t.length&&t.forEach((e,t)=>{e.rid="r"+t});var a=no.clone(this._sendingRtpParametersByKind[e.kind],{}),i=(a.codecs=ao.reduceCodecs(a.codecs,n),no.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),n=(i.codecs=ao.reduceCodecs(i.codecs,n),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let s=await this._pc.createOffer(),o=to.parse(s.sdp),c,d=(this._transportReady||await this.setupTransport({localDtlsRole:null!=(p=this._forcedLocalDtlsRole)?p:"client",localSdpObject:o}),!1);var p=(0,co.parse)((t||[{}])[0].scalabilityMode),p=(t&&1===t.length&&1<p.spatialLayers&&"video/vp9"===a.codecs[0].mimeType.toLowerCase()&&(b.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,o=to.parse(s.sdp),c=o.media[n.idx],so.addLegacySimulcast({offerMediaObject:c,numStreams:p.spatialLayers}),s={type:"offer",sdp:to.write(o)}),b.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),e.mid);if(a.mid=p,o=to.parse(this._pc.localDescription.sdp),c=o.media[n.idx],a.rtcp.cname=io.getCname({offerMediaObject:c}),t)if(1===t.length){let e=so.getRtpEncodings({offerMediaObject:c});Object.assign(e[0],t[0]),d&&(e=[e[0]]),a.encodings=e}else a.encodings=t;else a.encodings=so.getRtpEncodings({offerMediaObject:c});if(1<a.encodings.length&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(const l of a.encodings)l.scalabilityMode="S1T2";this._remoteSdp.send({offerMediaObject:c,reuseMid:n.reuseMid,offerRtpParameters:a,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});t={type:"answer",sdp:this._remoteSdp.getSdp()};return b.debug("send() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.set(p,e),{localId:p,rtpParameters:a,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),b.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),b.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),b.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),b.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),b.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";e=await this._pc.createOffer(),b.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),t={type:"answer",sdp:this._remoteSdp.getSdp()};b.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async replaceTrack(e,t){this.assertSendDirection(),t?b.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):b.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),b.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),b.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const n=e.sender.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.sender.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:a},t=(b.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%po.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=to.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),b.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},b.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[],n=new Map;for(const m of e){var{trackId:a,kind:i,rtpParameters:s,streamId:o}=m,c=(b.debug("receive() [trackId:%s, kind:%s]",a,i),s.mid||String(this._mapMidTransceiver.size));n.set(a,c),this._remoteSdp.receive({mid:c,kind:i,offerRtpParameters:s,streamId:o||s.rtcp.cname,trackId:a})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(b.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),p=to.parse(d.sdp);for(const f of e){var{trackId:l,rtpParameters:u}=f;const g=n.get(l);l=p.media.find(e=>String(e.mid)===g);io.applyCodecParameters({offerRtpParameters:u,answerMediaObject:l})}d={type:"answer",sdp:to.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:p}),b.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const v=n.get(h);h=this._pc.getTransceivers().find(e=>e.mid===v);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(v,h),r.push({localId:v,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){b.debug("stopReceiving() [localId:%s]",n);var t=this._mapMidTransceiver.get(n);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(b.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());b.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of e)this._mapMidTransceiver.delete(a)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){b.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();b.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){b.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();b.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i,protocol:r},n=(b.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),a={type:"offer",sdp:this._remoteSdp.getSdp()},b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=to.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),b.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||to.parse(this._pc.localDescription.sdp);const r=io.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}us.Chrome74=lo;var ro={},uo=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),ho=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),_=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&uo(t,e,r);return ho(t,e),t};Object.defineProperty(ro,"__esModule",{value:!0}),ro.Chrome70=void 0;const mo=_(p);var fo=i;const go=_(a),_o=_(c),vo=_(m),yo=_(f);_=l;const wo=g,bo=Hs,S=new fo.Logger("Chrome70"),So={OS:1024,MIS:1024};class Po extends _.HandlerInterface{static createFactory(){return()=>new Po}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome70"}close(){if(S.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){S.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=mo.parse(e.sdp);return vo.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return S.debug("getNativeSctpCapabilities()"),{numStreams:So}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){S.debug("run()"),this._direction=e,this._remoteSdp=new wo.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a}),this._sendingRtpParametersByKind={audio:_o.getSendingRtpParameters("audio",d),video:_o.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:_o.getSendingRemoteRtpParameters("audio",d),video:_o.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(S.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){S.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){S.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),S.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},S.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),S.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),S.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);var a=go.clone(this._sendingRtpParametersByKind[e.kind],{}),i=(a.codecs=_o.reduceCodecs(a.codecs,n),go.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),n=(i.codecs=_o.reduceCodecs(i.codecs,n),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let s=await this._pc.createOffer(),o=mo.parse(s.sdp),c,d=(this._transportReady||await this.setupTransport({localDtlsRole:null!=(p=this._forcedLocalDtlsRole)?p:"client",localSdpObject:o}),t&&1<t.length&&(S.debug("send() | enabling legacy simulcast"),o=mo.parse(s.sdp),c=o.media[n.idx],yo.addLegacySimulcast({offerMediaObject:c,numStreams:t.length}),s={type:"offer",sdp:mo.write(o)}),!1);var p=(0,bo.parse)((t||[{}])[0].scalabilityMode);if(t&&1===t.length&&1<p.spatialLayers&&"video/vp9"===a.codecs[0].mimeType.toLowerCase()&&(S.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,o=mo.parse(s.sdp),c=o.media[n.idx],yo.addLegacySimulcast({offerMediaObject:c,numStreams:p.spatialLayers}),s={type:"offer",sdp:mo.write(o)}),S.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),t){S.debug("send() | applying given encodings");var l=e.sender.getParameters();for(let e=0;e<(l.encodings||[]).length;++e){var u=l.encodings[e],h=t[e];if(!h)break;l.encodings[e]=Object.assign(u,h)}await e.sender.setParameters(l)}p=e.mid;if(a.mid=p,o=mo.parse(this._pc.localDescription.sdp),c=o.media[n.idx],a.rtcp.cname=vo.getCname({offerMediaObject:c}),a.encodings=yo.getRtpEncodings({offerMediaObject:c}),t)for(let e=0;e<a.encodings.length;++e)t[e]&&Object.assign(a.encodings[e],t[e]);if(d&&(a.encodings=[a.encodings[0]]),1<a.encodings.length&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(const m of a.encodings)m.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,reuseMid:n.reuseMid,offerRtpParameters:a,answerRtpParameters:i,codecOptions:r});n={type:"answer",sdp:this._remoteSdp.getSdp()};return S.debug("send() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.set(p,e),{localId:p,rtpParameters:a,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),S.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),S.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};S.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?S.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):S.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),S.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),S.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const n=e.sender.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.sender.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:a},t=(S.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%So.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=mo.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),S.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},S.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[],n=new Map;for(const m of e){var{trackId:a,kind:i,rtpParameters:s,streamId:o}=m,c=(S.debug("receive() [trackId:%s, kind:%s]",a,i),s.mid||String(this._mapMidTransceiver.size));n.set(a,c),this._remoteSdp.receive({mid:c,kind:i,offerRtpParameters:s,streamId:o||s.rtcp.cname,trackId:a})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(S.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),p=mo.parse(d.sdp);for(const f of e){var{trackId:l,rtpParameters:u}=f;const g=n.get(l);l=p.media.find(e=>String(e.mid)===g);vo.applyCodecParameters({offerRtpParameters:u,answerMediaObject:l})}d={type:"answer",sdp:mo.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:p}),S.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const v=n.get(h);h=this._pc.getTransceivers().find(e=>e.mid===v);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(v,h),r.push({localId:v,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){S.debug("stopReceiving() [localId:%s]",n);var t=this._mapMidTransceiver.get(n);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(S.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());S.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of e)this._mapMidTransceiver.delete(a)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:i,protocol:r},n=(S.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),a={type:"offer",sdp:this._remoteSdp.getSdp()},S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=mo.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),S.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||mo.parse(this._pc.localDescription.sdp);const r=vo.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}ro.Chrome70=Po;fo={},_={};Object.defineProperty(_,"__esModule",{value:!0}),_.addLegacySimulcast=_.getRtpEncodings=void 0,_.getRtpEncodings=function({offerMediaObject:e,track:t}){var r,n=new Set;for(const l of e.ssrcs||[])"msid"===l.attribute&&l.value.split(" ")[1]===t.id&&(r=l.id,n.add(r));if(0===n.size)throw new Error(`a=ssrc line with msid information not found [track.id:${t.id}]`);var a,i,s=new Map;for(const u of e.ssrcGroups||[])"FID"===u.semantics&&([a,i]=u.ssrcs.split(/\s+/),a=Number(a),i=Number(i),n.has(a))&&(n.delete(a),n.delete(i),s.set(a,i));for(const h of n)s.set(h,null);var o,c,d=[];for([o,c]of s){var p={ssrc:o};c&&(p.rtx={ssrc:c}),d.push(p)}return d},_.addLegacySimulcast=function({offerMediaObject:t,track:r,numStreams:n}){if(n<=1)throw new TypeError("numStreams must be greater than 1");let a,i,s;if(!(t.ssrcs||[]).find(e=>{return"msid"===e.attribute&&e.value.split(" ")[1]===r.id&&(a=e.id,s=e.value.split(" ")[0],!0)}))throw new Error(`a=ssrc line with msid information not found [track.id:${r.id}]`);(t.ssrcGroups||[]).some(e=>{return"FID"===e.semantics&&(e=e.ssrcs.split(/\s+/),Number(e[0])===a)&&(i=Number(e[1]),!0)});var e=t.ssrcs.find(e=>"cname"===e.attribute&&e.id===a);if(!e)throw new Error(`a=ssrc line with cname information not found [track.id:${r.id}]`);var o=e.value,c=[],d=[];for(let e=0;e<n;++e)c.push(a+e),i&&d.push(i+e);t.ssrcGroups=t.ssrcGroups||[],t.ssrcs=t.ssrcs||[],t.ssrcGroups.push({semantics:"SIM",ssrcs:c.join(" ")});for(let e=0;e<c.length;++e){var p=c[e];t.ssrcs.push({id:p,attribute:"cname",value:o}),t.ssrcs.push({id:p,attribute:"msid",value:s+" "+r.id})}for(let e=0;e<d.length;++e){var l=c[e],u=d[e];t.ssrcs.push({id:u,attribute:"cname",value:o}),t.ssrcs.push({id:u,attribute:"msid",value:s+" "+r.id}),t.ssrcGroups.push({semantics:"FID",ssrcs:l+" "+u})}};var Ro=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Co=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ro(t,e,r);return Co(t,e),t};Object.defineProperty(fo,"__esModule",{value:!0}),fo.Chrome67=void 0;const To=v(p);var Do=i;const ko=v(a),xo=v(c),Eo=v(m),Oo=v(_);v=l;const Mo=g,P=new Do.Logger("Chrome67"),Io={OS:1024,MIS:1024};class Lo extends v.HandlerInterface{static createFactory(){return()=>new Lo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome67"}close(){if(P.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){P.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=To.parse(e.sdp);return Eo.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return P.debug("getNativeSctpCapabilities()"),{numStreams:Io}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){P.debug("run()"),this._direction=e,this._remoteSdp=new Mo.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:xo.getSendingRtpParameters("audio",d),video:xo.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:xo.getSendingRemoteRtpParameters("audio",d),video:xo.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(P.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){P.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){P.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),P.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},P.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},P.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),P.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:n}){this.assertSendDirection(),P.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&P.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addTrack(t,this._sendStream);let a=await this._pc.createOffer(),i=To.parse(a.sdp),s;var o=ko.clone(this._sendingRtpParametersByKind[t.kind],{}),n=(o.codecs=xo.reduceCodecs(o.codecs),ko.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(n.codecs=xo.reduceCodecs(n.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:i}),"video"===t.kind&&r&&1<r.length&&(P.debug("send() | enabling simulcast"),i=To.parse(a.sdp),s=i.media.find(e=>"video"===e.type),Oo.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:r.length}),a={type:"offer",sdp:To.write(i)}),P.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),i=To.parse(this._pc.localDescription.sdp),s=i.media.find(e=>e.type===t.kind),o.rtcp.cname=Eo.getCname({offerMediaObject:s}),o.encodings=Oo.getRtpEncodings({offerMediaObject:s,track:t}),r)for(let e=0;e<o.encodings.length;++e)r[e]&&Object.assign(o.encodings[e],r[e]);if(1<o.encodings.length&&"video/vp8"===o.codecs[0].mimeType.toLowerCase())for(const d of o.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:n,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},n=(P.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId)),e=(this._nextSendLocalId++,this._pc.getSenders().find(e=>e.track===t));return this._mapSendLocalIdRtpSender.set(n,e),{localId:n,rtpParameters:o,rtpSender:e}}async stopSending(e){this.assertSendDirection(),P.debug("stopSending() [localId:%s]",e);var t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");this._pc.removeTrack(t),t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);t=await this._pc.createOffer();P.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void P.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(e={type:"answer",sdp:this._remoteSdp.getSdp()},P.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?P.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):P.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var r=e.track;await e.replaceTrack(t),r&&this._sendStream.removeTrack(r),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),P.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var t=e.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),P.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");const n=e.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapSendLocalIdRtpSender.get(e);if(e)return e.getStats();throw new Error("associated RTCRtpSender not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:a},t=(P.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Io.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=To.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),P.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},P.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[];for(const f of e){var{trackId:n,kind:a,rtpParameters:i,streamId:s}=f,o=(P.debug("receive() [trackId:%s, kind:%s]",n,a),a);this._remoteSdp.receive({mid:o,kind:a,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var c={type:"offer",sdp:this._remoteSdp.getSdp()},c=(P.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c),await this._pc.createAnswer()),d=To.parse(c.sdp);for(const g of e){var{kind:p,rtpParameters:l}=g;const _=p;p=d.media.find(e=>String(e.mid)===_);Eo.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}c={type:"answer",sdp:To.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:d}),P.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const v of e){var{kind:u,trackId:h,rtpParameters:m}=v;const y=h;h=u,u=this._pc.getReceivers().find(e=>e.track&&e.track.id===y);if(!u)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(y,{mid:h,rtpParameters:m,rtpReceiver:u}),r.push({localId:y,track:u.track,rtpReceiver:u})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){P.debug("stopReceiving() [localId:%s]",n);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},P.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();P.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){this.assertRecvDirection();e=(this._mapRecvLocalIdInfo.get(e)||{}).rtpReceiver;if(e)return e.getStats();throw new Error("associated RTCRtpReceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:i,protocol:r},n=(P.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),a={type:"offer",sdp:this._remoteSdp.getSdp()},P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=To.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),P.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||To.parse(this._pc.localDescription.sdp);const r=Eo.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}fo.Chrome67=Lo;var Do={},jo=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),No=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&jo(t,e,r);return No(t,e),t};Object.defineProperty(Do,"__esModule",{value:!0}),Do.Chrome55=void 0;const Ao=v(p);var Vo=i;const Fo=r,Bo=v(a),Uo=v(c),zo=v(m),Ho=v(_);v=l;const Go=g,C=new Vo.Logger("Chrome55"),$o={OS:1024,MIS:1024};class Jo extends v.HandlerInterface{static createFactory(){return()=>new Jo}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Chrome55"}close(){if(C.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){C.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=Ao.parse(e.sdp);return zo.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return C.debug("getNativeSctpCapabilities()"),{numStreams:$o}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){C.debug("run()"),this._direction=e,this._remoteSdp=new Go.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:Uo.getSendingRtpParameters("audio",d),video:Uo.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Uo.getSendingRemoteRtpParameters("audio",d),video:Uo.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(C.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){C.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){C.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),C.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),C.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:n}){this.assertSendDirection(),C.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&C.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),i=Ao.parse(a.sdp),s;var o=Bo.clone(this._sendingRtpParametersByKind[t.kind],{}),n=(o.codecs=Uo.reduceCodecs(o.codecs),Bo.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(n.codecs=Uo.reduceCodecs(n.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:i}),"video"===t.kind&&r&&1<r.length&&(C.debug("send() | enabling simulcast"),i=Ao.parse(a.sdp),s=i.media.find(e=>"video"===e.type),Ho.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:r.length}),a={type:"offer",sdp:Ao.write(i)}),C.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),i=Ao.parse(this._pc.localDescription.sdp),s=i.media.find(e=>e.type===t.kind),o.rtcp.cname=zo.getCname({offerMediaObject:s}),o.encodings=Ho.getRtpEncodings({offerMediaObject:s,track:t}),r)for(let e=0;e<o.encodings.length;++e)r[e]&&Object.assign(o.encodings[e],r[e]);if(1<o.encodings.length&&"video/vp8"===o.codecs[0].mimeType.toLowerCase())for(const d of o.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:n,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},n=(C.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId));return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(n,t),{localId:n,rtpParameters:o}}async stopSending(e){this.assertSendDirection(),C.debug("stopSending() [localId:%s]",e);var t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);e=await this._pc.createOffer();C.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(e){if(0===this._sendStream.getTracks().length)return void C.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(t={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new Fo.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new Fo.UnsupportedError(" not implemented")}async setRtpEncodingParameters(e,t){throw new Fo.UnsupportedError("not supported")}async getSenderStats(e){throw new Fo.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:a},t=(C.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%$o.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=Ao.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),C.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},C.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[];for(const g of e){var{trackId:n,kind:a,rtpParameters:i,streamId:s}=g,o=(C.debug("receive() [trackId:%s, kind:%s]",n,a),a);this._remoteSdp.receive({mid:o,kind:a,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var c={type:"offer",sdp:this._remoteSdp.getSdp()},c=(C.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c),await this._pc.createAnswer()),d=Ao.parse(c.sdp);for(const _ of e){var{kind:p,rtpParameters:l}=_;const v=p;p=d.media.find(e=>String(e.mid)===v);zo.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}c={type:"answer",sdp:Ao.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:d}),C.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const y of e){var{kind:u,trackId:h,rtpParameters:m}=y;const w=y.streamId||m.rtcp.cname;var f=this._pc.getRemoteStreams().find(e=>e.id===w).getTrackById(h);if(!f)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(h,{mid:u,rtpParameters:m}),r.push({localId:h,track:f})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){C.debug("stopReceiving() [localId:%s]",n);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();C.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new Fo.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:i,protocol:r},n=(C.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),a={type:"offer",sdp:this._remoteSdp.getSdp()},C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=Ao.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),C.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||Ao.parse(this._pc.localDescription.sdp);const r=zo.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Do.Chrome55=Jo;var Vo={},Wo=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),qo=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Wo(t,e,r);return qo(t,e),t};Object.defineProperty(Vo,"__esModule",{value:!0}),Vo.Firefox60=void 0;const Ko=v(p);var Qo=i;const Xo=r,Yo=v(a),Zo=v(c),ec=v(m),tc=v(f);v=l;const rc=g,T=new Qo.Logger("Firefox60"),nc={OS:16,MIS:2048};class ac extends v.HandlerInterface{static createFactory(){return()=>new ac}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Firefox60"}close(){if(T.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){T.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),r=document.createElement("canvas");r.getContext("2d");var n=r.captureStream().getVideoTracks()[0];try{t.addTransceiver("audio",{direction:"sendrecv"});var e=t.addTransceiver(n,{direction:"sendrecv"}),a=e.sender.getParameters(),i=[{rid:"r0",maxBitrate:1e5},{rid:"r1",maxBitrate:5e5}],s=(a.encodings=i,await e.sender.setParameters(a),await t.createOffer());try{r.remove()}catch(e){}try{n.stop()}catch(e){}try{t.close()}catch(e){}var o=Ko.parse(s.sdp);return ec.extractRtpCapabilities({sdpObject:o})}catch(e){try{r.remove()}catch(e){}try{n.stop()}catch(e){}try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return T.debug("getNativeSctpCapabilities()"),{numStreams:nc}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){T.debug("run()"),this._direction=e,this._remoteSdp=new rc.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a}),this._sendingRtpParametersByKind={audio:Zo.getSendingRtpParameters("audio",d),video:Zo.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Zo.getSendingRemoteRtpParameters("audio",d),video:Zo.getSendingRemoteRtpParameters("video",d)},this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(T.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){throw new Xo.UnsupportedError("not supported")}async restartIce(e){T.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),T.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),T.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),T.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<(t=Yo.clone(t,[])).length&&(t.forEach((e,t)=>{e.rid="r"+t}),t.reverse());var a=Yo.clone(this._sendingRtpParametersByKind[e.kind],{}),i=(a.codecs=Zo.reduceCodecs(a.codecs,n),Yo.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),n=(i.codecs=Zo.reduceCodecs(i.codecs,n),this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]})),e=(t&&((e=n.sender.getParameters()).encodings=t,await n.sender.setParameters(e)),await this._pc.createOffer()),s=Ko.parse(e.sdp),e=(this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:s}),T.debug("send() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),n.mid),s=(a.mid=e,(s=Ko.parse(this._pc.localDescription.sdp)).media[s.media.length-1]);if(a.rtcp.cname=ec.getCname({offerMediaObject:s}),t?1===t.length?(o=tc.getRtpEncodings({offerMediaObject:s}),Object.assign(o[0],t[0]),a.encodings=o):a.encodings=t.reverse():a.encodings=tc.getRtpEncodings({offerMediaObject:s}),1<a.encodings.length&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(const c of a.encodings)c.scalabilityMode="S1T2";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:a,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});var o={type:"answer",sdp:this._remoteSdp.getSdp()};return T.debug("send() | calling pc.setRemoteDescription() [answer:%o]",o),await this._pc.setRemoteDescription(o),this._mapMidTransceiver.set(e,n),{localId:e,rtpParameters:a,rtpSender:n.sender}}async stopSending(e){T.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated transceiver not found");t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.disableMediaSection(t.mid);t=await this._pc.createOffer(),T.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),T.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),T.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),T.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);t=await this._pc.createOffer(),T.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};T.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async replaceTrack(e,t){this.assertSendDirection(),t?T.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):T.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),T.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated transceiver not found");var t=e.sender.getParameters();r=t.encodings.length-1-r,t.encodings.forEach((e,t)=>{e.active=r<=t}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),T.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const n=e.sender.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.sender.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:a},T.debug("sendDataChannel() [options:%o]",e),t=this._pc.createDataChannel(n,e),this._nextSendSctpStreamId=++this._nextSendSctpStreamId%nc.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=Ko.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:a}),T.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),a={type:"answer",sdp:this._remoteSdp.getSdp()},T.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",a),await this._pc.setRemoteDescription(a),this._hasDataChannelMediaSection=!0),r={streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits};return{dataChannel:t,sctpStreamParameters:r}}async receive(e){this.assertRecvDirection();var t=[],r=new Map;for(const m of e){var{trackId:n,kind:a,rtpParameters:i,streamId:s}=m,o=(T.debug("receive() [trackId:%s, kind:%s]",n,a),i.mid||String(this._mapMidTransceiver.size));r.set(n,o),this._remoteSdp.receive({mid:o,kind:a,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var c={type:"offer",sdp:this._remoteSdp.getSdp()};T.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c);let d=await this._pc.createAnswer();var p=Ko.parse(d.sdp);for(const f of e){var{trackId:l,rtpParameters:u}=f;const g=r.get(l);l=p.media.find(e=>String(e.mid)===g);ec.applyCodecParameters({offerRtpParameters:u,answerMediaObject:l}),d={type:"answer",sdp:Ko.write(p)}}this._transportReady||await this.setupTransport({localDtlsRole:"client",localSdpObject:p}),T.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const v=r.get(h);h=this._pc.getTransceivers().find(e=>e.mid===v);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(v,h),t.push({localId:v,track:h.receiver.track,rtpReceiver:h.receiver})}return t}async stopReceiving(e){this.assertRecvDirection();for(const n of e){T.debug("stopReceiving() [localId:%s]",n);var t=this._mapMidTransceiver.get(n);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(T.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());T.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of e)this._mapMidTransceiver.delete(a)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){T.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();T.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){T.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();T.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i,protocol:r},n=(T.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),a={type:"offer",sdp:this._remoteSdp.getSdp()},T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=Ko.parse(i.sdp),await this.setupTransport({localDtlsRole:"client",localSdpObject:r})),T.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||Ko.parse(this._pc.localDescription.sdp);const r=ec.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Vo.Firefox60=ac;var Qo={},ic=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),sc=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&ic(t,e,r);return sc(t,e),t};Object.defineProperty(Qo,"__esModule",{value:!0}),Qo.Safari12=void 0;const oc=v(p);var cc=i;const dc=v(a),pc=v(c),lc=v(m),uc=v(f);v=l;const hc=g,D=new cc.Logger("Safari12"),mc={OS:1024,MIS:1024};class fc extends v.HandlerInterface{static createFactory(){return()=>new fc}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari12"}close(){if(D.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){D.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=oc.parse(e.sdp);return lc.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return D.debug("getNativeSctpCapabilities()"),{numStreams:mc}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){D.debug("run()"),this._direction=e,this._remoteSdp=new hc.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a}),this._sendingRtpParametersByKind={audio:pc.getSendingRtpParameters("audio",d),video:pc.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:pc.getSendingRemoteRtpParameters("audio",d),video:pc.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(D.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){D.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){D.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),D.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},D.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},D.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),D.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),D.debug("send() [kind:%s, track.id:%s]",e.kind,e.id);var a=dc.clone(this._sendingRtpParametersByKind[e.kind],{}),i=(a.codecs=pc.reduceCodecs(a.codecs,n),dc.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),n=(i.codecs=pc.reduceCodecs(i.codecs,n),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream]});let s=await this._pc.createOffer(),o=oc.parse(s.sdp),c;this._transportReady||await this.setupTransport({localDtlsRole:null!=(d=this._forcedLocalDtlsRole)?d:"client",localSdpObject:o}),t&&1<t.length&&(D.debug("send() | enabling legacy simulcast"),o=oc.parse(s.sdp),c=o.media[n.idx],uc.addLegacySimulcast({offerMediaObject:c,numStreams:t.length}),s={type:"offer",sdp:oc.write(o)}),D.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s);var d=e.mid;if(a.mid=d,o=oc.parse(this._pc.localDescription.sdp),c=o.media[n.idx],a.rtcp.cname=lc.getCname({offerMediaObject:c}),a.encodings=uc.getRtpEncodings({offerMediaObject:c}),t)for(let e=0;e<a.encodings.length;++e)t[e]&&Object.assign(a.encodings[e],t[e]);if(1<a.encodings.length&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(const p of a.encodings)p.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,reuseMid:n.reuseMid,offerRtpParameters:a,answerRtpParameters:i,codecOptions:r});n={type:"answer",sdp:this._remoteSdp.getSdp()};return D.debug("send() | calling pc.setRemoteDescription() [answer:%o]",n),await this._pc.setRemoteDescription(n),this._mapMidTransceiver.set(d,e),{localId:d,rtpParameters:a,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),D.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),D.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};D.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),D.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),D.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};D.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),D.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly",this._remoteSdp.resumeSendingMediaSection(e);t=await this._pc.createOffer(),D.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};D.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async replaceTrack(e,t){this.assertSendDirection(),t?D.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):D.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),D.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),D.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const n=e.sender.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.sender.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:a},t=(D.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%mc.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=oc.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),D.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},D.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[],n=new Map;for(const m of e){var{trackId:a,kind:i,rtpParameters:s,streamId:o}=m,c=(D.debug("receive() [trackId:%s, kind:%s]",a,i),s.mid||String(this._mapMidTransceiver.size));n.set(a,c),this._remoteSdp.receive({mid:c,kind:i,offerRtpParameters:s,streamId:o||s.rtcp.cname,trackId:a})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(D.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),p=oc.parse(d.sdp);for(const f of e){var{trackId:l,rtpParameters:u}=f;const g=n.get(l);l=p.media.find(e=>String(e.mid)===g);lc.applyCodecParameters({offerRtpParameters:u,answerMediaObject:l})}d={type:"answer",sdp:oc.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:p}),D.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const v=n.get(h);h=this._pc.getTransceivers().find(e=>e.mid===v);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(v,h),r.push({localId:v,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){D.debug("stopReceiving() [localId:%s]",n);var t=this._mapMidTransceiver.get(n);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(D.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());D.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of e)this._mapMidTransceiver.delete(a)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){D.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},D.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();D.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){D.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},D.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();D.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i,protocol:r},n=(D.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),a={type:"offer",sdp:this._remoteSdp.getSdp()},D.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=oc.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),D.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||oc.parse(this._pc.localDescription.sdp);const r=lc.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}Qo.Safari12=fc;var cc={},gc=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),_c=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),v=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&gc(t,e,r);return _c(t,e),t};Object.defineProperty(cc,"__esModule",{value:!0}),cc.Safari11=void 0;const vc=v(p);var yc=i;const wc=v(a),bc=v(c),Sc=v(m),Pc=v(_);v=l;const Rc=g,k=new yc.Logger("Safari11"),Cc={OS:1024,MIS:1024};class Tc extends v.HandlerInterface{static createFactory(){return()=>new Tc}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdRtpSender=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"Safari11"}close(){if(k.debug("close()"),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){k.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=vc.parse(e.sdp);return Sc.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return k.debug("getNativeSctpCapabilities()"),{numStreams:Cc}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){k.debug("run()"),this._direction=e,this._remoteSdp=new Rc.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:bc.getSendingRtpParameters("audio",d),video:bc.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:bc.getSendingRemoteRtpParameters("audio",d),video:bc.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(k.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){k.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){k.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),k.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},k.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),k.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:n}){this.assertSendDirection(),k.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&k.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addTrack(t,this._sendStream);let a=await this._pc.createOffer(),i=vc.parse(a.sdp),s;var o=wc.clone(this._sendingRtpParametersByKind[t.kind],{}),n=(o.codecs=bc.reduceCodecs(o.codecs),wc.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(n.codecs=bc.reduceCodecs(n.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:i}),"video"===t.kind&&r&&1<r.length&&(k.debug("send() | enabling simulcast"),i=vc.parse(a.sdp),s=i.media.find(e=>"video"===e.type),Pc.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:r.length}),a={type:"offer",sdp:vc.write(i)}),k.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),i=vc.parse(this._pc.localDescription.sdp),s=i.media.find(e=>e.type===t.kind),o.rtcp.cname=Sc.getCname({offerMediaObject:s}),o.encodings=Pc.getRtpEncodings({offerMediaObject:s,track:t}),r)for(let e=0;e<o.encodings.length;++e)r[e]&&Object.assign(o.encodings[e],r[e]);if(1<o.encodings.length&&"video/vp8"===o.codecs[0].mimeType.toLowerCase())for(const d of o.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:n,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},n=(k.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId)),e=(this._nextSendLocalId++,this._pc.getSenders().find(e=>e.track===t));return this._mapSendLocalIdRtpSender.set(n,e),{localId:n,rtpParameters:o,rtpSender:e}}async stopSending(e){this.assertSendDirection();var t=this._mapSendLocalIdRtpSender.get(e);if(!t)throw new Error("associated RTCRtpSender not found");t.track&&this._sendStream.removeTrack(t.track),this._mapSendLocalIdRtpSender.delete(e);t=await this._pc.createOffer();k.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t);try{await this._pc.setLocalDescription(t)}catch(e){if(0===this._sendStream.getTracks().length)return void k.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(e={type:"answer",sdp:this._remoteSdp.getSdp()},k.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){this.assertSendDirection(),t?k.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):k.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var r=e.track;await e.replaceTrack(t),r&&this._sendStream.removeTrack(r),t&&this._sendStream.addTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),k.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");var t=e.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),k.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapSendLocalIdRtpSender.get(e);if(!e)throw new Error("associated RTCRtpSender not found");const n=e.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapSendLocalIdRtpSender.get(e);if(e)return e.getStats();throw new Error("associated RTCRtpSender not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:a},t=(k.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Cc.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=vc.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),k.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},k.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[];for(const f of e){var{trackId:n,kind:a,rtpParameters:i,streamId:s}=f,o=(k.debug("receive() [trackId:%s, kind:%s]",n,a),a);this._remoteSdp.receive({mid:o,kind:a,offerRtpParameters:i,streamId:s||i.rtcp.cname,trackId:n})}var c={type:"offer",sdp:this._remoteSdp.getSdp()},c=(k.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",c),await this._pc.setRemoteDescription(c),await this._pc.createAnswer()),d=vc.parse(c.sdp);for(const g of e){var{kind:p,rtpParameters:l}=g;const _=p;p=d.media.find(e=>String(e.mid)===_);Sc.applyCodecParameters({offerRtpParameters:l,answerMediaObject:p})}c={type:"answer",sdp:vc.write(d)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:d}),k.debug("receive() | calling pc.setLocalDescription() [answer:%o]",c),await this._pc.setLocalDescription(c);for(const v of e){var{kind:u,trackId:h,rtpParameters:m}=v;const y=h;h=this._pc.getReceivers().find(e=>e.track&&e.track.id===y);if(!h)throw new Error("new RTCRtpReceiver not");this._mapRecvLocalIdInfo.set(y,{mid:u,rtpParameters:m,rtpReceiver:h}),r.push({localId:y,track:h.track,rtpReceiver:h})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){k.debug("stopReceiving() [localId:%s]",n);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},k.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();k.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=(this._mapRecvLocalIdInfo.get(e)||{}).rtpReceiver;if(e)return e.getStats();throw new Error("associated RTCRtpReceiver not found")}async pauseReceiving(e){}async resumeReceiving(e){}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i,protocol:r},n=(k.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),a={type:"offer",sdp:this._remoteSdp.getSdp()},k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=vc.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),k.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||vc.parse(this._pc.localDescription.sdp);const r=Sc.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}cc.Safari11=Tc;var yc={},v={},Dc=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),kc=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),x=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Dc(t,e,r);return kc(t,e),t};Object.defineProperty(v,"__esModule",{value:!0}),v.mangleRtpParameters=v.getCapabilities=void 0;const xc=x(a);v.getCapabilities=function(){var e,t=RTCRtpReceiver.getCapabilities();for(const r of(t=xc.clone(t,{})).codecs){r.channels=r.numChannels,delete r.numChannels,r.mimeType=r.mimeType||r.kind+"/"+r.name,r.parameters&&((e=r.parameters).apt&&(e.apt=Number(e.apt)),e["packetization-mode"])&&(e["packetization-mode"]=Number(e["packetization-mode"]));for(const n of r.rtcpFeedback||[])n.parameter||(n.parameter="")}return t},v.mangleRtpParameters=function(e){(e=xc.clone(e,{})).mid&&(e.muxId=e.mid,delete e.mid);for(const t of e.codecs)t.channels&&(t.numChannels=t.channels,delete t.channels),t.mimeType&&!t.name&&(t.name=t.mimeType.split("/")[1]),delete t.mimeType;return e};var Ec=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Oc=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),x=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ec(t,e,r);return Oc(t,e),t},E=(Object.defineProperty(yc,"__esModule",{value:!0}),yc.Edge11=void 0,i);const Mc=r,Ic=x(a),Lc=x(c),jc=x(v);x=l;const O=new E.Logger("Edge11");class Nc extends x.HandlerInterface{static createFactory(){return()=>new Nc}constructor(){super(),this._rtpSenders=new Map,this._rtpReceivers=new Map,this._nextSendLocalId=0,this._transportReady=!1}get name(){return"Edge11"}close(){O.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}for(const e of this._rtpSenders.values())try{e.stop()}catch(e){}for(const t of this._rtpReceivers.values())try{t.stop()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){return O.debug("getNativeRtpCapabilities()"),jc.getCapabilities()}async getNativeSctpCapabilities(){return O.debug("getNativeSctpCapabilities()"),{numStreams:{OS:0,MIS:0}}}run({iceParameters:e,iceCandidates:t,dtlsParameters:r,iceServers:n,iceTransportPolicy:a,extendedRtpCapabilities:i}){O.debug("run()"),this._sendingRtpParametersByKind={audio:Lc.getSendingRtpParameters("audio",i),video:Lc.getSendingRtpParameters("video",i)},this._remoteIceParameters=e,this._remoteIceCandidates=t,this._remoteDtlsParameters=r,this._cname="CNAME-"+Ic.generateRandomNumber(),this.setIceGatherer({iceServers:n,iceTransportPolicy:a}),this.setIceTransport(),this.setDtlsTransport()}async updateIceServers(e){throw new Mc.UnsupportedError("not supported")}async restartIce(e){if(O.debug("restartIce()"),this._remoteIceParameters=e,this._transportReady){O.debug("restartIce() | calling iceTransport.start()"),this._iceTransport.start(this._iceGatherer,e,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({})}}async getTransportStats(){return this._iceTransport.getStats()}async send({track:e,encodings:t,codec:r}){O.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),this._transportReady||await this.setupTransport({localDtlsRole:"server"}),O.debug("send() | calling new RTCRtpSender()");var n=new RTCRtpSender(e,this._dtlsTransport),e=Ic.clone(this._sendingRtpParametersByKind[e.kind],{}),a=(e.codecs=Lc.reduceCodecs(e.codecs,r),e.codecs.some(e=>/.+\/rtx$/i.test(e.mimeType)));for(const i of t=t||[{}])i.ssrc=Ic.generateRandomNumber(),a&&(i.rtx={ssrc:Ic.generateRandomNumber()});e.encodings=t,e.rtcp={cname:this._cname,reducedSize:!0,mux:!0};r=jc.mangleRtpParameters(e),O.debug("send() | calling rtpSender.send() [params:%o]",r),await n.send(r),t=String(this._nextSendLocalId);return this._nextSendLocalId++,this._rtpSenders.set(t,n),{localId:t,rtpParameters:e,rtpSender:n}}async stopSending(e){O.debug("stopSending() [localId:%s]",e);var t=this._rtpSenders.get(e);if(!t)throw new Error("RTCRtpSender not found");this._rtpSenders.delete(e);try{O.debug("stopSending() | calling rtpSender.stop()"),t.stop()}catch(e){throw O.warn("stopSending() | rtpSender.stop() failed:%o",e),e}}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){t?O.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):O.debug("replaceTrack() [localId:%s, no track]",e);e=this._rtpSenders.get(e);if(!e)throw new Error("RTCRtpSender not found");e.setTrack(t)}async setMaxSpatialLayer(e,r){O.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._rtpSenders.get(e);if(!e)throw new Error("RTCRtpSender not found");var t=e.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.setParameters(t)}async setRtpEncodingParameters(e,r){O.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._rtpSenders.get(e);if(!e)throw new Error("RTCRtpSender not found");const n=e.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.setParameters(n)}async getSenderStats(e){e=this._rtpSenders.get(e);if(e)return e.getStats();throw new Error("RTCRtpSender not found")}async sendDataChannel(e){throw new Mc.UnsupportedError("not implemented")}async receive(e){var t=[];for(const o of e){var{trackId:r,kind:n}=o;O.debug("receive() [trackId:%s, kind:%s]",r,n)}this._transportReady||await this.setupTransport({localDtlsRole:"server"});for(const c of e){var{trackId:a,kind:i,rtpParameters:s}=c,i=(O.debug("receive() | calling new RTCRtpReceiver()"),new RTCRtpReceiver(this._dtlsTransport,i)),s=(i.addEventListener("error",e=>{O.error('rtpReceiver "error" event [event:%o]',e)}),jc.mangleRtpParameters(s)),s=(O.debug("receive() | calling rtpReceiver.receive() [params:%o]",s),await i.receive(s),a);this._rtpReceivers.set(s,i),t.push({localId:s,track:i.track,rtpReceiver:i})}return t}async stopReceiving(e){for(const r of e){O.debug("stopReceiving() [localId:%s]",r);var t=this._rtpReceivers.get(r);if(!t)throw new Error("RTCRtpReceiver not found");this._rtpReceivers.delete(r);try{O.debug("stopReceiving() | calling rtpReceiver.stop()"),t.stop()}catch(e){O.warn("stopReceiving() | rtpReceiver.stop() failed:%o",e)}}}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){e=this._rtpReceivers.get(e);if(e)return e.getStats();throw new Error("RTCRtpReceiver not found")}async receiveDataChannel(e){throw new Mc.UnsupportedError("not implemented")}setIceGatherer({iceServers:e,iceTransportPolicy:t}){e=new RTCIceGatherer({iceServers:e||[],gatherPolicy:t||"all"});e.addEventListener("error",e=>{O.error('iceGatherer "error" event [event:%o]',e)});try{e.gather()}catch(e){O.debug("setIceGatherer() | iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=e}setIceTransport(){const e=new RTCIceTransport(this._iceGatherer);e.addEventListener("statechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("icestatechange",()=>{switch(e.state){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}}),e.addEventListener("candidatepairchange",e=>{O.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=e}setDtlsTransport(){const e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",()=>{O.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",()=>{O.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state),"closed"===e.state&&this.emit("@connectionstatechange","closed")}),e.addEventListener("error",e=>{O.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}async setupTransport({localDtlsRole:e}){O.debug("setupTransport()");const r=this._dtlsTransport.getLocalParameters();r.role=e,await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._iceTransport.start(this._iceGatherer,this._remoteIceParameters,"controlling");for(const t of this._remoteIceCandidates)this._iceTransport.addRemoteCandidate(t);this._iceTransport.addRemoteCandidate({}),this._remoteDtlsParameters.fingerprints=this._remoteDtlsParameters.fingerprints.filter(e=>"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm),this._dtlsTransport.start(this._remoteDtlsParameters),this._transportReady=!0}}yc.Edge11=Nc;var v={},Ac=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Vc=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),E=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Ac(t,e,r);return Vc(t,e),t};Object.defineProperty(v,"__esModule",{value:!0}),v.ReactNativeUnifiedPlan=void 0;const Fc=E(p);x=i;const Bc=E(a),Uc=E(c),zc=E(m),Hc=E(f);E=l;const Gc=g,$c=Hs,M=new x.Logger("ReactNativeUnifiedPlan"),Jc={OS:1024,MIS:1024};class Wc extends E.HandlerInterface{static createFactory(){return()=>new Wc}constructor(){super(),this._mapMidTransceiver=new Map,this._sendStream=new MediaStream,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNativeUnifiedPlan"}close(){if(M.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){M.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan"});try{t.addTransceiver("audio"),t.addTransceiver("video");var e=await t.createOffer();try{t.close()}catch(e){}var r=Fc.parse(e.sdp);return zc.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return M.debug("getNativeSctpCapabilities()"),{numStreams:Jc}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){M.debug("run()"),this._direction=e,this._remoteSdp=new Gc.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a}),this._sendingRtpParametersByKind={audio:Uc.getSendingRtpParameters("audio",d),video:Uc.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Uc.getSendingRemoteRtpParameters("audio",d),video:Uc.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(M.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){M.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){M.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),M.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},M.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},M.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),M.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:e,encodings:t,codecOptions:r,codec:n}){this.assertSendDirection(),M.debug("send() [kind:%s, track.id:%s]",e.kind,e.id),t&&1<t.length&&t.forEach((e,t)=>{e.rid="r"+t});var a=Bc.clone(this._sendingRtpParametersByKind[e.kind],{}),i=(a.codecs=Uc.reduceCodecs(a.codecs,n),Bc.clone(this._sendingRemoteRtpParametersByKind[e.kind],{})),n=(i.codecs=Uc.reduceCodecs(i.codecs,n),this._remoteSdp.getNextMediaSectionIdx()),e=this._pc.addTransceiver(e,{direction:"sendonly",streams:[this._sendStream],sendEncodings:t});let s=await this._pc.createOffer(),o=Fc.parse(s.sdp),c,d=(this._transportReady||await this.setupTransport({localDtlsRole:null!=(p=this._forcedLocalDtlsRole)?p:"client",localSdpObject:o}),!1);var p=(0,$c.parse)((t||[{}])[0].scalabilityMode),p=(t&&1===t.length&&1<p.spatialLayers&&"video/vp9"===a.codecs[0].mimeType.toLowerCase()&&(M.debug("send() | enabling legacy simulcast for VP9 SVC"),d=!0,o=Fc.parse(s.sdp),c=o.media[n.idx],Hc.addLegacySimulcast({offerMediaObject:c,numStreams:p.spatialLayers}),s={type:"offer",sdp:Fc.write(o)}),M.debug("send() | calling pc.setLocalDescription() [offer:%o]",s),await this._pc.setLocalDescription(s),e.mid);if(a.mid=p,o=Fc.parse(this._pc.localDescription.sdp),c=o.media[n.idx],a.rtcp.cname=zc.getCname({offerMediaObject:c}),t)if(1===t.length){let e=Hc.getRtpEncodings({offerMediaObject:c});Object.assign(e[0],t[0]),d&&(e=[e[0]]),a.encodings=e}else a.encodings=t;else a.encodings=Hc.getRtpEncodings({offerMediaObject:c});if(1<a.encodings.length&&("video/vp8"===a.codecs[0].mimeType.toLowerCase()||"video/h264"===a.codecs[0].mimeType.toLowerCase()))for(const l of a.encodings)l.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:c,reuseMid:n.reuseMid,offerRtpParameters:a,answerRtpParameters:i,codecOptions:r,extmapAllowMixed:!0});t={type:"answer",sdp:this._remoteSdp.getSdp()};return M.debug("send() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.set(p,e),{localId:p,rtpParameters:a,rtpSender:e.sender}}async stopSending(e){this.assertSendDirection(),M.debug("stopSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");if(t.sender.replaceTrack(null),this._pc.removeTrack(t.sender),this._remoteSdp.closeMediaSection(t.mid))try{t.stop()}catch(e){}t=await this._pc.createOffer(),M.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),t={type:"answer",sdp:this._remoteSdp.getSdp()};M.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t),this._mapMidTransceiver.delete(e)}async pauseSending(e){this.assertSendDirection(),M.debug("pauseSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(e);t=await this._pc.createOffer(),M.debug("pauseSending() | calling pc.setLocalDescription() [offer:%o]",t),await this._pc.setLocalDescription(t),e={type:"answer",sdp:this._remoteSdp.getSdp()};M.debug("pauseSending() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)}async resumeSending(e){this.assertSendDirection(),M.debug("resumeSending() [localId:%s]",e);var t=this._mapMidTransceiver.get(e);if(this._remoteSdp.resumeSendingMediaSection(e),!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="sendonly";e=await this._pc.createOffer(),M.debug("resumeSending() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),t={type:"answer",sdp:this._remoteSdp.getSdp()};M.debug("resumeSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t)}async replaceTrack(e,t){this.assertSendDirection(),t?M.debug("replaceTrack() [localId:%s, track.id:%s]",e,t.id):M.debug("replaceTrack() [localId:%s, no track]",e);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");await e.sender.replaceTrack(t)}async setMaxSpatialLayer(e,r){this.assertSendDirection(),M.debug("setMaxSpatialLayer() [localId:%s, spatialLayer:%s]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");var t=e.sender.getParameters();t.encodings.forEach((e,t)=>{e.active=t<=r}),await e.sender.setParameters(t)}async setRtpEncodingParameters(e,r){this.assertSendDirection(),M.debug("setRtpEncodingParameters() [localId:%s, params:%o]",e,r);e=this._mapMidTransceiver.get(e);if(!e)throw new Error("associated RTCRtpTransceiver not found");const n=e.sender.getParameters();n.encodings.forEach((e,t)=>{n.encodings[t]={...e,...r}}),await e.sender.setParameters(n)}async getSenderStats(e){this.assertSendDirection();e=this._mapMidTransceiver.get(e);if(e)return e.sender.getStats();throw new Error("associated RTCRtpTransceiver not found")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmits:r,protocol:a},t=(M.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%Jc.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=Fc.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),M.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},M.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[],n=new Map;for(const m of e){var{trackId:a,kind:i,rtpParameters:s,streamId:o}=m,c=(M.debug("receive() [trackId:%s, kind:%s]",a,i),s.mid||String(this._mapMidTransceiver.size));n.set(a,c),this._remoteSdp.receive({mid:c,kind:i,offerRtpParameters:s,streamId:o||s.rtcp.cname,trackId:a})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(M.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),p=Fc.parse(d.sdp);for(const f of e){var{trackId:l,rtpParameters:u}=f;const g=n.get(l);l=p.media.find(e=>String(e.mid)===g);zc.applyCodecParameters({offerRtpParameters:u,answerMediaObject:l})}d={type:"answer",sdp:Fc.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:p}),M.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const _ of e){var h=_["trackId"];const v=n.get(h);h=this._pc.getTransceivers().find(e=>e.mid===v);if(!h)throw new Error("new RTCRtpTransceiver not found");this._mapMidTransceiver.set(v,h),r.push({localId:v,track:h.receiver.track,rtpReceiver:h.receiver})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){M.debug("stopReceiving() [localId:%s]",n);var t=this._mapMidTransceiver.get(n);if(!t)throw new Error("associated RTCRtpTransceiver not found");this._remoteSdp.closeMediaSection(t.mid)}var r={type:"offer",sdp:this._remoteSdp.getSdp()},r=(M.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",r),await this._pc.setRemoteDescription(r),await this._pc.createAnswer());M.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",r),await this._pc.setLocalDescription(r);for(const a of e)this._mapMidTransceiver.delete(a)}async pauseReceiving(e){this.assertRecvDirection();for(const r of e){M.debug("pauseReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="inactive",this._remoteSdp.pauseMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},M.debug("pauseReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();M.debug("pauseReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async resumeReceiving(e){this.assertRecvDirection();for(const r of e){M.debug("resumeReceiving() [localId:%s]",r);var t=this._mapMidTransceiver.get(r);if(!t)throw new Error("associated RTCRtpTransceiver not found");t.direction="recvonly",this._remoteSdp.resumeReceivingMediaSection(r)}e={type:"offer",sdp:this._remoteSdp.getSdp()},M.debug("resumeReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();M.debug("resumeReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async getReceiverStats(e){this.assertRecvDirection();e=this._mapMidTransceiver.get(e);if(e)return e.receiver.getStats();throw new Error("associated RTCRtpTransceiver not found")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i,protocol:r},n=(M.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation(),a={type:"offer",sdp:this._remoteSdp.getSdp()},M.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=Fc.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),M.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||Fc.parse(this._pc.localDescription.sdp);const r=zc.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}v.ReactNativeUnifiedPlan=Wc;var f={},qc=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Kc=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),x=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&qc(t,e,r);return Kc(t,e),t};Object.defineProperty(f,"__esModule",{value:!0}),f.ReactNative=void 0;const Qc=x(p);E=i;const Xc=r,Yc=x(a),Zc=x(c),ed=x(m),td=x(_);p=l;const rd=g,I=new E.Logger("ReactNative"),nd={OS:1024,MIS:1024};class ad extends p.HandlerInterface{static createFactory(){return()=>new ad}constructor(){super(),this._sendStream=new MediaStream,this._mapSendLocalIdTrack=new Map,this._nextSendLocalId=0,this._mapRecvLocalIdInfo=new Map,this._hasDataChannelMediaSection=!1,this._nextSendSctpStreamId=0,this._transportReady=!1}get name(){return"ReactNative"}close(){if(I.debug("close()"),this._sendStream.release(!1),this._pc)try{this._pc.close()}catch(e){}this.emit("@close")}async getNativeRtpCapabilities(){I.debug("getNativeRtpCapabilities()");var t=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b"});try{var e=await t.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});try{t.close()}catch(e){}var r=Qc.parse(e.sdp);return ed.extractRtpCapabilities({sdpObject:r})}catch(e){try{t.close()}catch(e){}throw e}}async getNativeSctpCapabilities(){return I.debug("getNativeSctpCapabilities()"),{numStreams:nd}}run({direction:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,extendedRtpCapabilities:d}){I.debug("run()"),this._direction=e,this._remoteSdp=new rd.RemoteSdp({iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,planB:!0}),this._sendingRtpParametersByKind={audio:Zc.getSendingRtpParameters("audio",d),video:Zc.getSendingRtpParameters("video",d)},this._sendingRemoteRtpParametersByKind={audio:Zc.getSendingRemoteRtpParameters("audio",d),video:Zc.getSendingRemoteRtpParameters("video",d)},n.role&&"auto"!==n.role&&(this._forcedLocalDtlsRole="server"===n.role?"client":"server"),this._pc=new RTCPeerConnection({iceServers:i||[],iceTransportPolicy:s||"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"plan-b",...o},c),this._pc.connectionState?this._pc.addEventListener("connectionstatechange",()=>{this.emit("@connectionstatechange",this._pc.connectionState)}):this._pc.addEventListener("iceconnectionstatechange",()=>{switch(I.warn("run() | pc.connectionState not supported, using pc.iceConnectionState"),this._pc.iceConnectionState){case"checking":this.emit("@connectionstatechange","connecting");break;case"connected":case"completed":this.emit("@connectionstatechange","connected");break;case"failed":this.emit("@connectionstatechange","failed");break;case"disconnected":this.emit("@connectionstatechange","disconnected");break;case"closed":this.emit("@connectionstatechange","closed")}})}async updateIceServers(e){I.debug("updateIceServers()");var t=this._pc.getConfiguration();t.iceServers=e,this._pc.setConfiguration(t)}async restartIce(e){I.debug("restartIce()"),this._remoteSdp.updateIceParameters(e),this._transportReady&&("send"===this._direction?(e=await this._pc.createOffer({iceRestart:!0}),I.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),await this._pc.setLocalDescription(e),e={type:"answer",sdp:this._remoteSdp.getSdp()},I.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",e),await this._pc.setRemoteDescription(e)):(e={type:"offer",sdp:this._remoteSdp.getSdp()},I.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer(),I.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)))}async getTransportStats(){return this._pc.getStats()}async send({track:t,encodings:r,codecOptions:e,codec:n}){this.assertSendDirection(),I.debug("send() [kind:%s, track.id:%s]",t.kind,t.id),n&&I.warn("send() | codec selection is not available in %s handler",this.name),this._sendStream.addTrack(t),this._pc.addStream(this._sendStream);let a=await this._pc.createOffer(),i=Qc.parse(a.sdp),s;var o=Yc.clone(this._sendingRtpParametersByKind[t.kind],{}),n=(o.codecs=Zc.reduceCodecs(o.codecs),Yc.clone(this._sendingRemoteRtpParametersByKind[t.kind],{}));if(n.codecs=Zc.reduceCodecs(n.codecs),this._transportReady||await this.setupTransport({localDtlsRole:null!=(c=this._forcedLocalDtlsRole)?c:"client",localSdpObject:i}),"video"===t.kind&&r&&1<r.length&&(I.debug("send() | enabling simulcast"),i=Qc.parse(a.sdp),s=i.media.find(e=>"video"===e.type),td.addLegacySimulcast({offerMediaObject:s,track:t,numStreams:r.length}),a={type:"offer",sdp:Qc.write(i)}),I.debug("send() | calling pc.setLocalDescription() [offer:%o]",a),await this._pc.setLocalDescription(a),i=Qc.parse(this._pc.localDescription.sdp),s=i.media.find(e=>e.type===t.kind),o.rtcp.cname=ed.getCname({offerMediaObject:s}),o.encodings=td.getRtpEncodings({offerMediaObject:s,track:t}),r)for(let e=0;e<o.encodings.length;++e)r[e]&&Object.assign(o.encodings[e],r[e]);if(1<o.encodings.length&&("video/vp8"===o.codecs[0].mimeType.toLowerCase()||"video/h264"===o.codecs[0].mimeType.toLowerCase()))for(const d of o.encodings)d.scalabilityMode="S1T3";this._remoteSdp.send({offerMediaObject:s,offerRtpParameters:o,answerRtpParameters:n,codecOptions:e});var c={type:"answer",sdp:this._remoteSdp.getSdp()},n=(I.debug("send() | calling pc.setRemoteDescription() [answer:%o]",c),await this._pc.setRemoteDescription(c),String(this._nextSendLocalId));return this._nextSendLocalId++,this._mapSendLocalIdTrack.set(n,t),{localId:n,rtpParameters:o}}async stopSending(e){this.assertSendDirection(),I.debug("stopSending() [localId:%s]",e);var t=this._mapSendLocalIdTrack.get(e);if(!t)throw new Error("track not found");this._mapSendLocalIdTrack.delete(e),this._sendStream.removeTrack(t),this._pc.addStream(this._sendStream);e=await this._pc.createOffer();I.debug("stopSending() | calling pc.setLocalDescription() [offer:%o]",e);try{await this._pc.setLocalDescription(e)}catch(e){if(0===this._sendStream.getTracks().length)return void I.warn("stopSending() | ignoring expected error due no sending tracks: %s",e.toString());throw e}"stable"!==this._pc.signalingState&&(t={type:"answer",sdp:this._remoteSdp.getSdp()},I.debug("stopSending() | calling pc.setRemoteDescription() [answer:%o]",t),await this._pc.setRemoteDescription(t))}async pauseSending(e){}async resumeSending(e){}async replaceTrack(e,t){throw new Xc.UnsupportedError("not implemented")}async setMaxSpatialLayer(e,t){throw new Xc.UnsupportedError("not implemented")}async setRtpEncodingParameters(e,t){throw new Xc.UnsupportedError("not implemented")}async getSenderStats(e){throw new Xc.UnsupportedError("not implemented")}async sendDataChannel({ordered:e,maxPacketLifeTime:t,maxRetransmits:r,label:n,protocol:a}){this.assertSendDirection();var i,e={negotiated:!0,id:this._nextSendSctpStreamId,ordered:e,maxPacketLifeTime:t,maxRetransmitTime:t,maxRetransmits:r,protocol:a},t=(I.debug("sendDataChannel() [options:%o]",e),this._pc.createDataChannel(n,e)),a=(this._nextSendSctpStreamId=++this._nextSendSctpStreamId%nd.MIS,this._hasDataChannelMediaSection||(r=await this._pc.createOffer(),n=(a=Qc.parse(r.sdp)).media.find(e=>"application"===e.type),this._transportReady||await this.setupTransport({localDtlsRole:null!=(i=this._forcedLocalDtlsRole)?i:"client",localSdpObject:a}),I.debug("sendDataChannel() | calling pc.setLocalDescription() [offer:%o]",r),await this._pc.setLocalDescription(r),this._remoteSdp.sendSctpAssociation({offerMediaObject:n}),i={type:"answer",sdp:this._remoteSdp.getSdp()},I.debug("sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setRemoteDescription(i),this._hasDataChannelMediaSection=!0),{streamId:e.id,ordered:e.ordered,maxPacketLifeTime:e.maxPacketLifeTime,maxRetransmits:e.maxRetransmits});return{dataChannel:t,sctpStreamParameters:a}}async receive(e){this.assertRecvDirection();var t,r=[],n=new Map;for(const _ of e){var{trackId:a,kind:i,rtpParameters:s}=_,o=(I.debug("receive() [trackId:%s, kind:%s]",a,i),i),c=_.streamId||s.rtcp.cname;I.debug("receive() | forcing a random remote streamId to avoid well known bug in react-native-webrtc"),c+="-hack-"+Yc.generateRandomNumber(),n.set(a,c),this._remoteSdp.receive({mid:o,kind:i,offerRtpParameters:s,streamId:c,trackId:a})}var d={type:"offer",sdp:this._remoteSdp.getSdp()},d=(I.debug("receive() | calling pc.setRemoteDescription() [offer:%o]",d),await this._pc.setRemoteDescription(d),await this._pc.createAnswer()),p=Qc.parse(d.sdp);for(const v of e){var{kind:l,rtpParameters:u}=v;const y=l;l=p.media.find(e=>String(e.mid)===y);ed.applyCodecParameters({offerRtpParameters:u,answerMediaObject:l})}d={type:"answer",sdp:Qc.write(p)},this._transportReady||await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:p}),I.debug("receive() | calling pc.setLocalDescription() [answer:%o]",d),await this._pc.setLocalDescription(d);for(const w of e){var{kind:h,trackId:m,rtpParameters:f}=w,g=m;const b=n.get(m);m=this._pc.getRemoteStreams().find(e=>e.id===b).getTrackById(g);if(!m)throw new Error("remote track not found");this._mapRecvLocalIdInfo.set(g,{mid:h,rtpParameters:f}),r.push({localId:g,track:m})}return r}async stopReceiving(e){this.assertRecvDirection();for(const n of e){I.debug("stopReceiving() [localId:%s]",n);var{mid:t,rtpParameters:r}=this._mapRecvLocalIdInfo.get(n)||{};this._mapRecvLocalIdInfo.delete(n),this._remoteSdp.planBStopReceiving({mid:t,offerRtpParameters:r})}e={type:"offer",sdp:this._remoteSdp.getSdp()},I.debug("stopReceiving() | calling pc.setRemoteDescription() [offer:%o]",e),await this._pc.setRemoteDescription(e),e=await this._pc.createAnswer();I.debug("stopReceiving() | calling pc.setLocalDescription() [answer:%o]",e),await this._pc.setLocalDescription(e)}async pauseReceiving(e){}async resumeReceiving(e){}async getReceiverStats(e){throw new Xc.UnsupportedError("not implemented")}async receiveDataChannel({sctpStreamParameters:e,label:t,protocol:r}){this.assertRecvDirection();var{streamId:e,ordered:n,maxPacketLifeTime:a,maxRetransmits:i}=e,e={negotiated:!0,id:e,ordered:n,maxPacketLifeTime:a,maxRetransmitTime:a,maxRetransmits:i,protocol:r},n=(I.debug("receiveDataChannel() [options:%o]",e),this._pc.createDataChannel(t,e));return this._hasDataChannelMediaSection||(this._remoteSdp.receiveSctpAssociation({oldDataChannelSpec:!0}),a={type:"offer",sdp:this._remoteSdp.getSdp()},I.debug("receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]",a),await this._pc.setRemoteDescription(a),i=await this._pc.createAnswer(),this._transportReady||(r=Qc.parse(i.sdp),await this.setupTransport({localDtlsRole:null!=(t=this._forcedLocalDtlsRole)?t:"client",localSdpObject:r})),I.debug("receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]",i),await this._pc.setLocalDescription(i),this._hasDataChannelMediaSection=!0),{dataChannel:n}}async setupTransport({localDtlsRole:e,localSdpObject:t}){t=t||Qc.parse(this._pc.localDescription.sdp);const r=ed.extractDtlsParameters({sdpObject:t});r.role=e,this._remoteSdp.updateDtlsRole("client"===e?"server":"client"),await new Promise((e,t)=>{this.safeEmit("@connect",{dtlsParameters:r},e,t)}),this._transportReady=!0}assertSendDirection(){if("send"!==this._direction)throw new Error('method can just be called for handlers with "send" direction')}assertRecvDirection(){if("recv"!==this._direction)throw new Error('method can just be called for handlers with "recv" direction')}}f.ReactNative=ad;var id=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),sd=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),m=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&id(t,e,r);return sd(t,e),t},x=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(oe,"__esModule",{value:!0}),oe.Device=oe.detectDevice=void 0;const od=x(t.exports);_=i;const cd=s,dd=r,pd=m(a),ld=m(c),ud=Si,hd=us,md=ro,fd=fo,gd=Do,_d=Vo,vd=Qo,yd=cc,wd=yc,bd=v,Sd=f,Pd=new _.Logger("Device");function Rd(){if("object"==typeof navigator&&"ReactNative"===navigator.product){if("undefined"!=typeof RTCPeerConnection)return"undefined"!=typeof RTCRtpTransceiver?(Pd.debug("this._detectDevice() | ReactNative UnifiedPlan handler chosen"),"ReactNativeUnifiedPlan"):(Pd.debug("this._detectDevice() | ReactNative PlanB handler chosen"),"ReactNative");Pd.warn("this._detectDevice() | unsupported react-native-webrtc without RTCPeerConnection, forgot to call registerGlobals()?")}else{var e,t,r;if("object"==typeof navigator&&"string"==typeof navigator.userAgent)return r=navigator.userAgent,t=(e=od.default.getParser(r)).getEngine(),e.satisfies({chrome:">=74",chromium:">=74","microsoft edge":">=88"})?"Chrome74":e.satisfies({chrome:">=70",chromium:">=70"})?"Chrome70":e.satisfies({chrome:">=67",chromium:">=67"})?"Chrome67":e.satisfies({chrome:">=55",chromium:">=55"})?"Chrome55":e.satisfies({firefox:">=60"})?"Firefox60":e.satisfies({ios:{OS:">=14.3",firefox:">=30.0"}})||e.satisfies({safari:">=12.0"})&&"undefined"!=typeof RTCRtpTransceiver&&RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")?"Safari12":e.satisfies({safari:">=11"})?"Safari11":e.satisfies({"microsoft edge":">=11"})&&e.satisfies({"microsoft edge":"<=18"})?"Edge11":t.name&&"blink"===t.name.toLowerCase()?!(t=r.match(/(?:(?:Chrome|Chromium))[ /](\w+)/i))||74<=(r=Number(t[1]))?"Chrome74":70<=r?"Chrome70":67<=r?"Chrome67":"Chrome55":void Pd.warn("this._detectDevice() | browser not supported [name:%s, version:%s]",e.getBrowserName(),e.getBrowserVersion());Pd.warn("this._detectDevice() | unknown device")}}oe.detectDevice=Rd;oe.Device=class{constructor({handlerName:e,handlerFactory:t,Handler:r}={}){if(this._loaded=!1,this._observer=new cd.EnhancedEventEmitter,Pd.debug("constructor()"),r){if(Pd.warn("constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead"),"string"!=typeof r)throw new TypeError("non string Handler option no longer supported, use handlerFactory instead");e=r}if(e&&t)throw new TypeError("just one of handlerName or handlerInterface can be given");if(t)this._handlerFactory=t;else{if(e)Pd.debug("constructor() | handler given: %s",e);else{if(!(e=Rd()))throw new dd.UnsupportedError("device not supported");Pd.debug("constructor() | detected handler: %s",e)}switch(e){case"Chrome74":this._handlerFactory=hd.Chrome74.createFactory();break;case"Chrome70":this._handlerFactory=md.Chrome70.createFactory();break;case"Chrome67":this._handlerFactory=fd.Chrome67.createFactory();break;case"Chrome55":this._handlerFactory=gd.Chrome55.createFactory();break;case"Firefox60":this._handlerFactory=_d.Firefox60.createFactory();break;case"Safari12":this._handlerFactory=vd.Safari12.createFactory();break;case"Safari11":this._handlerFactory=yd.Safari11.createFactory();break;case"Edge11":this._handlerFactory=wd.Edge11.createFactory();break;case"ReactNativeUnifiedPlan":this._handlerFactory=bd.ReactNativeUnifiedPlan.createFactory();break;case"ReactNative":this._handlerFactory=Sd.ReactNative.createFactory();break;default:throw new TypeError(`unknown handlerName "${e}"`)}}r=this._handlerFactory();this._handlerName=r.name,r.close(),this._extendedRtpCapabilities=void 0,this._recvRtpCapabilities=void 0,this._canProduceByKind={audio:!1,video:!1},this._sctpCapabilities=void 0}get handlerName(){return this._handlerName}get loaded(){return this._loaded}get rtpCapabilities(){if(this._loaded)return this._recvRtpCapabilities;throw new dd.InvalidStateError("not loaded")}get sctpCapabilities(){if(this._loaded)return this._sctpCapabilities;throw new dd.InvalidStateError("not loaded")}get observer(){return this._observer}async load({routerRtpCapabilities:e}){Pd.debug("load() [routerRtpCapabilities:%o]",e),e=pd.clone(e,void 0);let t;try{if(this._loaded)throw new dd.InvalidStateError("already loaded");ld.validateRtpCapabilities(e);var r=await(t=this._handlerFactory()).getNativeRtpCapabilities();Pd.debug("load() | got native RTP capabilities:%o",r),ld.validateRtpCapabilities(r),this._extendedRtpCapabilities=ld.getExtendedRtpCapabilities(r,e),Pd.debug("load() | got extended RTP capabilities:%o",this._extendedRtpCapabilities),this._canProduceByKind.audio=ld.canSend("audio",this._extendedRtpCapabilities),this._canProduceByKind.video=ld.canSend("video",this._extendedRtpCapabilities),this._recvRtpCapabilities=ld.getRecvRtpCapabilities(this._extendedRtpCapabilities),ld.validateRtpCapabilities(this._recvRtpCapabilities),Pd.debug("load() | got receiving RTP capabilities:%o",this._recvRtpCapabilities),this._sctpCapabilities=await t.getNativeSctpCapabilities(),Pd.debug("load() | got native SCTP capabilities:%o",this._sctpCapabilities),ld.validateSctpCapabilities(this._sctpCapabilities),Pd.debug("load() succeeded"),this._loaded=!0,t.close()}catch(e){throw t&&t.close(),e}}canProduce(e){if(!this._loaded)throw new dd.InvalidStateError("not loaded");if("audio"!==e&&"video"!==e)throw new TypeError(`invalid kind "${e}"`);return this._canProduceByKind[e]}createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d}){return Pd.debug("createSendTransport()"),this.createTransport({direction:"send",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}createRecvTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d}){return Pd.debug("createRecvTransport()"),this.createTransport({direction:"recv",id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:i,iceTransportPolicy:s,additionalSettings:o,proprietaryConstraints:c,appData:d})}createTransport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:p}){if(!this._loaded)throw new dd.InvalidStateError("not loaded");if("string"!=typeof t)throw new TypeError("missing id");if("object"!=typeof r)throw new TypeError("missing iceParameters");if(!Array.isArray(n))throw new TypeError("missing iceCandidates");if("object"!=typeof a)throw new TypeError("missing dtlsParameters");if(i&&"object"!=typeof i)throw new TypeError("wrong sctpParameters");if(p&&"object"!=typeof p)throw new TypeError("if given, appData must be an object");e=new ud.Transport({direction:e,id:t,iceParameters:r,iceCandidates:n,dtlsParameters:a,sctpParameters:i,iceServers:s,iceTransportPolicy:o,additionalSettings:c,proprietaryConstraints:d,appData:p,handlerFactory:this._handlerFactory,extendedRtpCapabilities:this._extendedRtpCapabilities,canProduceByKind:this._canProduceByKind});return this._observer.safeEmit("newtransport",e),e}};var Cd,g={},E={},p=(Object.defineProperty(E,"__esModule",{value:!0}),{});Object.defineProperty(p,"__esModule",{value:!0}),x=g,Cd=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),t=e&&e.__exportStar||function(e,t){for(var r in e)"default"===r||Object.prototype.hasOwnProperty.call(t,r)||Cd(t,e,r)},Object.defineProperty(x,"__esModule",{value:!0}),t(oe,x),t(Si,x),t(Ui,x),t(Bi,x),t(ts,x),t(ss,x),t(E,x),t(p,x),t(l,x),t(r,x),B(g);{i=ti;var Td=e&&e.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r);var a=Object.getOwnPropertyDescriptor(t,r);a&&("get"in a?t.__esModule:!a.writable&&!a.configurable)||(a={enumerable:!0,get:function(){return t[r]}}),Object.defineProperty(e,n,a)}:function(e,t,r,n){e[n=void 0===n?r:n]=t[r]}),Dd=e&&e.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),s=e&&e.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.prototype.hasOwnProperty.call(e,r)&&Td(t,e,r);return Dd(t,e),t},a=e&&e.__importDefault||function(e){return e&&e.__esModule?e:{default:e}},a=(Object.defineProperty(i,"__esModule",{value:!0}),i.debug=i.parseScalabilityMode=i.detectDevice=i.Device=i.version=i.types=void 0,a(n.exports));i.debug=a.default;const Um=oe;Object.defineProperty(i,"Device",{enumerable:!0,get:function(){return Um.Device}}),Object.defineProperty(i,"detectDevice",{enumerable:!0,get:function(){return Um.detectDevice}});var a=s(g),kd=(i.types=a,i.version="3.6.72",Hs);Object.defineProperty(i,"parseScalabilityMode",{enumerable:!0,get:function(){return kd.parse}})}B(ti);var xd={},m={name:"protoo-client",version:"4.0.6",description:"protoo JavaScript client module",author:"Iñaki Baz Castillo <ibc@aliax.net>",homepage:"https://protoo.versatica.com",license:"MIT",repository:{type:"git",url:"https://github.com/ibc/protoo.git"},main:"lib/index.js",keywords:["nodejs","browser","websocket"],engines:{node:">=8.0.0"},scripts:{lint:"eslint -c .eslintrc.js lib"},dependencies:{debug:"^4.3.1",events:"^3.2.0",retry:"^0.12.0"},devDependencies:{eslint:"^5.16.0"},optionalDependencies:{websocket:"^1.0.33"},__npminstall_done:!0,_from:"protoo-client@4.0.6",_resolved:"https://registry.npmmirror.com/protoo-client/-/protoo-client-4.0.6.tgz"};const Ed=n.exports,Od="protoo-client";c=class{constructor(e){e?(this._debug=Ed(Od+":"+e),this._warn=Ed(Od+":WARN:"+e),this._error=Ed(Od+":ERROR:"+e)):(this._debug=Ed(Od),this._warn=Ed(Od+":WARN"),this._error=Ed(Od+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}},us=ce.EventEmitter;const Md=c;class Id extends us{constructor(e){super(),this.setMaxListeners(1/0),this._logger=e||new Md("EnhancedEventEmitter")}safeEmit(t,...e){try{this.emit(t,...e)}catch(e){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",t,e)}}async safeEmitAsPromise(r,...n){return new Promise((e,t)=>{this.safeEmit(r,...n,e,t)})}}ro=Id,fo={generateRandomNumber:function(){return Math.round(1e7*Math.random())}};const Ld=fo["generateRandomNumber"],jd=new c("Message");Do=class{static parse(e){let t;var r={};try{t=JSON.parse(e)}catch(e){return void jd.error("parse() | invalid JSON: %s",e)}if("object"==typeof t&&!Array.isArray(t)){if(t.request){if(r.request=!0,"string"!=typeof t.method)return void jd.error("parse() | missing/invalid method field");if("number"!=typeof t.id)return void jd.error("parse() | missing/invalid id field");r.id=t.id,r.method=t.method,r.data=t.data||{}}else if(t.response){if(r.response=!0,"number"!=typeof t.id)return void jd.error("parse() | missing/invalid id field");r.id=t.id,t.ok?(r.ok=!0,r.data=t.data||{}):(r.ok=!1,r.errorCode=t.errorCode,r.errorReason=t.errorReason)}else{if(!t.notification)return void jd.error("parse() | missing request/response field");if(r.notification=!0,"string"!=typeof t.method)return void jd.error("parse() | missing/invalid method field");r.method=t.method,r.data=t.data||{}}return r}jd.error("parse() | not an object")}static createRequest(e,t){return{request:!0,id:Ld(),method:e,data:t||{}}}static createSuccessResponse(e,t){return{response:!0,id:e.id,ok:!0,data:t||{}}}static createErrorResponse(e,t,r){return{response:!0,id:e.id,ok:!1,errorCode:t,errorReason:r}}static createNotification(e,t){return{notification:!0,method:e,data:t||{}}}},Vo=ro;const Nd=Do,Ad=new c("Peer");class Vd extends Vo{constructor(e){super(Ad),Ad.debug("constructor()"),this._closed=!1,this._transport=e,this._connected=!1,this._data={},this._sents=new Map,this._handleTransport()}get closed(){return this._closed}get connected(){return this._connected}get data(){return this._data}set data(e){throw new Error("cannot override data object")}close(){if(!this._closed){Ad.debug("close()"),this._closed=!0,this._connected=!1,this._transport.close();for(const e of this._sents.values())e.close();this.safeEmit("close")}}async request(e,t=void 0){const a=Nd.createRequest(e,t);return this._logger.debug("request() [method:%s, id:%s]",e,a.id),await this._transport.send(a),new Promise((t,r)=>{var e=1500*(15+.1*this._sents.size);const n={id:a.id,method:a.method,resolve:e=>{this._sents.delete(a.id)&&(clearTimeout(n.timer),t(e))},reject:e=>{this._sents.delete(a.id)&&(clearTimeout(n.timer),r(e))},timer:setTimeout(()=>{this._sents.delete(a.id)&&r(new Error("request timeout"))},e),close:()=>{clearTimeout(n.timer),r(new Error("peer closed"))}};this._sents.set(a.id,n)})}async notify(e,t=void 0){t=Nd.createNotification(e,t);this._logger.debug("notify() [method:%s]",e),await this._transport.send(t)}_handleTransport(){this._transport.closed?(this._closed=!0,setTimeout(()=>{this._closed||(this._connected=!1,this.safeEmit("close"))})):(this._transport.on("open",()=>{this._closed||(Ad.debug('emit "open"'),this._connected=!0,this.safeEmit("open"))}),this._transport.on("disconnected",()=>{this._closed||(Ad.debug('emit "disconnected"'),this._connected=!1,this.safeEmit("disconnected"))}),this._transport.on("failed",e=>{this._closed||(Ad.debug('emit "failed" [currentAttempt:%s]',e),this._connected=!1,this.safeEmit("failed",e))}),this._transport.on("close",()=>{this._closed||(this._closed=!0,Ad.debug('emit "close"'),this._connected=!1,this.safeEmit("close"))}),this._transport.on("message",e=>{e.request?this._handleRequest(e):e.response?this._handleResponse(e):e.notification&&this._handleNotification(e)}))}_handleRequest(r){try{this.emit("request",r,e=>{e=Nd.createSuccessResponse(r,e);this._transport.send(e).catch(()=>{})},(e,t)=>{e instanceof Error?(t=e.message,e=500):"number"==typeof e&&t instanceof Error&&(t=t.message);e=Nd.createErrorResponse(r,e,t);this._transport.send(e).catch(()=>{})})}catch(e){var t=Nd.createErrorResponse(r,500,String(e));this._transport.send(t).catch(()=>{})}}_handleResponse(e){var t,r=this._sents.get(e.id);r?e.ok?r.resolve(e.data):((t=new Error(e.errorReason)).code=e.errorCode,r.reject(t)):Ad.error("received response does not match any sent request [id:%s]",e.id)}_handleNotification(e){this.safeEmit("notification",e)}}Qo=Vd,cc={exports:{}},yc={};function Fd(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}var Bd,Ud,v=Fd;Fd.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts},Fd.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timeouts=[],this._cachedTimeouts=null},Fd.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=(new Date).getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);t=this._timeouts.shift();if(void 0===t){if(!this._cachedTimeouts)return!1;this._errors.splice(this._errors.length-1,this._errors.length),this._timeouts=this._cachedTimeouts.slice(0),t=this._timeouts.shift()}var r=this,e=setTimeout(function(){r._attempts++,r._operationTimeoutCb&&(r._timeout=setTimeout(function(){r._operationTimeoutCb(r._attempts)},r._operationTimeout),r._options.unref)&&r._timeout.unref(),r._fn(r._attempts)},t);return this._options.unref&&e.unref(),!0},Fd.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb)&&(this._operationTimeoutCb=t.cb);var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=(new Date).getTime(),this._fn(this._attempts)},Fd.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},Fd.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},Fd.prototype.start=Fd.prototype.try,Fd.prototype.errors=function(){return this._errors},Fd.prototype.attempts=function(){return this._attempts},Fd.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,n=0;n<this._errors.length;n++){var a=this._errors[n],i=a.message,s=(e[i]||0)+1;r<=(e[i]=s)&&(t=a,r=s)}return t},Ud=v,(Bd=yc).operation=function(e){var t=Bd.timeouts(e);return new Ud(t,{forever:e&&e.forever,unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},Bd.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t,r={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(t in e)r[t]=e[t];if(r.maxTimeout<r.minTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var n=[],a=0;a<r.retries;a++)n.push(this.createTimeout(a,r));return e&&e.forever&&!n.length&&n.push(this.createTimeout(a,r)),n.sort(function(e,t){return e-t}),n},Bd.createTimeout=function(e,t){var r=t.randomize?Math.random()+1:1,r=Math.round(r*t.minTimeout*Math.pow(t.factor,e));return Math.min(r,t.maxTimeout)},Bd.wrap=function(a,i,e){if(i instanceof Array&&(e=i,i=null),!e)for(var t in e=[],a)"function"==typeof a[t]&&e.push(t);for(var r=0;r<e.length;r++){var n=e[r],s=a[n];a[n]=function(e){var t=Bd.operation(i),r=Array.prototype.slice.call(arguments,1),n=r.pop();r.push(function(e){t.retry(e)||(e&&(arguments[0]=t.mainError()),n.apply(this,arguments))}),t.attempt(function(){e.apply(a,r)})}.bind(a,s),a[n].options=i}},B(cc.exports=yc);const zd=$.w3cwebsocket,Hd=cc.exports;f=ro;const Gd=Do,$d={retries:10,factor:2,minTimeout:1e3,maxTimeout:8e3},Jd=new c("WebSocketTransport");class Wd extends f{constructor(e,t){super(Jd),Jd.debug("constructor() [url:%s, options:%o]",e,t),this._closed=!1,this._url=e,this._options=t||{},this._ws=null,this._runWebSocket()}get closed(){return this._closed}close(){if(!this._closed){Jd.debug("close()"),this._closed=!0,this.safeEmit("close");try{this._ws.onopen=null,this._ws.onclose=null,this._ws.onerror=null,this._ws.onmessage=null,this._ws.close()}catch(e){Jd.error("close() | error closing the WebSocket: %o",e)}}}async send(e){if(this._closed)throw new Error("transport closed");try{this._ws.send(JSON.stringify(e))}catch(e){throw Jd.warn("send() failed:%o",e),e}}_runWebSocket(){const r=Hd.operation(this._options.retry||$d);let n=!1;r.attempt(t=>{this._closed?r.stop():(Jd.debug("_runWebSocket() [currentAttempt:%s]",t),this._ws=new zd(this._url,"protoo",this._options.origin,this._options.headers,this._options.requestOptions,this._options.clientConfig),this._ws.onopen=()=>{this._closed||(n=!0,this.safeEmit("open"))},this._ws.onclose=e=>{if(!this._closed){if(Jd.warn('WebSocket "close" event [wasClean:%s, code:%s, reason:"%s"]',e.wasClean,e.code,e.reason),4e3!==e.code){if(n)return r.stop(),this.safeEmit("disconnected"),this._closed?void 0:void this._runWebSocket();if(this.safeEmit("failed",t),this._closed)return;if(r.retry(!0))return}this._closed=!0,this.safeEmit("close")}},this._ws.onerror=()=>{this._closed||Jd.error('WebSocket "error" event')},this._ws.onmessage=e=>{this._closed||(e=Gd.parse(e.data))&&(0===this.listenerCount("message")?Jd.error('no listeners for WebSocket "message" event, ignoring received message'):this.safeEmit("message",e))})})}}_=m.version,Si=Qo,Ui=Wd;xd.version=_,xd.Peer=Si,xd.WebSocketTransport=Ui;const qd="mediasoup-demo";class Kd{constructor(e){e?(this._debug=oi(qd+":"+e),this._warn=oi(qd+":WARN:"+e),this._error=oi(qd+":ERROR:"+e)):(this._debug=oi(qd),this._warn=oi(qd+":WARN"),this._error=oi(qd+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}get debug(){return this._debug}get warn(){return this._warn}get error(){return this._error}}let Qd="8888";"test.mediasoup.org"===window.location.hostname&&(Qd=4443);const Xd=new Kd("e2e");let Yd=void 0,Zd=void 0;function ep(){if(void 0===Yd)if(RTCRtpSender.prototype.createEncodedStreams)try{var e=new ReadableStream;window.postMessage(e,"*",[e]),Zd=new Worker("/resources/js/e2e-worker.js",{name:"e2e worker"}),Xd.debug("isSupported() | supported"),Yd=!0}catch(e){Xd.debug("isSupported() | not supported: "+e),Yd=!1}else Xd.debug("isSupported() | not supported"),Yd=!1;return Yd}function tp(){if(!1===Yd)throw new Error("e2e not supported");if(void 0===Yd)throw new Error("e2e not initialized, must call isSupported() first")}var rp="index-module_process__ODoW8",np="index-module_progress_bar__outer__rPAtx",ap="index-module_tip__Wl6-9",ip="index-module_box__INJYU",sp="index-module_loadingText__33IIf",op="index-module_fail__ohdIh",cp="index-module_success__hMF8Z",dp="index-module_tip1__OjcWh",pp="index-module_loadFailTitle__8aKST",lp="index-module_loadFailText__oedDA",up="index-module_logout__OQjzv",hp="index-module_reload__vRmQ4",mp="index-module_btnGroup__BnLL6",fp="index-module_zhyzPayBox__hHgOJ",gp="index-module_notSupport__cGA2B";Bi=".index-module_progress_bar__plqyh {\n    display: inline-block;\n    width: 300px;\n}\n\n.index-module_process__ODoW8 {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    justify-content: center;\n    align-items: center;\n}\n\n.index-module_progress_bar__outer__rPAtx {\n    background: url('https://minio.smartyunzhou.com/public/loadingGif2.gif');\n    background-size: 100% 100%;\n    background-repeat: no-repeat;\n    width: 270px;\n    height: 250px;\n    padding: 5px;\n    display: inline-block;\n}\n\n.index-module_tip__Wl6-9 {\n    margin-top: 20px;\n    font-style: normal;\n    font-weight: 400;\n    line-height: 21px;\n    text-align: center;\n    letter-spacing: 0.02em;\n    font-family: 'FontName';\n    font-size: 15px;\n    color: #EA913E;\n    letter-spacing: 4px;\n}\n\n.index-module_box__INJYU {\n    text-align: center;\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    z-index: 1;\n    top: 0;\n    /* height: 100vh; */\n    background: rgba(0, 0, 0, 0.6);\n}\n\n.index-module_loadingText__33IIf {\n    font-size: 32px;\n    color: rgb(2, 95, 116);\n    text-transform: uppercase;\n    letter-spacing: 8px;\n    width: 600px;\n    height: 200px;\n    text-align: center;\n    background: #fff;\n    border-radius: 4px;\n    padding-top: 30px;\n}\n\n.index-module_fail__ohdIh {\n    z-index: 1;\n    width: 100%;\n    height: 100%;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background: rgba(0, 0, 0, 0.6);\n}\n\n.index-module_success__hMF8Z {\n    width: 100%;\n    object-fit: fill;\n    width: 100%;\n    height: 100%;\n    position: absolute;\n    top: 0;\n    z-index: 0;\n}\n\n.index-module_tip1__OjcWh {\n    width: 45px;\n    height: 45px;\n    display: inline-block;\n    background-image: url('../image/tip.svg');\n}\n\n.index-module_loadFailTitle__8aKST {\n    font-family: 'PingFang SC';\n    font-style: normal;\n    font-weight: 600;\n    font-size: 14px;\n    line-height: 22px;\n    /* or 157% */\n\n    text-align: center;\n\n    /* Neutral/10强调、正文标题 */\n\n    color: #1D2129;\n}\n\n.index-module_loadFailText__oedDA {\n    font-family: 'PingFang SC';\n    font-style: normal;\n    font-weight: 600;\n    font-size: 12px;\n    line-height: 22px;\n    text-align: center;\n    color: #1D2129;\n}\n\n.index-module_logout__OQjzv,\n.index-module_reload__vRmQ4 {\n    width: 68px;\n    height: 36px;\n    font-family: 'Nunito Sans';\n    font-style: normal;\n    font-weight: 400;\n    font-size: 14px;\n    line-height: 22px;\n    color: #FFFFFF;\n    padding: 8px 20px;\n    margin-top: 20px;\n    cursor: pointer;\n}\n\n.index-module_logout__OQjzv {\n    background: #F2F3F5;\n    color: #1D2129;\n}\n\n.index-module_reload__vRmQ4 {\n    background: #EA913E;\n}\n\n.index-module_btnGroup__BnLL6 {\n    margin-top: 30px;\n}\n.index-module_zhyzPayBox__hHgOJ{\n    width: 100%;\n    flex: 1;\n    position: relative;\n}\n\n.index-module_preload__eawHG{\n    position: absolute;\n    width: 100%;\n    height: 100%;\n    top: 0;\n    right: 0;\n    left: 0;\n    bottom: 0;\n    background-color: #6e7077; \n }\n .index-module_preload__eawHG:before {\n     border-radius: 10px;\n     font-size: 50px;\n     color: #fff;\n       content: '请求云渲染中...';\n       width: 400px;\n       display: block;\n       position: absolute;\n       top: 50%;\n       left: calc(50% - 200px);\n   }\n\n   .index-module_notSupport__cGA2B{\n     display: flex;\n     justify-content: center;\n     align-items: center;\n     width: 100%;\n     height: 100%;\n     font-size: 24px;\n     color: rgb(32, 32, 189);\n   }\n",Ul=(Ul=void 0===Ul?{}:Ul).insertAt,Bi&&"undefined"!=typeof document&&(ts=document.head||document.getElementsByTagName("head")[0],(ss=document.createElement("style")).type="text/css","top"===Ul&&ts.firstChild?ts.insertBefore(ss,ts.firstChild):ts.appendChild(ss),ss.styleSheet?ss.styleSheet.cssText=Bi:ss.appendChild(document.createTextNode(Bi)));const _p={_origin:"https://api.emailjs.com"};const vp=(e,t,r)=>{if(!e)throw"The public key is required. Visit https://dashboard.emailjs.com/admin/account";if(!t)throw"The service ID is required. Visit https://dashboard.emailjs.com/admin";if(r)return!0;throw"The template ID is required. Visit https://dashboard.emailjs.com/admin/templates"};class yp{constructor(e){this.status=e?e.status:0,this.text=e?e.responseText:"Network Error"}}const wp=(e,a,i={})=>new Promise((t,r)=>{const n=new XMLHttpRequest;n.addEventListener("load",({target:e})=>{e=new yp(e);(200===e.status||"OK"===e.text?t:r)(e)}),n.addEventListener("error",({target:e})=>{r(new yp(e))}),n.open("POST",_p._origin+e,!0),Object.keys(i).forEach(e=>{n.setRequestHeader(e,i[e])}),n.send(a)});var bp={init:(e,t="https://api.emailjs.com")=>{_p._userID=e,_p._origin=t},send:(e,t,r,n)=>{n=n||_p._userID,vp(n,e,t),n={lib_version:"3.10.0",user_id:n,service_id:e,template_id:t,template_params:r};return wp("/api/v1.0/email/send",JSON.stringify(n),{"Content-type":"application/json"})},sendForm:(e,t,r,n)=>{n=n||_p._userID,r=(e=>{let t;if((t="string"==typeof e?document.querySelector(e):e)&&"FORM"===t.nodeName)return t;throw"The 3rd parameter is expected to be the HTML form element or the style selector of form"})(r),vp(n,e,t),r=new FormData(r);return r.append("lib_version","3.10.0"),r.append("service_id",e),r.append("template_id",t),r.append("user_id",n),wp("/api/v1.0/email/send-form",r)}};const Sp="file_cache",Pp="SSC2E9WV2Y2FfK_JX",Rp=(e,t)=>{var r=localStorage.getItem(Sp);"failed"==e?"no"!=r&&r||(Cp("yes"),e="template_823ux9e",t={to_name:"郝哲坤",...t=t,roomId:t.roomId,host:t.myhostname},bp.send("service_jz5i5y9",e,t,Pp).then(()=>{Cp("yes")},()=>{Cp("no")})):"yes"==r&&Cp("no")},Cp=e=>{localStorage.setItem(Sp,e)};let Tp=document.createEvent("HTMLEvents");Tp.initEvent(V,!0,!0);const Dp={peerId:"YunZhou"+Date.parse(new Date),displayName:"YunZhou"+Math.round(100*Math.random()),device:function(){var e=navigator.userAgent,e=di.getParser(e);let t;return{flag:t=e.satisfies({chrome:">=0",chromium:">=0"})?"chrome":e.satisfies({firefox:">=0"})?"firefox":e.satisfies({safari:">=0"})?"safari":e.satisfies({opera:">=0"})?"opera":e.satisfies({"microsoft edge":">=0"})?"edge":"unknown",name:e.getBrowserName(),version:e.getBrowserVersion()}}(),handlerName:"micromessenger"==navigator.userAgent.toLowerCase().match(/MicroMessenger/i)?"Safari12":ti.detectDevice(),useSimulcast:!1,useSharingSimulcast:!1,forceTcp:!0,produce:!0,consume:!0,forceH264:!0,forceVP9:!1,svc:"",datachannel:!0,externalVideo:!1,e2eKey:""},kp={optional:[{googDscp:!0}]},L=new Kd("RoomClient");class xp{constructor(e){var{myhostname:e,roomId:t,displayName:r,protooPort:n,ishttps:a,renderEle:i,peerId:s,device:o,handlerName:c,useSimulcast:d,useSharingSimulcast:p,forceTcp:l,produce:u,consume:h,forceH264:m,forceVP9:f,datachannel:g,externalVideo:_,e2eKey:v}=e;this._closed=!1,this.roomId=t,this.ishttps=a||!1,this.myhostname=e,this.renderEle=i,this._displayName=r||Dp.displayName,this._device=o||Dp.device,this._forceTcp=l||Dp.forceTcp,this._produce=u||Dp.produce,this._consume=h||Dp.consume,this._useDataChannel=g||Dp.datachannel,this._forceH264=Boolean(m)||Boolean(Dp.forceH264),this._forceVP9=Boolean(f)||Boolean(Dp.forceVP9),this._externalVideo=null,this._e2eKey=v||Dp.e2eKey,this._externalVideoStream=null,this._nextDataChannelTestNumber=0,_&&(this._externalVideo=document.createElement("video"),this._externalVideo.controls=!0,this._externalVideo.muted=!0,this._externalVideo.loop=!0,this._externalVideo.setAttribute("playsinline",""),this._externalVideo.src=_.src,this._externalVideo.play().catch(e=>L.warn("externalVideo.play() failed:%o",e))),this._handlerName=c||Dp.handlerName,this._useSimulcast=d||Dp.useSimulcast,this._useSharingSimulcast=p||Dp.useSharingSimulcast,this._protooUrl=function(e){var{myhostname:e,roomId:t,peerId:r,protooPort:n,ishttps:a}=e;return`${a?"wss:":"ws:"}//${e}:${Qd=n?n:Qd}/wscloud/?roomId=${t}&peerId=`+r}({myhostname:e,roomId:t,peerId:s||Dp.peerId,protooPort:n,ishttps:this.ishttps}),this._protoo=null,this._mediasoupDevice=null,this._sendTransport=null,this._recvTransport=null,this._micProducer=null,this._webcamProducer=null,this._shareProducer=null,this._chatDataProducer=null,this._botDataProducer=null,this._consumers=new Map,this._dataConsumers=new Map,this._webcams=new Map,this._webcam={device:null,resolution:"hd"},this._e2eKey&&ep()&&(a="setCryptoKey",i=this._e2eKey,r=!0,Xd.debug("setCryptoKey() [operation:%o, useCryptoOffset:%o]",a,r),tp(),Zd.postMessage({operation:a,currentCryptoKey:i,useCryptoOffset:r}))}close(){this._closed||(this._closed=!0,L.debug("close()"),this._protoo.close(),this._sendTransport&&this._sendTransport.close(),this._recvTransport&&this._recvTransport.close())}async join(){var e=new xd.WebSocketTransport(this._protooUrl);this._protoo=new xd.Peer(e),this._protoo.on("open",()=>this._joinRoom()),this._protoo.on("failed",()=>{Rp("failed",{roomId:this.roomId,myhostname:this.myhostname})}),this._protoo.on("disconnected",()=>{this._sendTransport&&(this._sendTransport.close(),this._sendTransport=null),this._recvTransport&&(this._recvTransport.close(),this._recvTransport=null)}),this._protoo.on("close",()=>{this._closed||this.close()}),this._protoo.on("request",async(e,t,r)=>{L.debug('proto "request" event [method:%s, data:%o]',e.method,e.data);var n,a,i=(new Date).valueOf();switch(L.debug("var timestamp = (new Date()).valueOf() = "+i),e.method){case"newConsumer":if(this._consume){var{peerId:s,producerId:o,id:c,kind:d,rtpParameters:p,type:l,appData:u,producerPaused:h}=e.data;L.debug("type"+l+" producerPaused"+h);try{const g=await this._recvTransport.consume({id:c,producerId:o,kind:d,rtpParameters:p,appData:{...u,peerId:s}});ei.commit(Ua,{[this.roomId]:g}),ei.commit(za,{[this.roomId]:this}),this._e2eKey&&ep()&&(n=g.rtpReceiver,Xd.debug("setupReceiverTransform()"),tp(),a=(n=n.createEncodedStreams()).readable||n.readableStream,n=n.writable||n.writableStream,Zd.postMessage({operation:"decode",readableStream:a,writableStream:n},[a,n])),this._consumers.set(g.id,g),g.on("transportclose",()=>{this._consumers.delete(g.id)});var{spatialLayers:m,temporalLayers:f}=ti.parseScalabilityMode(g.rtpParameters.encodings[0].scalabilityMode);L.debug("spatialLayers "+m+"temporalLayers "+f),Rp("success",{roomId:this.roomId,myhostname:this.myhostname}),Tp.data={appli_id:this.roomId},window.dispatchEvent(Tp),t()}catch(e){throw L.error('"newConsumer" request failed:%o',e),e}}else r(403,"I do not want to consume");break;case"newDataConsumer":if(this._consume)if(this._useDataChannel){var{peerId:l,dataProducerId:h,id:c,sctpStreamParameters:o,label:d,protocol:p,appData:u}=e.data;try{const _=await this._recvTransport.consumeData({id:c,dataProducerId:h,sctpStreamParameters:o,label:d,protocol:p,appData:{...u,peerId:l}});this._dataConsumers.set(_.id,_),_.on("transportclose",()=>{this._dataConsumers.delete(_.id)}),_.on("open",()=>{L.debug('DataConsumer "open" event')}),_.on("close",()=>{L.warn('DataConsumer "close" event'),this._dataConsumers.delete(_.id)}),_.on("error",e=>{L.error('DataConsumer "error" event:%o',e)}),_.on("message",e=>{var t;if(L.debug('DataConsumer "message" event [streamId:%d]',_.sctpStreamParameters.streamId),e instanceof ArrayBuffer)return(t=new DataView(e).getUint32())==Math.pow(2,32)-1?(L.warn("dataChannelTest finished!"),void(this._nextDataChannelTestNumber=0)):(t>this._nextDataChannelTestNumber&&L.warn("dataChannelTest: %s packets missing",t-this._nextDataChannelTestNumber),void(this._nextDataChannelTestNumber=t+1));"string"!=typeof e?L.warn('ignoring DataConsumer "message" (not a string)'):_.label}),t()}catch(e){throw L.error('"newDataConsumer" request failed:%o',e),e}}else r(403,"I do not want DataChannels");else r(403,"I do not want to data consume")}}),this._protoo.on("notification",e=>{switch(L.debug('proto "notification" event [method:%s, data:%o]',e.method,e.data),e.method){case"producerScore":var{producerId:t,score:r}=e.data;L.debug("producerId "+t+" score "+r);break;case"newPeer":t=e.data;L.debug("newPeer "+t);break;case"peerClosed":r=e.data["peerId"];L.debug("peerClose "+r);break;case"peerDisplayNameChanged":var{peerId:t,displayName:r,oldDisplayName:n}=e.data;L.debug("peerClose "+t+" displayName "+r+" oldDisplayName"+n);break;case"downlinkBwe":L.debug("'downlinkBwe' event:%o",e.data);break;case"consumerClosed":t=e.data["consumerId"],r=this._consumers.get(t);r&&(r.close(),this._consumers.delete(t),n=r.appData["peerId"],L.debug("peerId "+n));break;case"consumerPaused":t=e.data["consumerId"],r=this._consumers.get(t);r&&r.pause();break;case"consumerResumed":n=e.data["consumerId"],t=this._consumers.get(n);t&&t.resume();break;case"consumerLayersChanged":var{consumerId:r,spatialLayer:n,temporalLayer:t}=e.data;L.debug("spatialLayer "+n+" temporalLayer "+t),this._consumers.get(r);break;case"consumerScore":var{consumerId:n,score:t}=e.data;L.debug("consumerId "+n+" score "+t);break;case"dataConsumerClosed":r=e.data["dataConsumerId"],n=this._dataConsumers.get(r);n&&(n.close(),this._dataConsumers.delete(r),t=n.appData["peerId"],L.debug("peerId"+t));break;case"activeSpeaker":r=e.data["peerId"];L.debug("peerId "+r);break;default:L.error('unknown protoo notification.method "%s"',e.method)}})}async _joinRoom(){L.debug("_joinRoom() this._forceTcp = "+this._forceTcp+", _produce = "+this._produce+", _useDataChannel = "+this._useDataChannel);try{this._mediasoupDevice=new ti.Device({handlerName:this._handlerName});var e,t,r,n,a,i,s,o,c,d,p=await this._protoo.request("getRouterRtpCapabilities"),{}=(await this._mediasoupDevice.load({routerRtpCapabilities:p}),this._produce&&({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a}=await this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!0,consuming:!1,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0}),L.debug("create send transport ---\x3e "),this._sendTransport=this._mediasoupDevice.createSendTransport({id:e,iceParameters:t,iceCandidates:r,dtlsParameters:n,sctpParameters:a,iceServers:[],proprietaryConstraints:kp,additionalSettings:{encodedInsertableStreams:this._e2eKey&&ep()}}),L.debug("send transport on ---\x3e "),this._sendTransport.on("connect",(e,t,r)=>{e=e.dtlsParameters;L.debug("send transport connectWebRtcTransport ^_^ !!! ---\x3e "),this._protoo.request("connectWebRtcTransport",{transportId:this._sendTransport.id,dtlsParameters:e}).then(t).catch(r)}),this._sendTransport.on("produce",async(e,t,r)=>{var{kind:e,rtpParameters:n,appData:a}=e;try{var i=(await this._protoo.request("produce",{transportId:this._sendTransport.id,kind:e,rtpParameters:n,appData:a}))["id"];t({id:i})}catch(e){r(e)}}),L.debug("send _sendTransport on producedata ---\x3e ^_^ !!! ---\x3e "),this._sendTransport.on("producedata",async(e,t,r)=>{var{sctpStreamParameters:e,label:n,protocol:a,appData:i}=e;L.debug('"producedata" event: [sctpStreamParameters:%o, appData:%o]',e,i);try{L.debug("_protoo.request produceData ---\x3e ^_^ !!! ---\x3e ");var s=(await this._protoo.request("produceData",{transportId:this._sendTransport.id,sctpStreamParameters:e,label:n,protocol:a,appData:i}))["id"];t({id:s})}catch(e){r(e)}})),this._consume&&({id:i,iceParameters:s,iceCandidates:o,dtlsParameters:c,sctpParameters:d}=await this._protoo.request("createWebRtcTransport",{forceTcp:this._forceTcp,producing:!1,consuming:!0,sctpCapabilities:this._useDataChannel?this._mediasoupDevice.sctpCapabilities:void 0}),this._recvTransport=this._mediasoupDevice.createRecvTransport({id:i,iceParameters:s,iceCandidates:o,dtlsParameters:c,sctpParameters:d,iceServers:[],additionalSettings:{encodedInsertableStreams:this._e2eKey&&ep()}}),this._recvTransport.on("connect",(e,t,r)=>{e=e.dtlsParameters;this._protoo.request("connectWebRtcTransport",{transportId:this._recvTransport.id,dtlsParameters:e}).then(t).catch(r)})),await this._protoo.request("join",{displayName:this._displayName,device:this._device,rtpCapabilities:this._consume?this._mediasoupDevice.rtpCapabilities:void 0,sctpCapabilities:this._useDataChannel&&this._consume?this._mediasoupDevice.sctpCapabilities:void 0}));this._produce&&(this.enableChatDataProducer(),L.debug(" _sendTransport ----\x3e ^_^ -> connectionstatechange ----\x3e   , <--------\x3e"),this._sendTransport.on("connectionstatechange",e=>{L.debug("%%%% ok ^_^ connectionstatechange ----\x3e  "+e+" , <--------\x3e"),"connected"===e&&this.enableBotDataProducer()}))}catch(e){L.error("_joinRoom() failed:%o",e),"UnsupportedError"===e.name&&(this.renderEle.innerHTML="浏览器不支持,建议使用其他浏览器"),this.renderEle.classList.add(gp)}}async enableChatDataProducer(){if(L.debug("enableChatDataProducer()"),this._useDataChannel)try{this._chatDataProducer=await this._sendTransport.produceData({ordered:!1,maxRetransmits:1,label:"chat",priority:"medium",appData:{info:"my-chat-DataProducer"}}),this._chatDataProducer.on("transportclose",()=>{this._chatDataProducer=null}),this._chatDataProducer.on("open",()=>{L.debug('chat DataProducer "open" event')}),this._chatDataProducer.on("close",()=>{L.error('chat DataProducer "close" event'),this._chatDataProducer=null}),this._chatDataProducer.on("error",e=>{L.error('chat DataProducer "error" event:%o',e)}),this._chatDataProducer.on("bufferedamountlow",()=>{L.debug('chat DataProducer "bufferedamountlow" event')})}catch(e){throw L.error("enableChatDataProducer() | failed:%o",e),e}}async sendMoveMessage(e){if(this._chatDataProducer)try{this._chatDataProducer.send(e)}catch(e){L.error("chat DataProducer.send() failed:%o",e)}}}const Ep={IFrameRequest:0,RequestQualityControl:1,MaxFpsRequest:2,AverageBitrateRequest:3,StartStreaming:4,StopStreaming:5,LatencyTest:6,RequestInitialSettings:7,UIInteraction:50,Command:51,KeyDown:60,KeyUp:61,KeyPress:62,MouseEnter:70,MouseLeave:71,MouseDown:72,MouseUp:73,MouseMove:74,MouseWheel:75,TouchStart:80,TouchEnd:81,TouchMove:82},Op={MainButton:0,AuxiliaryButton:1,SecondaryButton:2,FourthButton:3,FifthButton:4},Mp={PrimaryButton:1,SecondaryButton:2,AuxiliaryButton:4,FourthButton:8,FifthButton:16};function Ip(e){return 112<=e&&e<=123||9===e}const Lp={BackSpace:8,Shift:16,Control:17,Alt:18,RightShift:253,RightControl:254,RightAlt:255};function jp(e){return e.keyCode===Lp.Shift&&"ShiftRight"===e.code?Lp.RightShift:e.keyCode===Lp.Control&&"ControlRight"===e.code?Lp.RightControl:e.keyCode===Lp.Alt&&"AltRight"===e.code?Lp.RightAlt:e.keyCode}var Np=void 0,Ap=void 0;let Vp=0,Fp=0,Bp=1;function Up(t,r){t.onmousemove=function(e){zp(e.offsetX,e.offsetY,e.movementX,e.movementY,r),e.preventDefault()},t.onmousedown=function(e){t.focus(),Hp(e.button,e.offsetX,e.offsetY,r),e.preventDefault()},t.onmouseup=function(e){Gp(e.button,e.offsetX,e.offsetY,r),e.preventDefault()},t.oncontextmenu=function(e){e.preventDefault()},"onmousewheel"in t?t.onmousewheel=function(e){$p(e.wheelDelta,e.offsetX,e.offsetY,r),e.preventDefault()}:t.addEventListener("DOMMouseScroll",function(e){$p(-120*e.detail,e.offsetX,e.offsetY,r),e.preventDefault()},!1),t.pressMouseButtons=function(e){var t,r;t=e.buttons,r=e.offsetX,e=e.offsetY,t&Mp.PrimaryButton&&Hp(Op.MainButton,r,e),t&Mp.SecondaryButton&&Hp(Op.SecondaryButton,r,e),t&Mp.AuxiliaryButton&&Hp(Op.AuxiliaryButton,r,e),t&Mp.FourthButton&&Hp(Op.FourthButton,r,e),t&Mp.FifthButton&&Hp(Op.FifthButton,r,e)},t.releaseMouseButtons=function(e){var t,r;t=e.buttons,r=e.offsetX,e=e.offsetY,t&Mp.PrimaryButton&&Gp(Op.MainButton,r,e),t&Mp.SecondaryButton&&Gp(Op.SecondaryButton,r,e),t&Mp.AuxiliaryButton&&Gp(Op.AuxiliaryButton,r,e),t&Mp.FourthButton&&Gp(Op.FourthButton,r,e),t&Mp.FifthButton&&Gp(Op.FifthButton,r,e)},t.ontouchmove=function(e){Fp=(Bp,zp(e.touches[0].clientX,e.touches[0].clientY,1,1,r),Vp=e.touches[0].clientX,e.touches[0].clientY),e.preventDefault()},t.ontouchstart=function(e){1==(Bp=e.touches.length)?(Gp(2,e.touches[0].clientX,e.touches[0].clientY,r),Hp(0,e.touches[0].clientX,e.touches[0].clientY,r),Vp=e.touches[0].clientX,Fp=e.touches[0].clientY):(Vp=e.touches[0].clientX,Fp=e.touches[0].clientY,Gp(0,Vp,Fp,r),Hp(2,Vp,Fp,r)),e.preventDefault()},t.ontouchend=function(e){Gp(0,Vp,Fp,r),Gp(2,Vp,Fp,r),2==Bp&&Hp(2,Vp,Fp,r),e.preventDefault()}}function zp(e,t,r,n,a){e=Np(e,t),t=Ap(r,n),r=new DataView(new ArrayBuffer(9));r.setUint8(0,Ep.MouseMove),r.setUint16(1,e.x,!0),r.setUint16(3,e.y,!0),r.setInt16(5,t.x,!0),r.setInt16(7,t.y,!0),Jp(r.buffer,a)}function Hp(e,t,r,n){t=Np(t,r),r=new DataView(new ArrayBuffer(6));r.setUint8(0,Ep.MouseDown),r.setUint8(1,e),r.setUint16(2,t.x,!0),r.setUint16(4,t.y,!0),Jp(r.buffer,n)}function Gp(e,t,r,n){t=Np(t,r),r=new DataView(new ArrayBuffer(6));r.setUint8(0,Ep.MouseUp),r.setUint8(1,e),r.setUint16(2,t.x,!0),r.setUint16(4,t.y,!0),Jp(r.buffer,n)}function $p(e,t,r,n){t=Np(t,r),r=new DataView(new ArrayBuffer(7));r.setUint8(0,Ep.MouseWheel),r.setInt16(1,e,!0),r.setUint16(3,t.x,!0),r.setUint16(5,t.y,!0),Jp(r.buffer,n)}function Jp(e,t){ei.state.stream.cc[t]&&ei.state.stream.wc[t].sendMoveMessage(e)}function Wp(e,t){var r,n;e&&(n=t,(r=e).onmouseenter=function(e){var t=new DataView(new ArrayBuffer(1));t.setUint8(0,Ep.MouseEnter),Jp(t.buffer,n),r.pressMouseButtons(e,n)},r.onmouseleave=function(e){var t=new DataView(new ArrayBuffer(1));t.setUint8(0,Ep.MouseLeave),Jp(t.buffer,n),r.releaseMouseButtons(e)})}function qp(e,t,r){var n,a;a=r,(n=e).setAttribute("tabindex","10"),n.focus(),n.onkeydown=function(e){Jp(new Uint8Array([Ep.KeyDown,jp(e),e.repeat]).buffer,a),e.keyCode===Lp.BackSpace&&n.onkeypress({charCode:Lp.BackSpace}),Ip(e.keyCode)&&e.preventDefault()},n.onkeyup=function(e){Jp(new Uint8Array([Ep.KeyUp,jp(e)]).buffer,a),Ip(e.keyCode)&&e.preventDefault()},n.onkeypress=function(e){var t=new DataView(new ArrayBuffer(3));t.setUint8(0,Ep.KeyPress),t.setUint16(1,e.charCode,!0),Jp(t.buffer,a)},Wp(t,r);{var i=e;let n=i;if(n&&0<t.length){i=n.clientHeight/n.clientWidth,t=t[0].videoHeight/t[0].videoWidth;if(t<i){let r=1;Np=(e,t)=>{r=1;e/=n.clientWidth,t=r*(t/n.clientHeight-.5)+.5;return e<0||1<e||t<0||1<t?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*e,y:65536*t}},Ap=(e,t)=>{return{x:32767*(e/(.5*n.clientWidth)),y:32767*(r*t/(.5*n.clientHeight))}}}else{let r=t/i;Np=(e,t)=>{e=(r=1)*(e/n.clientWidth-.5)+.5,t/=n.clientHeight;return e<0||1<e||t<0||1<t?{inRange:!1,x:65535,y:65535}:{inRange:!0,x:65536*e,y:65536*t}},Ap=(e,t)=>{return{x:32767*(r*e/(.5*n.clientWidth)),y:32767*(t/(.5*n.clientHeight))}}}}}Up(e,r)}function Kp(e){return e&&e.Math==Math&&e}function Qp(e){try{return!!e()}catch(e){return!0}}function Xp(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function Yp(e){return Pl(Sl(e),8,-1)}function Zp(e){return null==e}function el(e){if(Dl(e))throw kl("Can't call method on "+e);return e}function tl(e){return xl(El(e))}function rl(e,t){return arguments.length<2?(r=Ll[e],jl(r)?r:void 0):Ll[e]&&Ll[e][t];var r}function nl(t,r){try{Zl(Yl,t,{value:r,configurable:!0,writable:!0})}catch(e){Yl[t]=r}return r}function al(e){return ru(tu(e))}function il(e){return"Symbol("+(void 0===e?"":e)+")_"+ou(++iu+su,36)}function sl(e){return e=wu(e,"string"),bu(e)?e:e+""}function ol(e){if(Iu(e))return e;throw ju(Lu(e)+" is not an object")}function cl(e){return(e=+e)!=e||0==e?0:Rh(e)}function dl(e){return Eh(e.length)}function pl(o){return function(e,t,r){var n,a=Oh(e),i=Ih(a),s=Mh(r,i);if(o&&t!=t){for(;s<i;)if((n=a[s++])!=n)return!0}else for(;s<i;s++)if((o||s in a)&&a[s]===t)return o||s||0;return!o&&-1}}function ll(e,t){return(e=Zh[Yh(e)])==tm||e!=em&&(Qh(t)?Kh(t):!!t)}var ul,hl,ml,fl,gl,_l,vl,E=Kp("object"==typeof globalThis&&globalThis)||Kp("object"==typeof window&&window)||Kp("object"==typeof self&&self)||Kp("object"==typeof e&&e)||function(){return this}()||Function("return this")(),p={},l=!Qp(function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]}),t=!Qp(function(){var e=function(){}.bind();return"function"!=typeof e||e.hasOwnProperty("prototype")}),yl=Function.prototype.call,r=t?yl.bind(yl):function(){return yl.apply(yl,arguments)},x={},oe={}.propertyIsEnumerable,wl=Object.getOwnPropertyDescriptor,s=wl&&!oe.call({1:2},1),g=(x.f=s?function(e){e=wl(this,e);return!!e&&e.enumerable}:oe,t),a=Function.prototype,bl=a.call,Hs=g&&a.bind.bind(bl,bl),i=g?Hs:function(e){return function(){return bl.apply(e,arguments)}},ce=i,Sl=ce({}.toString),Pl=ce("".slice),us=Qp,Rl=Yp,Cl=Object,Tl=i("".split),fo=us(function(){return!Cl("z").propertyIsEnumerable(0)})?function(e){return"String"==Rl(e)?Tl(e,""):Cl(e)}:Cl,Dl=Zp,kl=TypeError,xl=fo,El=el,Vo="object"==typeof document&&document.all,v={all:Vo,IS_HTMLDDA:void 0===Vo&&void 0!==Vo},Ol=v.all,yc=v.IS_HTMLDDA?function(e){return"function"==typeof e||e===Ol}:function(e){return"function"==typeof e},Ml=yc,Il=v.all,cc=v.IS_HTMLDDA?function(e){return"object"==typeof e?null!==e:Ml(e)||e===Il}:function(e){return"object"==typeof e?null!==e:Ml(e)},Ll=E,jl=yc,ro=i({}.isPrototypeOf),Do="undefined"!=typeof navigator&&String(navigator.userAgent)||"",c=E.process,f=E.Deno,m=c&&c.versions||f&&f.version,Qo=m&&m.v8,Nl=(qu=!(qu=Qo?0<(Wu=Qo.split("."))[0]&&Wu[0]<4?1:+(Wu[0]+Wu[1]):qu)&&Do&&(!(Wu=Do.match(/Edge\/(\d+)/))||74<=Wu[1])&&(Wu=Do.match(/Chrome\/(\d+)/))?+Wu[1]:qu,qu),_=Qp,Si=!!Object.getOwnPropertySymbols&&!_(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&Nl&&Nl<41}),Ui=Si&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Al=rl,Vl=yc,Fl=ro,Bl=Object,Ul=Ui?function(e){return"symbol"==typeof e}:function(e){var t=Al("Symbol");return Vl(t)&&Fl(t.prototype,Bl(e))},zl=String,Hl=yc,Gl=function(e){try{return zl(e)}catch(e){return"Object"}},$l=TypeError,Jl=function(e){if(Hl(e))return e;throw $l(Gl(e)+" is not a function")},Wl=Zp,ql=r,Kl=yc,Ql=cc,Xl=TypeError,ts={exports:{}},Yl=E,Zl=Object.defineProperty,ss=nl,Bi="__core-js_shared__",e=E[Bi]||ss(Bi,{}),eu=e,tu=((ts.exports=function(e,t){return eu[e]||(eu[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.27.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.27.2/LICENSE",source:"https://github.com/zloirock/core-js"}),el),ru=Object,nu=al,au=i({}.hasOwnProperty),s=Object.hasOwn||function(e,t){return au(nu(e),t)},oe=i,iu=0,su=Math.random(),ou=oe(1..toString),t=ts.exports,cu=s,a=il,du=Si,g=Ui,pu=E.Symbol,lu=t("wks"),uu=g?pu.for||pu:pu&&pu.withoutSetter||a,hu=r,mu=cc,fu=Ul,gu=function(e,t){e=e[t];return Wl(e)?void 0:Jl(e)},_u=function(e,t){var r,n;if("string"===t&&Kl(r=e.toString)&&!Ql(n=ql(r,e)))return n;if(Kl(r=e.valueOf)&&!Ql(n=ql(r,e)))return n;if("string"!==t&&Kl(r=e.toString)&&!Ql(n=ql(r,e)))return n;throw Xl("Can't convert object to primitive value")},vu=TypeError,yu=function(e){return cu(lu,e)||(lu[e]=du&&cu(pu,e)?pu[e]:uu("Symbol."+e)),lu[e]}("toPrimitive"),wu=function(e,t){if(!mu(e)||fu(e))return e;var r=gu(e,yu);if(r){if(r=hu(r,e,t=void 0===t?"default":t),!mu(r)||fu(r))return r;throw vu("Can't convert object to primitive value")}return _u(e,t=void 0===t?"number":t)},bu=Ul,Hs=cc,Su=E.document,Pu=Hs(Su)&&Hs(Su.createElement),Ru=function(e){return Pu?Su.createElement(e):{}},ce=!l&&!Qp(function(){return 7!=Object.defineProperty(Ru("div"),"a",{get:function(){return 7}}).a}),Cu=r,Tu=x,Du=Xp,ku=tl,xu=sl,Eu=s,Ou=ce,Mu=Object.getOwnPropertyDescriptor,us=(p.f=l?Mu:function(e,t){if(e=ku(e),t=xu(t),Ou)try{return Mu(e,t)}catch(e){}if(Eu(e,t))return Du(!Cu(Tu.f,e,t),e[t])},{}),fo=l&&Qp(function(){return 42!=Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype}),Iu=cc,Lu=String,ju=TypeError,Nu=ce,Au=ol,Vu=sl,Fu=TypeError,Bu=Object.defineProperty,Uu=Object.getOwnPropertyDescriptor,zu="enumerable",Hu="configurable",Gu="writable",Vo=(us.f=l?fo?function(e,t,r){var n;return Au(e),t=Vu(t),Au(r),"function"==typeof e&&"prototype"===t&&"value"in r&&Gu in r&&!r[Gu]&&(n=Uu(e,t))&&n[Gu]&&(e[t]=r.value,r={configurable:(Hu in r?r:n)[Hu],enumerable:(zu in r?r:n)[zu],writable:!1}),Bu(e,t,r)}:Bu:function(e,t,r){if(Au(e),t=Vu(t),Au(r),Nu)try{return Bu(e,t,r)}catch(e){}if("get"in r||"set"in r)throw Fu("Accessors not supported");return"value"in r&&(e[t]=r.value),e},l),$u=us,Ju=Xp,v=Vo?function(e,t,r){return $u.f(e,t,Ju(1,r))}:function(e,t,r){return e[t]=r,e},c={exports:{}},f=l,m=s,Qo=Function.prototype,Do=f&&Object.getOwnPropertyDescriptor,Wu=m(Qo,"name"),qu={EXISTS:Wu,PROPER:Wu&&"something"===function(){}.name,CONFIGURABLE:Wu&&(!f||Do(Qo,"name").configurable)},_=yc,ro=e,Ku=i(Function.toString),ss=(_(ro.inspectSource)||(ro.inspectSource=function(e){return Ku(e)}),ro.inspectSource),Bi=yc,oe=E.WeakMap,Si=Bi(oe)&&/native code/.test(String(oe)),Qu=il,Xu=(0,ts.exports)("keys"),Ui={},Yu=cc,Zu=v,eh=s,t=e,g=function(e){return Xu[e]||(Xu[e]=Qu(e))},a=Ui,th="Object already initialized",rh=E.TypeError,Ul=E.WeakMap,nh=Si||t.state?((ml=t.state||(t.state=new Ul)).get=ml.get,ml.has=ml.has,ml.set=ml.set,ul=function(e,t){if(ml.has(e))throw rh(th);return t.facade=e,ml.set(e,t),t},hl=function(e){return ml.get(e)||{}},function(e){return ml.has(e)}):(a[fl=g("state")]=!0,ul=function(e,t){if(eh(e,fl))throw rh(th);return t.facade=e,Zu(e,fl,t),t},hl=function(e){return eh(e,fl)?e[fl]:{}},function(e){return eh(e,fl)}),Hs={set:ul,get:hl,has:nh,enforce:function(e){return nh(e)?hl(e):ul(e,{})},getterFor:function(t){return function(e){if(Yu(e)&&(e=hl(e)).type===t)return e;throw rh("Incompatible receiver, "+t+" required")}}},r=i,x=Qp,ah=yc,ih=s,sh=l,oh=qu.CONFIGURABLE,ch=ss,dh=Hs.enforce,ph=Hs.get,lh=String,uh=Object.defineProperty,hh=r("".slice),mh=r("".replace),fh=r([].join),gh=sh&&!x(function(){return 8!==uh(function(){},"length",{value:8}).length}),_h=String(String).split("String"),ce=c.exports=function(e,t,r){"Symbol("===hh(lh(t),0,7)&&(t="["+mh(lh(t),/^Symbol\(([^)]*)\)/,"$1")+"]"),r&&r.getter&&(t="get "+t),r&&r.setter&&(t="set "+t),(!ih(e,"name")||oh&&e.name!==t)&&(sh?uh(e,"name",{value:t,configurable:!0}):e.name=t),gh&&r&&ih(r,"arity")&&e.length!==r.arity&&uh(e,"length",{value:r.arity});try{r&&ih(r,"constructor")&&r.constructor?sh&&uh(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}r=dh(e);return ih(r,"source")||(r.source=fh(_h,"string"==typeof t?t:"")),e},vh=(Function.prototype.toString=ce(function(){return ah(this)&&ph(this).source||ch(this)},"toString"),yc),yh=us,wh=c.exports,bh=nl,fo={},Sh=Math.ceil,Ph=Math.floor,Rh=Math.trunc||function(e){e=+e;return(0<e?Ph:Sh)(e)},Ch=cl,Th=Math.max,Dh=Math.min,kh=cl,xh=Math.min,Eh=function(e){return 0<e?xh(kh(e),9007199254740991):0},Oh=tl,Mh=function(e,t){e=Ch(e);return e<0?Th(e+t,0):Dh(e,t)},Ih=dl,Vo={includes:pl(!0),indexOf:pl(!1)},m=i,Lh=s,jh=tl,Nh=Vo.indexOf,Ah=Ui,Vh=m([].push),Fh=function(e,t){var r,n=jh(e),a=0,i=[];for(r in n)!Lh(Ah,r)&&Lh(n,r)&&Vh(i,r);for(;t.length>a;)!Lh(n,r=t[a++])||~Nh(i,r)||Vh(i,r);return i},Bh=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"].concat("length","prototype"),Wu=(fo.f=Object.getOwnPropertyNames||function(e){return Fh(e,Bh)},{}),f=(Wu.f=Object.getOwnPropertySymbols,rl),Uh=fo,zh=Wu,Hh=ol,Gh=i([].concat),Do=f("Reflect","ownKeys")||function(e){var t=Uh.f(Hh(e)),r=zh.f;return r?Gh(t,r(e)):t},$h=s,Jh=Do,Wh=p,qh=us,Kh=Qp,Qh=yc,Xh=/#|\.prototype\./,Yh=ll.normalize=function(e){return String(e).replace(Xh,".").toLowerCase()},Zh=ll.data={},em=ll.NATIVE="N",tm=ll.POLYFILL="P",Qo=E,rm=p.f,nm=v,am=function(e,t,r,n){var a=(n=n||{}).enumerable,i=void 0!==n.name?n.name:t;if(vh(r)&&wh(r,i,n),n.global)a?e[t]=r:bh(t,r);else{try{n.unsafe?e[t]&&(a=!0):delete e[t]}catch(e){}a?e[t]=r:yh.f(e,t,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return e},_=nl,im=function(e,t,r){for(var n=Jh(t),a=qh.f,i=Wh.f,s=0;s<n.length;s++){var o=n[s];$h(e,o)||r&&$h(r,o)||a(e,o,i(t,o))}},sm=ll,om=Yp,cm=Array.isArray||function(e){return"Array"==om(e)},dm=TypeError,pm=Object.getOwnPropertyDescriptor,ro=l&&!function(){if(void 0!==this)return 1;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(e){return e instanceof TypeError}}(),lm=TypeError,um=al,hm=dl,mm=ro?function(e,t){if(cm(e)&&!pm(e,"length").writable)throw dm("Cannot set read only .length");return e.length=t}:function(e,t){return e.length=t},fm=function(e){if(9007199254740991<e)throw lm("Maximum allowed index exceeded");return e},gm={target:"Array",proto:!0,arity:1,forced:Qp(function(){return 4294967297!==[].push.call({length:4294967296},1)})||!function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(e){return e instanceof TypeError}}()},_m={push:function(e){var t=um(this),r=hm(t),n=arguments.length;fm(r+n);for(var a=0;a<n;a++)t[r]=arguments[a],r++;return mm(t,r),r}},vm=gm.target,ym=gm.global,wm=gm.stat,bm=ym?Qo:wm?Qo[vm]||_(vm,{}):(Qo[vm]||{}).prototype;if(bm)for(gl in _m){if(_l=_m[gl],vl=gm.dontCallGetSet?(vl=rm(bm,gl))&&vl.value:bm[gl],!sm(ym?gl:vm+(wm?".":"#")+gl,gm.forced)&&void 0!==vl){if(typeof _l==typeof vl)continue;im(_l,vl)}(gm.sham||vl&&vl.sham)&&nm(_l,"sham",!0),am(bm,gl,_l,gm)}const Sm="/Pac/User/login";let Pm=null,Rm={cache:"no-store",keepalive:!0},Cm={},Tm=[],Dm=!1;const km=e=>"[object Function]"===Object.prototype.toString.call(e),xm=(e,n,a)=>{fetch(Cm.passUrl+e,{...n,headers:{...n.headers,...Rm,"X-Token":Pm}}).then(e=>(Tm.length&&Tm.shift(),e.json())).then(e=>{var t=Cm.event,e=e.data||e,r=n.headers.func_name;r&&(t.data={type:r,data:e},window.dispatchEvent(t)),a&&km(a)&&a(e)}).catch(()=>{a&&km(a)&&a("网络异常,请检查网络后重连")})},j=(e,t,r)=>{var{passUrl:n,username:a,password:i}=Cm;Pm?xm(e,t,r):(Tm.push({url:e,options:t,callback:r}),Dm||(Dm=!0,fetch(""+n+Sm,{method:"post",headers:{"Content-Type":"application/json",func_name:"userLogin"},body:JSON.stringify({loginName:a,password:i})}).then(e=>e.json()).then(e=>{Pm=e.data.accessToken,Tm.forEach(e=>{var{url:e,options:t,callback:r}=e;xm(e,t,r)})}).catch(e=>{console.log("网络异常,请检查网络后重连",e)}).finally(()=>{Dm=!1})))};const Em="InformationMonitoring";let Om=document.createEvent("HTMLEvents");Om.initEvent(Em,!0,!0);class Mm extends class{constructor(){this.appliId=""}setTaskId(e){this.appliId=e}userLogin(e,t){j(Sm,{method:"post",headers:{"Content-Type":"application/json",func_name:"userLogin"},body:JSON.stringify(e)},t)}getUser(e,t){j("/Pac/User/getUser?userId="+e.userId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUser"}},t)}getUserList(e){j("/Pac/User/getUserList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUserList"}},e)}getCloudAppsList(e){j("/Pac/CloudApps/getCloudAppsList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUserList"}},e)}getCloudAppsCloudRender(e,t){j("/Pac/CloudApps/getCloudAppsCloudRender?appliId="+this.appliId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getUserList"},params:e},t)}closeCloudApps(e){j("/Pac/CloudApps/closeCloudApps?appliId="+this.appliId,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"closeCloudApps"}},e)}openCloudApps(e){j("/Pac/CloudApps/openCloudApps?appliId="+this.appliId,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"openCloudApps"}},e)}getAppSceneLoadState(e){j("/Pac/AppScene/getAppSceneLoadState?appliId="+this.appliId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getAppSceneLoadState"}},e)}deleteCloudAgents(e,t){j("/Pac/CloudAgents/deleteCloudAgents",{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteCloudAgents"},body:JSON.stringify({agentId:e.agentId})},t)}getCloudAgentsList(e){j("/Pac/CloudAgents/getCloudAgentsList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getCloudAgentsList"}},e)}getAppSceneList(e){j("/Pac/AppScene/getAppSceneList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getAppSceneList"}},e)}getSceneCloudRender(e,t){j(`/Pac/Scene/getSceneCloudRender?contentId=${e.contentId}&sid=${e.sid}&XToken=`+e.XToken,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getSceneCloudRender"}},t)}getScenePage(e){j("/Pac/Scene/getScenePage",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getScenePage"}},e)}getChildSceneList(e,t){j("/Pac/Scene/getChildSceneList?sid="+e.sid,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getChildSceneList"}},t)}AggregationV4GetFlagList(e,t){j(`/Pac/Rte/Aggregation/V4//get${e.flag}List?tag=${e.tag}&view=`+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"AggregationV4GetFlagList"},params:e},t)}AggregationV4GetFlag(e,t){j(`/Pac/Rte/Aggregation/V4/get${e.flag}?home=${e.home}&id=`+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"AggregationV4GetFlag"},params:e},t)}AggregationV4GetFlagTagList(e,t){j(`/Pac/Rte/Aggregation/V4/get${e.flag}TagList?id=`+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"AggregationV4GetFlagTagList"}},t)}AggregationV4DisplayObject(e,t){j(`/Pac/Rte/Aggregation/V4/setDisplay${e.flag}Object`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4DisplayObject"},body:JSON.stringify(e)},t)}AggregationV4MoveAlongThePath(e,t){j(`/Pac/Rte/Aggregation/V4/set${e.flag}MoveAlongThePath`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4MoveAlongThePath"},body:JSON.stringify(e)},t)}AggregationV4FlagPlus(e,t){j(`/Pac/Rte/Aggregation/V4/set${e.flag}Pulse`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4FlagPlus"},body:JSON.stringify(e)},t)}AggregationV4FlagTag(e,t){j(`/Pac/Rte/Aggregation/V4/set${e.flag}Tag`,{method:"post",headers:{"Content-Type":"application/json",func_name:"AggregationV4FlagTag"},body:JSON.stringify(e)},t)}getPoiTemplate(e,t){j("/Pac/Rte/PoiTemplate/V4/getPoiTemplate?resourceId="+e.resourceId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiTemplate"}},t)}getPoiTemplateList(e){j("/Pac/Rte/PoiTemplate/V4/getPoiTemplateList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiTemplateList"}},e)}addPoi(e,t){j("/Pac/Rte/Poi/V4/addPoi",{method:"post",headers:{"Content-Type":"application/json",func_name:"addPoi"},body:JSON.stringify(e)},t)}deletePoi(e,t){j("/Pac/Rte/Poi/V4/deletePoi?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deletePoi"}},t)}updatePoi(e,t){j("/Pac/Rte/Poi/V4/updatePoi",{method:"put",headers:{"Content-Type":"application/json",func_name:"updatePoi"},body:JSON.stringify(e)},t)}getPoi(e,t){j("/Pac/Rte/Poi/V4/getPoi?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoi"}},t)}getPoiList(e,t){j("/Pac/Rte/Poi/V4/getPoiList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiList"}},t)}getPoiTagList(e,t){j("/Pac/Rte/Poi/V4/getPoiTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPoiTagList"}},t)}setDisplayPoi(e,t){j("/Pac/Rte/Poi/V4/setDisplayPoi",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayPoi"},body:JSON.stringify(e)},t)}setPoiPluse(e,t){j("/Pac/Rte/Poi/V4/setPoiPluse",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPoiPluse"},body:JSON.stringify(e)},t)}setPoiTag(e,t){j("/Pac/Rte/Poi/V4/setPoiTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPoiTag"},body:JSON.stringify(e)},t)}getObjectList(e,t){j("/Pac/Rte/Tag/V4/getObjectList",{method:"post",headers:{"Content-Type":"application/json",func_name:"getObjectList"},body:JSON.stringify(e)},t)}getTagList(e){j("/Pac/Rte/Tag/V4/getTagList",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getTagList"}},e)}setObjectTag(e,t){j("/Pac/Rte/Tag/V4/setObjectTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setObjectTag"},body:JSON.stringify(e)},t)}getContourStyle(e,t){j("/Pac/Rte/ContourStyle/V4/getContourStyle?resourceId="+e.resourceId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourStyle"}},t)}getContourStyleList(e){j("/Pac/Rte/ContourStyle/V4/getContourStyleList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourStyleList"}},e)}addContour(e,t){j("/Pac/Rte/Contour/V4/addContour",{method:"post",headers:{"Content-Type":"application/json",func_name:"addContour"},body:JSON.stringify(e)},t)}getContourList(e,t){j("/Pac/Rte/Contour/V4/getContourList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourList"}},t)}getContourTagList(e,t){j("/Pac/Rte/Contour/V4/getContourTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContourTagList"}},t)}updateContour(e,t){j("/Pac/Rte/Contour/V4/updateContour",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateContour"},body:JSON.stringify(e)},t)}getContour(e,t){j("/Pac/Rte/Contour/V4/getContour?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getContour"}},t)}setContourPluse(e,t){j("/Pac/Rte/Contour/V4/setContourPluse",{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourPluse"},body:JSON.stringify(e)},t)}setContourTag(e,t){j("/Pac/Rte/Contour/V4/setContourTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourTag"},body:JSON.stringify(e)},t)}setContourHight(e,t){j("/Pac/Rte/Contour/V4/setContourWidthHigh",{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourHight"},body:JSON.stringify({dhigh:e.height,id:e.id})},t)}setDisplayContour(e,t){j("/Pac/Rte/Contour/V4/setDisplayContour",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayContour"},body:JSON.stringify(e)},t)}setContourDynamicTexture(e,t){j("/Pac/Rte/Contour/V4/setContourDynamicTexture",{method:"post",headers:{"Content-Type":"application/json",func_name:"setContourDynamicTexture"},body:JSON.stringify(e)},t)}deleteContour(e,t){j("/Pac/Rte/Contour/V4/deleteContour?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/json",func_name:"deleteContour"}},t)}getScene(e,t){j("/Pac/Rte/Scene/V4/getScene?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/json",func_name:"getScene"}},t)}getSceneList(e,t){j("/Pac/Rte/Scene/V4/getSceneList?view="+e.view,{method:"get",headers:{"Content-Type":"application/json",func_name:"getSceneList"}},t)}getArchitecture(e,t){j("/Pac/Rte/Architecture/V4/getArchitecture?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getArchitecture"}},t)}getArchitectureList(e,t){j("/Pac/Rte/Architecture/V4/getArchitectureList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getArchitectureList"}},t)}setDispersedArchitecture(e,t){j("/Pac/Rte/Architecture/V4/setDispersedArchitecture",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDispersedArchitecture"},body:JSON.stringify(e)},t)}setDisplayArchitecture(e,t){j("/Pac/Rte/Architecture/V4/setDisplayArchitecture",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayArchitecture"},body:JSON.stringify(e)},t)}setHighlightArchitecture(e,t){j("/Pac/Rte/Architecture/V4/setHighlightArchitecture",{method:"post",headers:{"Content-Type":"application/json",func_name:"setHighlightArchitecture"},body:JSON.stringify(e)},t)}deleteDataPannel(e,t){j("/Pac/Rte/DataPannel/V4/deleteDataPannel?id="+e.id,{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteDataPannel"}},t)}addDataPannel(e,t){j("/Pac/Rte/DataPannel/V4/addDataPannel",{method:"post",headers:{"Content-Type":"application/json",func_name:"addDataPannel"},body:JSON.stringify(e)},t)}setDataPannelToward(e,t){j("/Pac/Rte/DataPannel/V4/setDataPannelAlwaysFaceScreen",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelToward"},body:JSON.stringify(e)},t)}setDataPannelUrl(e,t){j("/Pac/Rte/DataPannel/V4/setDataPannelUrl",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelUrl"},body:JSON.stringify(e)},t)}setDataPannelVisibleDistance(e,t){j("/Pac/Rte/DataPannel/V4/setDataPannelVisibleDistance",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelVisibleDistance"},body:JSON.stringify(e)},t)}getDataPannelList(e,t){j("/Pac/Rte/DataPannel/V4/getDataPannelList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getDataPannelList"}},t)}getDataPannel(e,t){j("/Pac/Rte/DataPannel/V4/getDataPannel?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getDataPannel"}},t)}updateDataPannel(e,t){j("/Pac/Rte/DataPannel/V4/updateDataPannel",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateDataPannel"},body:JSON.stringify(e)},t)}getDataPannelTagList(e,t){j("/Pac/Rte/DataPannel/V4/getDataPannelTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getDataPannelTagList"}},t)}setDataPannelTag(e,t){j("/Pac/Rte/DataPannel/V4/setDataPannelTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDataPannelTag"},body:JSON.stringify(e)},t)}setDisplayDataPannel(e,t){j("/Pac/Rte/DataPannel/V4/setDisplayDataPannel",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayDataPannel"},body:JSON.stringify(e)},t)}addHeatMap(e,t){j("/Pac/Rte/HeatMap/V4/addHeatMap",{method:"post",headers:{"Content-Type":"application/json",func_name:"addHeatMap"},body:JSON.stringify(e)},t)}addPathHeatMap(e,t){j("/Pac/Rte/HeatMap/V4/addPathHeatMap",{method:"post",headers:{"Content-Type":"application/json",func_name:"addPathHeatMap"},body:JSON.stringify(e)},t)}getHeatMapList(e,t){j("/Pac/Rte/HeatMap/V4/getHeatMapList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHeatMapList"}},t)}getHeatMapTagList(e,t){j("/Pac/Rte/HeatMap/V4/getHeatMapTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHeatMapTagList"}},t)}getHeatMap(e,t){j("/Pac/Rte/HeatMap/V4/getHeatMap?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHeatMap"}},t)}updateHeatMap(e,t){j("/Pac/Rte/HeatMap/V4/updateHeatMap",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateHeatMap"},body:JSON.stringify(e)},t)}setDisplayHeatMap(e,t){j("/Pac/Rte/HeatMap/V4/setDisplayHeatMap",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayHeatMap"},body:JSON.stringify(e)},t)}setHeatMapTag(e,t){j("/Pac/Rte/HeatMap/V4/setHeatMapTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setHeatMapTag"},body:JSON.stringify(e)},t)}setPathHeatMapWidthHigh(e,t){j("/Pac/Rte/HeatMap/V4/setPathHeatMapWidthHigh",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathHeatMapWidthHigh"},body:JSON.stringify(e)},t)}deleteHeatMap(e,t){j("/Pac/Rte/HeatMap/V4/deleteHeatMap?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteHeatMap"}},t)}getEffectTemplate(e,t){j("/Pac/Rte/EffectTemplate/V4/getEffectTemplate?resourceId="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectTemplate"}},t)}getEffectTemplateList(e){j("/Pac/Rte/EffectTemplate/V4/getEffectTemplateList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectTemplateList"}},e)}addEffect(e,t){j("/Pac/Rte/Effect/V4/addEffect",{method:"post",headers:{"Content-Type":"application/json",func_name:"addEffect"},body:JSON.stringify(e)},t)}updateEffect(e,t){j("/Pac/Rte/Effect/V4/updateEffect",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateEffect"},body:JSON.stringify(e)},t)}getEffect(e,t){j("/Pac/Rte/Effect/V4/getEffect?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffect"}},t)}getEffectList(e,t){j("/Pac/Rte/Effect/V4/getEffectList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectList"}},t)}setDisplayEffect(e,t){j("/Pac/Rte/Effect/V4/setDisplayEffect",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayEffect"},body:JSON.stringify(e)},t)}setEffectMoveAlongThePath(e,t){j("/Pac/Rte/Effect/V4/setEffectMoveAlongThePath",{method:"post",headers:{"Content-Type":"application/json",func_name:"setEffectMoveAlongThePath"},body:JSON.stringify(e)},t)}setEffectPluse(e,t){j("/Pac/Rte/Effect/V4/setEffectPluse",{method:"post",headers:{"Content-Type":"application/json",func_name:"setEffectPluse"},body:JSON.stringify(e)},t)}setEffectTag(e,t){j("/Pac/Rte/Effect/V4/setEffectTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setEffectTag"},body:JSON.stringify(e)},t)}getEffectTagList(e,t){j("/Pac/Rte/Effect/V4/getEffectTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getEffectTagList"}},t)}deleteEffect(e,t){j("/Pac/Rte/Effect/V4/deleteEffect?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteEffect"}},t)}addViewPath(e,t){j("/Pac/Rte/SceneViewPath/V4/addSceneViewPath",{method:"post",headers:{"Content-Type":"application/json",func_name:"addViewPath"},body:JSON.stringify(e)},t)}updateViewPath(e,t){j("/Pac/Rte/SceneViewPath/V4/updateSceneViewPath",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateViewPath"},body:JSON.stringify(e)},t)}getViewPathList(e,t){j(`/Pac/Rte/SceneViewPath/V4/getSceneViewPathList?tag=${e.tag}&view=`+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPathList"}},t)}getViewPath(e,t){j("/Pac/Rte/SceneViewPath/V4/getSceneViewPath?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPath"}},t)}getViewPathTagList(e,t){j("/Pac/Rte/SceneViewPath/V4/getSceneViewPathTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPathTagList"}},t)}playViewPath(e,t){j("/Pac/Rte/SceneViewPath/V4/playSceneViewPath",{method:"post",headers:{"Content-Type":"application/json",func_name:"playViewPath"},body:JSON.stringify(e)},t)}setViewPathTag(e,t){j("/Pac/Rte/SceneViewPath/V4/setSceneViewPathTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setViewPathTag"},body:JSON.stringify(e)},t)}deleteViewPath(e,t){j("/Pac/Rte/SceneViewPath/V4/deleteSceneViewPath?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteViewPath"}},t)}getViewPointList(e){j("/Pac/Rte/SceneViewPoint/V4/getSceneViewPointList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPointList"}},e)}getViewPoint(e,t){j("/Pac/Rte/SceneViewPoint/V4/getSceneViewPoint?home="+e.home,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getViewPoint"}},t)}setDefaultViewPoint(e,t){j("/Pac/Rte/SceneViewPoint/V4/setDefaultSceneViewPoint",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDefaultViewPoint"},body:JSON.stringify(e)},t)}updateViewPoint(e,t){j("/Pac/Rte/SceneViewPoint/V4/updateSceneViewPoint",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateViewPoint"},body:JSON.stringify(e)},t)}moveAlongThePath(e,t){j("/Pac/Rte/SceneViewPoint/V4/setSceneViewPointMoveAlongThePath",{method:"post",headers:{"Content-Type":"application/json",func_name:"moveAlongThePath"},body:JSON.stringify(e)},t)}getVideoPannelList(e,t){j("/Pac/Rte/VideoPannel/V4/getVideoPannelList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getVideoPannelList"}},t)}getVideoPannel(e,t){j("/Pac/Rte/VideoPannel/V4/getVideoPannel?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getVideoPannel"}},t)}getAreaVideoPannelList(e,t){j("/Pac/Rte/VideoPannel/V4/getAreaVideoPannelList",{method:"post",headers:{"Content-Type":"application/json",func_name:"getAreaVideoPannelList"},body:JSON.stringify(e)},t)}getVideoPannelTagList(e,t){j("/Pac/Rte/VideoPannel/V4/getVideoPannelTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getVideoPannelTagList"}},t)}updateVideoPannel(e,t){j("/Pac/Rte/VideoPannel/V4/updateVideoPannel",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateVideoPannel"},body:JSON.stringify(e)},t)}setDisplayVideoPannel(e,t){j("/Pac/Rte/VideoPannel/V4/setDisplayVideoPannel",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayVideoPannel"},body:JSON.stringify(e)},t)}setVideoPannelMoveAlongThePath(e,t){j("/Pac/Rte/VideoPannel/V4/setVideoPannelMoveAlongThePath",{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelMoveAlongThePath"},body:JSON.stringify(e)},t)}setVideoPannelPlay(e,t){j("/Pac/Rte/VideoPannel/V4/setVideoPannelPlay",{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelPlay"},body:JSON.stringify(e)},t)}setVideoPannelSource(e,t){j("/Pac/Rte/VideoPannel/V4/setVideoPannelSource",{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelSource"},body:JSON.stringify(e)},t)}setVideoPannelTag(e,t){j("/Pac/Rte/VideoPannel/V4/setVideoPannelTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setVideoPannelTag"},body:JSON.stringify(e)},t)}getPathStyleList(e){j("/Pac/Rte/PathBrowserStyle/V4/getPathBrowserStyleList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathStyleList"}},e)}getPathBrowserStyle(e,t){j("/Pac/Rte/PathBrowserStyle/V4/getPathBrowserStyle?resourceId="+e.resourceId,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathBrowserStyle"}},t)}getPathList(e,t){j("/Pac/Rte/PathBrowser/V4/getPathBrowserList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathList"}},t)}getPath(e,t){j("/Pac/Rte/PathBrowser/V4/getPathBrowser?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPath"}},t)}updatePath(e,t){j("/Pac/Rte/PathBrowser/V4/updatePathBrowser",{method:"put",headers:{"Content-Type":"application/json",func_name:"updatePath"},body:JSON.stringify(e)},t)}addPath(e,t){j("/Pac/Rte/PathBrowser/V4/addPathBrowser",{method:"post",headers:{"Content-Type":"application/json",func_name:"addPath"},body:JSON.stringify(e)},t)}getPathTagList(e,t){j("/Pac/Rte/PathBrowser/V4/getPathBrowserTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getPathTagList"}},t)}setDisplayPath(e,t){j("/Pac/Rte/PathBrowser/V4/setDisplayPathBrowser",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayPath"},body:JSON.stringify(e)},t)}setPathDynamicTexture(e,t){j("/Pac/Rte/PathBrowser/V4/setPathBrowserDynamicTexture",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathDynamicTexture"},body:JSON.stringify(e)},t)}setPathPulse(e,t){j("/Pac/Rte/PathBrowser/V4/setPathBrowserPulse",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathPulse"},body:JSON.stringify(e)},t)}setPathTag(e,t){j("/Pac/Rte/PathBrowser/V4/setPathBrowserTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathTag"},body:JSON.stringify(e)},t)}setPathWidth(e,t){j("/Pac/Rte/PathBrowser/V4/setPathBrowserWidthHigh",{method:"post",headers:{"Content-Type":"application/json",func_name:"setPathWidth"},body:JSON.stringify({id:e.id,dwidth:e.width})},t)}deletePath(e,t){j("/Pac/Rte/PathBrowser/V4/deletePathBrowser?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deletePath"}},t)}getGeneralModelTemplate(e,t){j("/Pac/Rte/GeneralModelTemplate/V4/getGeneralModelTemplate?resourceId="+encodeURIComponent(e.resourceId),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelTemplate"}},t)}getGeneralModelTemplateList(e){j("/Pac/Rte/GeneralModelTemplate/V4/getGeneralModelTemplateList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelTemplateList"}},e)}addGeneralModel(e,t){j("/Pac/Rte/GeneralModel/V4/addGeneralModel",{method:"post",headers:{"Content-Type":"application/json",func_name:"addGeneralModel"},body:JSON.stringify(e)},t)}updateGeneralModel(e,t){j("/Pac/Rte/GeneralModel/V4/updateGeneralModel",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateGeneralModel"},body:JSON.stringify(e)},t)}getGeneralModel(e,t){j("/Pac/Rte/GeneralModel/V4/getGeneralModel?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelList"}},t)}getGeneralModelList(e,t){j("/Pac/Rte/GeneralModel/V4/getGeneralModelList?view="+e.view,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelList"}},t)}getGeneralModelTagList(e,t){j("/Pac/Rte/GeneralModel/V4/getGeneralModelTagList?id="+encodeURIComponent(e.id),{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getGeneralModelTagList"}},t)}setDisplayGeneralModel(e,t){j("/Pac/Rte/GeneralModel/V4/setDisplayGeneralModel",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayGeneralModel"},body:JSON.stringify(e)},t)}setGeneralModelMoveAlongThePath(e,t){j("/Pac/Rte/GeneralModel/V4/setGeneralModelMoveAlongThePath",{method:"post",headers:{"Content-Type":"application/json",func_name:"setGeneralModelMoveAlongThePath"},body:JSON.stringify(e)},t)}setGeneralModelTag(e,t){j("/Pac/Rte/GeneralModel/V4/setGeneralModelTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setGeneralModelTag"},body:JSON.stringify(e)},t)}deleteGeneralModel(e,t){j("/Pac/Rte/GeneralModel/V4/deleteGeneralModel?id="+encodeURIComponent(e.id),{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteGeneralModel"}},t)}addHighlightArea(e,t){j("/Pac/Rte/HighlightArea/V4/addHighlightArea",{method:"post",headers:{"Content-Type":"application/json",func_name:"addHighlightArea"},body:JSON.stringify(e)},t)}deleteHighlightArea(e,t){j("/Pac/Rte/HighlightArea/V4/deleteHighlightArea?id="+e.id,{method:"delete",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"deleteHighlightArea"}},t)}updateHighlightArea(e,t){j("/Pac/Rte/HighlightArea/V4/updateHighlightArea",{method:"put",headers:{"Content-Type":"application/json",func_name:"updateHighlightArea"},body:JSON.stringify(e)},t)}getHighlightArea(e,t){j("/Pac/Rte/HighlightArea/V4/getHighlightArea?id="+e.id,{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHighlightArea"}},t)}getHighlightAreaList(e,t){j("/Pac/Rte/HighlightArea/V4/getHighlightAreaList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHighlightAreaList"},params:e},t)}getHighlightAreaTagList(e,t){j("/Pac/Rte/HighlightArea/V4/getHighlightAreaTagList",{method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"getHighlightAreaTagList"},params:e},t)}setDisplayHighlightArea(e,t){j("/Pac/Rte/HighlightArea/V4/setDisplayHighlightArea",{method:"post",headers:{"Content-Type":"application/json",func_name:"setDisplayHighlightArea"},body:JSON.stringify(e)},t)}setHighlightAreaTag(e,t){j("/Pac/Rte/HighlightArea/V4/setHighlightAreaTag",{method:"post",headers:{"Content-Type":"application/json",func_name:"setHighlightAreaTag"},body:JSON.stringify(e)},t)}displayObject(e,t){j("/Pac/Rte/Project/V4/displayObject",{method:"post",headers:{"Content-Type":"application/json",func_name:"displayObject"},body:JSON.stringify(e)},t)}locationSceneObject(e,t){j("/Pac/Rte/Project/V4/locationSceneObject?objectId="+e.objectId,{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"locationSceneObject"}},t)}quitProject(e,t){j("/Pac/Rte/Project/V4/quitProject",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"quitProject"},body:JSON.stringify(e)},t)}saveProject(e){j("/Pac/Rte/Project/V4/saveProject",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"saveProject"}},e)}setLoLaLine(e,t){j("/Pac/Rte/Project/V4/setLoLaLine",{method:"post",headers:{"Content-Type":"application/json",func_name:"setLoLaLine"},body:JSON.stringify(e)},t)}setMoveObject(e,t){j("/Pac/Rte/Project/V4/setMoveObject",{method:"post",headers:{"Content-Type":"application/json",func_name:"setMoveObject"},body:JSON.stringify(e)},t)}setSurround(e,t){j("/Pac/Rte/Project/V4/setSurround",{method:"post",headers:{"Content-Type":"application/json",func_name:"setSurround"},body:JSON.stringify(e)},t)}switchCallback(e,t){j("/Pac/Rte/Project/V4/switchCallback",{method:"post",headers:{"Content-Type":"application/json",func_name:"switchCallback"},body:JSON.stringify(e)},t)}switchProjectScene(e,t){j("/Pac/Rte/Project/V4/switchProjectScene",{method:"post",headers:{"Content-Type":"application/x-www-form-urlencoded",func_name:"switchProjectScene"},body:`projectId=${encodeURIComponent(e.projectId)}&sceneId=`+encodeURIComponent(e.sceneId)},t)}}{constructor(t,r,n){var a,i=e=>super[e],e=3<arguments.length&&void 0!==arguments[3]&&arguments[3],e=(super(),(a=this).url=t,this.username=r,this.password=n,this.appliId="",this.dropFn=null,this.logoutFn=null,this.process=0,this.protooPort="",this.height="80vh",this.ishttps=e,this.videoEle=null,(async()=>{var e;return e={event:Om,passUrl:t,username:r,password:n},Cm=e,delete this.then,this})());this.then=e.then.bind(e),this.renderEle=e=>{let t=null,r=!0;var n;ei.state.stream.cc[this.appliId]?((t=new MediaStream).addTrack(ei.state.stream.cc[this.appliId].track),(n=e.getElementsByTagName("video")[0]).srcObject=t,n.autofocus="autofocus",n.preload="auto",n.playsInline=!0,n.webkitPlaysinline=!0,n.x5VideoPlayerType="h5",n.x5VideoPlayerFullscreen=!0,n.x5VideoOrientation="portraint",n.className=cp,this.videoEle=n,setTimeout(()=>{qp(e,e.getElementsByTagName("video"),this.appliId),window.addEventListener("resize",()=>{qp(e,e.getElementsByTagName("video"),this.appliId)})},2e3),setTimeout(()=>{qp(e,e.getElementsByTagName("video"),this.appliId),window.addEventListener("resize",()=>{qp(e,e.getElementsByTagName("video"),this.appliId)})},4e3),n.addEventListener("dragover",e=>{e.preventDefault()}),n.addEventListener("drop",e=>{r=!0,super.switchCallback({coordinate:!0,pixelPoint:!0},()=>{zp(e.offsetX,e.offsetY,0,0,this.appliId),Hp(0,e.offsetX,e.offsetY,this.appliId),Gp(0,e.offsetX,e.offsetY,this.appliId)})}),this.dropFn&&(n=`${this.ishttps?"wss":"ws"}://${(this.ishttps?this.url.split("https://"):this.url.split("http://"))[1]}websocket/`+(this.appliId+100*Math.random()),new WebSocket(n).onmessage=e=>{r&&this.dropFn&&(this.dropFn({type:"drop",...JSON.parse(e.data).PICKPOINT}),r=!1)})):this.setRenderStatus(e,A)},this.setRenderStatus=(e,t)=>{var r;t==N?e.innerHTML=`
                <div class="${ip}">
                <div class="${rp}">
                <div class=${np}>
                </div>
                <div class="${ap}">孪生世界正在加载中[${this.process}%] , 请稍等...</div>
                </div>
                </div> 
              `:t==A&&(e.style.display="inline-block",e.innerHTML=`
                <div class=${op}>
                <div class=${sp}>
                  <div >
                    <span class=${dp} ></span>
                  </div>
                  <div class=${pp}>加载失败</div>
                  <div class=${lp}>抱歉,由于当前场景加载失败,无法正常体验</div>
                  <div class=${mp}>
                    <span class=${up} id="zhyz_logout" style="display: ${this.logoutFn?"inline":"none"}">退出</span>
                    <span class=${hp} id="zhyz_reload">刷新</span>
                  </div>
                </div> 
                </div>
              `,t=document.getElementById("zhyz_reload"),r=document.getElementById("zhyz_logout"),t&&(t.onclick=()=>{super.closeCloudApps({appliId:this.appliId},()=>{super.openCloudApps({appliId:this.appliId})}),this.joinRoom({ele:e,roomId:this.appliId,myhostname:this.myhostname,protooPort:this.protooPort,displayName:this.username})}),r)&&(r.onclick=()=>{this.logoutFn&&this.logoutFn()})},this.setLoading=(e,t)=>{e=(e=>{if("string"==typeof e)try{var t=JSON.parse(e);return"object"==typeof t&&t?t:{}}catch(e){return{}}console.log("It is not a string!")})(e.data),e=e.LOADPROJECT_PROCESS||{};let r=null;(e.result&&e.process||null==e.result&&e.process)&&(r=e.process?e.process.toFixed(0):0,this.process=r),100<=r?(this.process=100,this.setRenderStatus(t,N),setTimeout(()=>{t.style.display="none",t.style.zIndex="0",ei.state.stream.cc[this.appliId](this.appliId)||this.setRenderStatus(t,A)},1e3)):!r&&0!=r||(t.style.display="inline-block",t.style.zIndex="2",this.setRenderStatus(t,N))},this.ws=null,this.socketServe=null,this.myhostname=null,this.handleResponseFunction=t=>{var e=this.url.replace("http://","ws://").replace("https://","wss://")+"/websocket/"+this.appliId;this.ws=new WebSocket(e),this.ws.onopen=()=>{console.log("ws连接状态："+this.ws.readyState)},this.ws.onmessage=e=>{console.log("接收到来自服务器的消息："),t(e.data)},this.ws.onclose=()=>{console.log("ws连接状态："+this.ws.readyState)},this.ws.onerror=function(e){console.log(e)}},this.RegisterCloudResponse=t=>{window.addEventListener(Em,e=>{t(e.data)})},this.playVideo=e=>{this.videoEle&&this.videoEle.play(),e(this.videoEle)},this.registerWebscoket=t=>{var e=`${this.ishttps?"wss":"ws"}://${(this.ishttps?this.url.split("https://"):this.url.split("http://"))[1]}websocket/`+this.appliId+Math.random();this.socketServe=new J(e,e=>{t(e)})},this.closeWebscoket=e=>{e(JSON.stringify({msg:"关闭长连接"})),this.socketServe.websocketclose()},this.enlarge=e=>{$p(120,e.offsetX||0,e.offsetY||0,this.appliId)},this.narrow=e=>{$p(-120,e.offsetX||0,e.offsetY||0,this.appliId)},this.backToOrigin=()=>{var e=new DataView(new ArrayBuffer(3));e.setUint8(0,62),e.setUint16(1,32,!0),Jp(e.buffer,this.appliId)},this.joinRoom=(t,e)=>{var r={ele:t.ele,roomId:t.appliId,myhostname:t.myhostname,protooPort:t.protooPort,displayName:this.username};t.protooPort&&(r.protooPort=t.protooPort,this.protooPort=t.protooPort),this.appliId=t.appliId,super.setTaskId(t.appliId),a={"App-TaskId":t.appliId},Rm={...Rm,...a};let n=document.createElement("div");var a=navigator.userAgent,i=t.ele.getElementsByTagName("video")[0];"micromessenger"==a.toLowerCase().match(/MicroMessenger/i)&&a.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?i.controls=!0:(i.muted=!0,i.autoplay=!0),n.id="cloudrender-loading",t.ele.classList.add(fp),0!=t.ele.parentNode.clientHeight&&(this.height=t.ele.parentNode.clientHeight+"px"),t.ele.style.height=this.height,t.ele.insertBefore(n,null),this.myhostname=t.myhostname;{a={...r,ishttps:this.ishttps,renderEle:t.ele};let e="";a.protooPort&&(e=a.protooPort);var{roomId:a,myhostname:i,displayName:r,ishttps:s,renderEle:o}=a;new xp({myhostname:i,roomId:a,displayName:r,protooPort:e,ishttps:s,renderEle:o}).join()}i=`${this.ishttps?"wss":"ws"}://${(this.ishttps?this.url.split("https://"):this.url.split("http://"))[1]}websocket/`+(this.appliId+100*Math.random());let c=new WebSocket(i);c.onmessage=e=>{this.setLoading(e,n,c)},c.onerror=e=>{console.log("连接失败",e)},window.onload=()=>{n.style.display="none",n.style.zIndex="0"},window.addEventListener(V,e=>{e.data.appli_id==this.appliId&&this.renderEle(t.ele)}),e&&e(c)},this.registerDropFn=e=>{e&&(this.dropFn=e)},this.registerLogoutFn=e=>{e&&(this.logoutFn=e)},this.RtAPI=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];a[t[0]]?a[t[0]](t[1],t[2]):i(t[0]).call(a,t[1],t[2])}}}return window.CloudRender=Mm});
